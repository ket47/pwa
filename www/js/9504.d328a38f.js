"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[9504],{7123:function(e,l,t){t.r(l),t.d(l,{default:function(){return O}});var s=t(641),a=t(33);const i=e=>((0,s.Qi)("data-v-7ab95bba"),e=e(),(0,s.jt)(),e),o={key:0},u={key:1},n=i((()=>(0,s.Lk)("p",null,"Анкета пользователя активна.",-1))),r=["href"],d=["href"],_={slot:"end",style:{"font-size":"10px",width:"7em"}},m={slot:"end",style:{"font-size":"10px",width:"7em"}},h={slot:"end",style:{"font-size":"10px",width:"7em"}},p={slot:"end",style:{"font-size":"10px",width:"7em"}},c={slot:"end",style:{"font-size":"10px",width:"7em"}},b={key:2};function f(e,l,t,i,f,k){const v=(0,s.g2)("ion-title"),g=(0,s.g2)("ion-toolbar"),F=(0,s.g2)("ion-header"),y=(0,s.g2)("ion-input"),I=(0,s.g2)("ion-item"),C=(0,s.g2)("ion-button"),V=(0,s.g2)("ion-content"),$=(0,s.g2)("ion-modal"),O=(0,s.g2)("ion-card-content"),w=(0,s.g2)("ion-card"),W=(0,s.g2)("ion-icon"),U=(0,s.g2)("ion-chip"),A=(0,s.g2)("ion-toggle"),x=(0,s.g2)("ion-label"),X=(0,s.g2)("ion-item-divider"),G=(0,s.g2)("ion-checkbox"),D=(0,s.g2)("ion-list"),L=(0,s.g2)("ion-accordion"),q=(0,s.g2)("ion-accordion-group"),P=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(P,{"page-title":"Пользователь",pageDefaultBackLink:"/user"},{default:(0,s.k6)((()=>{var e;return[(0,s.bF)($,{"is-open":f.isAddPromoOpen,"initial-breakpoint":.75,breakpoints:[0,.75,1]},{default:(0,s.k6)((()=>[(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,null,{default:(0,s.k6)((()=>[(0,s.eW)("Добавление скидки")])),_:1})])),_:1})])),_:1}),(0,s.bF)(V,{class:"ion-padding"},{default:(0,s.k6)((()=>[(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{label:"Название скидки","label-placement":"stacked",type:"text",modelValue:f.promo_name,"onUpdate:modelValue":l[0]||(l[0]=e=>f.promo_name=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{label:"Сумма скидки","label-placement":"stacked",type:"text",modelValue:f.promo_value,"onUpdate:modelValue":l[1]||(l[1]=e=>f.promo_value=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{label:"Минимальный заказ","label-placement":"stacked",type:"text",modelValue:f.promo_minsum,"onUpdate:modelValue":l[2]||(l[2]=e=>f.promo_minsum=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{label:"Срок жизни дней","label-placement":"stacked",type:"num",modelValue:f.promo_lifetime,"onUpdate:modelValue":l[3]||(l[3]=e=>f.promo_lifetime=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,{lines:"none"}),(0,s.bF)(C,{onClick:l[4]||(l[4]=e=>k.promoCreate()),expand:"block"},{default:(0,s.k6)((()=>[(0,s.eW)("Создать")])),_:1}),(0,s.bF)(C,{onClick:l[5]||(l[5]=e=>f.isAddPromoOpen=0),color:"light",expand:"block"},{default:(0,s.k6)((()=>[(0,s.eW)("Закрыть")])),_:1})])),_:1})])),_:1},8,["is-open"]),null==f.user?((0,s.uX)(),(0,s.CE)("div",o)):null!==(e=f.user)&&void 0!==e&&e.user_id?((0,s.uX)(),(0,s.CE)("div",u,[k.message?((0,s.uX)(),(0,s.Wv)(w,{key:0,lines:"none"},{default:(0,s.k6)((()=>[(0,s.bF)(O,{class:(0,a.C4)(k.messageClass)},{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(k.message),1)])),_:1},8,["class"])])),_:1})):((0,s.uX)(),(0,s.Wv)(w,{key:1,lines:"none"},{default:(0,s.k6)((()=>[(0,s.bF)(O,{style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,s.k6)((()=>[n,f.user.user_phone?((0,s.uX)(),(0,s.Wv)(U,{key:0,color:"primary"},{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.callOutline},null,8,["src"]),(0,s.Lk)("a",{href:`tel:+${f.user.user_phone}`},"+"+(0,a.v_)(f.user.user_phone),9,r)])),_:1})):(0,s.Q3)("",!0),f.user.user_email?((0,s.uX)(),(0,s.Wv)(U,{key:1,color:"primary"},{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.mailOutline},null,8,["src"]),(0,s.Lk)("a",{href:`mailto:${f.user.user_email}`},(0,a.v_)(f.user.user_email),9,d)])),_:1})):(0,s.Q3)("",!0)])),_:1})])),_:1})),(0,s.Lk)("form",{onChange:l[17]||(l[17]=(...e)=>k.updateUser&&k.updateUser(...e))},[(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.trashOutline,color:"primary",slot:"start"},null,8,["src"]),(0,s.eW)(" Удалено "),(0,s.bF)(A,{slot:"end",modelValue:f.is_deleted,"onUpdate:modelValue":l[6]||(l[6]=e=>f.is_deleted=e),color:"danger",onIonChange:l[7]||(l[7]=e=>k.itemDelete(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.closeOutline,color:"primary",slot:"start"},null,8,["src"]),(0,s.eW)(" Заблокировано "),(0,s.bF)(A,{slot:"end",modelValue:f.is_disabled,"onUpdate:modelValue":l[8]||(l[8]=e=>f.is_disabled=e),onIonChange:l[9]||(l[9]=e=>k.itemDisable(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,s.bF)(X,null,{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)("Основные настройки")])),_:1})])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{modelValue:f.user.user_phone,"onUpdate:modelValue":l[10]||(l[10]=e=>f.user.user_phone=e),name:"user_phone",placeholder:"Телефон",label:"Телефон","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(G,{modelValue:f.user.user_phone_verified,"onUpdate:modelValue":l[11]||(l[11]=e=>f.user.user_phone_verified=e),name:"user_phone_verified",onClick:l[12]||(l[12]=e=>k.updateUserDelayed({target:{name:"user_phone_verified"}}))},{default:(0,s.k6)((()=>[(0,s.eW)("Телефон подтвержден")])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{modelValue:f.user.user_email,"onUpdate:modelValue":l[13]||(l[13]=e=>f.user.user_email=e),name:"user_email",placeholder:"Емаил",label:"почта","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{modelValue:f.user.user_name,"onUpdate:modelValue":l[14]||(l[14]=e=>f.user.user_name=e),name:"user_name",placeholder:"Имя",label:"Имя","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{modelValue:f.user.user_birthday,"onUpdate:modelValue":l[15]||(l[15]=e=>f.user.user_birthday=e),name:"user_birthday",placeholder:"День рождения",label:"День рождения","label-placement":"stacked",type:"datetime-local"},null,8,["modelValue"])])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)("Регистрация")])),_:1}),(0,s.Lk)("p",_,(0,a.v_)(f.user.created_at),1)])),_:1}),(0,s.bF)(I,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)("Последний вход")])),_:1}),(0,s.Lk)("p",m,(0,a.v_)(f.user.signed_in_at),1)])),_:1}),(0,s.bF)(I,{lines:"full",onClick:l[16]||(l[16]=e=>{k.itemSignInById(f.user.user_id)}),button:"",color:"warning"},{default:(0,s.k6)((()=>[(0,s.bF)(W,{icon:i.enterOutline,slot:"start"},null,8,["icon"]),(0,s.eW)(" Войти как "+(0,a.v_)(f.user.user_name),1)])),_:1})])),_:1})],32),(0,s.bF)(X,null,{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)("Дополнително")])),_:1})])),_:1}),(0,s.bF)(q,null,{default:(0,s.k6)((()=>[(0,s.bF)(L,null,{default:(0,s.k6)((()=>[(0,s.bF)(I,{slot:"header"},{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>{var e;return[(0,s.eW)("Пуш подписки "+(0,a.v_)((null===(e=f.user_push_subs)||void 0===e?void 0:e.length)||0),1)]})),_:1})])),_:1}),(0,s.bF)(D,{slot:"content"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(f.user_push_subs,(e=>((0,s.uX)(),(0,s.Wv)(I,{key:e.sub_id},{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(e.platform)+" / "+(0,a.v_)(e.mobile||e.browser),1)])),_:2},1024),(0,s.Lk)("p",h,(0,a.v_)(e.created_at),1)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,s.bF)(L,null,{default:(0,s.k6)((()=>[(0,s.bF)(I,{slot:"header"},{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>{var e;return[(0,s.eW)("Скидки "+(0,a.v_)((null===(e=f.promo_list)||void 0===e?void 0:e.length)||0),1)]})),_:1})])),_:1}),(0,s.bF)(D,{slot:"content"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(f.promo_list,(e=>((0,s.uX)(),(0,s.Wv)(I,{key:e.promo_id},{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.checkmarkOutline,color:"success",slot:"start"},null,8,["src"]),(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(e.promo_name)+" / "+(0,a.v_)(e.promo_value)+" / "+(0,a.v_)(e.promo_share)+"%",1)])),_:2},1024),(0,s.Lk)("p",p,(0,a.v_)(e.expired_at),1)])),_:2},1024)))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(f.promo_list_expired,(e=>((0,s.uX)(),(0,s.Wv)(I,{key:e.promo_id},{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.closeOutline,color:"danger",slot:"start"},null,8,["src"]),(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(e.promo_name)+" / "+(0,a.v_)(e.promo_value)+" / "+(0,a.v_)(e.promo_share)+"%",1)])),_:2},1024),(0,s.Lk)("p",c,(0,a.v_)(e.expired_at),1)])),_:2},1024)))),128)),(0,s.bF)(I,{button:"",onClick:l[18]||(l[18]=e=>f.isAddPromoOpen=1)},{default:(0,s.k6)((()=>[(0,s.bF)(W,{src:i.addOutline,slot:"start"},null,8,["src"]),(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.eW)("Добавить скидку")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])):((0,s.uX)(),(0,s.CE)("div",b))]})),_:1})}var k=t(5654),v=t(5480),g=t(2311),F=t.n(g),y=t(5538),I=t(8701),C={components:{IonInput:k.$w,IonCard:k.b_,IonCardContent:k.I9,IonLabel:k.he,IonItem:k.uz,IonButton:k.Jm,IonList:k.nf,IonCheckbox:k.eY,IonItemDivider:k.Dg,IonToggle:k.BY,IonIcon:k.iq,IonAccordion:k.xk,IonAccordionGroup:k.YH,IonModal:k.Sb,IonHeader:k.eU,IonContent:k.W9,IonToolbar:k.ai,IonTitle:k.BC,IonChip:k.ZB},setup(){return{enterOutline:v.b9o,addOutline:v.EKF,trashOutline:v.P1A,searchOutline:v.jBE,documentTextOutline:v.pXZ,checkmarkOutline:v.g1L,closeOutline:v.xfX,callOutline:v.bNN,mailOutline:v.SM1}},data(){var e,l;return{managed_user_id:null===(e=this.$route)||void 0===e||null===(l=e.query)||void 0===l?void 0:l.user_id,user:null,user_push_subs:null,promo_list:null,promo_list_expired:null,promo_name:null,promo_value:null,promo_minsum:null,promo_lifetime:null,isAdmin:I.A.isAdmin(),isAddPromoOpen:0,is_deleted:0,is_disabled:0}},ionViewDidEnter(){var e,l,t,s;this.managed_user_id!=(null===(e=this.$route)||void 0===e||null===(l=e.query)||void 0===l?void 0:l.user_id)&&(this.managed_user_id=null===(t=this.$route)||void 0===t||null===(s=t.query)||void 0===s?void 0:s.user_id,this.itemGet())},mounted(){this.itemGet()},computed:{message(){var e,l;return null!==(e=this.user)&&void 0!==e&&e.deleted_at?"Пользователь удален":1==(null===(l=this.user)||void 0===l?void 0:l.is_disabled)?"Пользователь заблокирован":null},messageClass(){var e,l;return null!==(e=this.user)&&void 0!==e&&e.deleted_at?"deleted":1==(null===(l=this.user)||void 0===l?void 0:l.is_disabled)?"disabled":null}},methods:{async itemGet(){if(0==this.managed_user_id){const e=await this.itemGetCreate();if(!e)return;this.managed_user_id=e}if(this.managed_user_id>0)try{this.user=await F().post(`${y.A.state.hostname}User/itemGet`,{user_id:this.managed_user_id}),this.user_push_subs=await F().post(`${y.A.state.hostname}MessageSub/listGet`,{user_id:this.managed_user_id}),this.promo_list=await F().post(`${y.A.state.hostname}Promo/listGet`,{user_id:this.managed_user_id,type:"active"}),this.promo_list_expired=await F().post(`${y.A.state.hostname}Promo/listGet`,{user_id:this.managed_user_id,type:"expired"})}catch(e){this.$flash("Не удалось загрузить пользователя")}else this.user={};this.itemParseFlags()},itemParseFlags(){this.user&&(this.is_deleted=null==this.user.deleted_at?0:1,this.is_disabled=0==this.user.is_disabled?0:1)},async itemGetCreate(){const e=prompt("Телефон нового пользователя");if(!e)return void setTimeout((()=>this.$go("/admin/list-moderation")),200);const l={name_query_fields:"user_phone",name_query:e,limit:1},t=await F().post(`${y.A.state.hostname}User/listGet`,l);if(t&&t[0])return t[0].user_id;const s={user_phone:e,user_name:"новый пользователь"};return this.itemCreate(s)},async itemCreate(e){try{return await F().post(`${y.A.state.hostname}User/itemCreate`,e)}catch(l){let e="unknown";try{const t=Object.keys(JSON.parse(l.responseJSON.messages.error))[0],s=Object.values(JSON.parse(l.responseJSON.messages.error))[0];e=t+"_"+s}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_required":this.$flash("Пароль обязателен для заполнения");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break;default:this.$flash("Не удалось зарегистрироваться")}return 0}},async itemDelete(e){if(!confirm("Вы уверены?"))return;const l=e?"itemDelete":"itemUnDelete";try{await F().post(y.A.state.hostname+"user/"+l,{user_id:this.user.user_id}),this.user.deleted_at=e?1:null}catch{}this.itemGet()},async itemDisable(e){if(this.user.is_disabled!=e)try{await F().post(y.A.state.hostname+"User/itemDisable",{user_id:this.user.user_id,is_disabled:e}),this.user.is_disabled=e}catch{this.itemGet()}},async itemSignInById(e){if(!confirm(`Войти в профиль пользователя ${this.user.user_name}?`))return;this.$flash("Выходим из админ профиля");const l={user_id:e};await F().post(`${y.A.state.hostname}User/signInById`,l),await this.$go("/")},async updateUser(e){const l=e.target.name,t=this.user[l],s={user_id:this.user.user_id,[l]:t};try{await F().post(y.A.state.hostname+"User/itemUpdate",JSON.stringify(s)),this.$flash("Сохранено")}catch(a){this.$flash("Ошибка сохранения"),this.itemGet()}},async updateUserDelayed(e){setTimeout((()=>this.updateUser(e)),200)},async promoCreate(){const e=100*this.promo_value/this.promo_minsum,l={owner_id:this.managed_user_id,promo_name:this.promo_name,promo_value:this.promo_value,promo_share:e,promo_lifetime:this.promo_lifetime};this.promo_lifetime&&this.promo_name&&this.promo_value&&!(this.promo_value>this.promo_minsum)?(await F().post(y.A.state.hostname+"Promo/itemCreate",l),this.isAddPromoOpen=0,this.$flash("Скидка создана"),this.itemGet()):this.$flash("Проверьте форму!")}}},V=t(6262);const $=(0,V.A)(C,[["render",f],["__scopeId","data-v-7ab95bba"]]);var O=$}}]);
//# sourceMappingURL=9504.d328a38f.js.map