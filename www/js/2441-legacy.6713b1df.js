(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2441],{9587:function(e,t,o){var i=o(614),r=o(111),l=o(7674);e.exports=function(e,t,o){var n,u;return l&&i(n=t.constructor)&&n!==o&&r(u=n.prototype)&&u!==o.prototype&&l(e,u),e}},7850:function(e,t,o){var i=o(111),r=o(4326),l=o(5112),n=l("match");e.exports=function(e){var t;return i(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==r(e))}},2626:function(e,t,o){var i=o(3070).f;e.exports=function(e,t,o){o in e||i(e,o,{configurable:!0,get:function(){return t[o]},set:function(e){t[o]=e}})}},4706:function(e,t,o){var i=o(6916),r=o(2597),l=o(7976),n=o(7066),u=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in u||r(e,"flags")||!l(u,e)?t:i(n,e)}},4603:function(e,t,o){var i=o(9781),r=o(7854),l=o(1702),n=o(4705),u=o(9587),d=o(8880),a=o(8006).f,c=o(7976),s=o(7850),p=o(1340),m=o(4706),_=o(2999),h=o(2626),g=o(8052),f=o(7293),k=o(2597),w=o(9909).enforce,I=o(6340),v=o(5112),y=o(9441),W=o(7168),b=v("match"),U=r.RegExp,C=U.prototype,O=r.SyntaxError,D=l(C.exec),V=l("".charAt),G=l("".replace),$=l("".indexOf),L=l("".slice),x=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,j=/a/g,Z=/a/g,q=new U(j)!==j,P=_.MISSED_STICKY,z=_.UNSUPPORTED_Y,S=i&&(!q||P||y||W||f((function(){return Z[b]=!1,U(j)!=j||U(Z)==Z||"/a/i"!=U(j,"i")}))),M=function(e){for(var t,o=e.length,i=0,r="",l=!1;i<=o;i++)t=V(e,i),"\\"!==t?l||"."!==t?("["===t?l=!0:"]"===t&&(l=!1),r+=t):r+="[\\s\\S]":r+=t+V(e,++i);return r},F=function(e){for(var t,o=e.length,i=0,r="",l=[],n={},u=!1,d=!1,a=0,c="";i<=o;i++){if(t=V(e,i),"\\"===t)t+=V(e,++i);else if("]"===t)u=!1;else if(!u)switch(!0){case"["===t:u=!0;break;case"("===t:D(x,L(e,i+1))&&(i+=2,d=!0),r+=t,a++;continue;case">"===t&&d:if(""===c||k(n,c))throw new O("Invalid capture group name");n[c]=!0,l[l.length]=[c,a],d=!1,c="";continue}d?c+=t:r+=t}return[r,l]};if(n("RegExp",S)){for(var T=function(e,t){var o,i,r,l,n,a,_=c(C,this),h=s(e),g=void 0===t,f=[],k=e;if(!_&&h&&g&&e.constructor===T)return e;if((h||c(C,e))&&(e=e.source,g&&(t=m(k))),e=void 0===e?"":p(e),t=void 0===t?"":p(t),k=e,y&&"dotAll"in j&&(i=!!t&&$(t,"s")>-1,i&&(t=G(t,/s/g,""))),o=t,P&&"sticky"in j&&(r=!!t&&$(t,"y")>-1,r&&z&&(t=G(t,/y/g,""))),W&&(l=F(e),e=l[0],f=l[1]),n=u(U(e,t),_?this:C,T),(i||r||f.length)&&(a=w(n),i&&(a.dotAll=!0,a.raw=T(M(e),o)),r&&(a.sticky=!0),f.length&&(a.groups=f)),e!==k)try{d(n,"source",""===k?"(?:)":k)}catch(I){}return n},E=a(U),Y=0;E.length>Y;)h(T,U,E[Y++]);C.constructor=T,T.prototype=C,g(r,"RegExp",T,{constructor:!0})}I("RegExp")},8450:function(e,t,o){var i=o(9781),r=o(9441),l=o(4326),n=o(7045),u=o(9909).get,d=RegExp.prototype,a=TypeError;i&&r&&n(d,"dotAll",{configurable:!0,get:function(){if(this!==d){if("RegExp"===l(this))return!!u(this).dotAll;throw a("Incompatible receiver, RegExp required")}}})},3123:function(e,t,o){"use strict";var i=o(2104),r=o(6916),l=o(1702),n=o(7007),u=o(7850),d=o(9670),a=o(4488),c=o(6707),s=o(1530),p=o(7466),m=o(1340),_=o(8173),h=o(1589),g=o(7651),f=o(2261),k=o(2999),w=o(7293),I=k.UNSUPPORTED_Y,v=4294967295,y=Math.min,W=[].push,b=l(/./.exec),U=l(W),C=l("".slice),O=!w((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var o="ab".split(e);return 2!==o.length||"a"!==o[0]||"b"!==o[1]}));n("split",(function(e,t,o){var l;return l="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,o){var l=m(a(this)),n=void 0===o?v:o>>>0;if(0===n)return[];if(void 0===e)return[l];if(!u(e))return r(t,l,e,n);var d,c,s,p=[],_=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),g=0,k=new RegExp(e.source,_+"g");while(d=r(f,k,l)){if(c=k.lastIndex,c>g&&(U(p,C(l,g,d.index)),d.length>1&&d.index<l.length&&i(W,p,h(d,1)),s=d[0].length,g=c,p.length>=n))break;k.lastIndex===d.index&&k.lastIndex++}return g===l.length?!s&&b(k,"")||U(p,""):U(p,C(l,g)),p.length>n?h(p,0,n):p}:"0".split(void 0,0).length?function(e,o){return void 0===e&&0===o?[]:r(t,this,e,o)}:t,[function(t,o){var i=a(this),n=void 0==t?void 0:_(t,e);return n?r(n,t,i,o):r(l,m(i),t,o)},function(e,i){var r=d(this),n=m(e),u=o(l,r,n,i,l!==t);if(u.done)return u.value;var a=c(r,RegExp),_=r.unicode,h=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(I?"g":"y"),f=new a(I?"^(?:"+r.source+")":r,h),k=void 0===i?v:i>>>0;if(0===k)return[];if(0===n.length)return null===g(f,n)?[n]:[];var w=0,W=0,b=[];while(W<n.length){f.lastIndex=I?0:W;var O,D=g(f,I?C(n,W):n);if(null===D||(O=y(p(f.lastIndex+(I?W:0)),n.length))===w)W=s(n,W,_);else{if(U(b,C(n,w,W)),b.length===k)return b;for(var V=1;V<=D.length-1;V++)if(U(b,D[V]),b.length===k)return b;W=w=O}}return U(b,C(n,w)),b}]}),!O,I)},7327:function(e,t,o){"use strict";o.d(t,{Z:function(){return p}});var i=o(6252),r=o(3577);const l=(0,i.Uk)("Просмотр фотографии");function n(e,t,o,n,u,d){const a=(0,i.up)("ion-title"),c=(0,i.up)("ion-icon"),s=(0,i.up)("ion-toolbar"),p=(0,i.up)("ion-header"),m=(0,i.up)("ion-button"),_=(0,i.up)("ion-col"),h=(0,i.up)("ion-row"),g=(0,i.up)("ion-grid"),f=(0,i.up)("ion-img"),k=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[l])),_:1}),(0,i.Wm)(c,{icon:n.closeOutline,onClick:t[0]||(t[0]=e=>{n.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[o.actions?((0,i.wg)(),(0,i.j4)(g,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.actions,((e,t)=>((0,i.wg)(),(0,i.j4)(_,{key:t},{default:(0,i.w5)((()=>{var o;return[e[0]?((0,i.wg)(),(0,i.j4)(m,{key:0,onClick:o=>d.actionCreate(t,e[1]),expand:"block",color:null!==(o=e[1])&&void 0!==o?o:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e[0]),1)])),_:2},1032,["onClick","color"])):(0,i.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{src:e.$heap.state.hostname+"image/get.php/"+o.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var u=o(8903),d=o(8292),a={props:["image_hash","actions"],components:{IonIcon:d.gu,IonToolbar:d.sr,IonHeader:d.Gu,IonImg:d.Xz,IonContent:d.W2,IonTitle:d.wd,IonButton:d.YG,IonCol:d.wI,IonRow:d.Nd,IonGrid:d.jY},setup(){const e=function(){d.Fy.dismiss()};return{closeModal:e,closeOutline:u.fID}},methods:{actionCreate(e,t){("danger"!=t||confirm("Вы уверены?"))&&d.Fy.dismiss(null,e)}}},c=o(3744);const s=(0,c.Z)(a,[["render",n]]);var p=s},2226:function(e,t,o){"use strict";o.d(t,{Z:function(){return b}});var i=o(6252),r=o(3577);const l=(0,i.Uk)("Фотографии"),n={key:0,class:"image_grid"},u=["onClick"],d={key:0},a={key:1},c={key:0,class:"image_controls"},s=["id"];function p(e,t,o,p,m,_){var h;const g=(0,i.up)("ion-label"),f=(0,i.up)("ion-icon"),k=(0,i.up)("ion-item"),w=(0,i.up)("ion-img"),I=(0,i.up)("ion-avatar");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(k,{lines:"none",onClick:t[0]||(t[0]=e=>{m.editMode=!m.editMode,m.editMode&&_.load()})},{default:(0,i.w5)((()=>[o.title?((0,i.wg)(),(0,i.j4)(g,{key:0,color:"imageList?.length?'':medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(o.title),1)])),_:1})):((0,i.wg)(),(0,i.j4)(g,{key:1,color:"imageList?.length?'':medium"},{default:(0,i.w5)((()=>[l])),_:1})),m.editMode?((0,i.wg)(),(0,i.j4)(f,{key:2,slot:"end",icon:p.settingsSharp,color:"primary"},null,8,["icon"])):((0,i.wg)(),(0,i.j4)(f,{key:3,slot:"end",icon:p.settingsOutline},null,8,["icon"]))])),_:1}),null!==(h=_.imageList)&&void 0!==h&&h.length?((0,i.wg)(),(0,i.iD)("div",n,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.imageList,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.image_id,style:{position:"relative"}},[(0,i._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:e=>_.imagePreview(t.image_hash)},[t.deleted_at?((0,i.wg)(),(0,i.iD)("div",d,"будет удалено")):1==t.is_disabled?((0,i.wg)(),(0,i.iD)("div",a,"на модерации")):(0,i.kq)("",!0)],8,u),(0,i.Wm)(I,{onClick:e=>_.imagePreview(t.image_hash),class:(0,r.C_)(t.class)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),m.editMode?((0,i.wg)(),(0,i.iD)("div",c,[(0,i.Wm)(f,{icon:p.chevronBackCircleOutline,onClick:e=>_.back(t)},null,8,["icon","onClick"]),_.isAdmin&&1==t.is_disabled?((0,i.wg)(),(0,i.j4)(f,{key:0,icon:p.checkmarkCircle,color:"success",onClick:e=>_.enable(t)},null,8,["icon","onClick"])):(0,i.kq)("",!0),t.deleted_at?((0,i.wg)(),(0,i.j4)(f,{key:1,icon:p.addCircle,color:"success",onClick:e=>_.restore(t)},null,8,["icon","onClick"])):((0,i.wg)(),(0,i.j4)(f,{key:2,icon:p.trash,color:"danger",onClick:e=>_.remove(t)},null,8,["icon","onClick"])),(0,i.Wm)(f,{icon:p.chevronForwardCircleOutline,onClick:e=>_.forward(t)},null,8,["icon","onClick"])])):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0),(0,i._)("input",{type:"file",id:m.fileUploaderId,accept:".png, .jpg, .jpeg, .webp, .gif",onChange:t[1]||(t[1]=e=>_.uploadImage(e)),style:{display:"none"}},null,40,s)])}var m=o(8534),_=o(8903),h=o(8292),g=o(7327),f=o(9755),k=o.n(f),w=o(9042),I=o(351),v={props:["images","image_holder","image_holder_id","controller","title"],components:{IonLabel:h.Q$,IonIcon:h.gu,IonItem:h.Ie,IonImg:h.Xz,IonAvatar:h.BJ},setup(){return{settingsOutline:_.C$N,settingsSharp:_.kiF,chevronBackCircleOutline:_.CK0,chevronForwardCircleOutline:_.esm,trash:_._Ij,addCircle:_.ZWo,checkmarkCircle:_.I1A}},data(){var e;return{images_loaded:null,editMode:!1,fileUploaderId:(null!==(e=this.image_holder)&&void 0!==e?e:this.controller)+this.image_holder_id}},computed:{imageList(){let e=this.images_loaded||this.images,t=[];for(let o in e)e[o].deleted_at?(e[o].class=" deleted",this.editMode&&t.push(e[o])):1==e[o].is_disabled?(e[o].class=" disabled",this.editMode&&t.push(e[o])):t.push(e[o]);return t},isAdmin(){return I.Z.isAdmin()}},methods:{back(e){var t=this;return(0,m.Z)((function*(){try{yield k().post(t.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"}),t.load()}catch(o){}}))()},forward(e){var t=this;return(0,m.Z)((function*(){try{yield k().post(t.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"}),t.load()}catch(o){}}))()},remove(e){var t=this;return(0,m.Z)((function*(){try{yield k().post(t.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id}),t.load(),t.$flash("Фото перемещено в корзину и будет удалено")}catch(o){}}))()},restore(e){var t=this;return(0,m.Z)((function*(){try{yield k().post(t.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id}),t.load(),t.$flash("Фото перемещено извлечено из корзины")}catch(o){}}))()},enable(e){var t=this;return(0,m.Z)((function*(){try{yield k().post(t.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0}),t.load()}catch(o){}}))()},load(){var e=this;return(0,m.Z)((function*(){var t;const o={image_holder_id:e.image_holder_id,image_holder:null!==(t=e.image_holder)&&void 0!==t?t:e.controller,is_disabled:1,is_deleted:1,is_active:1};e.images_loaded=yield k().post(e.$heap.state.hostname+"Image/listGet",o)}))()},imagePreview(e){return(0,m.Z)((function*(){const t=yield h.Fy.create({component:g.Z,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[.5,1]}),o=function(){t.dismiss()};return w.Z.on("dismissModal",o),t.present()}))()},uploadImage(e){var t=this;return(0,m.Z)((function*(){let o=new FormData;o.append("files[]",e.target.files[0]),o.set("image_holder_id",t.image_holder_id),t.image_holder&&o.set("image_holder",t.image_holder);const i={url:t.$heap.state.hostname+t.controller+"/fileUpload",type:"POST",data:o,processData:!1,contentType:!1};try{yield k().ajax(i),t.load()}catch(d){var r,l,n,u;if("limit_exeeded"==(null===d||void 0===d||null===(r=d.responseJSON)||void 0===r||null===(l=r.messages)||void 0===l?void 0:l.error))return void t.$flash("Уже загружено максимальное количество фото");if("no_valid_images"==(null===d||void 0===d||null===(n=d.responseJSON)||void 0===n||null===(u=n.messages)||void 0===u?void 0:u.error))return void t.$flash("Формат файла не поддерживается");t.$flash("Не удалось загрузить фото")}}))()},take_photo(){k()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}},y=o(3744);const W=(0,y.Z)(v,[["render",p],["__scopeId","data-v-5ec0cc30"]]);var b=W},2441:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return fe}});o(3948),o(4916),o(5306);var i=o(6252),r=o(3577);const l=e=>((0,i.dD)("data-v-ff703546"),e=e(),(0,i.Cn)(),e),n={key:0},u={key:0},d=(0,i.Uk)("Обратите внимание на то, что поля "),a=l((()=>(0,i._)("ul",null,[(0,i._)("li",null,"Название (больше 5 букв), "),(0,i._)("li",null,"Цена, "),(0,i._)("li",null,"Актуальный остаток (если ведется учет), "),(0,i._)("li",null,"Изображения товара")],-1))),c=(0,i.Uk)(" обязательные "),s=[d,a,c],p=(0,i.Uk)(" Удалено "),m=(0,i.Uk)(" Вести учет остатков "),_=(0,i.Uk)(" Имеет варианты "),h=(0,i.Uk)(" На модерации "),g=(0,i.Uk)(" Родительский товар "),f=(0,i.Uk)("Вариант*"),k={style:{display:"grid","grid-template-columns":"1fr 1fr"}},w=(0,i.Uk)("Вариант*"),I=(0,i.Uk)("добавить"),v={key:2},y=(0,i.Uk)(" Показать товар "),W=(0,i.Uk)(" Показать в магазине "),b=(0,i.Uk)(" Управление магазином "),U=(0,i.Uk)("Основные настройки"),C=(0,i.Uk)("Название*"),O=(0,i.Uk)("Описание*"),D=(0,i.Uk)("Артикул"),V=(0,i.Uk)("Штрихкод"),G=(0,i.Uk)("Остаток "),$={key:0},L=(0,i.Uk)("Мин. заказ*"),x={key:0},j=(0,i.Uk)("Единица*"),Z=(0,i.Uk)("штука"),q=(0,i.Uk)("порция вес"),P=(0,i.Uk)("порция объем"),z=(0,i.Uk)("килограмм"),S=(0,i.Uk)("метр"),M=(0,i.Uk)("литр"),F=(0,i.Uk)("Объем л*"),T=(0,i.Uk)("Цена"),E=(0,i.Uk)("Цена*"),Y=(0,i.Uk)("Цена в меню/на полке"),A=(0,i.Uk)("Цена акционная"),B=(0,i.Uk)("Начало акции"),R=(0,i.Uk)("Конец акции"),H=(0,i.Uk)("Изображения товара*"),N=(0,i.Uk)(" Добавить фото на витрину "),K=(0,i.Uk)("Категории товара*"),Q=(0,i.Uk)("Без категории (в разделе 'Другое')"),J=(0,i.Uk)("Добавить в категорию");function X(e,t,o,l,d,a){var c,X;const ee=(0,i.up)("ion-progress-bar"),te=(0,i.up)("ion-card-title"),oe=(0,i.up)("ion-card-header"),ie=(0,i.up)("ion-text"),re=(0,i.up)("ion-card-content"),le=(0,i.up)("ion-card"),ne=(0,i.up)("ion-icon"),ue=(0,i.up)("ion-toggle"),de=(0,i.up)("ion-item"),ae=(0,i.up)("ion-card-subtitle"),ce=(0,i.up)("ion-img"),se=(0,i.up)("ion-label"),pe=(0,i.up)("ion-input"),me=(0,i.up)("ion-chip"),_e=(0,i.up)("ion-button"),he=(0,i.up)("ion-item-divider"),ge=(0,i.up)("ion-list"),fe=(0,i.up)("ion-textarea"),ke=(0,i.up)("ion-select-option"),we=(0,i.up)("ion-select"),Ie=(0,i.up)("ion-item-group"),ve=(0,i.up)("image-tile-comp"),ye=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(ye,{"page-title":null!==(c=null===(X=d.productItem)||void 0===X?void 0:X.product_name)&&void 0!==c?c:"Товар",pageDefaultBackLink:"/catalog"},{default:(0,i.w5)((()=>{var o,c;return[d.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(le,{color:(null===(o=d.productItem)||void 0===o?void 0:o.validity)<d.validity_min?"danger":""},{default:(0,i.w5)((()=>{var e;return[(0,i.Wm)(oe,null,{default:(0,i.w5)((()=>[(0,i.Wm)(te,null,{default:(0,i.w5)((()=>{var e,t,o;return[(0,i.Uk)(" Форма заполнена на "+(0,r.zw)(null!==(e=null===(t=d.productItem)||void 0===t?void 0:t.validity)&&void 0!==e?e:0)+"% ",1),(0,i.Wm)(ee,{value:(null===(o=d.productItem)||void 0===o?void 0:o.validity)/100},null,8,["value"])]})),_:1})])),_:1}),(null===(e=d.productItem)||void 0===e?void 0:e.validity)<d.validity_min?((0,i.wg)(),(0,i.j4)(re,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(ie,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Uk)(" Вам необходимо заполнить анкету не меньше чем на "+(0,r.zw)(d.validity_min)+"% для рассмотрения модератором ",1),0==(null===(e=d.productItem)||void 0===e?void 0:e.validity)?((0,i.wg)(),(0,i.iD)("p",u,s)):(0,i.kq)("",!0)]})),_:1})])),_:1})):(0,i.kq)("",!0)]})),_:1},8,["color"]),a.message&&(null===(c=d.productItem)||void 0===c?void 0:c.validity)>d.validity_min?((0,i.wg)(),(0,i.j4)(le,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(re,{class:(0,r.C_)(a.messageClass)},{default:(0,i.w5)((()=>[(0,i.Wm)(ie,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(a.message),1)])),_:1})])),_:1},8,["class"])])),_:1})):(0,i.kq)("",!0)])),d.productItem?((0,i.wg)(),(0,i.j4)(ge,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.trashOutline,color:"primary",slot:"start"},null,8,["src"]),p,(0,i.Wm)(ue,{slot:"end",modelValue:d.is_deleted,"onUpdate:modelValue":t[0]||(t[0]=e=>d.is_deleted=e),color:"danger",onIonChange:t[1]||(t[1]=e=>a.itemDelete(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.pizzaOutline,color:"primary",slot:"start"},null,8,["src"]),m,d.productItem?((0,i.wg)(),(0,i.j4)(ue,{key:0,slot:"end",modelValue:d.is_counted,"onUpdate:modelValue":t[2]||(t[2]=e=>d.is_counted=e),onIonChange:t[3]||(t[3]=e=>a.save("is_counted",e.target.checked?1:0))},null,8,["modelValue"])):(0,i.kq)("",!0)])),_:1}),d.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(de,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.layersOutline,color:"primary",slot:"start"},null,8,["src"]),_,d.productItem?((0,i.wg)(),(0,i.j4)(ue,{key:0,slot:"end",modelValue:d.is_option_parent,"onUpdate:modelValue":t[4]||(t[4]=e=>d.is_option_parent=e),onIonChange:t[5]||(t[5]=e=>{a.itemOptionSet(e.target.checked)})},null,8,["modelValue"])):(0,i.kq)("",!0)])),_:1})),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.ribbonOutline,color:"primary",slot:"start"},null,8,["src"]),h,(0,i.Wm)(ue,{slot:"end",modelValue:d.is_disabled,"onUpdate:modelValue":t[6]||(t[6]=e=>d.is_disabled=e),onIonChange:t[7]||(t[7]=e=>a.itemDisable(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),d.optionData?((0,i.wg)(),(0,i.iD)("div",{key:1,onChange:t[12]||(t[12]=(...e)=>a.saveForm&&a.saveForm(...e))},[(0,i.Wm)(le,{onClick:t[9]||(t[9]=t=>e.$router.replace(`product-edit-${d.optionData.parent.product_id}?refreshOptions=1`)),color:d.productId==d.optionData.parent.product_id?"primary":"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(oe,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ae,null,{default:(0,i.w5)((()=>[g])),_:1})])),_:1}),(0,i.Wm)(re,null,{default:(0,i.w5)((()=>[(0,i.Wm)(de,{color:"light",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(ce,{slot:"start",style:{height:"70px"},src:`${e.$heap.state.hostname}image/get.php/${d.optionData.parent.image_hash}.70.70.webp`},null,8,["src"]),(0,i.Uk)(" "+(0,r.zw)(d.optionData.parent.product_name),1)])),_:1}),d.productId==d.optionData.parent.product_id?((0,i.wg)(),(0,i.j4)(de,{key:0,color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(se,{position:"stacked"},{default:(0,i.w5)((()=>[f])),_:1}),(0,i.Wm)(pe,{name:"product_option",modelValue:d.productItem.product_option,"onUpdate:modelValue":t[8]||(t[8]=e=>d.productItem.product_option=e)},null,8,["modelValue"])])),_:1})):((0,i.wg)(),(0,i.j4)(de,{key:1,lines:"none",color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(me,null,{default:(0,i.w5)((()=>[(0,i.Uk)("["+(0,r.zw)(d.optionData.parent.product_option)+"]",1)])),_:1})])),_:1}))])),_:1})])),_:1},8,["color"]),(0,i._)("div",k,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(d.optionData.children,(o=>((0,i.wg)(),(0,i.j4)(le,{onClick:t=>e.$router.replace(`product-edit-${o.product_id}?refreshOptions=1`),key:o.product_id,color:d.productItem.product_id==o.product_id?"primary":""},{default:(0,i.w5)((()=>[(0,i.Wm)(re,null,{default:(0,i.w5)((()=>[d.productItem.product_id==o.product_id?((0,i.wg)(),(0,i.j4)(de,{key:0,color:d.productItem.deleted_at?"danger":""},{default:(0,i.w5)((()=>[(0,i.Wm)(se,{position:"stacked"},{default:(0,i.w5)((()=>[w])),_:1}),(0,i.Wm)(pe,{name:"product_option",modelValue:d.productItem.product_option,"onUpdate:modelValue":t[10]||(t[10]=e=>d.productItem.product_option=e)},null,8,["modelValue"])])),_:1},8,["color"])):((0,i.wg)(),(0,i.j4)(de,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(me,{color:o.deleted_at?"danger":""},{default:(0,i.w5)((()=>[(0,i.Uk)("["+(0,r.zw)(o.product_option)+"]",1)])),_:2},1032,["color"])])),_:2},1024))])),_:2},1024)])),_:2},1032,["onClick","color"])))),128)),(0,i.Wm)(le,null,{default:(0,i.w5)((()=>[(0,i.Wm)(re,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_e,{color:"light",expand:"block",onClick:t[11]||(t[11]=e=>a.itemOptionCreate())},{default:(0,i.w5)((()=>[I])),_:1})])),_:1})])),_:1})])],32)):(0,i.kq)("",!0),d.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",v,[(0,i.Wm)(he),(0,i.Wm)(de,{button:"",onClick:t[13]||(t[13]=t=>e.$router.push("product-"+d.productItem.product_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.chevronBack,slot:"start"},null,8,["src"]),y])),_:1}),(0,i.Wm)(de,{button:"",onClick:t[14]||(t[14]=e=>a.showProductInStore())},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.chevronBack,slot:"start"},null,8,["src"]),W])),_:1}),(0,i.Wm)(de,{button:"",onClick:t[15]||(t[15]=t=>e.$router.push("/catalog/store-edit-"+d.productItem.store_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.chevronBack,slot:"start"},null,8,["src"]),b])),_:1})]))])),_:1})):(0,i.kq)("",!0),d.productItem?((0,i.wg)(),(0,i.iD)("form",{key:2,onChange:t[29]||(t[29]=(...e)=>a.saveForm&&a.saveForm(...e))},[(0,i.Wm)(ge,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(Ie,null,{default:(0,i.w5)((()=>[(0,i.Wm)(he,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[U])),_:1})])),_:1}),d.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(de,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(se,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[C])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_name,"onUpdate:modelValue":t[16]||(t[16]=e=>d.productItem.product_name=e),name:"product_name",placeholder:"полное название товара",clearInput:"true"},null,8,["modelValue"])])),_:1})),d.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(de,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(se,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[O])),_:1}),(0,i.Wm)(fe,{modelValue:d.productItem.product_description,"onUpdate:modelValue":t[17]||(t[17]=e=>d.productItem.product_description=e),name:"product_description",rows:"6",placeholder:"характеристики, свойства, состав товара"},null,8,["modelValue"])])),_:1})),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[D])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_code,"onUpdate:modelValue":t[18]||(t[18]=e=>d.productItem.product_code=e),name:"product_code",slot:"end",placeholder:"код товара"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[V])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_barcode,"onUpdate:modelValue":t[19]||(t[19]=e=>d.productItem.product_barcode=e),name:"product_barcode",slot:"end",placeholder:"штрихкод"},null,8,["modelValue"])])),_:1}),d.is_counted?((0,i.wg)(),(0,i.j4)(de,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[G,d.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",$,"("+(0,r.zw)(d.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_quantity,"onUpdate:modelValue":t[20]||(t[20]=e=>d.productItem.product_quantity=e),name:"product_quantity",slot:"end",placeholder:"в наличии"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[L,d.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",x,"("+(0,r.zw)(d.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_quantity_min,"onUpdate:modelValue":t[21]||(t[21]=e=>d.productItem.product_quantity_min=e),name:"product_quantity_min",type:"number",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1}),d.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(de,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[j])),_:1}),(0,i.Wm)(we,{modelValue:d.productItem.product_unit,"onUpdate:modelValue":t[22]||(t[22]=e=>d.productItem.product_unit=e),name:"product_unit",slot:"end",onIonChange:a.saveForm},{default:(0,i.w5)((()=>[(0,i.Wm)(ke,{value:"шт"},{default:(0,i.w5)((()=>[Z])),_:1}),(0,i.Wm)(ke,{value:"порция"},{default:(0,i.w5)((()=>[q])),_:1}),(0,i.Wm)(ke,{value:"порция мл"},{default:(0,i.w5)((()=>[P])),_:1}),(0,i.Wm)(ke,{value:"кг"},{default:(0,i.w5)((()=>[z])),_:1}),(0,i.Wm)(ke,{value:"м"},{default:(0,i.w5)((()=>[S])),_:1}),(0,i.Wm)(ke,{value:"л"},{default:(0,i.w5)((()=>[M])),_:1})])),_:1},8,["modelValue","onIonChange"])])),_:1})),"кг"!=d.productItem.product_unit?((0,i.wg)(),(0,i.j4)(de,{key:4},{default:(0,i.w5)((()=>["порция мл"==d.productItem.product_unit?((0,i.wg)(),(0,i.j4)(se,{key:0},{default:(0,i.w5)((()=>[F])),_:1})):((0,i.wg)(),(0,i.j4)(se,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)("Вес 1"+(0,r.zw)(d.productItem.product_unit)+" (кг)*",1)])),_:1})),(0,i.Wm)(pe,{modelValue:d.productItem.product_weight,"onUpdate:modelValue":t[23]||(t[23]=e=>d.productItem.product_weight=e),name:"product_weight",type:"number",step:"0.1",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(ge,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(Ie,null,{default:(0,i.w5)((()=>[(0,i.Wm)(he,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[T])),_:1})])),_:1})])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[E])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_price,"onUpdate:modelValue":t[24]||(t[24]=e=>d.productItem.product_price=e),name:"product_price",type:"number",inputmode:"numeric",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[Y])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_net_price,"onUpdate:modelValue":t[25]||(t[25]=e=>d.productItem.product_net_price=e),name:"product_net_price",type:"number",inputmode:"numeric",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,{color:"success"},{default:(0,i.w5)((()=>[A])),_:1}),(0,i.Wm)(pe,{modelValue:d.productItem.product_promo_price,"onUpdate:modelValue":t[26]||(t[26]=e=>d.productItem.product_promo_price=e),name:"product_promo_price",type:"number",inputmode:"numeric",slot:"end",color:"success"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,{color:"success"},{default:(0,i.w5)((()=>[B])),_:1}),(0,i.Wm)(pe,{type:"date",modelValue:d.productItem.product_promo_start,"onUpdate:modelValue":t[27]||(t[27]=e=>d.productItem.product_promo_start=e),name:"product_promo_start",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(de,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,{color:"success"},{default:(0,i.w5)((()=>[R])),_:1}),(0,i.Wm)(pe,{type:"date",modelValue:d.productItem.product_promo_finish,"onUpdate:modelValue":t[28]||(t[28]=e=>d.productItem.product_promo_finish=e),name:"product_promo_finish",slot:"end"},null,8,["modelValue"])])),_:1})])),_:1})],32)):(0,i.kq)("",!0),d.productItem&&!d.is_option_child?((0,i.wg)(),(0,i.j4)(ge,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(he,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[H])),_:1})])),_:1}),(0,i.Wm)(ve,{images:d.productItem.images,image_holder_id:d.productItem.product_id,title:"Витрина товара 5 фото",controller:"Product",ref:"productImgs"},null,8,["images","image_holder_id"]),(0,i.Wm)(_e,{onClick:t[30]||(t[30]=t=>e.$refs.productImgs.take_photo()),color:"light",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.cameraOutline,slot:"start"},null,8,["src"]),N])),_:1})])),_:1})):(0,i.kq)("",!0),d.productItem&&a.categoryList&&!d.is_option_child?((0,i.wg)(),(0,i.j4)(ge,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(he,null,{default:(0,i.w5)((()=>[(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[K])),_:1})])),_:1}),0==a.categoryList.length?((0,i.wg)(),(0,i.j4)(de,{key:0,color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.compassOutline,slot:"start",color:"danger"},null,8,["src"]),(0,i.Wm)(se,{color:"danger"},{default:(0,i.w5)((()=>[Q])),_:1})])),_:1})):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.categoryList,(e=>((0,i.wg)(),(0,i.j4)(de,{key:e.group_id},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.compassOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.group_name),1)])),_:2},1024),(0,i.Wm)(ne,{src:l.trashOutline,slot:"end",onClick:t=>a.categoryDelete(e.group_id,e.group_name)},null,8,["src","onClick"])])),_:2},1024)))),128)),(0,i.Wm)(de,{button:"",onClick:t[31]||(t[31]=e=>a.categoryAdd())},{default:(0,i.w5)((()=>[(0,i.Wm)(ne,{src:l.addOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(se,null,{default:(0,i.w5)((()=>[J])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)]})),_:1},8,["page-title"])}var ee=o(8534),te=(o(3123),o(8862),o(6699),o(8292)),oe=o(8903),ie=o(2226);const re=(0,i.Uk)("Категории"),le={class:"ion-padding",slot:"content"};function ne(e,t,o,l,n,u){const d=(0,i.up)("ion-title"),a=(0,i.up)("ion-icon"),c=(0,i.up)("ion-toolbar"),s=(0,i.up)("ion-header"),p=(0,i.up)("ion-searchbar"),m=(0,i.up)("ion-img"),_=(0,i.up)("ion-avatar"),h=(0,i.up)("ion-label"),g=(0,i.up)("ion-item"),f=(0,i.up)("ion-checkbox"),k=(0,i.up)("ion-list"),w=(0,i.up)("ion-accordion"),I=(0,i.up)("ion-accordion-group"),v=(0,i.up)("ion-skeleton-text"),y=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[re])),_:1}),(0,i.Wm)(a,{slot:"end",onClick:t[0]||(t[0]=e=>{u.closeModal()}),icon:l.closeOutline,size:"large",color:"medium"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{placeholder:"Фильтр по категориям",modelValue:n.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>n.searchQuery=e)},null,8,["modelValue"]),u.groupListFiltered.length>0?((0,i.wg)(),(0,i.j4)(I,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(u.groupListTree,(t=>((0,i.wg)(),(0,i.j4)(w,{key:t.group_id},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{slot:"header"},{default:(0,i.w5)((()=>[t.image_hash?((0,i.wg)(),(0,i.j4)(_,{key:0,slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".50.50.webp"},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(t.group_name),1)])),_:2},1024)])),_:2},1024),(0,i._)("div",le,[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.children,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.group_id},[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[t.image_hash?((0,i.wg)(),(0,i.j4)(_,{key:0,slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".50.50.webp"},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(t.group_name),1)])),_:2},1024),(0,i.Wm)(f,{slot:"end",checked:t.is_marked,onClick:e=>u.mimickChage(e.target,t.group_id)},null,8,["checked","onClick"])])),_:2},1024)])))),128))])),_:2},1024)])])),_:2},1024)))),128))])),_:1})):((0,i.wg)(),(0,i.j4)(k,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3,4],(e=>(0,i.Wm)(g,{key:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{style:{width:"100%"}})])),_:2},1024))),64))])),_:1}))])),_:1})],64)}o(4603),o(8450);var ue=o(9755),de=o.n(ue),ae={props:["controller","memberId","memberOfIds","memberLimit"],components:{IonCheckbox:te.nz,IonContent:te.W2,IonHeader:te.Gu,IonToolbar:te.sr,IonTitle:te.wd,IonIcon:te.gu,IonButton:te.YG,IonImg:te.Xz,IonAvatar:te.BJ,IonLabel:te.Q$,IonItemDivider:te.rH,IonList:te.q_,IonItem:te.Ie,IonAccordion:te.We,IonAccordionGroup:te.eh,IonSearchbar:te.VI,IonSkeletonText:te.CK},setup(){return{closeOutline:oe.fID}},data(){return{searchQuery:"",groupList:null,checkedGroupList:[]}},created(){this.listGroupGet(),this.checkedGroupList=this.memberOfIds||[]},computed:{groupListFiltered(){var e,t;if(!this.searchQuery)return null!==(t=this.groupList)&&void 0!==t?t:[];const o=new RegExp(this.searchQuery.replace(/^[\w\d\s]/,"").replace(/\s/g,".*"),"im");return null!==(e=this.groupList.filter((e=>{var t;return null===(t=e.group_name)||void 0===t?void 0:t.match(o)})))&&void 0!==e?e:[]},groupListTree(){let e=[];for(let t of this.groupListFiltered)if(0==t.group_parent_id)t.children=this.groupList.filter((e=>e.group_parent_id==t.group_id)),e.push(t);else{let o=e.findIndex((e=>t.group_parent_id==e.group_id));if(o<0){let i=this.groupList.find((e=>e.group_id==t.group_parent_id));i.children=[],o=e.push(i)-1}e[o].children.push(t)}return e},parentGroupList(){var e;return null===(e=this.groupListFiltered)||void 0===e?void 0:e.filter((e=>0==e.group_parent_id))},childGroupList(){let e={};for(let t of this.parentGroupList)e[t.group_id]=this.groupListFiltered.filter((e=>e.group_parent_id==t.group_id));return e}},methods:{listGroupGet(){var e=this;return(0,ee.Z)((function*(){e.groupList=yield de().get(e.$heap.state.hostname+e.controller+"/listGroupGet"),e.itemMarkGroups()}))()},itemMarkGroups(){if(this.groupList)try{for(let e of this.groupList)e.is_marked=this.checkedGroupList.includes(e.group_id)?1:0}catch(e){}},itemUpdateGroup(e,t){var o=this;return(0,ee.Z)((function*(){const i={[o.controller.toLowerCase()+"_id"]:o.memberId,is_joined:e,group_id:t};try{yield de().post(o.$heap.state.hostname+o.controller+"/itemUpdateGroup",i)}catch(r){o.$flash("Не удалось сохранить изменение")}}))()},mimickChage(e,t){const o=this;setTimeout((()=>{o.groupChanged(e,t)}),0)},groupChanged(e,t){var o=this;return(0,ee.Z)((function*(){const i=e.checked?1:0;if(i){if(o.checkedGroupList.length>=o.memberLimit)return o.$flash(`Можно выбрать не больше ${o.memberLimit} категорий`),void(e.checked=0);1==o.memberLimit&&o.closeModal(),o.checkedGroupList.push(t)}else o.checkedGroupList=o.checkedGroupList.filter((function(e,o,i){return e!=t}));o.itemUpdateGroup(i,t)}))()},closeModal(){te.Fy.dismiss(this.checkedGroupList)}}},ce=o(3744);const se=(0,ce.Z)(ae,[["render",ne]]);var pe=se,me=o(2008),_e=o(9042),he={components:{IonInput:te.pK,IonTextarea:te.g2,IonCard:te.PM,IonCardContent:te.FN,IonCardHeader:te.Zi,IonToggle:te.ho,IonIcon:te.gu,IonItem:te.Ie,IonList:te.q_,IonLabel:te.Q$,IonItemDivider:te.rH,IonItemGroup:te.Ub,IonButton:te.YG,IonProgressBar:te.X7,IonText:te.yW,IonSelect:te.t9,IonSelectOption:te.n0,IonImg:te.Xz,IonChip:te.hM,IonCardTitle:te.Dq,IonCardSubtitle:te.tO,imageTileComp:ie.Z},setup(){return{cameraOutline:oe.kuq,trashOutline:oe.gtu,banOutline:oe.L6S,personOutline:oe.QJ7,addOutline:oe.s6O,pizzaOutline:oe.fqo,compassOutline:oe.gmD,chevronBack:oe.Mny,layersOutline:oe.Y1P,ribbonOutline:oe.Muk}},data(){return{productId:this.$route.params.id,productItem:null,productGroupList:null,validity:0,validity_min:80,optionData:null,refreshOptions:this.$route.query.refreshOptions,is_option_parent:!1,is_option_child:!1,is_groups_marked:0,is_deleted:0,is_disabled:0,is_counted:0}},computed:{message(){var e,t,o;return null!==(e=this.productItem)&&void 0!==e&&e.deleted_at?"Товар не активен и будет удален. Вы еще можете отменить удаление":1==(null===(t=this.productItem)||void 0===t?void 0:t.is_disabled)?"Товар не активен и находится на рассмотрении у администратора":1!=(null===(o=this.productItem)||void 0===o?void 0:o.is_counted)?"Товар активен и готов к продаже. Учет остатков товара не ведется":"Товар активен и готов к продаже."},messageClass(){var e,t,o;return null!==(e=this.productItem)&&void 0!==e&&e.deleted_at?"deleted":1==(null===(t=this.productItem)||void 0===t?void 0:t.is_disabled)?"disabled":1!=(null===(o=this.productItem)||void 0===o?void 0:o.is_counted)?"primary":"active"},categoryList(){let e=[];try{let t=this.productItem.member_of_groups.group_ids.split(","),o=this.productItem.member_of_groups.group_names.split(",");for(let i in t)e.push({group_id:t[i],group_name:o[i]})}catch(t){}return e}},created(){this.listGroupGet(),this.itemGet()},ionViewDidEnter(){var e;this.refreshOptions&&null!==(e=this.productItem)&&void 0!==e&&e.product_parent_id&&this.itemOptionGet()},methods:{itemGet(){var e=this;return(0,ee.Z)((function*(){try{let t=yield de().post(me.Z.state.hostname+"Product/itemGet",{product_id:e.productId});e.productItem=e.itemPrepare(t),e.itemParseFlags(),e.is_option_child=e.productItem.product_parent_id&&e.productItem.product_parent_id!=e.productItem.product_id,e.is_option_parent=e.productItem.product_parent_id&&e.productItem.product_parent_id==e.productItem.product_id,yield e.itemOptionGet()}catch(t){}}))()},itemPrepare(e){return e.product_promo_start&&(e.product_promo_start=e.product_promo_start.split(" ")[0]),e.product_promo_finish&&(e.product_promo_finish=e.product_promo_finish.split(" ")[0]),e},itemParseFlags(){this.is_deleted=null==this.productItem.deleted_at?0:1,this.is_disabled=0==this.productItem.is_disabled?0:1,this.is_counted=0==this.productItem.is_counted?0:1},itemDelete(e){var t=this;return(0,ee.Z)((function*(){const o=e?"itemDelete":"itemUnDelete";try{yield de().post(me.Z.state.hostname+"Product/"+o,{product_id:t.productId}),t.productItem.deleted_at=e?1:null,(t.is_option_child||t.is_option_parent)&&t.itemOptionGet()}catch(i){t.itemGet()}}))()},itemDisable(e){var t=this;return(0,ee.Z)((function*(){if(t.productItem.is_disabled!=e)try{yield de().post(me.Z.state.hostname+"Product/itemDisable",{product_id:t.productId,is_disabled:e}),t.productItem.is_disabled=e}catch(o){t.$flash("Изменение не сохранено"),t.itemGet()}}))()},itemUpdate(e){var t=this;return(0,ee.Z)((function*(){try{return yield de().post(me.Z.state.hostname+"Product/itemUpdate",JSON.stringify(e)),t.$flash("💾 сохранено"),!0}catch(o){const e=o.responseJSON.messages.error;return null!==e&&void 0!==e&&e.includes("product_description")?t.$flash("Описание слишком короткое"):null!==e&&void 0!==e&&e.includes("product_name")?t.$flash("Название слишком короткое"):t.$flash("Изменение не сохранено"),t.itemGet(),!1}}))()},itemOptionGet(){var e=this;return(0,ee.Z)((function*(){e.productItem.product_parent_id||(e.optionData=null);const t={product_parent_id:e.productItem.product_parent_id};let o=yield de().post(`${e.$heap.state.hostname}Product/itemOptionGet`,t);e.optionData={parent:o[0],children:o.slice(1)}}))()},itemOptionCreate(){var e=this;return(0,ee.Z)((function*(){var t,o,i;const r=null!==(t=null===(o=e.optionData)||void 0===o||null===(i=o.children)||void 0===i?void 0:i.length)&&void 0!==t?t:0,l={is_disabled:1,store_id:e.productItem.store_id,product_parent_id:e.productItem.product_parent_id,product_name:"OPTION",product_price:0,product_option:`Вариант#${r}`};try{yield de().post(`${e.$heap.state.hostname}Product/itemCreate`,l),e.itemOptionGet()}catch(n){}}))()},itemOptionSet(e){var t=this;return(0,ee.Z)((function*(){e?yield t.itemOptionSave(t.productId,t.productId):yield t.itemOptionDelete(t.productId),t.itemGet()}))()},itemOptionUpdate(e){return(0,ee.Z)((function*(){}))()},itemOptionSave(e,t){var o=this;return(0,ee.Z)((function*(){try{yield de().post(`${o.$heap.state.hostname}Product/itemOptionSave`,{product_id:e,product_parent_id:t})}catch(i){}}))()},itemOptionDelete(e){var t=this;return(0,ee.Z)((function*(){if(confirm("Удалить разновидности товара?"))try{yield de().post(`${t.$heap.state.hostname}Product/itemOptionDelete`,{product_id:e}),t.itemOptionGet()}catch(o){}}))()},checkPromoPrice(e){if(this.productItem.product_price>0&&this.productItem.product_promo_price>0&&this.productItem.product_price<=this.productItem.product_promo_price){"product_promo_price"==e&&(this.productItem.product_price=Number(this.productItem.product_promo_price)+1),"product_price"==e&&(this.productItem.product_promo_price=Number(this.productItem.product_price)-1);const t={product_id:this.productId,product_promo_price:this.productItem.product_promo_price,product_price:this.productItem.product_price};return this.itemUpdate(t),this.$flash("Акционная цена должна быть ниже основной. Внимание цена изменена!"),!1}return!0},saveForm(e){const t=e.target.name,o=this.productItem[t]=e.target.value;this.checkPromoPrice(t)&&this.save(t,o)},save(e,t){var o=this;return(0,ee.Z)((function*(){if(!o.productItem.product_id)return;let i={product_id:o.productItem.product_id,[e]:t};o.itemUpdate(i)&&(o.productItem[e]=t,o.itemParseFlags())}))()},categoryDelete(e,t){if(confirm("Исключить товар из категории "+t+"?"))try{this.itemUpdateGroup(0,e)}catch(o){}},categoryAdd(){var e=this;return(0,ee.Z)((function*(){var t,o,i;const r=(null===(t=e.productItem)||void 0===t||null===(o=t.member_of_groups)||void 0===o||null===(i=o.group_ids)||void 0===i?void 0:i.split(","))||[],l=yield te.Fy.create({component:pe,componentProps:{controller:"Product",memberId:e.productId,memberOfIds:r,memberLimit:1},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});l.present(),_e.Z.on("dismissModal",(()=>{l.dismiss()})),yield l.onDidDismiss(),e.itemGet()}))()},itemUpdateGroup(e,t){var o=this;return(0,ee.Z)((function*(){const i={product_id:o.productId,is_joined:e,group_id:t};try{yield de().post(me.Z.state.hostname+"Product/itemUpdateGroup",i)}catch(r){o.$flash("Не удалось сохранить изменение")}o.itemGet()}))()},listGroupGet(){var e=this;return(0,ee.Z)((function*(){try{e.productGroupList=yield de().get(me.Z.state.hostname+"Product/listGroupGet"),e.itemMarkGroups()}catch(t){}}))()},showProductInStore(){let e=0;try{e=this.productItem.member_of_groups.group_ids.split(",")[0]}catch(t){}this.$router.push({path:"store-"+this.productItem.store_id,query:{sub_group_id:e}})}}};const ge=(0,ce.Z)(he,[["render",X],["__scopeId","data-v-ff703546"]]);var fe=ge}}]);
//# sourceMappingURL=2441-legacy.6713b1df.js.map