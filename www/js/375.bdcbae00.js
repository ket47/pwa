"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[375],{375:function(e,t,l){l.r(t),l.d(t,{default:function(){return I}});var s=l(641),a=l(33);const o={key:0},i={key:1},n={slot:"end",style:{"font-size":"10px",width:"7em"}},u={slot:"end",style:{"font-size":"10px",width:"7em"}},r={slot:"end",style:{"font-size":"10px",width:"7em"}},d={slot:"end",style:{"font-size":"10px",width:"7em"}},_={slot:"end",style:{"font-size":"10px",width:"7em"}},m={key:2};function h(e,t,l,h,p,c){const b=(0,s.g2)("ion-title"),f=(0,s.g2)("ion-toolbar"),k=(0,s.g2)("ion-header"),v=(0,s.g2)("ion-input"),g=(0,s.g2)("ion-item"),F=(0,s.g2)("ion-button"),y=(0,s.g2)("ion-content"),I=(0,s.g2)("ion-modal"),C=(0,s.g2)("ion-card-content"),V=(0,s.g2)("ion-card"),$=(0,s.g2)("ion-icon"),w=(0,s.g2)("ion-toggle"),O=(0,s.g2)("ion-label"),U=(0,s.g2)("ion-item-divider"),W=(0,s.g2)("ion-checkbox"),x=(0,s.g2)("ion-list"),A=(0,s.g2)("ion-accordion"),G=(0,s.g2)("ion-accordion-group"),X=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(X,{"page-title":"Пользователь",pageDefaultBackLink:"/user"},{default:(0,s.k6)((()=>{var e;return[(0,s.bF)(I,{"is-open":p.isAddPromoOpen,"initial-breakpoint":.75,breakpoints:[0,.75,1]},{default:(0,s.k6)((()=>[(0,s.bF)(k,null,{default:(0,s.k6)((()=>[(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.bF)(b,null,{default:(0,s.k6)((()=>[(0,s.eW)("Добавление скидки")])),_:1})])),_:1})])),_:1}),(0,s.bF)(y,{class:"ion-padding"},{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,{label:"Название скидки","label-placement":"stacked",type:"text",modelValue:p.promo_name,"onUpdate:modelValue":t[0]||(t[0]=e=>p.promo_name=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,{label:"Сумма скидки","label-placement":"stacked",type:"text",modelValue:p.promo_value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.promo_value=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,{label:"Минимальный заказ","label-placement":"stacked",type:"text",modelValue:p.promo_minsum,"onUpdate:modelValue":t[2]||(t[2]=e=>p.promo_minsum=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,{label:"Срок жизни дней","label-placement":"stacked",type:"num",modelValue:p.promo_lifetime,"onUpdate:modelValue":t[3]||(t[3]=e=>p.promo_lifetime=e)},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{lines:"none"}),(0,s.bF)(F,{onClick:t[4]||(t[4]=e=>c.promoCreate()),expand:"block"},{default:(0,s.k6)((()=>[(0,s.eW)("Создать")])),_:1}),(0,s.bF)(F,{onClick:t[5]||(t[5]=e=>p.isAddPromoOpen=0),color:"light",expand:"block"},{default:(0,s.k6)((()=>[(0,s.eW)("Закрыть")])),_:1})])),_:1})])),_:1},8,["is-open"]),null==p.user?((0,s.uX)(),(0,s.CE)("div",o)):null!==(e=p.user)&&void 0!==e&&e.user_id?((0,s.uX)(),(0,s.CE)("div",i,[c.message?((0,s.uX)(),(0,s.Wv)(V,{key:0,lines:"none"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{class:(0,a.C4)(c.messageClass)},{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(c.message),1)])),_:1},8,["class"])])),_:1})):((0,s.uX)(),(0,s.Wv)(V,{key:1,lines:"none"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,s.k6)((()=>[(0,s.eW)(" Анкета пользователя активна. ")])),_:1})])),_:1})),(0,s.Lk)("form",{onChange:t[17]||(t[17]=(...e)=>c.updateUser&&c.updateUser(...e))},[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)($,{src:h.trashOutline,color:"primary",slot:"start"},null,8,["src"]),(0,s.eW)(" Удалено "),(0,s.bF)(w,{slot:"end",modelValue:p.is_deleted,"onUpdate:modelValue":t[6]||(t[6]=e=>p.is_deleted=e),color:"danger",onIonChange:t[7]||(t[7]=e=>c.itemDelete(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,null,{default:(0,s.k6)((()=>[(0,s.bF)($,{src:h.closeOutline,color:"primary",slot:"start"},null,8,["src"]),(0,s.eW)(" Заблокировано "),(0,s.bF)(w,{slot:"end",modelValue:p.is_disabled,"onUpdate:modelValue":t[8]||(t[8]=e=>p.is_disabled=e),onIonChange:t[9]||(t[9]=e=>c.itemDisable(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,s.bF)(U,null,{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)("Основные настройки")])),_:1})])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(v,{modelValue:p.user.user_phone,"onUpdate:modelValue":t[10]||(t[10]=e=>p.user.user_phone=e),name:"user_phone",placeholder:"Телефон",label:"Телефон","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(W,{modelValue:p.user.user_phone_verified,"onUpdate:modelValue":t[11]||(t[11]=e=>p.user.user_phone_verified=e),name:"user_phone_verified",onClick:t[12]||(t[12]=e=>c.updateUserDelayed({target:{name:"user_phone_verified"}}))},{default:(0,s.k6)((()=>[(0,s.eW)("Телефон подтвержден")])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(v,{modelValue:p.user.user_email,"onUpdate:modelValue":t[13]||(t[13]=e=>p.user.user_email=e),name:"user_email",placeholder:"Емаил",label:"почта","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(v,{modelValue:p.user.user_name,"onUpdate:modelValue":t[14]||(t[14]=e=>p.user.user_name=e),name:"user_name",placeholder:"Имя",label:"Имя","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(v,{modelValue:p.user.user_birthday,"onUpdate:modelValue":t[15]||(t[15]=e=>p.user.user_birthday=e),name:"user_birthday",placeholder:"День рождения",label:"День рождения","label-placement":"stacked",type:"datetime-local"},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)("Регистрация")])),_:1}),(0,s.Lk)("p",n,(0,a.v_)(p.user.created_at),1)])),_:1}),(0,s.bF)(g,{lines:"full"},{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)("Последний вход")])),_:1}),(0,s.Lk)("p",u,(0,a.v_)(p.user.signed_in_at),1)])),_:1}),(0,s.bF)(g,{lines:"full",onClick:t[16]||(t[16]=e=>{c.itemSignInById(p.user.user_id)}),button:"",color:"warning"},{default:(0,s.k6)((()=>[(0,s.bF)($,{icon:h.enterOutline,slot:"start"},null,8,["icon"]),(0,s.eW)(" Войти как "+(0,a.v_)(p.user.user_name),1)])),_:1})])),_:1})],32),(0,s.bF)(U,null,{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)("Дополнително")])),_:1})])),_:1}),(0,s.bF)(G,null,{default:(0,s.k6)((()=>[(0,s.bF)(A,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"header"},{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>{var e;return[(0,s.eW)("Пуш подписки "+(0,a.v_)((null===(e=p.user_push_subs)||void 0===e?void 0:e.length)||0),1)]})),_:1})])),_:1}),(0,s.bF)(x,{slot:"content"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p.user_push_subs,(e=>((0,s.uX)(),(0,s.Wv)(g,{key:e.sub_id},{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(e.platform)+" / "+(0,a.v_)(e.mobile||e.browser),1)])),_:2},1024),(0,s.Lk)("p",r,(0,a.v_)(e.created_at),1)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,s.bF)(A,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"header"},{default:(0,s.k6)((()=>[(0,s.bF)(O,null,{default:(0,s.k6)((()=>{var e;return[(0,s.eW)("Скидки "+(0,a.v_)((null===(e=p.promo_list)||void 0===e?void 0:e.length)||0),1)]})),_:1})])),_:1}),(0,s.bF)(x,{slot:"content"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p.promo_list,(e=>((0,s.uX)(),(0,s.Wv)(g,{key:e.promo_id},{default:(0,s.k6)((()=>[(0,s.bF)($,{src:h.checkmarkOutline,color:"success",slot:"start"},null,8,["src"]),(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(e.promo_name)+" / "+(0,a.v_)(e.promo_value)+" / "+(0,a.v_)(e.promo_share)+"%",1)])),_:2},1024),(0,s.Lk)("p",d,(0,a.v_)(e.expired_at),1)])),_:2},1024)))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p.promo_list_expired,(e=>((0,s.uX)(),(0,s.Wv)(g,{key:e.promo_id},{default:(0,s.k6)((()=>[(0,s.bF)($,{src:h.closeOutline,color:"danger",slot:"start"},null,8,["src"]),(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(e.promo_name)+" / "+(0,a.v_)(e.promo_value)+" / "+(0,a.v_)(e.promo_share)+"%",1)])),_:2},1024),(0,s.Lk)("p",_,(0,a.v_)(e.expired_at),1)])),_:2},1024)))),128)),(0,s.bF)(g,{button:"",onClick:t[18]||(t[18]=e=>p.isAddPromoOpen=1)},{default:(0,s.k6)((()=>[(0,s.bF)($,{src:h.addOutline,slot:"start"},null,8,["src"]),(0,s.bF)(O,null,{default:(0,s.k6)((()=>[(0,s.eW)("Добавить скидку")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])):((0,s.uX)(),(0,s.CE)("div",m))]})),_:1})}l(3110);var p=l(5654),c=l(5480),b=l(2311),f=l.n(b),k=l(5538),v=l(8701),g={components:{IonTextarea:p.nc,IonInput:p.$w,IonCard:p.b_,IonCardHeader:p.ME,IonCardTitle:p.tN,IonCardContent:p.I9,IonGrid:p.lO,IonRow:p.ln,IonCol:p.hU,IonLabel:p.he,IonItem:p.uz,IonButton:p.Jm,IonList:p.nf,IonCheckbox:p.eY,IonText:p.IO,IonItemDivider:p.Dg,IonToggle:p.BY,IonIcon:p.iq,IonAccordion:p.xk,IonAccordionGroup:p.YH,IonModal:p.Sb,IonHeader:p.eU,IonContent:p.W9,IonToolbar:p.ai,IonTitle:p.BC},setup(){return{enterOutline:c.b9o,addOutline:c.EKF,trashOutline:c.P1A,searchOutline:c.jBE,documentTextOutline:c.pXZ,checkmarkOutline:c.g1L,closeOutline:c.xfX}},data(){var e,t;return{managed_user_id:null===(e=this.$route)||void 0===e||null===(t=e.query)||void 0===t?void 0:t.user_id,user:null,user_push_subs:null,promo_list:null,promo_list_expired:null,promo_name:null,promo_value:null,promo_minsum:null,promo_lifetime:null,isAdmin:v.A.isAdmin(),isAddPromoOpen:0,is_deleted:0,is_disabled:0}},ionViewDidEnter(){var e,t,l,s;this.managed_user_id!=(null===(e=this.$route)||void 0===e||null===(t=e.query)||void 0===t?void 0:t.user_id)&&(this.managed_user_id=null===(l=this.$route)||void 0===l||null===(s=l.query)||void 0===s?void 0:s.user_id,this.itemGet())},mounted(){this.itemGet()},computed:{message(){var e,t;return null!==(e=this.user)&&void 0!==e&&e.deleted_at?"Пользователь удален":1==(null===(t=this.user)||void 0===t?void 0:t.is_disabled)?"Пользователь заблокирован":null},messageClass(){var e,t;return null!==(e=this.user)&&void 0!==e&&e.deleted_at?"deleted":1==(null===(t=this.user)||void 0===t?void 0:t.is_disabled)?"disabled":null}},methods:{async itemGet(){if(0==this.managed_user_id){const e=await this.itemGetCreate();if(!e)return;this.managed_user_id=e}if(this.managed_user_id>0)try{this.user=await f().post(`${k.A.state.hostname}User/itemGet`,{user_id:this.managed_user_id}),this.user_push_subs=await f().post(`${k.A.state.hostname}MessageSub/listGet`,{user_id:this.managed_user_id}),this.promo_list=await f().post(`${k.A.state.hostname}Promo/listGet`,{user_id:this.managed_user_id,type:"active"}),this.promo_list_expired=await f().post(`${k.A.state.hostname}Promo/listGet`,{user_id:this.managed_user_id,type:"expired"})}catch(e){this.$flash("Не удалось загрузить пользователя")}else this.user={};this.itemParseFlags()},itemParseFlags(){this.user&&(this.is_deleted=null==this.user.deleted_at?0:1,this.is_disabled=0==this.user.is_disabled?0:1)},async itemGetCreate(){const e=prompt("Телефон нового пользователя");if(!e)return void setTimeout((()=>this.$go("/admin/list-moderation")),200);const t={name_query_fields:"user_phone",name_query:e,limit:1},l=await f().post(`${k.A.state.hostname}User/listGet`,t);if(l&&l[0])return l[0].user_id;const s={user_phone:e,user_name:"новый пользователь"};return this.itemCreate(s)},async itemCreate(e){try{return await f().post(`${k.A.state.hostname}User/itemCreate`,e)}catch(t){let e="unknown";try{const l=Object.keys(JSON.parse(t.responseJSON.messages.error))[0],s=Object.values(JSON.parse(t.responseJSON.messages.error))[0];e=l+"_"+s}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_required":this.$flash("Пароль обязателен для заполнения");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break;default:this.$flash("Не удалось зарегистрироваться")}return 0}},async itemDelete(e){if(!confirm("Вы уверенны?"))return;const t=e?"itemDelete":"itemUnDelete";try{await f().post(k.A.state.hostname+"user/"+t,{user_id:this.user.user_id}),this.user.deleted_at=e?1:null}catch{}this.itemGet()},async itemDisable(e){if(this.user.is_disabled!=e)try{await f().post(k.A.state.hostname+"User/itemDisable",{user_id:this.user.user_id,is_disabled:e}),this.user.is_disabled=e}catch{this.itemGet()}},async itemSignInById(e){if(!confirm(`Войти в профиль пользователя ${this.user.user_name}?`))return;this.$flash("Выходим из админ профиля");const t={user_id:e};await f().post(`${k.A.state.hostname}User/signInById`,t),await this.$go("/")},async updateUser(e){const t=e.target.name,l=this.user[t],s={user_id:this.user.user_id,[t]:l};try{await f().post(k.A.state.hostname+"User/itemUpdate",JSON.stringify(s)),this.$flash("Сохранено")}catch(a){this.$flash("Ошибка сохранения"),this.itemGet()}},async updateUserDelayed(e){setTimeout((()=>this.updateUser(e)),200)},async promoCreate(){const e=100*this.promo_value/this.promo_minsum,t={owner_id:this.managed_user_id,promo_name:this.promo_name,promo_value:this.promo_value,promo_share:e,promo_lifetime:this.promo_lifetime};this.promo_lifetime&&this.promo_name&&this.promo_value&&!(this.promo_value>this.promo_minsum)?(await f().post(k.A.state.hostname+"Promo/itemCreate",t),this.isAddPromoOpen=0,this.$flash("Скидка создана"),this.itemGet()):this.$flash("Проверьте форму!")}}},F=l(6262);const y=(0,F.A)(g,[["render",h],["__scopeId","data-v-e3b765fa"]]);var I=y}}]);
//# sourceMappingURL=375.bdcbae00.js.map