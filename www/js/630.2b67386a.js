"use strict";(self["webpackChunktezkel_delivery"]=self["webpackChunktezkel_delivery"]||[]).push([[630],{4405:function(e,t,o){var r=o(2008);const n={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const t=e.locations[0].distance,o=e.store_time_preparation||0;return n.deliveryTimeCalculate(t,o)},deliveryTimeCalculate(e,t){t=parseInt(t??r.Z.getters.settings.delivery.timePreparationDefault);const o=parseInt(r.Z.getters.settings.delivery.timeDelta),n=parseInt(r.Z.getters.settings.delivery.speed),i=5*Math.round(e/n*60/5)+t,a=i>o?i-o:i,s=a+o;return{time:i,timeMin:a,timeMax:s}}};t["Z"]=n},1272:function(e,t,o){o.d(t,{Z:function(){return W}});var r=o(6252),n=o(3577);const i={class:"center"},a={key:0,class:"rightend"},s=(0,r.Uk)("мин"),l={key:1,class:"rightend"},d=(0,r.Uk)(" Выбрать адрес доставки ");function c(e,t,o,c,u,m){const p=(0,r.up)("ion-img"),h=(0,r.up)("ion-text"),_=(0,r.up)("ion-note"),y=(0,r.up)("ion-icon"),w=(0,r.up)("ion-label"),k=(0,r.up)("ion-item"),f=(0,r.up)("ion-textarea");return(0,r.wg)(),(0,r.iD)(r.HY,null,[m.isMainLocationSet?((0,r.wg)(),(0,r.iD)("div",{key:0,onClick:t[0]||(t[0]=e=>m.selectDeliveryAddress()),class:"selector"},[(0,r._)("div",i,[u.location_main.image_hash?((0,r.wg)(),(0,r.j4)(p,{key:0,src:e.$heap.state.hostname+"image/get.php/"+u.location_main.image_hash+".40.40.webp"},null,8,["src"])):(0,r.kq)("",!0),(0,r.Wm)(h,{style:{margin:"5px","font-size":"0.7em"},color:"dark"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(e.$heap.state.user?.location_main?.location_address),1)])),_:1})]),o.deliveryTime?((0,r.wg)(),(0,r.iD)("div",a,[(0,r.Wm)(h,{style:{"font-size":"24px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(o.deliveryTime.time),1)])),_:1}),(0,r.Wm)(_,{style:{"font-size":"10px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,r.w5)((()=>[s])),_:1})])):((0,r.wg)(),(0,r.iD)("div",l))])):((0,r.wg)(),(0,r.j4)(k,{key:1,detail:"",button:"",onClick:t[1]||(t[1]=e=>m.selectDeliveryAddress()),class:"selector"},{default:(0,r.w5)((()=>[(0,r.Wm)(y,{slot:"start",style:{color:"var(--ion-color-primary)"},icon:c.location},null,8,["icon"]),(0,r.Wm)(w,null,{default:(0,r.w5)((()=>[d])),_:1})])),_:1})),o.showComment&&e.$heap.state.user.location_main?((0,r.wg)(),(0,r.j4)(k,{key:2},{default:(0,r.w5)((()=>[(0,r.Wm)(f,{placeholder:"комментарий к адресу",onChange:t[2]||(t[2]=e=>m.locationCommentChanged()),modelValue:e.$heap.state.user.location_main.location_comment,"onUpdate:modelValue":t[3]||(t[3]=t=>e.$heap.state.user.location_main.location_comment=t)},null,8,["modelValue"])])),_:1})):(0,r.kq)("",!0)],64)}var u=o(9632),m=o(8903),p=o(2008),h=o(9023),_=o(9042),y=o(9755),w=o.n(y),k={props:["deliveryTime","showComment"],components:{IonIcon:u.gu,IonTextarea:u.g2,IonImg:u.Xz,IonText:u.yW,IonNote:u.uN,IonLabel:u.Q$,IonItem:u.Ie},setup(){return{location:m.xhW}},data(){return{location_main:p.Z.state.user.location_main}},created(){let e=this;_.Z.on("userMainLocationSet",(t=>{e.location_main=t})),_.Z.on("userGet",(t=>{e.location_main=t.location_main}))},methods:{selectDeliveryAddress(){h.Z.push("user-addresses")},async locationCommentChanged(){const e={location_id:p.Z.state.user.location_main.location_id,location_comment:p.Z.state.user.location_main.location_comment};w().post(this.$heap.state.hostname+"Location/itemUpdate",JSON.stringify(e))}},computed:{isSignedIn(){return p.Z.state.user.user_id&&p.Z.state.user.user_id>-1},isMainLocationSet(){return this.location_main?1:0}}},f=o(3744);const g=(0,f.Z)(k,[["render",c],["__scopeId","data-v-45e69907"]]);var W=g},201:function(e,t,o){o.r(t),o.d(t,{default:function(){return te}});var r=o(6252),n=o(3577);const i=e=>((0,r.dD)("data-v-43fa20e3"),e=e(),(0,r.Cn)(),e),a=(0,r.Uk)("Заказ"),s=(0,r.Uk)(" Номер "),l=(0,r.Uk)("Итог"),d=(0,r.Uk)(" Сумма заказа "),c={slot:"start"},u={class:"righttop_badge"},m={slot:"start"},p={class:"righttop_badge"},h=(0,r.Uk)(" Выберите скидку "),_=(0,r.Uk)(" Налоги "),y=(0,r.Uk)(" Доставка "),w=(0,r.Uk)(" Итого к оплате "),k=(0,r.Uk)("Способы оплаты"),f=i((()=>(0,r._)("label",{for:"payment_card"},"Оплата картой",-1))),g={slot:"end"},W=["checked"],I=(0,r.Uk)(" Я согласен(на) с "),v=(0,r.Uk)("Вернуться"),$=(0,r.Uk)("Продолжить");function C(e,t,o,i,C,U){const b=(0,r.up)("user-address-widget"),z=(0,r.up)("ion-item-divider"),O=(0,r.up)("ion-icon"),T=(0,r.up)("ion-text"),D=(0,r.up)("ion-item"),L=(0,r.up)("ion-textarea"),x=(0,r.up)("ion-badge"),G=(0,r.up)("ion-checkbox"),Z=(0,r.up)("ion-list"),S=(0,r.up)("ion-card-content"),q=(0,r.up)("ion-card"),P=(0,r.up)("ion-col"),j=(0,r.up)("ion-row"),M=(0,r.up)("ion-button"),A=(0,r.up)("ion-grid"),F=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(F,{pageTitle:"Оформление заказа",pageDefaultBackLink:C.order?`/order-${C.order.order_id}`:"order-list"},{default:(0,r.w5)((()=>[(0,r.Wm)(b,{deliveryTime:C.deliveryTime,showComment:"1"},null,8,["deliveryTime"]),C.order?((0,r.wg)(),(0,r.j4)(Z,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(z,null,{default:(0,r.w5)((()=>[a])),_:1}),(0,r.Wm)(D,null,{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.ordersIcon,slot:"start",color:"primary"},null,8,["icon"]),s,(0,r.Wm)(T,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)("#"+(0,n.zw)(C.order?.order_id),1)])),_:1})])),_:1}),(0,r.Wm)(D,null,{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.storefrontOutline,slot:"start",color:"primary"},null,8,["icon"]),(0,r.Uk)(' Из "'+(0,n.zw)(C.order?.store.store_name)+'" ',1)])),_:1}),(0,r.Wm)(D,null,{default:(0,r.w5)((()=>[(0,r.Wm)(L,{rows:"3",placeholder:"комментарий к заказу",onChange:t[0]||(t[0]=e=>U.orderDescriptionChanged()),modelValue:C.order.order_description,"onUpdate:modelValue":t[1]||(t[1]=e=>C.order.order_description=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(z,null,{default:(0,r.w5)((()=>[l])),_:1}),(0,r.Wm)(D,null,{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.cubeOutline,slot:"start",color:"primary"},null,8,["icon"]),d,(0,r.Wm)(T,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(C.order.order_sum_product)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),C.promo?((0,r.wg)(),(0,r.j4)(D,{key:0,button:"",onClick:t[2]||(t[2]=e=>U.promoPick()),color:"success"},{default:(0,r.w5)((()=>[(0,r._)("div",c,[(0,r.Wm)(O,{icon:i.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,r._)("sup",u,[C.promoCount>0?((0,r.wg)(),(0,r.j4)(x,{key:0,color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(C.promoCount),1)])),_:1})):(0,r.kq)("",!0)])]),(0,r.Uk)(" "+(0,n.zw)(C.promo.promo_name)+" ",1),(0,r.Wm)(T,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)("-"+(0,n.zw)(C.order.order_sum_promo)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):((0,r.wg)(),(0,r.j4)(D,{key:1,button:"",detail:"",onClick:t[3]||(t[3]=e=>U.promoPick())},{default:(0,r.w5)((()=>[(0,r._)("div",m,[(0,r.Wm)(O,{icon:i.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,r._)("sup",p,[C.promoCount>0?((0,r.wg)(),(0,r.j4)(x,{key:0,color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(C.promoCount),1)])),_:1})):(0,r.kq)("",!0)])]),h])),_:1})),C.order?.order_sum_tax>0?((0,r.wg)(),(0,r.j4)(D,{key:2},{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.pieChartOutline,slot:"start",color:"primary"},null,8,["icon"]),_,(0,r.Wm)(T,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(C.order?.order_sum_tax)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(D,null,{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),y,(0,r.Wm)(T,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(C.order?.order_sum_delivery??0)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),C.order?.order_sum_total>0?((0,r.wg)(),(0,r.j4)(D,{key:3},{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.walletOutline,slot:"start",color:"primary"},null,8,["icon"]),w,(0,r.Wm)(T,{slot:"end",color:"primary"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(C.order?.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(z,null,{default:(0,r.w5)((()=>[k])),_:1}),(0,r.Wm)(D,{button:"",onClick:t[4]||(t[4]=e=>C.paymentType="payment_card")},{default:(0,r.w5)((()=>[(0,r.Wm)(O,{icon:i.cardOutline,slot:"start",color:"primary"},null,8,["icon"]),f,(0,r._)("div",g,[(0,r._)("input",{type:"radio",name:"paymentType",id:"payment_card",value:"card",checked:"payment_card"==C.paymentType},null,8,W)])])),_:1}),(0,r.kq)("",!0),(0,r.Wm)(D,{lines:"none"},{default:(0,r.w5)((()=>[(0,r.Wm)(T,{style:{"font-size":"0.9em"}},{default:(0,r.w5)((()=>[I,(0,r._)("a",{href:"#/page-customer_contract",onClick:t[6]||(t[6]=t=>e.$router.push("/page-customer_contract"))},"офертой об оказании услуг доставки")])),_:1}),(0,r.Wm)(G,{slot:"end",modelValue:C.termsAccepted,"onUpdate:modelValue":t[7]||(t[7]=e=>C.termsAccepted=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(A,null,{default:(0,r.w5)((()=>[U.checkoutError?((0,r.wg)(),(0,r.j4)(j,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(P,null,{default:(0,r.w5)((()=>[(0,r.Wm)(q,{color:"warning"},{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(U.checkoutError),1)])),_:1})])),_:1})])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(j,null,{default:(0,r.w5)((()=>[(0,r.Wm)(P,null,{default:(0,r.w5)((()=>[(0,r.Wm)(M,{expand:"block",color:"medium",onClick:t[8]||(t[8]=e=>U.cancel())},{default:(0,r.w5)((()=>[v])),_:1})])),_:1}),(0,r.Wm)(P,null,{default:(0,r.w5)((()=>[(0,r.Wm)(M,{expand:"block",onClick:t[9]||(t[9]=e=>U.proceed()),disabled:U.checkoutError},{default:(0,r.w5)((()=>[$])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1},8,["pageDefaultBackLink"])}var U=o(7782),b=o(4405),z=o(9042),O=o(9023),T=o(9755),D=o.n(T),L=o(8764),x=o(8903),G=o(9632),Z=o(1272);const S=(0,r.Uk)("Оплата картой"),q=["src"],P={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},j=["src"];function M(e,t,o,n,i,a){const s=(0,r.up)("ion-title"),l=(0,r.up)("ion-icon"),d=(0,r.up)("ion-toolbar"),c=(0,r.up)("ion-header"),u=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Wm)(s,{slot:"start"},{default:(0,r.w5)((()=>[S])),_:1}),(0,r.Wm)(l,{icon:n.closeOutline,onClick:t[0]||(t[0]=e=>{n.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r._)("iframe",{src:i.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"600px",border:"none"},onLoad:t[1]||(t[1]=e=>a.onLoad())},null,40,q),i.loadAnimation?((0,r.wg)(),(0,r.iD)("div",P,[(0,r._)("img",{src:n.loading},null,8,j)])):(0,r.kq)("",!0)])),_:1})],64)}var A=o.p+"img/loading.30880178.svg",F={components:{IonTitle:G.wd,IonIcon:G.gu,IonToolbar:G.sr,IonHeader:G.Gu,IonContent:G.W2},props:["order_data"],setup(){const e=function(){G.Fy.dismiss()};return{closeModal:e,closeOutline:x.fID,loading:A}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{async postToIframe(){try{this.paymentLink=await D().post(this.$heap.state.hostname+"UniPayments/paymentLinkGet",this.order_data)}catch(e){this.$flash("Нет возможности принять оплату картой"),this.closeModal()}},onLoad(){this.loadAnimation=0},listenFrame(){let e=this;window.addEventListener("message",(t=>{"paymentOk"!=t.data&&"paymentNo"!=t.data||e.closeModal()}))}}},H=o(3744);const V=(0,H.Z)(F,[["render",M]]);var R=V;const B=(0,r.Uk)("Ваши скидки"),N=(0,r.Uk)("Без скидки"),Y=(0,r.Uk)("Показать все ваши скидки");function E(e,t,o,i,a,s){const l=(0,r.up)("ion-title"),d=(0,r.up)("ion-icon"),c=(0,r.up)("ion-toolbar"),u=(0,r.up)("ion-header"),m=(0,r.up)("ion-skeleton-text"),p=(0,r.up)("ion-item"),h=(0,r.up)("ion-list"),_=(0,r.up)("ion-text"),y=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c,{color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Wm)(l,null,{default:(0,r.w5)((()=>[B])),_:1}),(0,r.Wm)(d,{icon:i.closeOutline,onClick:t[0]||(t[0]=t=>e.$topic.publish("dismissModal")),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((()=>[null==a.promoList?((0,r.wg)(),(0,r.j4)(h,{key:0},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.iD)(r.HY,null,(0,r.Ko)([1,2,3],(e=>(0,r.Wm)(p,{lines:"none",key:e},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:i.giftOutline,color:"primary"},null,8,["icon"]),(0,r.Wm)(m,{style:{width:"70%"}}),(0,r.Wm)(m,{slot:"end",style:{width:"50px"}})])),_:2},1024))),64))])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(h,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(a.promoList,(t=>((0,r.wg)(),(0,r.j4)(p,{key:t.promo_id,button:"",onClick:e=>s.promoPick(t)},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:i.giftOutline,color:"primary"},null,8,["icon"]),(0,r.Wm)(_,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(t.promo_name),1)])),_:2},1024),(0,r.Wm)(_,{slot:"end",color:"success"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(t.promo_value)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),(0,r.Wm)(p,{button:"",onClick:t[1]||(t[1]=e=>s.promoPick({}))},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:i.banOutline,color:"danger"},null,8,["icon"]),(0,r.Wm)(_,null,{default:(0,r.w5)((()=>[N])),_:1}),(0,r.Wm)(_,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)("0"+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),(0,r.Wm)(p,{button:"",detail:"",onClick:t[2]||(t[2]=t=>{e.$router.push("user-promo"),e.$topic.publish("dismissModal")})},{default:(0,r.w5)((()=>[(0,r.Wm)(_,null,{default:(0,r.w5)((()=>[Y])),_:1})])),_:1})])),_:1})])),_:1})],64)}var K={components:{IonIcon:G.gu,IonToolbar:G.sr,IonHeader:G.Gu,IonContent:G.W2,IonTitle:G.wd,IonList:G.q_,IonItem:G.Ie,IonText:G.yW,IonSkeletonText:G.CK},setup(){return{giftOutline:x._$o,closeOutline:x.fID,banOutline:x.L6S}},data(){return{promoList:null}},mounted(){this.listGet()},methods:{async listGet(){try{const e={type:"active"};this.promoList=await D().post(`${this.$heap.state.hostname}Promo/listGet`,e)}catch{}},promoPick(e){G.Fy.dismiss(e)}}};const J=(0,H.Z)(K,[["render",E]]);var X=J,Q={components:{UserAddressWidget:Z.Z,IonTextarea:G.g2,IonItemDivider:G.rH,IonIcon:G.gu,IonItem:G.Ie,IonList:G.q_,IonText:G.yW,IonItemGroup:G.Ub,IonButton:G.YG,IonCol:G.wI,IonRow:G.Nd,IonGrid:G.jY,IonCheckbox:G.nz,IonCard:G.PM,IonCardHeader:G.Zi,IonCardContent:G.FN,IonCardTitle:G.Dq,IonBadge:G.yp},setup(){return{cardOutline:x.pvm,cashOutline:x.zaw,giftOutline:x._$o,cubeOutline:x.XFf,walletOutline:x.S5P,pieChartOutline:x.qlh,storefrontOutline:x.qRG,ordersIcon:L,rocketOutline:x.G$D,documentTextOutline:x.L82}},data(){return{order:null,promo:null,promoCount:0,deliveryTime:{},paymentType:"payment_card",termsAccepted:1,storeIsReady:0}},computed:{checkoutError(){return!!this.order&&(this.order.order_sum_total<2*this.order.order_sum_promo?`Сумма к оплате со скидкой ${this.order.order_sum_promo}${this.$heap.state.currencySign} должна быть больше чем ${2*this.order.order_sum_promo}${this.$heap.state.currencySign}`:1*this.order.order_sum_product<1*this.order.store.store_minimal_order?`Сумма заказа у "${this.order.store.store_name}" должна быть больше чем ${this.order.store.store_minimal_order}${this.$heap.state.currencySign}`:1*this.order.order_sum_total<=1*this.order.order_sum_delivery?`Сумма к оплате должна быть больше чем ${this.order.order_sum_delivery}${this.$heap.state.currencySign}`:this.order.order_sum_total<=10?"Сумма к оплате слишком маленькая":0==this.storeIsReady?`К сожалению, "${this.order.store.store_name}" не готов к заказам`:0==this.termsAccepted&&"К сожалению, мы не можем доставить вам заказ, без согласия с условиями")}},mounted(){this.checkoutDataGet()},ionViewDidEnter(){this.checkoutDataGet()},methods:{async itemLoad(){try{this.order=await D().post(`${this.$heap.state.hostname}Order/itemGet`,{order_id:this.order.order_id}),this.$heap.commit("setCurrentOrder",this.order)}catch{}},async checkoutDataGet(){if(this.order=this.$heap.state.currentOrder,!this.order)return this.$flash("Заказ не найден"),void this.$router.push("/order-list");"customer_confirmed"==this.order.stage_current?(this.storeIsReady=await this.storeReadinessCheck(),this.deliveryTime=await this.deliveryTimeGet(),this.promo=await this.promoGet(),this.promoCount=await this.promoCountGet()):O.Z.push("order-"+this.order.order_id)},async storeReadinessCheck(){try{return await D().post(`${this.$heap.state.hostname}Store/itemIsReady`,{store_id:this.order.order_store_id})}catch{return!1}},async deliveryTimeGet(){const e={start_holder:"store",start_holder_id:this.order.order_store_id,finish_holder:"user",finish_holder_id:this.order.owner_id};try{const t=null,o=await D().post(this.$heap.state.hostname+"Location/distanceHolderGet",e);return b.Z.deliveryTimeCalculate(o,t)}catch{}},async orderDescriptionChanged(){const e={order_id:this.order.order_id,order_description:this.order.order_description};U.Z.api.itemUpdate(e)},async proceed(){this.paymentType,"payment_card"==this.paymentType&&this.paymentFormOpen({order_id:this.order.order_id,order_sum_total:this.order.order_sum_total,user_id:this.order.owner_id})},async cancel(){this.$router.push("order-"+this.order.order_id)},async paymentFormOpen(e){const t=this,o=await G.Fy.create({component:R,componentProps:{order_data:e},initialBreakpoint:.85,breakpoints:[0,.85,.95]}),r=function(){o.dismiss()};return z.Z.on("dismissModal",r),o.onDidDismiss().then((()=>{t.paymentStatusCheck()})),o.present()},async paymentStatusCheck(){const e={order_id:this.order.order_id};try{const t=await D().post(this.$heap.state.hostname+"UniPayments/paymentStatusRequest",e);"OK"==t&&O.Z.push("order-"+this.order.order_id)}catch(t){this.$flash("Данный заказ не может быть оплачен");const e=t.responseJSON?.messages?.error;"wrong_status"==e&&O.Z.push("order-"+this.order.order_id)}},async promoPick(){const e=await G.Fy.create({component:X,showBackdrop:!0,backdropDismiss:!0,initialBreakpoint:.6,breakpoints:[0,.6,.75]});e.present(),this.$topic.on("dismissModal",(()=>{e.dismiss()}));const t=await e.onDidDismiss();this.promoLink(t.data),this.promo=t?.data?.promo_id?t.data:null},async promoLink(e){try{const t={promo_id:e?.promo_id,order_id:this.order.order_id};await D().post(`${this.$heap.state.hostname}Promo/itemLink`,t),this.itemLoad()}catch(t){}},async promoGet(){try{const e={order_id:this.order.order_id};return await D().post(`${this.$heap.state.hostname}Promo/itemLinkGet`,e)}catch(e){}},async promoCountGet(){try{const e={mode:"count"};return await D().post(`${this.$heap.state.hostname}Promo/listGet`,e)}catch(e){}}}};const ee=(0,H.Z)(Q,[["render",C],["__scopeId","data-v-43fa20e3"]]);var te=ee}}]);
//# sourceMappingURL=630.2b67386a.js.map