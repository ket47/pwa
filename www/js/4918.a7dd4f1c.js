"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[4918],{4918:function(t,o,e){e.r(o),e.d(o,{default:function(){return b}});var i=e(641),n=e(33);const a={style:{color:"var(--ion-color-primary)"}},s={class:"ion-padding"};function l(t,o,e,l,c,r){const d=(0,i.g2)("ion-skeleton-text"),u=(0,i.g2)("ion-card-title"),h=(0,i.g2)("ion-card-header"),p=(0,i.g2)("ion-card-content"),m=(0,i.g2)("ion-card"),_=(0,i.g2)("ion-item"),g=(0,i.g2)("ion-icon"),k=(0,i.g2)("ion-label"),f=(0,i.g2)("ion-chip"),b=(0,i.g2)("ion-list"),y=(0,i.g2)("ion-img"),v=(0,i.g2)("ion-button"),x=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(x,{"page-title":"Мои адреса",ref:"UserAddressPage"},{default:(0,i.k6)(()=>[null==c.locationList?((0,i.uX)(),(0,i.Wv)(m,{key:0},{default:(0,i.k6)(()=>[(0,i.bF)(h,null,{default:(0,i.k6)(()=>[(0,i.bF)(u,null,{default:(0,i.k6)(()=>[(0,i.bF)(d,{animated:"",style:{width:"190px",height:"30px"}})]),_:1})]),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)(()=>[(0,i.Lk)("p",null,[(0,i.bF)(d,{animated:"",style:{width:"250px"}}),o[6]||(o[6]=(0,i.eW)()),(0,i.bF)(d,{animated:""})])]),_:1})]),_:1})):r.mainAddress?((0,i.uX)(),(0,i.Wv)(m,{key:1},{default:(0,i.k6)(()=>[(0,i.bF)(h,null,{default:(0,i.k6)(()=>[(0,i.bF)(u,null,{default:(0,i.k6)(()=>o[7]||(o[7]=[(0,i.eW)(" Адрес доставки ")])),_:1,__:[7]})]),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)(()=>[(0,i.Lk)("p",null,[(0,i.Lk)("b",a,(0,n.v_)(r.mainAddress.location_address),1),o[8]||(o[8]=(0,i.eW)(", выбран как адрес доставки заказов."))])]),_:1})]),_:1})):((0,i.uX)(),(0,i.Wv)(m,{key:2},{default:(0,i.k6)(()=>[(0,i.bF)(h,null,{default:(0,i.k6)(()=>[(0,i.bF)(u,null,{default:(0,i.k6)(()=>o[9]||(o[9]=[(0,i.eW)(" Добавьте адрес ")])),_:1,__:[9]})]),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)(()=>o[10]||(o[10]=[(0,i.Lk)("p",null,"Нам нужно знать куда привезти ваш заказ",-1)])),_:1,__:[10]})]),_:1})),null==c.locationList?((0,i.uX)(),(0,i.Wv)(b,{key:3,lines:"none"},{default:(0,i.k6)(()=>[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([1,2,3],t=>(0,i.Lk)("div",{key:t,style:{padding:"5px"}},[(0,i.bF)(_,{button:"",detail:""},{default:(0,i.k6)(()=>[(0,i.bF)(d,{slot:"start",style:{height:"30px",width:"30px"},animated:""}),(0,i.bF)(d,{animated:""})]),_:1}),1==t?((0,i.uX)(),(0,i.Wv)(_,{key:0,lines:"full"},{default:(0,i.k6)(()=>[(0,i.Lk)("div",null,[(0,i.bF)(f,{color:"medium"},{default:(0,i.k6)(()=>[(0,i.bF)(g,{src:l.addOutline},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)(()=>[(0,i.bF)(d,{style:{width:"70px"},animated:""})]),_:1})]),_:1}),(0,i.bF)(f,{color:"medium"},{default:(0,i.k6)(()=>[(0,i.bF)(g,{src:l.addOutline},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)(()=>[(0,i.bF)(d,{style:{width:"70px"},animated:""})]),_:1})]),_:1})]),(0,i.bF)(d,{slot:"end",style:{height:"30px",width:"30px","border-radius":"40px"},animated:""})]),_:1})):(0,i.Q3)("",!0)])),64))]),_:1})):c.locationList.length?((0,i.uX)(),(0,i.Wv)(b,{key:4,lines:"none"},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(c.locationList,(e,a)=>((0,i.uX)(),(0,i.CE)("div",{key:e.location_id},[(0,i.bF)(_,{button:"",detail:"",onClick:t=>r.locationSetMain(`${e.location_id}`,`${a}`)},{default:(0,i.k6)(()=>[(0,i.bF)(y,{slot:"start",alt:"",src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.bF)(k,{style:{"white-space":"normal",cursor:"pointer"},class:(0,n.C4)(1==e.is_main?"is_main":"")},{default:(0,i.k6)(()=>[(0,i.eW)((0,n.v_)(e.location_address),1)]),_:2},1032,["class"])]),_:2},1032,["onClick"]),1==e.is_main?((0,i.uX)(),(0,i.Wv)(_,{key:0,lines:"full"},{default:(0,i.k6)(()=>[(0,i.Lk)("div",null,[e.location_comment?((0,i.uX)(),(0,i.CE)("div",{key:0,onClick:o[0]||(o[0]=t=>r.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"15px",display:"inline-block"}},(0,n.v_)(e.location_comment),1)):((0,i.uX)(),(0,i.Wv)(f,{key:1,color:"medium",onClick:o[1]||(o[1]=t=>r.locationCommentEdit("locationStart"))},{default:(0,i.k6)(()=>[(0,i.bF)(g,{src:l.addOutline},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)(()=>o[11]||(o[11]=[(0,i.eW)("комментарий")])),_:1,__:[11]})]),_:1})),e.location_phone>0?((0,i.uX)(),(0,i.Wv)(f,{key:2,color:"medium",onClick:o[2]||(o[2]=t=>r.locationPhoneEdit("locationStart"))},{default:(0,i.k6)(()=>[(0,i.bF)(g,{src:l.callOutline},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)(()=>[(0,i.eW)("+"+(0,n.v_)(e.location_phone),1)]),_:2},1024)]),_:2},1024)):((0,i.uX)(),(0,i.Wv)(f,{key:3,color:"medium",onClick:o[3]||(o[3]=t=>r.locationPhoneEdit("locationStart"))},{default:(0,i.k6)(()=>[(0,i.bF)(g,{src:l.addOutline},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)(()=>o[12]||(o[12]=[(0,i.eW)("телефон")])),_:1,__:[12]})]),_:1}))]),(0,i.bF)(g,{slot:"end",icon:l.trashOutline,onClick:t=>r.locationDelete(`${e.location_id}`,`${a}`),color:"medium"},null,8,["icon","onClick"])]),_:2},1024)):(0,i.Q3)("",!0)]))),128))]),_:1})):(0,i.Q3)("",!0),(0,i.Lk)("div",s,[(0,i.bF)(v,{expand:"block",onClick:o[4]||(o[4]=t=>r.modalLocationCreate())},{default:(0,i.k6)(()=>[(0,i.bF)(g,{src:l.locationOutline,slot:"start"},null,8,["src"]),o[13]||(o[13]=(0,i.eW)(" Добавить адрес"))]),_:1,__:[13]}),(0,i.bF)(v,{onClick:o[5]||(o[5]=o=>t.$router.go(-1)),color:"light",expand:"block"},{default:(0,i.k6)(()=>o[14]||(o[14]=[(0,i.eW)("Назад")])),_:1,__:[14]})])]),_:1},512)}e(8111),e(116);var c=e(5634),r=e(9983),d=e(5538),u=e(8701),h=e(2311),p=e.n(h),m=e(8926),_=e(5480),g={name:"UserAddresses",components:{IonImg:c.KW,IonLabel:c.he,IonItem:c.uz,IonList:c.nf,IonIcon:c.iq,IonCard:c.b_,IonCardHeader:c.ME,IonCardContent:c.I9,IonCardTitle:c.tN,IonChip:c.ZB,IonButton:c.Jm,IonSkeletonText:c.ds},setup(){return{locationOutline:_.UN$,trashOutline:_.P1A,addOutline:_.EKF,callOutline:_.bNN}},data(){return{locationList:null,locationGroupList:[],is_loading:0}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find(t=>1==t.is_main)}},methods:{async modalLocationCreate(){if(!d.A.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/modal/user-authorize"));const t=await c.OZ.create({component:m.A,showBackdrop:!0,componentProps:{locationGroupList:this.locationGroupList}});return t.onDidDismiss().then(t=>{const o=t.data;o&&this.locationCreate(o)}),t.present()},async locationListGet(){try{var t,o;let e=null;const i=await p().get(d.A.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=i.location_list||[],this.locationGroupList=i.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(e=t);if(e||this.modalLocationCreate(),!e)return void u.A.get();e&&(null===(t=e)||void 0===t?void 0:t.location_id)!=(null===(o=d.A.state.user.location_main)||void 0===o?void 0:o.location_id)&&(d.A.state.user.location_main=e,this.$topic.publish("userMainLocationSet",d.A.state.user.location_main))}catch{}},async locationCreate(t){let o={location_holder:"user",location_holder_id:d.A.state.user.user_id,location_group_id:t.location_group_id,location_address:t.location_address,location_latitude:t.location_latitude,location_longitude:t.location_longitude,location_comment:t.location_comment};try{await p().post(d.A.state.hostname+"User/locationCreate",o),this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(e){const t=e.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,o){this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null);const e=this.locationList[o];d.A.state.user.location_main={location_id:e.location_id,location_latitude:e.location_latitude,location_longitude:e.location_longitude,location_address:e.location_address,location_phone:e.location_phone,location_comment:e.location_comment,image_hash:e.image_hash},this.$topic.publish("userMainLocationSet",d.A.state.user.location_main),await p().post(d.A.state.hostname+"User/locationSetMain",{location_id:t}),this.$flash("Адрес доставки изменен"),this.locationListGet()},async locationDelete(t,o){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(o,1),await p().post(d.A.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()}},async locationCurrentSet(){const t=await c.FJ.create({message:"Определяем ваше местоположение"});t.present();try{await u.A.geo.locationCurrentGet(),this.$flash("Ваше местоположение определено")}catch(o){this.$flash("Не удалось получить ваше местоположение")}t.dismiss(),r.A.go(-1)},async locationUpdate(t){await p().post(d.A.state.hostname+"Location/itemUpdate",JSON.stringify(t)),this.$flash("Сохранено"),this.locationListGet()},async locationPhoneEdit(t){let o=d.A.state.user.location_main.location_phone??"";const e=await c.TN.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:o}]});try{await e.present();const{data:t,role:i}=await e.onDidDismiss();if("confirm"==i&&(o=t.values.phone.replace(/\D/g,"").replace(/^7/,""),o)){if(10!=o.length)return void this.$flash("Проверьте правильность телефона");o="+7"+o}"cancel"==i&&(o=""),d.A.state.user.location_main.location_phone=o;const n={location_id:d.A.state.user.location_main.location_id,location_phone:o};this.locationUpdate(n)}catch(i){console.log(i)}},async locationCommentEdit(t){let o=d.A.state.user.location_main.location_comment??"";const e=await c.TN.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:o}]});try{await e.present();const{data:t,role:i}=await e.onDidDismiss();o=t.values.comment,"cancel"==i&&(o=""),d.A.state.user.location_main.location_comment=o;const n={location_id:d.A.state.user.location_main.location_id,location_comment:o};this.locationUpdate(n)}catch(i){console.log(i)}}}},k=e(6262);const f=(0,k.A)(g,[["render",l],["__scopeId","data-v-3f2b1c88"]]);var b=f},8926:function(t,o,e){e.d(o,{A:function(){return v}});var i=e(641),n=e(33),a=e(3751);const s={style:{position:"absolute",bottom:"10px",width:"100%"}},l={style:{"margin-left":"12px","margin-right":"12px","background-color":"#ffffffdd","--ion-item-background":"#ffffff00","border-top-left-radius":"10px","border-top-right-radius":"10px"}},c={key:0},r={key:1},d={slot:"end",style:{color:"#666"}},u={style:{width:"100%"}},h={style:{display:"grid","grid-template-columns":"1fr 1fr"}};function p(t,o,e,p,m,_){const g=(0,i.g2)("ymap-marker"),k=(0,i.g2)("yandex-map"),f=(0,i.g2)("ion-item"),b=(0,i.g2)("ion-searchbar"),y=(0,i.g2)("ion-content"),v=(0,i.g2)("ion-img"),x=(0,i.g2)("ion-label"),C=(0,i.g2)("ion-segment-button"),F=(0,i.g2)("ion-segment"),L=(0,i.g2)("ion-input"),A=(0,i.g2)("ion-icon"),w=(0,i.g2)("ion-button"),I=(0,i.g2)("ion-toolbar");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(y,null,{default:(0,i.k6)(()=>[m.showed?((0,i.uX)(),(0,i.Wv)(k,{key:0,onClick:o[0]||(o[0]=t=>{_.onClick(t)}),style:{height:"100%"},coords:m.coords,zoom:16,settings:m.settings,controls:["zoomControl"]},{default:(0,i.k6)(()=>[(0,i.bF)(g,{coords:m.coords,"marker-id":"1",properties:_.placemarkProperties},null,8,["coords","properties"])]),_:1},8,["coords","settings"])):(0,i.Q3)("",!0),(0,i.Lk)("div",s,[(0,i.Lk)("div",l,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(m.suggestions,(t,o)=>((0,i.uX)(),(0,i.Wv)(f,{key:o,onClick:o=>_.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),lines:"full"},{default:(0,i.k6)(()=>[0==o?((0,i.uX)(),(0,i.CE)("p",c,[(0,i.Lk)("b",null,(0,n.v_)(t.subtitle.text)+" "+(0,n.v_)(t.title.text),1)])):((0,i.uX)(),(0,i.CE)("p",r,(0,n.v_)(t.subtitle.text)+" "+(0,n.v_)(t.title.text),1)),(0,i.Lk)("span",d,(0,n.v_)(t.distance.text),1)]),_:2},1032,["onClick"]))),128))]),(0,i.bF)(b,{debounce:"500",modelValue:m.addressSearchQuery,"onUpdate:modelValue":o[1]||(o[1]=t=>m.addressSearchQuery=t),onIonInput:o[2]||(o[2]=t=>_.suggestionsGet()),onKeyup:o[3]||(o[3]=(0,a.jR)(t=>_.pickAddress(),["enter"])),placeholder:"поиск по адресу",class:"search"},null,8,["modelValue"])])]),_:1}),(0,i.bF)(I,{style:{"--background":"white"}},{default:(0,i.k6)(()=>[(0,i.Lk)("div",u,[m.locationGroups?((0,i.uX)(),(0,i.Wv)(F,{key:0,mode:"ios",modelValue:m.locationGroup,"onUpdate:modelValue":o[4]||(o[4]=t=>m.locationGroup=t)},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(m.locationGroups,o=>((0,i.uX)(),(0,i.Wv)(C,{key:o.group_id,value:o},{default:(0,i.k6)(()=>[(0,i.bF)(v,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.40.40.png`,style:{height:"18px"}},null,8,["src"]),(0,i.bF)(x,null,{default:(0,i.k6)(()=>[(0,i.eW)((0,n.v_)(o.group_name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):(0,i.Q3)("",!0),(0,i.bF)(L,{label:"квартира, дом, этаж, подъезд","label-placement":"floating",modelValue:m.addressComment,"onUpdate:modelValue":o[5]||(o[5]=t=>m.addressComment=t)},null,8,["modelValue"]),(0,i.Lk)("div",h,[(0,i.bF)(w,{onClick:o[6]||(o[6]=t=>p.closeModal()),color:"light",expand:"block"},{default:(0,i.k6)(()=>[(0,i.bF)(A,{src:p.closeOutline,slot:"start"},null,8,["src"]),o[8]||(o[8]=(0,i.eW)(" Закрыть "))]),_:1,__:[8]}),(0,i.bF)(w,{strong:!0,onClick:o[7]||(o[7]=t=>_.pickAddress()),color:"primary",expand:"block"},{default:(0,i.k6)(()=>[(0,i.bF)(A,{src:p.checkmark,slot:"start"},null,8,["src"]),o[9]||(o[9]=(0,i.eW)("Ок "))]),_:1,__:[9]})])])]),_:1})],64)}e(4114),e(8111),e(116);var m=e(5634),_=e(5221),g=e(5480),k=e(8701),f={components:{IonContent:m.W9,IonToolbar:m.ai,IonButton:m.Jm,IonSearchbar:m.S1,IonIcon:m.iq,IonItem:m.uz,IonInput:m.$w,IonSegment:m.Gp,IonSegmentButton:m.eP,IonImg:m.KW,IonLabel:m.he,yandexMap:_.IK,ymapMarker:_.cT},setup(){const t=function(){m.OZ.dismiss()};return{closeModal:t,locationOutline:g.UN$,closeOutline:g.xfX,checkmark:g.AIp}},props:["location_group_name_low","locationGroupList"],data(){var t;let o=this.$heap.state.settings.location,e=JSON.parse(o.mapCenter);return{settings:{apiKey:o.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationGroup:(null===(t=this.locationGroupList)||void 0===t?void 0:t[0])??null,locationGroups:this.locationGroupList??null,locSettings:o,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:e,addressComment:"",showed:1}},computed:{locationType(){return this.locationGroup?this.locationGroup.group_name+" адрес":this.location_group_name_low??"адрес"},placemarkProperties(){return{iconCaption:this.locationType}}},methods:{async pickAddress(){var t;try{if(this.suggestions[0]&&(console.log(this.coords),await this.suggestionSelect(this.suggestions[0].title.text,this.suggestions[0].uri),console.log(this.coords)),!this.selectedAddress){var o;const t=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(o=t.geoObjects.get(0))||void 0===o?void 0:o.getAddressLine()}}catch(i){console.log(i)}var e={location_group_id:(null===(t=this.locationGroup)||void 0===t?void 0:t.group_id)??null,location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};m.OZ.dismiss(e)},filterAddress(t){const o=this.locSettings.addressErase.split(", "),e=t.split(", ");let i=[];for(const n of e)o.find(t=>t==n)||i.push(n);return i.reverse().join(", ")},onClick(t){t&&t.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,o=this.coords.slice().reverse().join(","),e=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&results=3&lang=ru_RU&ll=${o}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),i=await e.json();this.suggestions=i.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(t,o){this.selectedAddress=t,this.addressSearchQuery=t,await this.geocode(o)},async geocode(t){try{this.suggestions=[];const o=this.$heap.state.settings.location.ymapApiKey,e=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${o}&format=json&results=1&uri=${t}`),i=await e.json(),n=i.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=n.Point.pos.split(" ").reverse()}catch(o){console.log(o)}}},async mounted(){this.showed=0,setTimeout(async()=>{await(0,_.wc)(),this.showed=1,document.querySelectorAll(".search input")[0].focus();const t=k.A.geo.lastStoredGet();null!==t&&void 0!==t&&t.location_latitude&&(this.coords=[t.location_latitude,t.location_longitude]);const o=await k.A.geo.get();if(this.markDeviceOnMap&&o){const{coords:t}=o;this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}},100)}},b=e(6262);const y=(0,b.A)(f,[["render",p],["__scopeId","data-v-ed952a3e"]]);var v=y}}]);
//# sourceMappingURL=4918.a7dd4f1c.js.map