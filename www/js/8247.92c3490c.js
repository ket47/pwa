"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[8247],{5069:function(e,t,o){var i=o(2109),n=o(1702),l=o(3157),r=n([].reverse),a=[1,2];i({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return l(this)&&(this.length=this.length),r(this)}})},8247:function(e,t,o){o.r(t),o.d(t,{default:function(){return q}});o(4916),o(5306);var i=o(6252),n=o(3577);const l=(0,i.Uk)(" Задания "),r=(0,i.Uk)(" Активные "),a=(0,i.Uk)(" Исполненые "),s=["onClick"],u=["onClick"],d={key:2,style:{display:"flex","align-items":"center","justify-content":"center",height:"70vh"}},c={style:{width:"max-content","text-align":"center"}},m=(0,i.Uk)("Заказов нет"),_=(0,i._)("br",null,null,-1),h=(0,i.Uk)("но вы можете создать новый");function p(e,t,o,p,f,w){const k=(0,i.up)("ion-segment-button"),v=(0,i.up)("ion-segment"),y=(0,i.up)("ion-text"),g=(0,i.up)("ion-label"),W=(0,i.up)("ion-item"),b=(0,i.up)("ion-icon"),I=(0,i.up)("ion-chip"),L=(0,i.up)("ion-img"),j=(0,i.up)("ion-avatar"),C=(0,i.up)("ion-list"),D=(0,i.up)("ion-note"),z=(0,i.up)("ion-infinite-scroll-content"),U=(0,i.up)("ion-infinite-scroll"),O=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(O,{"page-title":"Заказы"},{default:(0,i.w5)((()=>{var o;return[(0,i.Wm)(v,{"swipe-gesture":"true",modelValue:f.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>f.orderType=e),onIonChange:t[1]||(t[1]=e=>w.listTypeChanged(e))},{default:(0,i.w5)((()=>[f.courierJobsInclude?((0,i.wg)(),(0,i.j4)(k,{key:0,value:"jobs"},{default:(0,i.w5)((()=>[l])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(k,{value:"active"},{default:(0,i.w5)((()=>[r])),_:1}),(0,i.Wm)(k,{value:"done"},{default:(0,i.w5)((()=>[a])),_:1})])),_:1},8,["modelValue"]),(null===(o=f.orderList)||void 0===o?void 0:o.length)>0?((0,i.wg)(),(0,i.j4)(C,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.orderListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>w.itemClick(t)},[(0,i.Wm)(W,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Uk)("#"+(0,n.zw)(t.order_id),1)])),_:2},1024),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name),1)])),_:2},1024),(0,i.Wm)(y,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.date),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(W,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{slot:"start",icon:t.icon,color:"primary"},null,8,["icon"]),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.stage_current_name?((0,i.wg)(),(0,i.j4)(I,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{icon:p.checkmarkOutline},null,8,["icon"]),(0,i.Wm)(g,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.stage_current_name),1)])),_:2},1024)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024)])),_:2},1024),t.image_hash?((0,i.wg)(),(0,i.j4)(j,{key:0,slot:"end"},{default:(0,i.w5)((()=>[(0,i.Wm)(L,{style:{"border-radius":"10px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024)],8,s)))),128))])),_:1})):(0,i.kq)("",!0),f.jobList?((0,i.wg)(),(0,i.j4)(C,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.jobListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>w.itemClick(t)},[(0,i.Wm)(W,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name),1)])),_:2},1024),(0,i.Wm)(y,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.date_time),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(W,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{slot:"start",icon:p.rocketOutline,color:"primary"},null,8,["icon"]),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.distance_km?((0,i.wg)(),(0,i.j4)(I,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.distance_km),1)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024),(0,i.Wm)(D,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.location_address),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)],8,u)))),128))])),_:1})):(0,i.kq)("",!0),f.orderList&&0!=f.orderList.length||f.jobList&&0!=f.jobList.length?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",d,[(0,i._)("div",c,[(0,i.Wm)(b,{icon:p.sparklesOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[m])),_:1}),_,(0,i.Wm)(D,{onClick:t[2]||(t[2]=t=>e.$router.replace("/")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.w5)((()=>[h])),_:1})])])),(0,i.Wm)(U,{onIonInfinite:t[3]||(t[3]=e=>w.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{"loading-spinner":"bubbles","loading-text":"Загрузка..."})])),_:1})]})),_:1})}o(3948);var f=o(8292),w=o(8903),k=o(8764),v=o(7782),y=o(351),g=o(9042),W=o(422);const b=(0,i.Uk)("Просмотр задания"),I={class:"center_chip"},L={class:"center_chip"},j={class:"center_chip"},C=(0,i.Uk)("Покупатель"),D=(0,i.Uk)("Покупатель"),z=(0,i.Uk)("Начать доставку");function U(e,t,o,l,r,a){const s=(0,i.up)("ion-title"),u=(0,i.up)("ion-icon"),d=(0,i.up)("ion-toolbar"),c=(0,i.up)("ion-header"),m=(0,i.up)("ion-avatar"),_=(0,i.up)("ion-text"),h=(0,i.up)("ion-label"),p=(0,i.up)("ion-item"),f=(0,i.up)("ion-chip"),w=(0,i.up)("ion-note"),k=(0,i.up)("ion-skeleton-text"),v=(0,i.up)("ion-button"),y=(0,i.up)("ion-item-group"),g=(0,i.up)("ion-list"),W=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[b])),_:1}),(0,i.Wm)(u,{slot:"end",onClick:t[0]||(t[0]=e=>{a.close()}),icon:l.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[o.orderData?((0,i.wg)(),(0,i.j4)(g,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{icon:l.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Курьер "+(0,n.zw)(e.$heap.state.user.user_name),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(p,{lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",I,[(0,i.Wm)(f,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Uk)((0,n.zw)(null===(e=o.orderData)||void 0===e?void 0:e.distance_km),1)]})),_:1})])),_:1})])])),_:1}),(0,i.Wm)(p,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{icon:l.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.store_name),1)])),_:1}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.location_address),1)])),_:1})])),_:1})])),_:1}),a.start_finish_distance_km?((0,i.wg)(),(0,i.j4)(p,{key:0,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",L,[(0,i.Wm)(f,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(a.start_finish_distance_km),1)])),_:1})])),_:1})])])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",j,[(0,i.Wm)(f,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{animated:"",style:{width:"100%"}})])),_:1})])])),_:1})),r.job?((0,i.wg)(),(0,i.j4)(p,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{icon:l.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{color:"primary"},{default:(0,i.w5)((()=>[C])),_:1}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(r.job.finish_location_address),1)])),_:1})])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{icon:l.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{color:"primary"},{default:(0,i.w5)((()=>[D])),_:1}),(0,i.Wm)(k,{animated:"",style:{width:"60%"}}),(0,i.Wm)(k,{animated:"",style:{width:"80%"}})])),_:1})])),_:1})),r.job?((0,i.wg)(),(0,i.j4)(y,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{onClick:t[1]||(t[1]=e=>a.deliveryStart()),expand:"full"},{default:(0,i.w5)((()=>[z])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})):(0,i.kq)("",!0)])),_:1})],64)}o(5069);var O={props:["orderData"],components:{IonList:f.q_,IonItemGroup:f.Ub,IonTitle:f.wd,IonButton:f.YG,IonSkeletonText:f.CK,IonNote:f.uN,IonChip:f.hM,IonItem:f.Ie,IonLabel:f.Q$,IonText:f.yW,IonAvatar:f.BJ,IonIcon:f.gu,IonHeader:f.Gu,IonToolbar:f.sr,IonContent:f.W2},setup(){return{storefrontOutline:w.qRG,locationOutline:w.Iv7,flagOutline:w.FMn,closeOutline:w.fID}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){var e,t;return null!==(e=this.job)&&void 0!==e&&e.start_finish_distance?Math.round((null===(t=this.job)||void 0===t?void 0:t.start_finish_distance)/1e3)+"км":"-"}},methods:{async jobGet(){try{let e=await v.Z.api.itemJobGet(this.orderData.order_id);e.finish_location_address=e.finish_location_address.split(",").reverse().join(","),this.job=e}catch(o){var e,t;const i=null===(e=o.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.error;if("notfound"==i)return void this.$flash("Задание не найдено");if("notready"==i)return void this.$flash("Смена курьера не открыта")}},async deliveryStart(){var e,t;const o=null===(e=y.Z.courier)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.courier_id;try{await v.Z.api.itemJobStart(this.orderData.order_id,o),this.$router.push("order-"+this.orderData.order_id)}catch(l){var i,n;const e=null===(i=l.responseJSON)||void 0===i||null===(n=i.messages)||void 0===n?void 0:n.error;"notfound"==e&&this.$flash("Задание не найдено"),"notready"==e&&this.$flash("Смена курьера не открыта"),"notsearching"!=e&&"idle"!=e||this.$flash("Заданию уже назначен курьер")}g.Z.publish("dismissModal")},close(){g.Z.publish("dismissModal")}}},T=o(3744);const $=(0,T.Z)(O,[["render",U],["__scopeId","data-v-13745910"]]);var S=$,x={components:{IonSegment:f.cJ,IonSegmentButton:f.GO,IonIcon:f.gu,IonAvatar:f.BJ,IonText:f.yW,IonLabel:f.Q$,IonItem:f.Ie,IonList:f.q_,IonChip:f.hM,IonNote:f.uN,IonImg:f.Xz,IonInfiniteScroll:f.ju,IonInfiniteScrollContent:f.MB},setup(){return{sparklesOutline:w.Fcs,storefrontOutline:w.qRG,timeOutline:w.bdY,ordersIcon:k,rocketOutline:w.G$D,ribbonOutline:w.Muk,checkmarkOutline:w.TjA}},data(){return{jobList:null,orderList:null,orderType:null,courierJobsInclude:null,clock:null}},computed:{orderListComputed(){for(let e of this.orderList){switch(e.user_role){case"customer":e.icon=k;break;case"admin":e.icon=w.Muk;break;case"courier":e.icon=w.G$D;break;case"supplier":e.icon=w.qRG;break}e.date=this.toLocDate(e.created_at)}return this.orderList},jobListComputed(){for(let e of this.jobList)e.location_address||(e.location_address=""),e.distance?e.distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="",e.date_time=this.toLocDateTime(e.created_at);return this.jobList}},created(){let e=this;this.$topic.on("courierStatusChange",(function(){e.courierReadinessCheck()})),e.courierReadinessCheck()},methods:{toLocDate(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,o)},toLocDateTime(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,o)},courierReadinessCheck(){const e="ready"==y.Z.courier.status?1:0;this.courierJobsInclude!==e&&(this.courierJobsInclude=e,0==this.courierJobsInclude?this.orderType="active":this.orderType="jobs")},async listLoad(e,t="append"){var o,i,n;if("jobs"==e)return this.autoReload(e),void this.listJobLoad();let l="system_finish";"active"==e&&(this.autoReload(e),l="active_only");const r="append"==t&&null!==(o=null===(i=this.orderList)||void 0===i?void 0:i.length)&&void 0!==o?o:0,a="append"==t?10:null===(n=this.orderList)||void 0===n?void 0:n.length,s={order_group_type:l,offset:r,limit:a};let u=await v.Z.api.listLoad(s);var d;"append"==t&&(null!==(d=this.orderList)&&void 0!==d||(this.orderList=[]),u=this.orderList.concat(u));this.orderList=u,this.jobList=null},async listLoadMore(e){await this.listLoad(this.orderType),e.target.complete()},listTypeChanged(e){const t=e.target.value;this.orderList=[],this.listLoad(t)},async listJobLoad(){try{var e,t;const o=null===(e=y.Z.courier)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.courier_id;this.jobList=await v.Z.api.listJobGet(o),this.orderList=null}catch(n){var o,i;const e=null===(o=n.responseJSON)||void 0===o||null===(i=o.messages)||void 0===i?void 0:i.error;"notready"==e&&(y.Z.courier.status="notready",this.courierReadinessCheck())}},autoReload(e){clearTimeout(this.clock);const t=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((()=>{this.listLoad(this.orderType,"reload")}),t))},ionViewDidEnter(){this.courierReadinessCheck(),this.listLoad(this.orderType)},ionViewDidLeave(){clearTimeout(this.clock)},async itemClick(e){if(e.is_courier_job){const t=await f.Fy.create({component:S,componentProps:{orderData:e},initialBreakpoint:.6,breakpoints:[0,.6,.75]}),o=function(){t.dismiss()};return g.Z.on("dismissModal",o),t.present()}this.itemOpen(e.order_id)},itemOpen(e){W.Z.push(`order-${e}`)}}};const J=(0,T.Z)(x,[["render",p]]);var q=J},8764:function(e,t,o){e.exports=o.p+"img/orders.ea36eab8.svg"}}]);
//# sourceMappingURL=8247.92c3490c.js.map