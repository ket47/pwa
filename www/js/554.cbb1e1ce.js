"use strict";(self["webpackChunktezkel_delivery"]=self["webpackChunktezkel_delivery"]||[]).push([[554],{6622:function(e,t,i){i.d(t,{Z:function(){return j}});var o=i(6252),n=i(3577);const r=(0,o.Uk)("Фотографии"),a={key:0,class:"image_grid"},s=["onClick"],l={key:0},d={key:1},c={key:0,class:"image_controls"},u=["id"];function m(e,t,i,m,p,h){const _=(0,o.up)("ion-label"),g=(0,o.up)("ion-icon"),f=(0,o.up)("ion-item"),w=(0,o.up)("ion-img"),k=(0,o.up)("ion-avatar");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o.Wm)(f,{lines:"none",onClick:t[0]||(t[0]=e=>{p.editMode=!p.editMode,p.editMode&&h.load()})},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{color:"imageList?.length?'':medium"},{default:(0,o.w5)((()=>[r])),_:1}),p.editMode?((0,o.wg)(),(0,o.j4)(g,{key:0,slot:"end",icon:m.settingsSharp,color:"primary"},null,8,["icon"])):((0,o.wg)(),(0,o.j4)(g,{key:1,slot:"end",icon:m.settingsOutline},null,8,["icon"]))])),_:1}),h.imageList?.length?((0,o.wg)(),(0,o.iD)("div",a,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.imageList,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.image_id,style:{position:"relative"}},[(0,o._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:e=>h.imagePreview(t.image_hash)},[t.deleted_at?((0,o.wg)(),(0,o.iD)("div",l,"будет удалено")):1==t.is_disabled?((0,o.wg)(),(0,o.iD)("div",d,"на модерации")):(0,o.kq)("",!0)],8,s),(0,o.Wm)(k,{onClick:e=>h.imagePreview(t.image_hash),class:(0,n.C_)(t.class)},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),p.editMode?((0,o.wg)(),(0,o.iD)("div",c,[(0,o.Wm)(g,{icon:m.chevronBackCircleOutline,onClick:e=>h.back(t)},null,8,["icon","onClick"]),h.isAdmin&&1==t.is_disabled?((0,o.wg)(),(0,o.j4)(g,{key:0,icon:m.checkmarkCircle,color:"success",onClick:e=>h.enable(t)},null,8,["icon","onClick"])):(0,o.kq)("",!0),t.deleted_at?((0,o.wg)(),(0,o.j4)(g,{key:1,icon:m.addCircle,color:"success",onClick:e=>h.restore(t)},null,8,["icon","onClick"])):((0,o.wg)(),(0,o.j4)(g,{key:2,icon:m.trash,color:"danger",onClick:e=>h.remove(t)},null,8,["icon","onClick"])),(0,o.Wm)(g,{icon:m.chevronForwardCircleOutline,onClick:e=>h.forward(t)},null,8,["icon","onClick"])])):(0,o.kq)("",!0)])))),128))])):(0,o.kq)("",!0)]),(0,o._)("input",{type:"file",id:p.fileUploaderId,accept:"image/*",onChange:t[1]||(t[1]=e=>h.uploadImage(e)),style:{display:"none"}},null,40,u)],64)}var p=i(8903),h=i(9540);const _=(0,o.Uk)("Просмотр фотографии");function g(e,t,i,n,r,a){const s=(0,o.up)("ion-title"),l=(0,o.up)("ion-icon"),d=(0,o.up)("ion-toolbar"),c=(0,o.up)("ion-header"),u=(0,o.up)("ion-img"),m=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[_])),_:1}),(0,o.Wm)(l,{icon:n.closeOutline,onClick:t[0]||(t[0]=e=>{n.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{src:e.$heap.state.hostname+"image/get.php/"+i.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var f={props:["image_hash"],components:{IonIcon:h.gu,IonToolbar:h.sr,IonHeader:h.Gu,IonImg:h.Xz,IonContent:h.W2,IonTitle:h.wd},setup(){const e=function(){h.Fy.dismiss()};return{closeModal:e,closeOutline:p.fID}}},w=i(3744);const k=(0,w.Z)(f,[["render",g]]);var y=k,I=i(9755),v=i.n(I),b=i(9042),W=i(351),C={props:["images","image_holder_id","controller"],components:{IonLabel:h.Q$,IonIcon:h.gu,IonItem:h.Ie,IonImg:h.Xz,IonAvatar:h.BJ},setup(){return{settingsOutline:p.C$N,settingsSharp:p.kiF,chevronBackCircleOutline:p.CK0,chevronForwardCircleOutline:p.esm,trash:p._Ij,addCircle:p.ZWo,checkmarkCircle:p.I1A}},data(){return{images_loaded:null,editMode:!1,fileUploaderId:this.controller+this.image_holder_id}},computed:{imageList(){let e=this.images_loaded||this.images,t=[];for(let i in e)e[i].deleted_at?(e[i].class=" deleted",this.editMode&&t.push(e[i])):1==e[i].is_disabled?(e[i].class=" disabled",this.editMode&&t.push(e[i])):t.push(e[i]);return t},isAdmin(){return W.Z.isAdmin()}},methods:{async back(e){try{await v().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"}),this.load()}catch{}},async forward(e){try{await v().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"}),this.load()}catch{}},async remove(e){try{await v().post(this.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id}),this.load(),this.$flash("Фото перемещено в корзину и будет удалено")}catch{}},async restore(e){try{await v().post(this.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id}),this.load(),this.$flash("Фото перемещено извлечено из корзины")}catch{}},async enable(e){try{await v().post(this.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0}),this.load()}catch{}},async load(){const e={image_holder_id:this.image_holder_id,image_holder:this.controller,is_disabled:1,is_deleted:1,is_active:1};this.images_loaded=await v().post(this.$heap.state.hostname+"Image/listGet",e)},async imagePreview(e){const t=await h.Fy.create({component:y,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[.5,1]}),i=function(){t.dismiss()};return b.Z.on("dismissModal",i),t.present()},async uploadImage(e){let t=new FormData;t.append("files[]",e.target.files[0]),t.set("image_holder_id",this.image_holder_id);const i={url:this.$heap.state.hostname+this.controller+"/fileUpload",type:"POST",data:t,processData:!1,contentType:!1};try{await v().ajax(i),this.load()}catch(o){if("limit_exeeded"==o?.responseJSON?.messages?.error)return void this.$flash("Уже загружено максимальное количество фото");this.$flash("Не удалось загрузить фото")}},take_photo(){v()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}};const D=(0,w.Z)(C,[["render",m],["__scopeId","data-v-43cc4d45"]]);var j=D},3554:function(e,t,i){i.r(t),i.d(t,{default:function(){return J}});var o=i(6252);const n={key:0,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},r={style:{width:"max-content","text-align":"center"}},a=(0,o.Uk)("Заказ не найден"),s=(0,o._)("br",null,null,-1),l=(0,o._)("a",{href:"/order-list"},"список заказов",-1),d=(0,o.Uk)("Отказ клиента"),c=(0,o.Uk)("Поломка в пути"),u=(0,o.Uk)("Заказ испорчен");function m(e,t,i,m,p,h){const _=(0,o.up)("ion-icon"),g=(0,o.up)("ion-label"),f=(0,o.up)("order-comp"),w=(0,o.up)("order-tracking-comp"),k=(0,o.up)("order-history-comp"),y=(0,o.up)("image-tile-comp"),I=(0,o.up)("ion-item"),v=(0,o.up)("ion-list"),b=(0,o.up)("ion-content"),W=(0,o.up)("ion-popover"),C=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(C,{pageTitle:`Заказ #${p.order_id}`,pageDefaultBackLink:"/order-list"},{default:(0,o.w5)((()=>["notfound"==p.order?((0,o.wg)(),(0,o.iD)("div",n,[(0,o._)("div",r,[(0,o.Wm)(_,{icon:m.sparklesOutline,size:"large"},null,8,["icon"]),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[a])),_:1}),s,l])])):(0,o.kq)("",!0),(0,o.Wm)(f,{orderData:p.order,onStageCreate:h.onStageCreate},null,8,["orderData","onStageCreate"]),(0,o.Wm)(w,{orderData:p.order},null,8,["orderData"]),(0,o.Wm)(k,{orderData:p.order},null,8,["orderData"]),p.order?((0,o.wg)(),(0,o.j4)(y,{key:1,images:p.order?.images,image_holder_id:p.order?.order_id,controller:"Order",ref:"orderImgs"},null,8,["images","image_holder_id"])):(0,o.kq)("",!0),(0,o.Wm)(W,{"is-open":p.isOpenDeliveryRejectionPopover,onDidDismiss:t[3]||(t[3]=e=>p.isOpenDeliveryRejectionPopover=!1)},{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(I,{button:!0,detail:!1,onClick:t[0]||(t[0]=e=>h.action_rejected_reason("ОТКАЗ КУРЬЕРА: Отказ клиента"))},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[d])),_:1})])),_:1}),(0,o.Wm)(I,{button:!0,detail:!1,onClick:t[1]||(t[1]=e=>h.action_rejected_reason("ОТКАЗ КУРЬЕРА: Поломка в пути"))},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[c])),_:1})])),_:1}),(0,o.Wm)(I,{button:!0,detail:!1,onClick:t[2]||(t[2]=e=>h.action_rejected_reason("ОТКАЗ КУРЬЕРА: Заказ испорчен"))},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[u])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open"])])),_:1},8,["pageTitle"])}var p=i(8903),h=i(9540),_=i(7782),g=i(253),f=i(3577);const w=(0,o.Uk)("История заказа");function k(e,t,i,n,r,a){const s=(0,o.up)("ion-label"),l=(0,o.up)("ion-item"),d=(0,o.up)("ion-icon"),c=(0,o.up)("ion-text"),u=(0,o.up)("ion-note"),m=(0,o.up)("ion-list"),p=(0,o.up)("ion-accordion"),h=(0,o.up)("ion-accordion-group");return i.orderData?.stages?((0,o.wg)(),(0,o.j4)(h,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l,{slot:"header"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[w])),_:1})])),_:1}),(0,o.Wm)(m,{slot:"content"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.orderData.stages,(e=>((0,o.wg)(),(0,o.j4)(l,{key:e.group_id},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{slot:"start",icon:n.checkmarkOutline,size:"small",color:"success"},null,8,["icon"]),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,f.zw)(e.group_name),1)])),_:2},1024),(0,o.Wm)(u,{slot:"end",style:{width:"80px"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,f.zw)(e.created_at),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0)}var y={props:["orderData"],components:{IonIcon:h.gu,IonText:h.yW,IonLabel:h.Q$,IonItem:h.Ie,IonList:h.q_,IonNote:h.uN,IonAccordion:h.We,IonAccordionGroup:h.eh},setup(){return{checkmarkOutline:p.TjA}}},I=i(3744);const v=(0,I.Z)(y,[["render",k]]);var b=v;const W=(0,o.Uk)("Отслеживание заказа");function C(e,t,i,n,r,a){const s=(0,o.up)("ion-label"),l=(0,o.up)("ion-item"),d=(0,o.up)("ion-icon"),c=(0,o.up)("ion-chip"),u=(0,o.up)("ion-progress-bar"),m=(0,o.up)("ion-list"),p=(0,o.up)("ion-accordion"),h=(0,o.up)("ion-accordion-group");return i.orderData&&"delivery_start"==r.job?.group_type?((0,o.wg)(),(0,o.j4)(h,{key:0,value:"tracking",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{value:"tracking"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{slot:"header"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[W])),_:1})])),_:1}),(0,o.Wm)(m,{slot:"content"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{color:"primary",slot:"start",icon:n.locationOutline,style:{"font-size":"30px"}},null,8,["icon"]),(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Курьер, "+(0,f.zw)(r.job.courier_name),1)])),_:1})])),_:1}),a.courier_finish_distance_km?((0,o.wg)(),(0,o.j4)(l,{key:0,lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{slot:"start",color:"success"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,f.zw)(a.courier_finish_distance_km),1)])),_:1}),(0,o.Wm)(c,{slot:"end",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,f.zw)(a.courier_finish_time_min.timeMin)+"-"+(0,f.zw)(a.courier_finish_time_min.timeMax)+"мин ",1)])),_:1})])),_:1})):(0,o.kq)("",!0),a.courier_finish_distance_km?((0,o.wg)(),(0,o.j4)(l,{key:1,lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{color:"secondary",value:a.courier_progress,reversed:"true"},null,8,["value"])])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(l,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{style:{"text-align":"right"}},{default:(0,o.w5)((()=>[(0,o.Uk)("Клиент, "+(0,f.zw)(e.$heap.state.user.user_name),1)])),_:1}),(0,o.Wm)(d,{color:"primary",slot:"end",icon:n.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1})])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0)}var D=i(4405),j={props:["orderData"],components:{IonList:h.q_,IonItemGroup:h.Ub,IonTitle:h.wd,IonButton:h.YG,IonSkeletonText:h.CK,IonNote:h.uN,IonChip:h.hM,IonItem:h.Ie,IonLabel:h.Q$,IonText:h.yW,IonAvatar:h.BJ,IonIcon:h.gu,IonAccordionGroup:h.eh,IonAccordion:h.We,IonProgressBar:h.X7},setup(){return{storefrontOutline:p.qRG,locationOutline:p.Iv7,flagOutline:p.FMn}},data(){return{job:null,refreshInterval:6e4}},mounted(){this.jobGet()},computed:{courier_finish_distance_km(){return this.job?.courier_finish_distance?Math.round(this.job?.courier_finish_distance/100)/10+"км":"-"},courier_finish_time_min(){return D.Z.deliveryTimeCalculate(this.job?.courier_finish_distance,0)},courier_progress(){return this.job?.courier_finish_distance/this.job?.start_finish_distance}},methods:{async jobGet(){if(this.isDelivering())try{if(this.job=await _.Z.api.itemJobTrack(this.orderData.order_id),"delivery_start"==this.job.group_type){const e=this;setTimeout((()=>{e.jobGet()}),this.refreshInterval)}}catch(e){const t=e.responseJSON?.messages?.error;if("notfound"==t)return void this.$flash("Задание не найдено");if("notready"==t)return void this.$flash("Смена курьера не открыта")}},isDelivering(){return"delivery_start"==this.orderData?.stage_current}}};const $=(0,I.Z)(j,[["render",C],["__scopeId","data-v-15ac4f3d"]]);var O=$;const U=(0,o.Uk)("Возражение"),x=(0,o.Uk)("Сохранить возражение"),G=(0,o.Uk)("Закрыть без возражения");function L(e,t,i,n,r,a){const s=(0,o.up)("ion-title"),l=(0,o.up)("ion-toolbar"),d=(0,o.up)("ion-header"),c=(0,o.up)("ion-label"),u=(0,o.up)("ion-textarea"),m=(0,o.up)("ion-item"),p=(0,o.up)("ion-list"),h=(0,o.up)("ion-button"),_=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l,{color:"secondary"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[U])),_:1})])),_:1})])),_:1}),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{position:"stacked"}),(0,o.Wm)(u,{rows:"6",modelValue:r.objection_text,"onUpdate:modelValue":t[0]||(t[0]=e=>r.objection_text=e),placeholder:"опишите суть возражения к исполнению заказа (минимум 10 букв)"},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(h,{onClick:t[1]||(t[1]=e=>a.save()),color:"primary",disabled:!r.objection_text||r.objection_text.length<10,expand:"full"},{default:(0,o.w5)((()=>[x])),_:1},8,["disabled"]),(0,o.Wm)(h,{onClick:t[2]||(t[2]=e=>a.close()),color:"light",expand:"full"},{default:(0,o.w5)((()=>[G])),_:1})])),_:1})],64)}var T={components:{IonTextarea:h.g2,IonButton:h.YG,IonHeader:h.Gu,IonToolbar:h.sr,IonTitle:h.wd,IonContent:h.W2,IonList:h.q_,IonItem:h.Ie,IonLabel:h.Q$},data(){return{objection_text:null}},methods:{close(){h.Fy.dismiss()},save(){h.Fy.dismiss(this.objection_text)}}};const Z=(0,I.Z)(T,[["render",L]]);var z=Z;const M=(0,o.Uk)("Добавить товар");function q(e,t,i,n,r,a){const s=(0,o.up)("ion-title"),l=(0,o.up)("ion-toolbar"),d=(0,o.up)("ion-header"),c=(0,o.up)("ion-searchbar"),u=(0,o.up)("ion-img"),m=(0,o.up)("ion-label"),p=(0,o.up)("ion-item"),h=(0,o.up)("ion-list"),_=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l,{color:"secondary"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[M])),_:1})])),_:1})])),_:1}),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{onInput:t[0]||(t[0]=e=>a.listGet({name_query:e.target.value,name_query_fields:"product_name,product_code"})),style:{"border-radius":"10px",color:"black"},placeholder:"Поиск в этом предприятии"}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.productList,(t=>((0,o.wg)(),(0,o.j4)(p,{key:t.product_id,onClick:e=>a.itemCreate(t.product_id)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start",src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".50.50.webp"},null,8,["src"]),(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,f.zw)(t.product_name),1)])),_:2},1024),(0,o.Wm)(m,{slot:"end",color:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,f.zw)(t.product_final_price)+(0,f.zw)(e.$heap.state.currencySign),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}var S=i(9755),P=i.n(S),A={components:{IonHeader:h.Gu,IonToolbar:h.sr,IonTitle:h.wd,IonContent:h.W2,IonSearchbar:h.VI,IonList:h.q_,IonItem:h.Ie,IonLabel:h.Q$,IonImg:h.Xz},props:["store_id","order_id"],data(){return{productList:[]}},mounted(){this.listGet()},methods:{async listGet(e={}){e.store_id=this.store_id,e.is_active=1,e.limit=5;let t={};try{t=await P().post(`${this.$heap.state.hostname}Product/listGet`,e)}catch(i){}this.productList=t.product_list},async itemCreate(e){let t={order_id:this.order_id,product_id:e,product_quantity:prompt("Введите количество",1)||1};try{await P().post(`${this.$heap.state.hostname}Entry/itemCreate`,t)}catch(i){this.$flash("Не удалось добавить товар")}h.Fy.dismiss()}}};const F=(0,I.Z)(A,[["render",q]]);var B=F,H=i(6622),N={components:{OrderComp:g.Z,OrderHistoryComp:b,OrderTrackingComp:O,OrderEntryAdd:B,ImageTileComp:H.Z,IonLabel:h.Q$,IonIcon:h.gu,IonContent:h.W2,IonAccordion:h.We,IonAccordionGroup:h.eh,IonItem:h.Ie,IonText:h.yW,IonNote:h.uN,IonList:h.q_,IonPopover:h.d8},setup(){return{sparklesOutline:p.Fcs}},data(){return{order_id:this.$route.params.id,order:null,orderIsLoading:!1,isOpenDeliveryRejectionPopover:!1}},methods:{async itemGet(){if(!this.orderIsLoading){try{this.orderIsLoading=!0,this.order=await _.Z.api.itemGet(this.order_id)}catch(e){switch(e.status){case 404:this.$flash("Заказ не найден"),this.order="notfound",this.$router.push("order-list");break}}this.orderIsLoading=!1}},async onStageCreate(e,t){if(t.includes("action")){t=t.split("_").splice(1).join("_");try{this[t](e)}catch{}}else try{const i=await _.Z.api.itemStageCreate(e,t);if("ok"==i)return"customer_purged"==t?(this.$flash("Заказ удален"),this.order=null,void this.$router.push("order-list")):(await this.itemGet(),!0)}catch(i){const e=i.responseJSON,t=e.messages.error;switch(t){case"wrong_courier_status":this.$flash("Смена курьера не открыта");break;case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии &#9785;","Заказ пуст");break;case"photos_must_be_made":this.$flash("Необходимо сфотографировать заказ"),this.action_take_photo();break}return!1}},async action_confirm(e){const t=await this.onStageCreate(e,"customer_confirmed");t&&this.action_checkout()},async action_checkout(){this.$heap.commit("setCurrentOrder",this.order),this.$router.push("order-checkout")},async action_add(){const e=await h.Fy.create({component:B,componentProps:{store_id:this.order.order_store_id,order_id:this.order_id},initialBreakpoint:.5,breakpoints:[.5,1],canDissmiss:!0});e.present();await e.onDidDismiss();this.itemGet()},async action_objection(){const e=await h.Fy.create({component:z,initialBreakpoint:.5,breakpoints:[.5,1],canDissmiss:!0});e.present();const t=await e.onDidDismiss();if(t.data){const e=`ВОЗРАЖЕНИЕ ПОКУПАТЕЛЯ: ${t.data}`,i=await _.Z.api.itemUpdate({order_id:this.order_id,order_objection:e});if("ok"==i){const e=await this.onStageCreate(this.order_id,"customer_disputed");e&&(this.$flash("Ваше возражение принято и будет рассмотрено администратором."),alert("Необходимо сфотографировать заказ"),this.action_take_photo())}}},action_rejected(){this.isOpenDeliveryRejectionPopover=!0},async action_rejected_reason(e){this.isOpenDeliveryRejectionPopover=!1;try{await _.Z.api.itemUpdate({order_id:this.order_id,order_objection:e}),await this.onStageCreate(this.order_id,"delivery_rejected"),this.$flash("Вы отказались от доставки")}catch{}},action_take_photo(){this.$refs.orderImgs.take_photo()},action_call_customer(){window.open(`tel:+${this.order.customer.user_phone}`)}},ionViewDidEnter(){null==this.order&&this.itemGet()},ionViewDidLeave(){this.order=null},created(){const e=this;e.itemGet(),this.$topic.on("orderSumChanged",(()=>{e.itemGet()}))}};const Y=(0,I.Z)(N,[["render",m]]);var J=Y},4405:function(e,t,i){var o=i(2008);const n={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const t=e.locations[0].distance,i=e.store_time_preparation||0;return n.deliveryTimeCalculate(t,i)},deliveryTimeCalculate(e,t){t=parseInt(t??o.Z.getters.settings.delivery.timePreparationDefault);const i=parseInt(o.Z.getters.settings.delivery.timeDelta),n=parseInt(o.Z.getters.settings.delivery.speed),r=5*Math.round(e/n*60/5)+t,a=r>i?r-i:r,s=a+i;return{time:r,timeMin:a,timeMax:s}}};t["Z"]=n}}]);
//# sourceMappingURL=554.cbb1e1ce.js.map