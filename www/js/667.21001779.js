"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[667],{667:function(e,t,i){i.r(t),i.d(t,{default:function(){return _}});var o=i(6252),a=i(3577);const s={key:0};function n(e,t,i,n,l,d){const r=(0,o.up)("ion-searchbar"),u=(0,o.up)("ion-input"),c=(0,o.up)("ion-button"),m=(0,o.up)("ion-item"),p=(0,o.up)("ion-content"),h=(0,o.up)("ion-popover"),_=(0,o.up)("ion-img"),g=(0,o.up)("ion-thumbnail"),w=(0,o.up)("ion-text"),f=(0,o.up)("ion-icon"),y=(0,o.up)("ion-checkbox"),k=(0,o.up)("ion-chip"),I=(0,o.up)("ion-list"),b=(0,o.up)("ion-skeleton-text"),v=(0,o.up)("ion-card-content"),D=(0,o.up)("ion-card"),$=(0,o.up)("ion-infinite-scroll-content"),C=(0,o.up)("ion-infinite-scroll"),W=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(W,{pageDefaultBackLink:`/catalog/store-edit-${l.storeId}`,"page-title":"Управление товарами"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o.Wm)(r,{placeholder:"Фильтр",modelValue:l.filter,"onUpdate:modelValue":t[0]||(t[0]=e=>l.filter=e)},null,8,["modelValue"]),(0,o.Wm)(h,{"is-open":l.editor_opened,onDidDismiss:t[2]||(t[2]=e=>l.editor_opened=0)},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{style:{}},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{placeholder:l.editor_placeholder,modelValue:l.editor_value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.editor_value=e),style:{"--border-width":"1px","--border-radius":"10px"}},null,8,["placeholder","modelValue"]),(0,o.Wm)(c,{slot:"end"},{default:(0,o.w5)((()=>[(0,o.Uk)("OK")])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open"]),d.listComputed.length>0?((0,o.wg)(),(0,o.j4)(I,{key:0},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.listComputed,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.item_id},[(0,o.Wm)(m,{lines:"none",onClick:e=>d.itemEdit(t),button:"",detail:""},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{slot:"start",class:(0,a.C_)(t.class),style:{"border-radius":"10px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1032,["class"]),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.item_name)+" ",1),1==t.is_counted&&1*t.product_quantity==0?((0,o.wg)(),(0,o.iD)("span",s," (нет в наличии)")):(0,o.kq)("",!0)])),_:2},1024)])),_:2},1032,["onClick"]),(0,o.Wm)(m,{lines:"full"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{color:"medium"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{src:n.calculatorOutline},null,8,["src"]),(0,o.Wm)(y,{"label-placement":"start",checked:1==t.is_counted,onIonChange:e=>d.itemUpdate(t.product_id,"is_counted",e.target.checked?1:0)},{default:(0,o.w5)((()=>[(0,o.Uk)("учет")])),_:2},1032,["checked","onIonChange"]),(0,o.Uk)("  ")])),_:2},1024),0==t.is_counted?((0,o.wg)(),(0,o.j4)(k,{key:0,color:"medium"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{src:n.infiniteOutline},null,8,["src"]),(0,o.Uk)("   ")])),_:1})):((0,o.wg)(),(0,o.j4)(k,{key:1,color:t.product_quantity>0?"success":"danger",onClick:e=>d.itemPrompt(t,"product_quantity","введите остаток")},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.product_quantity||0)+(0,a.zw)(t.product_unit),1)])),_:2},1032,["color","onClick"])),(0,o.Wm)(k,{color:"primary",onClick:e=>d.itemPrompt(t,"product_price","введите цену")},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.product_price)+(0,a.zw)(e.$heap.state.currencySign),1)])),_:2},1032,["onClick"])])),_:2},1024)])))),128))])),_:1})):1==l.is_loading?((0,o.wg)(),(0,o.j4)(I,{key:1},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2,3],(e=>(0,o.Wm)(m,{key:e,button:"",detail:""},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{slot:"start",style:{"background-color":"lightgray"}}),(0,o.Wm)(b,{animated:""})])),_:2},1024))),64))])),_:1})):((0,o.wg)(),(0,o.j4)(D,{key:2,color:"light"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Ничего не найдено ")])),_:1})])),_:1})),(0,o.Wm)(C,{onIonInfinite:t[3]||(t[3]=e=>d.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,o.w5)((()=>[(0,o.Wm)($,{"loading-spinner":"bubbles","loading-text":"Loading more data..."})])),_:1})])])),_:1},8,["pageDefaultBackLink"])}i(8862);var l=i(4929),d=i(9755),r=i.n(d),u=i(1590),c=i(8903),m={components:{IonInfiniteScroll:l.ju,IonInfiniteScrollContent:l.MB,IonItem:l.Ie,IonLabel:l.Q$,IonList:l.q_,IonSegmentButton:l.GO,IonSegment:l.cJ,IonImg:l.Xz,IonThumbnail:l.Bs,IonText:l.yW,IonSkeletonText:l.CK,IonCard:l.PM,IonCardContent:l.FN,IonSearchbar:l.VI,IonSelect:l.t9,IonSelectOption:l.n0,IonChip:l.hM,IonCheckbox:l.nz,IonIcon:l.gu,IonPopover:l.d8,IonContent:l.W2,IonInput:l.pK,IonButton:l.YG},setup(){return{infiniteOutline:c.QoN,calculatorOutline:c.ABu}},data(){return{storeId:this.$route.params.id,items:[],item_type:"active",filter:"",is_loading:0,moderationType:"products",holders:{store:"Поставщик",courier:"Курьер",product:"Товар",order:"Заказ",product_group_list:"Категория товара",location_group_list:"Категория местоп.",store_group_list:"Категория поставщ.",user_group_list:"Категория пользователя"},editor_opened:0,editor_value:null,editor_placeholder:""}},computed:{listComputed(){for(let t of this.items){var e;t.image_hash=t.image_hash||t.courier_photo_image_hash,t.item_id=t.image_id||t.store_id||t.courier_id||t.product_id,t.item_name=this.holders[t.image_holder]||(null!==(e=t.store_name)&&void 0!==e?e:t.store_name_new)||t.user_name||t.product_name,t.date_time=this.toLocDateTime(t.updated_at),t.class="",t.class+=t.deleted_at?"deleted ":"",t.class+=1==t.is_disabled?"disabled ":"",t.class+=1==t.is_counted&&0==t.product_quantity?"absent ":""}return this.items}},methods:{async listLoadMore(e){await this.listLoad(),e.target.complete()},async listReload(){this.items=[],this.listLoad()},async listLoad(){let e={is_disabled:"disabled"==this.item_type?1:0,is_active:"active"==this.item_type?1:0,is_deleted:"deleted"==this.item_type?1:0,name_query:this.filter,offset:this.items.length,limit:15};try{let t;if(this.is_loading=1,"products"==this.moderationType){e.name_query_fields="product_name",e.reverse="updated_at",e.store_id=this.storeId;const i=await r().post(`${this.$heap.state.hostname}Product/listGet`,e);t=i.product_list}this.is_loading=0,this.items=this.items.concat(t)}catch(t){}},listTypeChanged(e){e.target.value;this.items=[],this.listLoad()},listFilter(){clearTimeout(this.clock),this.clock=setTimeout((()=>{this.listReload()}),300)},toLocDate(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,i)},toLocDateTime(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,i)},async itemPrompt(e,t,i){const o=e[t],a=await l.Cl.create({header:i,buttons:[{text:"Отмена",role:"cancel"},{text:"Ок",role:"confirm"}],inputs:[{type:"input",name:"comment",placeholder:i,value:o}]});await a.present();const{data:s,role:n}=await a.onDidDismiss();"cancel"!=n&&this.itemUpdate(e.product_id,t,s.values.comment)},async itemUpdate(e,t,i){try{const o={product_id:e,[t]:i};await r().post(`${this.$heap.state.hostname}Product/itemUpdate`,JSON.stringify(o)),this.itemAlter(e,t,i),this.$flash("💾 Сохранено")}catch(s){var o,a;const e=null===s||void 0===s||null===(o=s.responseJSON)||void 0===o||null===(a=o.messages)||void 0===a?void 0:a.error;if("idle"==e)return;this.$flash("Не сохранено")}},itemAlter(e,t,i){for(let o in this.items)this.items[o].product_id==e&&(this.items[o][t]=i)},itemEdit(e){"images"==this.moderationType&&this.imageEdit(e),"products"==this.moderationType&&this.$go("/catalog/product-edit-"+e.product_id),"stores"==this.moderationType&&this.$go("/catalog/store-edit-"+e.store_id),"couriers"==this.moderationType&&this.$go("/user/courier-dashboard?courier_id="+e.courier_id)},async imageEdit(e){const t={delete:["Удалить","danger"],postpone:["Потом","primary"],enable:["Ок","success"]},i=await l.Fy.create({component:u.Z,componentProps:{image_hash:e.image_hash,actions:t},initialBreakpoint:.75,breakpoints:[.75,1]});this.$topic.on("dismissModal",(()=>{i.dismiss()})),i.present();const o=await i.onDidDismiss();"delete"==o.role&&await this.imageDelete(e),"enable"==o.role&&await this.imageEnable(e),"postpone"==o.role&&await this.imagePostpone(e),this.listReload()},async imageEnable(e){await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0})},async imagePostpone(e){await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0}),await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:1})},async imageDelete(e){await r().post(`${this.$heap.state.hostname}Image/itemDelete`,{image_id:e.image_id})}},mounted(){this.listLoad()},watch:{filter:function(){this.listFilter()}}},p=i(3744);const h=(0,p.Z)(m,[["render",n],["__scopeId","data-v-ced31e64"]]);var _=h}}]);
//# sourceMappingURL=667.21001779.js.map