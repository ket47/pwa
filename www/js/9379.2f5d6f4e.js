"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[9379],{9379:function(e,t,o){o.r(t),o.d(t,{default:function(){return E}});var i=o(641),l=o(33);const n=["onClick"],r=["onClick"],s={style:{display:"grid","grid-template-columns":"45px auto 20px",width:"100%","margin-bottom":"3px"}},a={style:{padding:"3px",color:"var(--ion-color-primary)"}},d={style:{padding:"3px",color:"#333"}},u={key:0,style:{padding:"3px",color:"#fff","background-color":"var(--ion-color-primary)","border-radius":"3px"}},c={key:1,style:{padding:"3px",color:"#999"}},_={style:{padding:"3px",color:"#333"}},h={key:3,style:{display:"flex","align-items":"end","justify-content":"center",height:"30vh"}},p={key:0,style:{width:"max-content","text-align":"center"}},m={key:1,style:{width:"max-content","text-align":"center"}};function b(e,t,o,b,k,f){const g=(0,i.g2)("ion-segment-button"),v=(0,i.g2)("ion-segment"),y=(0,i.g2)("ion-img"),L=(0,i.g2)("ion-avatar"),F=(0,i.g2)("ion-label"),C=(0,i.g2)("ion-icon"),I=(0,i.g2)("ion-chip"),j=(0,i.g2)("ion-item"),W=(0,i.g2)("ion-text"),$=(0,i.g2)("ion-list"),x=(0,i.g2)("ion-skeleton-text"),w=(0,i.g2)("ion-note"),T=(0,i.g2)("ion-button"),O=(0,i.g2)("ion-card-content"),X=(0,i.g2)("ion-card"),D=(0,i.g2)("ion-fab"),S=(0,i.g2)("ion-infinite-scroll-content"),E=(0,i.g2)("ion-infinite-scroll"),Q=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(Q,{"page-title":"Заказы",hideBackLink:"true"},{default:(0,i.k6)(()=>{var o,Q,z,G;return[(0,i.Lk)("div",null,[(0,i.bF)(v,{style:{height:"50px"},"swipe-gesture":"true",modelValue:k.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>k.orderType=e),onIonChange:t[1]||(t[1]=e=>f.listTypeChanged(e)),scrollable:!0},{default:(0,i.k6)(()=>[k.courierJobsInclude?((0,i.uX)(),(0,i.Wv)(g,{key:0,value:"jobs"},{default:(0,i.k6)(()=>t[7]||(t[7]=[(0,i.eW)(" Маршрут ")])),_:1,__:[7]})):(0,i.Q3)("",!0),(0,i.bF)(g,{value:"active"},{default:(0,i.k6)(()=>t[8]||(t[8]=[(0,i.eW)(" Заказы ")])),_:1,__:[8]}),(0,i.bF)(g,{value:"done",color:"medium"},{default:(0,i.k6)(()=>t[9]||(t[9]=[(0,i.eW)(" Архив ")])),_:1,__:[9]})]),_:1},8,["modelValue"])]),(null===(o=k.orderList)||void 0===o?void 0:o.length)>0?((0,i.uX)(),(0,i.Wv)($,{key:0},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(f.orderListComputed,t=>((0,i.uX)(),(0,i.CE)("div",{key:t.order_id,onClick:e=>f.itemOpen(t.order_id,t.is_shipment)},[(0,i.bF)(j,{lines:"none"},{default:(0,i.k6)(()=>[t.image_hash?((0,i.uX)(),(0,i.Wv)(L,{key:0,slot:"start"},{default:(0,i.k6)(()=>[(0,i.bF)(y,{style:{"border-radius":"16px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])]),_:2},1024)):(0,i.Q3)("",!0),1==t.is_shipment?((0,i.uX)(),(0,i.Wv)(F,{key:1},{default:(0,i.k6)(()=>[(0,i.Lk)("b",null,"Посылка "+(0,l.v_)(t.store_name),1)]),_:2},1024)):((0,i.uX)(),(0,i.Wv)(F,{key:2},{default:(0,i.k6)(()=>[(0,i.Lk)("b",null,(0,l.v_)(t.store_name),1)]),_:2},1024)),t.stage_current_name?((0,i.uX)(),(0,i.Wv)(I,{key:3,slot:"end",color:t.stage_color},{default:(0,i.k6)(()=>[1==t.is_canceled?((0,i.uX)(),(0,i.Wv)(C,{key:0,icon:b.banOutline},null,8,["icon"])):((0,i.uX)(),(0,i.Wv)(C,{key:1,icon:b.checkmarkOutline},null,8,["icon"])),(0,i.bF)(F,null,{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(t.stage_current_name),1)]),_:2},1024)]),_:2},1032,["color"])):(0,i.Q3)("",!0)]),_:2},1024),(0,i.bF)(j,{lines:"full"},{default:(0,i.k6)(()=>[(0,i.bF)(W,{slot:"start",color:"medium"},{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(t.date),1)]),_:2},1024),(0,i.bF)(W,{color:"medium"},{default:(0,i.k6)(()=>[(0,i.eW)("#"+(0,l.v_)(t.order_id),1)]),_:2},1024),(0,i.bF)(W,{slot:"end",color:"medium"},{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(t.order_sum_total)+(0,l.v_)(e.$heap.state.currencySign),1)]),_:2},1024)]),_:2},1024)],8,n))),128))]),_:1})):(0,i.Q3)("",!0),"jobs"==k.orderType&&f.routeListGroupped?((0,i.uX)(),(0,i.Wv)($,{key:1,lines:"none"},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(f.routeListGroupped,t=>((0,i.uX)(),(0,i.CE)("div",{key:t.courier_id},[(0,i.bF)(j,null,{default:(0,i.k6)(()=>[t.image_hash?((0,i.uX)(),(0,i.Wv)(L,{key:0,slot:"start"},{default:(0,i.k6)(()=>[(0,i.bF)(y,{style:{"border-radius":"16px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])]),_:2},1024)):(0,i.Q3)("",!0),(0,i.bF)(W,null,{default:(0,i.k6)(()=>[(0,i.Lk)("b",null,(0,l.v_)(t.courier_name),1)]),_:2},1024),(0,i.bF)(C,{slot:"end",icon:b.square,style:(0,l.Tr)(`color:${t.actual_color}`)},null,8,["icon","style"])]),_:2},1024),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.jobs,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.job_id,onClick:t=>f.itemClickConfirm(e)},[(0,i.bF)(j,{lines:"none",style:{"--inner-padding-bottom":"0px"}},{default:(0,i.k6)(()=>[e.finish_plan_scheduled_date?((0,i.uX)(),(0,i.Wv)(C,{key:0,icon:b.alarmOutline,slot:"start",color:"danger"},null,8,["icon"])):(0,i.Q3)("",!0),(0,i.bF)(W,null,{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(e.job_name),1)]),_:2},1024),(0,i.bF)(I,{slot:"end",color:e.stage_color},{default:(0,i.k6)(()=>[(0,i.bF)(C,{icon:b.checkmarkOutline},null,8,["icon"]),(0,i.bF)(F,{color:"dark"},{default:(0,i.k6)(()=>[(0,i.Lk)("small",null,(0,l.v_)(e.stage_label),1)]),_:2},1024)]),_:2},1032,["color"])]),_:2},1024),(0,i.bF)(j,{lines:"full"},{default:(0,i.k6)(()=>[(0,i.Lk)("div",s,[(0,i.Lk)("div",a,[(0,i.Lk)("b",null,(0,l.v_)(e.start_plan_date),1)]),(0,i.Lk)("div",d,[(0,i.Lk)("small",null,(0,l.v_)(e.start_address),1)]),(0,i.Lk)("div",null,[(0,i.bF)(C,{icon:b.square,style:(0,l.Tr)(`color:${e.start_color}`)},null,8,["icon","style"])]),e.finish_plan_scheduled_date?((0,i.uX)(),(0,i.CE)("div",u,(0,l.v_)(e.finish_plan_scheduled_date),1)):((0,i.uX)(),(0,i.CE)("div",c,(0,l.v_)(e.finish_plan_date),1)),(0,i.Lk)("div",_,[(0,i.Lk)("small",null,(0,l.v_)(e.finish_address),1)]),(0,i.Lk)("div",null,[(0,i.bF)(C,{icon:b.square,style:(0,l.Tr)(`color:${e.finish_color}`)},null,8,["icon","style"])])])]),_:2},1024)],8,r))),128))]))),128))]),_:1})):(0,i.Q3)("",!0),["active","done"].includes(k.orderType)&&null==k.orderList?((0,i.uX)(),(0,i.Wv)($,{key:2},{default:(0,i.k6)(()=>[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([1,2,3],e=>(0,i.Lk)("div",{key:e},[(0,i.bF)(j,{lines:"none"},{default:(0,i.k6)(()=>[(0,i.bF)(x,{style:{width:"50px"},slot:"start"}),(0,i.bF)(x,{style:{width:"100%"}}),(0,i.bF)(x,{style:{width:"50px"},slot:"end"})]),_:1}),(0,i.bF)(j,{lines:"full"},{default:(0,i.k6)(()=>[(0,i.bF)(x,{animated:"",style:{width:"30px",height:"30px","border-radius":"50px"},slot:"start"}),(0,i.bF)(I,{color:"medium"},{default:(0,i.k6)(()=>[(0,i.bF)(F,{color:"dark"},{default:(0,i.k6)(()=>[(0,i.bF)(x,{animated:"",style:{width:"80px"}})]),_:1})]),_:1}),(0,i.bF)(I,{color:"primary"},{default:(0,i.k6)(()=>[(0,i.bF)(C,{icon:b.checkmarkOutline},null,8,["icon"]),(0,i.bF)(F,{color:"dark"},{default:(0,i.k6)(()=>[(0,i.bF)(x,{animated:"",style:{width:"80px"}})]),_:1})]),_:1}),(0,i.bF)(x,{animated:"",style:{width:"40px",height:"40px","border-radius":"10px"},slot:"end"})]),_:1})])),64))]),_:1})):f.cartListTotal||k.orderList&&0!=(null===(Q=k.orderList)||void 0===Q?void 0:Q.length)||k.jobList&&0!=(null===(z=k.jobList)||void 0===z?void 0:z.length)||k.routeList&&0!=(null===(G=k.routeList)||void 0===G?void 0:G.length)?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",h,[e.$heap.getters.userIsLogged?((0,i.uX)(),(0,i.CE)("div",p,[(0,i.bF)(C,{icon:b.sparklesOutline,size:"large"},null,8,["icon"]),(0,i.bF)(F,null,{default:(0,i.k6)(()=>t[10]||(t[10]=[(0,i.eW)("Заказов нет")])),_:1,__:[10]}),t[12]||(t[12]=(0,i.Lk)("br",null,null,-1)),(0,i.bF)(w,{onClick:t[2]||(t[2]=t=>e.$router.replace("/")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.k6)(()=>t[11]||(t[11]=[(0,i.eW)("но вы можете создать новый")])),_:1,__:[11]})])):((0,i.uX)(),(0,i.CE)("div",m,[(0,i.bF)(C,{icon:b.informationOutline,size:"large"},null,8,["icon"]),(0,i.bF)(F,null,{default:(0,i.k6)(()=>t[13]||(t[13]=[(0,i.eW)("Необходимо войти в профиль")])),_:1,__:[13]}),t[15]||(t[15]=(0,i.Lk)("br",null,null,-1)),(0,i.bF)(w,{onClick:t[3]||(t[3]=t=>e.$router.replace("/modal/user-authorize")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.k6)(()=>t[14]||(t[14]=[(0,i.eW)("вход в профиль")])),_:1,__:[14]})]))])),f.cartListTotal&&k.orderList&&"active"==k.orderType?((0,i.uX)(),(0,i.Wv)(X,{key:4,onClick:t[4]||(t[4]=t=>{e.$topic.publish("cartOpen")}),color:"light"},{default:(0,i.k6)(()=>[(0,i.bF)(O,{style:{"text-align":"center"}},{default:(0,i.k6)(()=>[t[17]||(t[17]=(0,i.eW)(" У вас есть не оформленные товары в корзине. Успейте купить! ")),(0,i.bF)(T,{expand:"block",fill:"clear"},{default:(0,i.k6)(()=>[(0,i.bF)(F,{slot:"start"},{default:(0,i.k6)(()=>t[16]||(t[16]=[(0,i.eW)("Посмотреть")])),_:1,__:[16]})]),_:1})]),_:1,__:[17]})]),_:1})):(0,i.Q3)("",!0),"active"==k.orderType?((0,i.uX)(),(0,i.Wv)(D,{key:5,slot:"fixed",vertical:"bottom",horizontal:"end"},{default:(0,i.k6)(()=>[(0,i.Lk)("div",null,[(0,i.bF)(T,{onClick:t[5]||(t[5]=t=>e.$go("/order/shipment-0"))},{default:(0,i.k6)(()=>[(0,i.bF)(C,{icon:b.cubeOutline,slot:"start"},null,8,["icon"]),(0,i.bF)(F,null,{default:(0,i.k6)(()=>t[18]||(t[18]=[(0,i.eW)("Вызвать курьера")])),_:1,__:[18]})]),_:1})])]),_:1})):(0,i.Q3)("",!0),(0,i.bF)(E,{onIonInfinite:t[6]||(t[6]=e=>f.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,i.k6)(()=>[(0,i.bF)(S,{"loading-spinner":"bubbles","loading-text":"Загрузка..."})]),_:1})]}),_:1})}o(4114);var k=o(5634),f=o(5480),g=o(1376),v=o(6028);const y={style:{color:"#999"}},L=["href"],F={key:0},C={key:1},I=["href"],j=["href"];function W(e,t,o,n,r,s){const a=(0,i.g2)("ion-icon"),d=(0,i.g2)("ion-item"),u=(0,i.g2)("ion-list"),c=(0,i.g2)("ion-card-subtitle"),_=(0,i.g2)("ion-card-header"),h=(0,i.g2)("ion-chip"),p=(0,i.g2)("ion-checkbox"),m=(0,i.g2)("ion-card-content"),b=(0,i.g2)("ion-card"),k=(0,i.g2)("ion-button"),f=(0,i.g2)("ion-content");return(0,i.uX)(),(0,i.Wv)(f,null,{default:(0,i.k6)(()=>[(0,i.bF)(u,{lines:"none"},{default:(0,i.k6)(()=>[(0,i.bF)(d,null,{default:(0,i.k6)(()=>[o.job.finish_plan_scheduled_date?((0,i.uX)(),(0,i.Wv)(a,{key:0,icon:n.alarmOutline,slot:"start",style:{"font-size":"24px"},color:"danger"},null,8,["icon"])):(0,i.Q3)("",!0),(0,i.Lk)("h5",y,(0,l.v_)(o.job.job_name)+" ["+(0,l.v_)(o.job.stage_label)+"]",1)]),_:1}),(0,i.bF)(d,null,{default:(0,i.k6)(()=>[(0,i.Lk)("h6",null,"Забрать до "+(0,l.v_)(o.job.start_plan_date),1)]),_:1}),(0,i.bF)(d,null,{default:(0,i.k6)(()=>[(0,i.bF)(a,{slot:"end",icon:n.square,size:"large",style:(0,l.Tr)(`color:${o.job.start_color}`)},null,8,["icon","style"]),(0,i.Lk)("a",{href:`https://yandex.ru/maps/?pt=${o.job.start_longitude},${o.job.start_latitude}&z=19&l=map,trf`,target:"_new",style:{color:"#999"}},(0,l.v_)(o.job.start_address),9,L)]),_:1}),(0,i.bF)(d,null,{default:(0,i.k6)(()=>[s.finish_plan_scheduled_date_full?((0,i.uX)(),(0,i.CE)("h6",F,"Привезти к "+(0,l.v_)(s.finish_plan_scheduled_date_full)+" (⏰ Запланирован)",1)):((0,i.uX)(),(0,i.CE)("h6",C,"Привезти до "+(0,l.v_)(o.job.finish_plan_date),1))]),_:1}),(0,i.bF)(d,null,{default:(0,i.k6)(()=>[(0,i.bF)(a,{slot:"end",icon:n.square,size:"large",style:(0,l.Tr)(`color:${o.job.finish_color}`)},null,8,["icon","style"]),(0,i.Lk)("a",{href:`https://yandex.ru/maps/?pt=${o.job.finish_longitude},${o.job.finish_latitude}&z=19&l=map,trf`,target:"_new",style:{color:"#999"}},(0,l.v_)(o.job.finish_address),9,I)]),_:1})]),_:1}),"awaited"==o.job.stage&&1==o.job.payment_by_cash?((0,i.uX)(),(0,i.Wv)(b,{key:0,color:"light"},{default:(0,i.k6)(()=>[(0,i.bF)(_,null,{default:(0,i.k6)(()=>[(0,i.bF)(c,null,{default:(0,i.k6)(()=>t[4]||(t[4]=[(0,i.eW)("Заказ не оплачен")])),_:1,__:[4]})]),_:1}),r.customerDetails?((0,i.uX)(),(0,i.Wv)(m,{key:0},{default:(0,i.k6)(()=>[(0,i.Lk)("p",null,[t[5]||(t[5]=(0,i.eW)("Созвонитесь с клиентом ")),(0,i.Lk)("b",null,(0,l.v_)(r.customerDetails.user_name),1),t[6]||(t[6]=(0,i.eW)()),(0,i.bF)(h,{color:"primary"},{default:(0,i.k6)(()=>[(0,i.Lk)("a",{href:`tel:+${r.customerDetails.user_phone}`},"+"+(0,l.v_)(r.customerDetails.user_phone),9,j)]),_:1})]),(0,i.Lk)("p",null,[(0,i.bF)(p,{onClick:t[0]||(t[0]=e=>r.confirmed=e.target.checked?0:1)},{default:(0,i.k6)(()=>t[7]||(t[7]=[(0,i.eW)("Клиент на связи и готов ждать")])),_:1,__:[7]})])]),_:1})):(0,i.Q3)("",!0)]),_:1})):(0,i.Q3)("",!0),"awaited"==o.job.stage?((0,i.uX)(),(0,i.Wv)(k,{key:1,onClick:t[1]||(t[1]=e=>s.jobTake()),expand:"block",disabled:!r.confirmed},{default:(0,i.k6)(()=>t[8]||(t[8]=[(0,i.eW)("Взять задание")])),_:1,__:[8]},8,["disabled"])):"scheduled"!=o.job.stage?((0,i.uX)(),(0,i.Wv)(k,{key:2,onClick:t[2]||(t[2]=e=>s.itemOpen()),expand:"block"},{default:(0,i.k6)(()=>t[9]||(t[9]=[(0,i.eW)("Открыть заказ")])),_:1,__:[9]})):(0,i.Q3)("",!0),(0,i.bF)(k,{onClick:t[3]||(t[3]=e=>s.close()),expand:"block",color:"light"},{default:(0,i.k6)(()=>t[10]||(t[10]=[(0,i.eW)("Закрыть")])),_:1,__:[10]})]),_:1})}var $=o(2311),x=o.n($),w={props:["job"],components:{IonList:k.nf,IonButton:k.Jm,IonItem:k.uz,IonIcon:k.iq,IonContent:k.W9,IonCard:k.b_,IonCardHeader:k.ME,IonCardContent:k.I9,IonCardSubtitle:k.HW,IonChip:k.ZB,IonCheckbox:k.eY},setup(){return{square:f.EwI,alarmOutline:f.WYB}},data(){return{customerDetails:null,confirmed:0}},mounted(){"awaited"==this.job.stage&&1==this.job.payment_by_cash?(this.customerDetailsGet(),this.confirmed=0):this.confirmed=1},computed:{finish_plan_scheduled_date_full(){if(this.job.finish_plan_scheduled>0){const e=new Date(1e3*this.job.finish_plan_scheduled);return e.toLocaleDateString(void 0,{month:"short",year:"numeric",day:"numeric",hour:"numeric",minute:"numeric"})}return null}},methods:{async jobTake(){try{const e={order_id:this.job.order_id};await x().post(`${this.$heap.state.hostname}DeliveryJob/itemTake`,e),this.itemOpen(),this.$topic.publish("dismissModal"),k.OZ.dismiss(null,"confirm")}catch(o){var e,t;const i=null===(e=o.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.error;"forbidden"==i&&this.$flash("Не хватает прав"),"notfound"==i&&this.$flash("Задание не найдено"),"notready"==i&&this.$flash("Ваш статус должен быть 'ГОТОВ'"),"notsearching"!=i&&"idle"!=i||this.$flash("Заданию уже назначен курьер")}},itemOpen(){1==this.job.is_shipment?this.$go(`/order/shipment-${this.job.order_id}`):this.$go(`/order/order-${this.job.order_id}`)},async customerDetailsGet(){this.customerDetails=null;const e={job_id:this.job.job_id};try{this.customerDetails=await x().post(`${this.$heap.state.hostname}DeliveryJob/itemCustomerDetailGet`,e)}catch{this.$flash("Данные клиента не найдены")}},close(){k.OZ.dismiss(null,"cancel")}}},T=o(6262);const O=(0,T.A)(w,[["render",W],["__scopeId","data-v-0d409d3f"]]);var X=O,D={inject:["$Order"],components:{IonSegment:k.Gp,IonSegmentButton:k.eP,IonIcon:k.iq,IonAvatar:k.mC,IonText:k.IO,IonLabel:k.he,IonItem:k.uz,IonList:k.nf,IonChip:k.ZB,IonNote:k.JI,IonImg:k.KW,IonInfiniteScroll:k.Ax,IonInfiniteScrollContent:k.Hp,IonSkeletonText:k.ds,IonFab:k.Q8,IonButton:k.Jm,IonCard:k.b_,IonCardContent:k.I9},setup(){return{sparklesOutline:f.isq,storefrontOutline:f.te8,alarmOutline:f.WYB,ordersIcon:g,rocketOutline:f.hGQ,ribbonOutline:f.rp8,checkmarkOutline:f.g1L,informationOutline:f.Hzj,banOutline:f.Av6,square:f.EwI,cubeOutline:f.a7r,cartOutline:f.jSK}},data(){return{jobList:null,routeList:null,orderList:null,orderType:"active",courierJobsInclude:null,clock:null}},computed:{orderListComputed(){for(let e of this.orderList){switch(e.user_role){case"customer":e.icon=g;break;case"admin":e.icon=f.rp8;break;case"courier":e.icon=f.hGQ;break;case"supplier":e.icon=f.te8;break}e.date=this.toLocDate(e.created_at),e.stage_color="customer_cart"==e.stage_current?"light":"primary",e.stage_color="1"==e.is_canceled?"danger":e.stage_color}return this.orderList},jobListComputed(){for(let e of this.jobList)e.location_address||(e.location_address=""),e.distance?e.distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="",e.date_time=this.toLocDateTime(e.created_at);return this.jobList},routeListGroupped(){if(!this.routeList)return null;let e={};for(let l in this.routeList.open_shifts){let t=this.routeList.open_shifts[l];t.jobs=[],e["route_"+t.courier_id]=t}const t={scheduled:"Запланирован",awaited:"Очередь",assigned:"Назначен",started:"В пути"};for(let l of this.routeList.delivery_jobs){var o,i;const n=new Date(1e3*(1*l.start_plan+1*l.finish_arrival_time)),r=new Date(1e3*l.start_plan);if(l.start_plan_date=r.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"}),l.finish_plan_date=n.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"}),l.stage_label=t[l.stage]||"-",l.stage_color=["scheduled","awaited"].includes(l.stage)?"light":"primary",l.is_courier_job=1,l.finish_plan_scheduled>0){const e=new Date(1e3*l.finish_plan_scheduled);l.finish_plan_scheduled_date=e.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"})}l.courier_id||(l.courier_id=0,e["route_0"]||(e["route_0"]={courier_name:"",actual_color:"#fff",jobs:[]})),null===(o=e["route_"+l.courier_id])||void 0===o||null===(i=o.jobs)||void 0===i||i.push(l)}return e},cartListTotal(){return this.$Order.cart.listTotalGet()}},mounted(){this.$topic.on("courierStatusChange",()=>{this.courierReadinessCheck()}),this.$topic.on("userGet",()=>{this.listLoad(this.orderType,"reload")}),this.courierReadinessCheck()},methods:{toLocDate(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,o)},toLocDateTime(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,o)},courierReadinessCheck(){this.courierJobsInclude=1==localStorage.user_is_courier||1==localStorage.user_is_admin,0==this.courierJobsInclude&&(this.orderType="active")},async listLoad(e,t="reload"){var o;if("jobs"==e)return this.autoReload(e),void this.listRouteLoad();let i="system_finish";"active"==e&&(this.autoReload(e),i="active_only");const l={order_group_type:i,offset:0,limit:(null===(o=this.orderList)||void 0===o?void 0:o.length)||10};var n;"append"==t&&(l.offset=(null===(n=this.orderList)||void 0===n?void 0:n.length)??0,l.limit=10);let r=await v.A.api.listLoad(l);this.orderType=e,"append"==t&&(this.orderList??=[],r=this.orderList.concat(r)),this.orderList=r,this.jobList=null},async listLoadMore(e){await this.listLoad(this.orderType,"append"),e.target.complete()},listTypeChanged(e){const t=e.target.value;this.orderList=null,this.listLoad(t)},async listRouteLoad(){try{const e={};this.routeList=await x().post(`${this.$heap.state.hostname}DeliveryJob/routeListGet`,e)}catch(o){var e,t;null===(e=o.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t||t.error;console.log(o)}},autoReload(e){clearTimeout(this.clock);const t=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout(()=>{this.listLoad(this.orderType)},t))},ionViewDidEnter(){this.courierReadinessCheck(),this.listLoad(this.orderType)},ionViewDidLeave(){clearTimeout(this.clock)},async itemClickConfirm(e){const t=await k.OZ.create({component:X,componentProps:{job:e},initialBreakpoint:.75,breakpoints:[.75,1]});this.$topic.on("dismissModal",()=>{t.dismiss()}),await t.present();const{data:o,role:i}=await t.onDidDismiss();"confirm"==i&&this.itemOpen(e.order_id,e.is_shipment)},itemOpen(e,t){1==t?this.$go(`/order/shipment-${e}`):this.$go(`/order/order-${e}`)}}};const S=(0,T.A)(D,[["render",b],["__scopeId","data-v-33b57b96"]]);var E=S}}]);
//# sourceMappingURL=9379.2f5d6f4e.js.map