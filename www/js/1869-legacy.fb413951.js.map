{"version":3,"file":"js/1869-legacy.fb413951.js","mappings":"yQACIA,EAAAA,EAAAA,IAEcC,EAAA,CAFD,aAAW,iBAAe,C,kBACnC,IAAsF,EAAtFC,EAAAA,EAAAA,IAAsFC,EAAA,CAA1EC,UAAWC,EAAAC,MAAQC,cAAaC,EAAAD,cAAgBE,cAAaD,EAAAE,Y,0IAUjF,GACIC,WAAW,CACPC,SAAQ,IACRC,UAASA,EAAAA,IAEbC,IAAAA,GACI,MAAM,CACFR,MAAM,KAEd,EACAS,QAAQ,CACJ,gBAAMC,GACF,MAAMC,EAAK,IAAIC,KACTC,EAAM,CACRC,eAAe,KACfC,SAAS,EACTC,QAAQ,GACRC,WAAWN,EAAKO,cAAcC,QAAQ,OAAO,KAAKA,QAAQ,WAAW,IACrEC,WAAW,CACP,mBAAsB,CAAC,wBACvB,iBAAoB,CAAC,UAAU,SAAS,UAE5CC,cAAc,gBACdC,UAAU,YAEdC,KAAKvB,MAAMa,EACXU,KAAKC,UACT,EACA,cAAMC,GACF,IACI,MAAMC,EAAYC,KAAKC,MAAMC,aAAaC,eAC1C,GAAGJ,EAEC,YADAH,KAAKvB,MAAM0B,EAInB,CAAC,MAAAK,GAAY,CACbR,KAAKb,YACT,EACA,cAAMc,GACFK,aAAaC,cAAcH,KAAKK,UAAUT,KAAKvB,MACnD,EACA,gBAAMI,CAAY6B,GACdV,KAAKvB,MAAMkC,OAAOC,OAAOZ,KAAKvB,MAAMiC,GACpCV,KAAKC,UACT,EACA,mBAAMvB,CAAcc,EAAUqB,GAC1B,GAAqB,mBAAlBA,GAAyD,oBAAlBA,EAGtC,OAFAP,aAAaQ,WAAW,sBACxBd,KAAKe,QAAQnB,QAAS,qBAGL,2BAAlBiB,IACCA,EAAiB,sBAErB,IACI,MAAMG,EAAQhB,KAAKvB,MACbwC,QAAqBC,IAAAA,KAAa,GAAElB,KAAKmB,MAAMC,MAAMC,4BAA4BL,GACnFC,EAAa,GACbjB,KAAKe,QAAQO,KAAM,2BAA0BL,IAErD,CAAE,MAAMM,GACJ,MAAMC,EAAa,OAAHD,QAAG,IAAHA,OAAG,EAAHA,EAAKE,aACrB,IAAID,EACA,OAAO,EAEX,MAAME,EAAeF,EAAUG,SAASC,MACxC,OAAOF,GACH,IAAK,iBACD1B,KAAK6B,OAAO,+CAA+C,cAC3D,MACJ,IAAK,kBACD7B,KAAK8B,OAAO,sCACZ9B,KAAK+B,OAAOC,QAAQ,gBACpBhC,KAAKiC,IAAI,yBACTjC,KAAKmB,MAAMC,MAAMc,WAAW,gBAAgB1C,EAC5C,MAER,OAAO,CACX,CACJ,GAEJ2C,OAAAA,GACInC,KAAKE,UACT,G,UC3FJ,MAAMkC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://Tezkel/./src/views/ShipmentDraftView.vue","webpack://Tezkel/./src/views/ShipmentDraftView.vue?ac34"],"sourcesContent":["<template>\r\n    <base-layout page-title=\"Вызов курьера\">\r\n        <ship-comp :orderData=\"order\" @stageCreate=\"onStageCreate\" @orderUpdate=\"itemUpdate\"/>\r\n    </base-layout>\r\n</template>\r\n<script>\r\nimport {\r\n    IonButton\r\n}                       from '@ionic/vue'\r\nimport jQuery           from \"jquery\";\r\nimport ShipComp          from '@/components/ShipmentComp.vue';\r\n\r\nexport default {\r\n    components:{\r\n        ShipComp,\r\n        IonButton,\r\n    },\r\n    data(){\r\n        return{\r\n            order:null\r\n        }\r\n    },\r\n    methods:{\r\n        async itemCreate(){\r\n            const date=new Date()\r\n            const draft={\r\n                order_store_id:null,\r\n                order_id:0,\r\n                entries:[],\r\n                created_at:date.toISOString().replace(/[T]/g,' ').replace(/.\\d\\d\\dZ/,''),\r\n                stage_next:{\r\n                    \"customer_confirmed\": [\"Перейти к оформлению\"],\r\n                    \"customer_deleted\": [\"Удалить\",\"danger\",\"clear\"],\r\n                },\r\n                stage_current:'customer_cart',\r\n                user_role:'customer',\r\n            }\r\n            this.order=draft\r\n            this.itemSave()\r\n        },\r\n        async itemLoad(){\r\n            try{\r\n                const storedOrder=JSON.parse(localStorage.shipmentDraft)\r\n                if(storedOrder){\r\n                    this.order=storedOrder\r\n                    return\r\n                }\r\n\r\n            }catch{/** */}\r\n            this.itemCreate()\r\n        },\r\n        async itemSave(){\r\n            localStorage.shipmentDraft=JSON.stringify(this.order)\r\n        },\r\n        async itemUpdate( orderUpdate ){\r\n            this.order=Object.assign(this.order,orderUpdate)\r\n            this.itemSave()\r\n        },\r\n        async onStageCreate(order_id, order_stage_code){\r\n            if(order_stage_code=='customer_purged' || order_stage_code=='customer_deleted' ){\r\n                localStorage.removeItem('shipmentDraft');\r\n                this.$router.replace(`/order/order-list`)\r\n                return\r\n            }\r\n            if(order_stage_code=='customer_action_confirm'){\r\n                order_stage_code='customer_confirmed'\r\n            }\r\n            try{\r\n                const request=this.order\r\n                const new_order_id = await jQuery.post(`${this.$heap.state.hostname}Shipment/itemSync`,request)\r\n                if( new_order_id>0 ){\r\n                    this.$router.push(`modal/shipment-checkout-${new_order_id}`)\r\n                }\r\n            } catch(err){\r\n                const exception=err?.responseJSON;\r\n                if(!exception){\r\n                    return false;\r\n                }\r\n                const exception_code=exception.messages.error;\r\n                switch(exception_code){\r\n                    case 'order_is_empty':\r\n                        this.$alert(\"К сожалению, товара не осталось в наличии ☹️\",\"Заказ пуст\");\r\n                        break;\r\n                    case 'address_not_set':\r\n                        this.$flash(\"Необходимо добавить адрес доставки\")\r\n                        this.$topic.publish('dismissModal')\r\n                        this.$go('/modal/user-addresses')\r\n                        this.$heap.state.next_route='/order/order-'+order_id;\r\n                        break;\r\n                }\r\n                return false\r\n            }\r\n        },\r\n    },\r\n    mounted(){\r\n        this.itemLoad()\r\n    }\r\n}\r\n</script>","import { render } from \"./ShipmentDraftView.vue?vue&type=template&id=663df756\"\nimport script from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\nexport * from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","_createVNode","_component_ship_comp","orderData","$data","order","onStageCreate","$options","onOrderUpdate","itemUpdate","components","ShipComp","IonButton","data","methods","itemCreate","date","Date","draft","order_store_id","order_id","entries","created_at","toISOString","replace","stage_next","stage_current","user_role","this","itemSave","itemLoad","storedOrder","JSON","parse","localStorage","shipmentDraft","_unused","stringify","orderUpdate","Object","assign","order_stage_code","removeItem","$router","request","new_order_id","jQuery","$heap","state","hostname","push","err","exception","responseJSON","exception_code","messages","error","$alert","$flash","$topic","publish","$go","next_route","mounted","__exports__","render"],"sourceRoot":""}