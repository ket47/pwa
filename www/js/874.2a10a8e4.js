"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[874],{8385:function(e,t,i){i.d(t,{Z:function(){return b}});var a=i(6252),o=i(3577);const n=(0,a.Uk)("Фотографии"),s={key:0,class:"image_grid"},r={key:0,class:"image_controls"};function l(e,t,i,l,d,c){const u=(0,a.up)("ion-label"),h=(0,a.up)("ion-icon"),m=(0,a.up)("ion-item"),p=(0,a.up)("ion-img"),g=(0,a.up)("ion-avatar");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",null,[(0,a.Wm)(m,{lines:"none"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[n])),_:1}),d.editMode?((0,a.wg)(),(0,a.j4)(h,{key:0,slot:"end",icon:l.settingsSharp,color:"primary",onClick:t[0]||(t[0]=e=>d.editMode=0)},null,8,["icon"])):((0,a.wg)(),(0,a.j4)(h,{key:1,slot:"end",icon:l.settingsOutline,onClick:t[1]||(t[1]=e=>d.editMode=1)},null,8,["icon"]))])),_:1}),c.imageList?.length?((0,a.wg)(),(0,a.iD)("div",s,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(c.imageList,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.image_id},[(0,a.Wm)(g,{onClick:e=>c.imagePreview(t.image_hash),class:(0,o.C_)(t.class)},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),d.editMode?((0,a.wg)(),(0,a.iD)("div",r,[(0,a.Wm)(h,{icon:l.chevronBackCircleOutline,onClick:e=>c.back(t)},null,8,["icon","onClick"]),c.isAdmin&&1==t.is_disabled?((0,a.wg)(),(0,a.j4)(h,{key:0,icon:l.checkmarkCircle,color:"success",onClick:e=>c.enable(t)},null,8,["icon","onClick"])):(0,a.kq)("",!0),t.deleted_at?((0,a.wg)(),(0,a.j4)(h,{key:1,icon:l.trash,color:"success",onClick:e=>c.restore(t)},null,8,["icon","onClick"])):((0,a.wg)(),(0,a.j4)(h,{key:2,icon:l.trashBin,color:"danger",onClick:e=>c.remove(t)},null,8,["icon","onClick"])),(0,a.Wm)(h,{icon:l.chevronForwardCircleOutline,onClick:e=>c.forward(t)},null,8,["icon","onClick"])])):(0,a.kq)("",!0)])))),128))])):(0,a.kq)("",!0)]),(0,a._)("input",{type:"file",id:"foto_upload",accept:"image/*",onChange:t[2]||(t[2]=e=>c.uploadImage(e)),style:{display:"none"}},null,32)],64)}var d=i(8903);const c=(0,a.Uk)("Просмотр фотографии");function u(e,t,i,o,n,s){const r=(0,a.up)("ion-label"),l=(0,a.up)("ion-icon"),d=(0,a.up)("ion-toolbar"),u=(0,a.up)("ion-header"),h=(0,a.up)("ion-img"),m=(0,a.up)("ion-content");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[c])),_:1}),(0,a.Wm)(l,{icon:o.closeOutline,onClick:t[0]||(t[0]=e=>{o.closeModal()}),slot:"end"},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{src:e.$heap.state.hostname+"image/get.php/"+i.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var h=i(3455),m={props:["image_hash"],setup(){const e=function(){h.Fy.dismiss()};return{closeModal:e,closeOutline:d.fID}}},p=i(3744);const g=(0,p.Z)(m,[["render",u]]);var _=g,k=i(9755),w=i.n(k),f=i(9042),y=i(351),C={props:["images","image_holder_id","controller"],setup(){return{settingsOutline:d.C$N,settingsSharp:d.kiF,chevronBackCircleOutline:d.CK0,chevronForwardCircleOutline:d.esm,trashBin:d.UQi,trash:d._Ij,checkmarkCircle:d.I1A}},created(){},data(){return{images_loaded:null,editMode:!1}},computed:{imageList(){let e=this.images_loaded||this.images,t=[];for(let i in e)e[i].deleted_at?(e[i].class=" deleted",this.editMode&&t.push(e[i])):1==e[i].is_disabled?(e[i].class=" disabled",this.editMode&&t.push(e[i])):t.push(e[i]);return t},isAdmin(){return y.Z.isAdmin()}},methods:{async back(e){try{await w().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"}),this.load()}catch{}},async forward(e){try{await w().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"}),this.load()}catch{}},async remove(e){try{await w().post(this.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id}),this.load()}catch{}},async restore(e){try{await w().post(this.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id}),this.load()}catch{}},async enable(e){try{await w().post(this.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0}),this.load()}catch{}},async load(){const e={image_holder_id:this.image_holder_id,image_holder:this.controller,is_disabled:1,is_deleted:1,is_active:1};this.images_loaded=await w().post(this.$heap.state.hostname+"Image/listGet",e)},async imagePreview(e){const t=await h.Fy.create({component:_,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[0,.5,1]}),i=function(){t.dismiss()};return f.Z.on("dismissModal",i),t.present()},async uploadImage(e){let t=new FormData;t.append("files[]",e.target.files[0]),t.set("image_holder_id",this.image_holder_id);const i={url:this.$heap.state.hostname+this.controller+"/fileUpload",type:"POST",data:t,processData:!1,contentType:!1};try{await w().ajax(i),this.load()}catch(a){if("limit_exeeded"==a?.responseJSON?.messages?.error)return void this.$flash("Уже загружено максимальное количество фото");this.$flash("Не удалось загрузить фото")}},take_photo(){w()("#foto_upload").trigger("click")}}};const v=(0,p.Z)(C,[["render",l],["__scopeId","data-v-9da20430"]]);var b=v},6874:function(e,t,i){i.r(t),i.d(t,{default:function(){return w}});var a=i(6252);const o={key:0,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},n={style:{width:"max-content","text-align":"center"}},s=(0,a.Uk)("Заказ не найден"),r=(0,a._)("br",null,null,-1),l=(0,a._)("a",{href:"/order-list"},"список заказов",-1);function d(e,t,i,d,c,u){const h=(0,a.up)("ion-icon"),m=(0,a.up)("ion-label"),p=(0,a.up)("order-comp"),g=(0,a.up)("image-tile-comp"),_=(0,a.up)("ion-content"),k=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(k,{pageTitle:"Заказ",pageDefaultBackLink:"order-list"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>["notfound"==c.order?((0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",n,[(0,a.Wm)(h,{icon:d.sparklesOutline,size:"large"},null,8,["icon"]),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[s])),_:1}),r,l])])):(0,a.kq)("",!0),(0,a.Wm)(p,{orderData:c.order,onStageCreate:u.onStageCreate},null,8,["orderData","onStageCreate"]),c.order?.images.length?((0,a.wg)(),(0,a.j4)(g,{key:1,images:c.order?.images,image_holder_id:c.order?.order_id,controller:"Order",ref:"orderImgs"},null,8,["images","image_holder_id"])):(0,a.kq)("",!0)])),_:1})])),_:1})}var c=i(8903),u=i(7782),h=i(3234),m=i(8385),p=i(9127),g={components:{OrderComp:h.Z,ImageTileComp:m.Z},setup(){return{sparklesOutline:c.Fcs}},data(){return{order_id:0,order:null}},methods:{async orderGet(){try{this.order=await u.Z.api.itemGet(this.order_id)}catch(e){switch(e.status){case 404:this.$flash("Заказ не найден"),this.order="notfound",p.Z.push("order-list");break}}},async onStageCreate(e,t){if(t.includes("action")){t=t.split("_").splice(1).join("_");try{this[t](e)}catch{}}else try{const i=await u.Z.api.itemStageCreate(e,t);if("ok"==i){if("customer_purged"==t)return this.$flash("Заказ удален"),this.order=null,void p.Z.push("order-list");this.orderGet()}}catch{}},async action_checkout(e){await this.onStageCreate(e,"customer_confirmed"),this.$heap.state.currentOrder=this.order,p.Z.push("order-checkout-"+e)},action_take_photo(){this.$refs.orderImgs.take_photo()},ionViewDidEnter(){this.order_id=this.$route.params.id,this.orderGet()}}},_=i(3744);const k=(0,_.Z)(g,[["render",d]]);var w=k}}]);
//# sourceMappingURL=874.2a10a8e4.js.map