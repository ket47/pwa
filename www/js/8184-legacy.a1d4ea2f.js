"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[8184],{4405:function(t,e,n){n(4916),n(5306);var a=n(2008);const r={deliveryCalculate(t){if(!t.locations||!t.locations[0]||!t.locations[0].distance)return null;const e=t.locations[0].distance,n=t.store_time_preparation||0;return r.deliveryTimeCalculate(e,n)},deliveryTimeCalculate(t,e){var n;e=parseInt(null!==(n=e)&&void 0!==n?n:a.Z.getters.settings.delivery.timePreparationDefault);const r=parseInt(a.Z.getters.settings.delivery.timeDelta),o=parseInt(a.Z.getters.settings.delivery.speed),i=5*Math.round(t/o*60/5)+e,s=i>r?i-r:i,l=s+r;return{time:i,timeMin:s,timeMax:l}},render(t,e){for(let n in e)t=t.replace(`{{${n}}}`,e[n]);return t}};e["Z"]=r},8184:function(t,e,n){n.r(e),n.d(e,{default:function(){return D}});var a=n(6252),r=n(3577);const o=(0,a.Uk)("Дата"),i=(0,a.Uk)("Тип проводки"),s=(0,a.Uk)("Заказ #"),l=(0,a.Uk)("Продавец #"),d=(0,a.Uk)("Курьер #"),u=(0,a.Uk)("Сумма"),c=(0,a.Uk)("Комментарий"),_=(0,a.Uk)("Отключена"),m=(0,a.Uk)("Удалить"),p=(0,a.Uk)("Сохранить");function h(t,e,n,h,f,y){const w=(0,a.up)("ion-label"),k=(0,a.up)("ion-input"),g=(0,a.up)("ion-item"),$=(0,a.up)("ion-select-option"),v=(0,a.up)("ion-select"),I=(0,a.up)("ion-icon"),W=(0,a.up)("ion-button"),b=(0,a.up)("ion-textarea"),U=(0,a.up)("ion-toggle"),q=(0,a.up)("ion-note"),G=(0,a.up)("ion-list"),T=(0,a.up)("ion-col"),V=(0,a.up)("ion-row"),C=(0,a.up)("ion-grid"),Z=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(Z,{pageDefaultBackLink:"/user","page-title":"Редактирование проводки"},{default:(0,a.w5)((()=>[f.transaction?((0,a.wg)(),(0,a.j4)(G,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(w,{position:"floating"},{default:(0,a.w5)((()=>[o])),_:1}),(0,a.Wm)(k,{modelValue:f.transaction.trans_date,"onUpdate:modelValue":e[0]||(e[0]=t=>f.transaction.trans_date=t),placeholder:"дата",type:"date"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(g,{lines:"none"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,{position:"floating"},{default:(0,a.w5)((()=>[i])),_:1}),(0,a.Wm)(v,{interface:"popover",placeholder:"Выберите тип проводки",modelValue:f.transaction.trans_role,"onUpdate:modelValue":e[1]||(e[1]=t=>f.transaction.trans_role=t),required:"",onIonChange:e[2]||(e[2]=t=>y.itemUpdateRole())},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(f.transTypes,(t=>((0,a.wg)(),(0,a.j4)($,{key:t.trans_role,value:t.trans_role},{default:(0,a.w5)((()=>[(0,a.Uk)((0,r.zw)(t.trans_name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v,{slot:"start",modelValue:f.transaction.trans_holder,"onUpdate:modelValue":e[3]||(e[3]=t=>f.transaction.trans_holder=t),disabled:"",placeholder:"Тип объекта"},{default:(0,a.w5)((()=>[(0,a.Wm)($,{value:"order"},{default:(0,a.w5)((()=>[s])),_:1}),(0,a.Wm)($,{value:"store"},{default:(0,a.w5)((()=>[l])),_:1}),(0,a.Wm)($,{value:"courier"},{default:(0,a.w5)((()=>[d])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(w,{onClick:e[4]||(e[4]=t=>y.holderIdPick())},{default:(0,a.w5)((()=>[(0,a.Uk)((0,r.zw)(f.transaction.trans_holder_label),1)])),_:1}),(0,a.Wm)(W,{slot:"end",onClick:e[5]||(e[5]=t=>y.holderIdPick())},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{icon:h.searchOutline},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(w,{position:"floating"},{default:(0,a.w5)((()=>[u])),_:1}),(0,a.Wm)(k,{modelValue:f.transaction.trans_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>f.transaction.trans_amount=t),placeholder:"сумма",inputmode:"decimal",autocomplete:"transaction-amount",min:"1"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(w,{position:"floating"},{default:(0,a.w5)((()=>[c])),_:1}),(0,a.Wm)(b,{modelValue:f.transaction.trans_description,"onUpdate:modelValue":e[7]||(e[7]=t=>f.transaction.trans_description=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(g,{lines:"full"},{default:(0,a.w5)((()=>[(0,a.Wm)(w,null,{default:(0,a.w5)((()=>[_])),_:1}),(0,a.Wm)(U,{modelValue:f.transaction.is_disabled,"onUpdate:modelValue":e[8]||(e[8]=t=>f.transaction.is_disabled=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(g,{lines:"none"},{default:(0,a.w5)((()=>[f.transaction.created_at?((0,a.wg)(),(0,a.j4)(q,{key:0},{default:(0,a.w5)((()=>[(0,a.Uk)(" Создано "+(0,r.zw)(f.transaction.created_user_name)+" "+(0,r.zw)(f.transaction.created_at),1)])),_:1})):(0,a.kq)("",!0),f.transaction.created_at?((0,a.wg)(),(0,a.j4)(q,{key:1},{default:(0,a.w5)((()=>[(0,a.Uk)(" Изменено "+(0,r.zw)(f.transaction.updated_user_name)+" "+(0,r.zw)(f.transaction.updated_at),1)])),_:1})):(0,a.kq)("",!0)])),_:1})])),_:1})):(0,a.kq)("",!0),f.transaction?((0,a.wg)(),(0,a.j4)(C,{key:1},{default:(0,a.w5)((()=>[(0,a.Wm)(V,null,{default:(0,a.w5)((()=>[(0,a.Wm)(T,null,{default:(0,a.w5)((()=>[(0,a.Wm)(W,{color:"medium",onClick:e[9]||(e[9]=t=>y.itemDelete()),expand:"block"},{default:(0,a.w5)((()=>[m])),_:1})])),_:1}),(0,a.Wm)(T,null,{default:(0,a.w5)((()=>[(0,a.Wm)(W,{color:"primary",onClick:e[10]||(e[10]=t=>y.itemSave()),expand:"block"},{default:(0,a.w5)((()=>[p])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1})}var f=n(8534),y=(n(4916),n(5306),n(8862),n(2066)),w=n(8903),k=n(9755),g=n.n(k),$=n(351),v=n(4405);const I={class:"ion-page"},W=(0,a.Uk)(" Ничего не найдено ");function b(t,e,n,o,i,s){const l=(0,a.up)("ion-title"),d=(0,a.up)("ion-icon"),u=(0,a.up)("ion-toolbar"),c=(0,a.up)("ion-header"),_=(0,a.up)("ion-searchbar"),m=(0,a.up)("ion-skeleton-text"),p=(0,a.up)("ion-item"),h=(0,a.up)("ion-list"),f=(0,a.up)("ion-img"),y=(0,a.up)("ion-content");return(0,a.wg)(),(0,a.iD)("div",I,[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,{color:"secondary"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Выбрать "+(0,r.zw)(i.itemTypeName),1)])),_:1}),(0,a.Wm)(d,{icon:o.closeOutline,onClick:e[0]||(e[0]=t=>{s.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(y,null,{default:(0,a.w5)((()=>{var n;return[(0,a.Wm)(_,{modelValue:i.query,"onUpdate:modelValue":e[1]||(e[1]=t=>i.query=t),debounce:100,onIonChange:e[2]||(e[2]=t=>s.listGet())},null,8,["modelValue"]),i.itemList?null!==(n=i.itemList)&&void 0!==n&&n.length?((0,a.wg)(),(0,a.j4)(h,{key:1},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.itemList,(e=>((0,a.wg)(),(0,a.j4)(p,{key:e.id,button:"",detail:"",onClick:t=>s.itemPick(e)},{default:(0,a.w5)((()=>[e.image_hash?((0,a.wg)(),(0,a.j4)(f,{key:0,slot:"start",src:`${t.$heap.state.hostname}image/get.php/${e.image_hash}.50.50.webp`},null,8,["src"])):(0,a.kq)("",!0),(0,a.Uk)(" "+(0,r.zw)(e.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,a.wg)(),(0,a.j4)(h,{key:2},{default:(0,a.w5)((()=>[(0,a.Wm)(p,null,{default:(0,a.w5)((()=>[W])),_:1})])),_:1})):((0,a.wg)(),(0,a.j4)(h,{key:0},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)([0,1,2,3,4,5,6,7,8,9],(t=>(0,a.Wm)(p,{key:t,button:"",detail:""},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{style:{height:"35px",width:"40px"},animated:""}),(0,a.Wm)(m,{style:{width:"100%"},animated:""})])),_:2},1024))),64))])),_:1}))]})),_:1})])}var U={props:["itemType"],components:{IonContent:y.W2,IonHeader:y.Gu,IonToolbar:y.sr,IonTitle:y.wd,IonIcon:y.gu,IonImg:y.Xz,IonList:y.q_,IonItem:y.Ie,IonSearchbar:y.VI,IonSkeletonText:y.CK},setup(){return{closeOutline:w.fID}},data(){return{query:null,itemList:null,itemTypeName:""}},mounted(){this.listGet()},methods:{listGet(){var t=this;return(0,f.Z)((function*(){"order"==t.itemType?(t.itemTypeName="Заказ",t.ordersGet()):"store"==t.itemType?(t.itemTypeName="Продавец",t.storesGet()):"courier"==t.itemType?(t.itemTypeName="Курьер",t.couriersGet()):t.$flash("unknown item type "+t.itemType)}))()},storesGet(){var t=this;return(0,f.Z)((function*(){const e={name_query:t.query,name_query_fields:"store_name",limit:10};try{let n=yield g().post(`${t.$heap.state.hostname}Store/listGet`,e);t.itemList=n.map((t=>(t.name=`продавец ${t.store_name}`,t.id=t.store_id,t)))}catch(n){}}))()},couriersGet(){var t=this;return(0,f.Z)((function*(){const e={name_query:t.query,name_query_fields:"user_name,user_phone",limit:10};try{let n=yield g().post(`${t.$heap.state.hostname}Courier/listGet`,e);t.itemList=n.map((t=>(t.name=`курьер ${t.user_name} ${t.user_phone}`,t.id=t.courier_id,t.image_hash=t.courier_photo_image_hash,t)))}catch(n){}}))()},ordersGet(){var t=this;return(0,f.Z)((function*(){const e={name_query:t.query,name_query_fields:"store_name,order_id,user_name",limit:10};try{let n=yield g().post(`${t.$heap.state.hostname}Order/listGet`,e);t.itemList=n.map((t=>(t.name=`заказ#${t.order_id} ${t.store_name} > ${t.user_name}`,t.id=t.order_id,t)))}catch(n){}}))()},itemPick(t){y.Fy.dismiss(t)},closeModal(){y.Fy.dismiss()}}},q=n(3744);const G=(0,q.Z)(U,[["render",b]]);var T=G;const V=[{trans_role:"transit->supplier",trans_holder:"order",trans_name:"Продавец Возврат товара",trans_description:"Средства взимаемые с Продавца для воврата оплаты Покупателю. Заказ №{{trans_holder_id}}"},{trans_role:"supplier->transit",trans_holder:"order",trans_name:"Продавец Отгрузка заказа",trans_description:"Стоимость товара, отгруженного Покупателю. Заказ №{{trans_holder_id}}"},{trans_role:"capital.profit->supplier",trans_holder:"order",trans_name:"Продавец Комиссия сайта",trans_description:"Комиссия сайта за предоставленные услуги. Заказ №{{trans_holder_id}}"},{trans_role:"money.account->supplier",trans_holder:"store",trans_name:"Продавец Выплата",trans_description:"Оплата по договору за выполненые заказы"},{trans_role:"supplier->money.account",trans_holder:"store",trans_name:"Продавец Авансирование услуг",trans_description:"Аванс за услуги сайта"},{trans_role:"supplier->capital.profit",trans_holder:"store",trans_name:"Продавец Бонус на услуги при регистрации",trans_description:"Бонус на услуги при регистрации на сайте"},{trans_role:"money.account->courier",trans_holder:"courier",trans_name:"Курьер Выплата",trans_description:"Оплата по договору за оказанные услуги"},{trans_role:"courier->capital.profit",trans_holder:"order",trans_name:"Курьер Начисление бонуса",trans_description:"Начисление бонуса за Заказ №{{trans_holder_id}}"},{trans_role:"capital.profit->courier",trans_holder:"order",trans_name:"Курьер Штраф",trans_description:"Штраф за не выполнение Заказа №{{trans_holder_id}}"}];var C={components:{IonInput:y.pK,IonIcon:y.gu,IonList:y.q_,IonItem:y.Ie,IonToggle:y.ho,IonLabel:y.Q$,IonSelect:y.t9,IonSelectOption:y.n0,IonTextarea:y.g2,IonButton:y.YG,IonGrid:y.jY,IonRow:y.Nd,IonCol:y.wI,IonNote:y.uN},setup(){return{trashOutline:w.gtu,searchOutline:w.W6I}},data(){return{transactionId:this.$route.params.id,transaction:null,transTypes:V}},computed:{},created(){const t=this;this.$topic.on("userGet",(()=>{t.init()})),$.Z.isAdmin()&&this.init()},methods:{init(){$.Z.isAdmin()||this.$router.replace("/"),this.itemGet()},itemGet(){var t=this;return(0,f.Z)((function*(){if(0==t.transactionId)return void(t.transaction={});let e={trans_id:t.transactionId};try{t.transaction=yield g().post(`${t.$heap.state.hostname}Transaction/itemGet`,e),t.holderLabelGet()}catch(r){var n,a;const e=null===r||void 0===r||null===(n=r.responseJSON)||void 0===n||null===(a=n.messages)||void 0===a?void 0:a.error;switch(e){case"forbidden":t.$flash("Не достаточно прав");break;case"notfound":t.$flash("Проводка не найдена");break}return!1}}))()},holderLabelGet(){var t=this;return(0,f.Z)((function*(){try{if(t.transaction.trans_holder_label="","order"==t.transaction.trans_holder){const e={name_query:t.transaction.trans_holder_id,name_query_fields:"order_id"},n=yield g().post(`${t.$heap.state.hostname}Order/listGet`,e),a=n[0];t.transaction.trans_holder_label=`заказ#${a.order_id} ${a.store_name} > ${a.user_name}`}if("store"==t.transaction.trans_holder){const e={name_query:t.transaction.trans_holder_id,name_query_fields:"store_id"},n=yield g().post(`${t.$heap.state.hostname}Store/listGet`,e),a=n[0];t.transaction.trans_holder_label=`продавец ${a.store_name}`}if("courier"==t.transaction.trans_holder){const e={name_query:t.transaction.trans_holder_id,name_query_fields:"courier_id"},n=yield g().post(`${t.$heap.state.hostname}Courier/listGet`,e),a=n[0];t.transaction.trans_holder_label=`курьер ${a.user_name} ${a.user_phone}`}}catch(e){}}))()},holderIdPick(){var t=this;return(0,f.Z)((function*(){if(!t.transaction.trans_holder)return;const e=t.transaction.trans_holder,n=yield y.Fy.create({component:T,componentProps:{itemType:e},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});n.present(),t.$topic.on("dismissModal",(()=>{n.dismiss()}));const a=yield n.onDidDismiss();a.data&&(t.transaction.trans_holder_id=a.data.id,t.transaction.trans_holder_label=a.data.name,t.itemRender())}))()},validate(){return this.transaction.trans_date?this.transaction.trans_role?this.transaction.trans_holder_id>0?0!=this.transaction.trans_amount||(this.$flash("Сумма должна не равняться нулю"),!1):(this.$flash("Контрагент не выбран"),!1):(this.$flash("Тип проводки не выбран"),!1):(this.$flash("Дата не выбрана"),!1)},itemSave(){var t=this;return(0,f.Z)((function*(){if(!t.validate())return;const e={trans_id:t.transaction.trans_id,trans_date:t.transaction.trans_date,trans_holder:t.transaction.trans_holder,trans_holder_id:t.transaction.trans_holder_id,trans_amount:t.transaction.trans_amount,trans_role:t.transaction.trans_role,trans_description:t.transaction.trans_description,is_disabled:t.transaction.is_disabled};try{const n=e.trans_id?"itemUpdate":"itemCreate";yield g().post(`${t.$heap.state.hostname}Transaction/${n}`,JSON.stringify(e)),t.$flash("💾 сохранено"),t.$router.go(-1)}catch(r){var n,a;const e=null===r||void 0===r||null===(n=r.responseJSON)||void 0===n||null===(a=n.messages)||void 0===a?void 0:a.error;switch(e){case"forbidden":t.$flash("Не достаточно прав");break}return t.$flash("Не удалось сохранить проводку"),!1}}))()},itemUpdateRole(){var t=this;return(0,f.Z)((function*(){t.transaction.trans_holder_id="",t.transaction.trans_holder_label="Выберите агента",t.itemRender()}))()},itemRender(){const t=this.transTypes.find((t=>t.trans_role==this.transaction.trans_role));t?(this.transaction.trans_tags="",this.transaction.trans_holder=t.trans_holder,this.transaction.trans_description=v.Z.render(t.trans_description,this.transaction)):this.$flash("Неверный тип проводки")},itemDelete(){var t=this;return(0,f.Z)((function*(){if(confirm("Вы уверенны?"))try{yield g().post(`${t.$heap.state.hostname}Transaction/itemDelete`,{trans_id:t.transactionId}),t.$router.go(-1)}catch(e){}}))()}}};const Z=(0,q.Z)(C,[["render",h]]);var D=Z}}]);
//# sourceMappingURL=8184-legacy.a1d4ea2f.js.map