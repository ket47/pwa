{"version":3,"file":"js/103.1cbeb2cb.js","mappings":"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","sources":["webpack://tezkel/./src/views/UserAddresses.vue","webpack://tezkel/./src/views/UserAddresses.vue?cfef"],"sourcesContent":["<template>\n  <base-layout page-title=\"Мои адреса\" pageDefaultBackLink=\"/user\" ref=\"UserAddressPage\">\n        <ion-list v-if=\"locationList.length\" lines=\"full\">\n          <ion-item v-for=\"(location,i) in locationList\" :key=\"location.location_id\">\n              <ion-img slot=\"start\" alt=\"location icon\" :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\n              <ion-label @click=\"locationSetMain(`${location.location_id}`,`${i}`)\" style=\"white-space:normal;cursor:pointer;\">{{ location.location_address }}</ion-label>\n              <ion-icon slot=\"end\" :icon=\"trash\" @click=\"locationDelete(`${location.location_id}`,`${i}`)\"></ion-icon>\n          </ion-item>\n        </ion-list>\n        <ion-card v-else color=\"warning\">\n          <ion-card-content>\n          Пока адреса не добавлены\n          </ion-card-content>\n        </ion-card>\n\n        <ion-list>\n          <ion-list-header>\n            <ion-label>Добавить адрес</ion-label>\n          </ion-list-header>\n          <ion-item  v-for=\"location in locationGroupList\" :key=\"location.group_id\" @click=\"modalLocationCreate(`${location.group_id}`,`${location.group_name}`)\" style=\"cursor:pointer\">\n              <ion-img :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\n              <ion-label style=\"margin-left:5px;padding-left:5px;border-left:solid 1px black;white-space:normal\">{{ location.group_name }}</ion-label>\n          </ion-item>\n        </ion-list>\n  </base-layout>\n</template>\n\n\n<script>\nimport {\n  IonImg,\n  IonLabel,\n  IonItem,\n  IonList,\n  IonListHeader,\n  IonIcon,\n  modalController,\n  IonCard,\n  IonCardContent,\n}                         from \"@ionic/vue\";\nimport router             from '@/router';\nimport heap               from '@/heap';\nimport User              from '@/scripts/User.js'\nimport jQuery             from 'jquery';\nimport UserAddressPicker  from '@/components/UserAddressPicker.vue';\n\nimport { trash }          from 'ionicons/icons';\n\nexport default{\n  name: 'UserAddresses',\n  components: {\n  IonImg,\n  IonLabel,\n  IonItem,\n  IonList,\n  IonListHeader,\n  IonIcon,\n  IonCard,\n  IonCardContent,\n  },\n  setup(){\n    return { trash };\n  },\n  mounted(){\n    this.locationListGet();\n  },\n  methods:{\n    async modalLocationCreate( location_group_id, location_group_name ) {\n      if(!heap.state.user.user_id){\n        this.$flash('Чтобы добавленные адреса сохранились, пожалуйста войдите в систему');\n        router.push({name: 'UserSignIn'});\n        return;\n      }\n      var location_group_name_low=String(location_group_name).toLowerCase();\n      const modal = await modalController.create({\n        component: UserAddressPicker,\n        showBackdrop:true,\n        backdropDismiss:true,\n        swipeToClose: true,\n        cssClass: 'update-profile-modal',\n        presentingElement: this.$refs.UserAddressPage.$el,\n        componentProps:{\n          location_group_name_low\n        },\n      });\n      modal.onDidDismiss().then(location => {\n        this.locationCreate(location_group_id,location.data);\n      });\n      return modal.present();\n    },\n    async locationListGet(){\n      try{\n        let new_location_main=null\n        const response=await jQuery.get(heap.state.hostname + \"User/locationListGet\",{includeGroupList:1})\n        this.locationList=response.location_list;\n        this.locationGroupList=response.location_group_list;\n        if(this.locationList){\n          for(let loc of this.locationList){\n            if(loc.is_main!=1)continue;\n              new_location_main=loc;\n          }\n        }\n        if( !new_location_main ){\n          /**\n           * for some reason main location is not present so reload user data\n           */\n          User.get()\n          return\n        }\n        if(new_location_main && new_location_main?.location_id!=heap.state.user.location_main?.location_id){\n          heap.state.user.location_main=new_location_main\n          this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\n        }\n      }catch{/** */}\n    },\n    async locationCreate(group_id,location){\n      if( !location ){\n        return;\n      }\n      let request={\n        location_holder:'user',\n        location_holder_id:heap.state.user.user_id,\n        location_group_id:group_id,\n        location_address:location.location_address,\n        location_latitude:location.location_latitude,\n        location_longitude:location.location_longitude\n      };\n      try{\n        await jQuery.post(heap.state.hostname + \"User/locationCreate\",request)\n        this.locationListGet();\n      } catch(err){\n        const exception=err.responseJSON;\n        const exception_code=exception.messages.error;\n        switch(exception_code){\n            case 'limit_exeeded':\n                this.$flash(\"Больше адресов добавить нельзя\");\n                break;\n        }\n        return false\n      }\n    },\n    async locationSetMain( location_id, index ){\n      var self=this;\n      var loc=self.locationList[index];\n      heap.state.user.location_main={\n        location_id:loc.location_id,\n        location_latitude:loc.location_latitude,\n        location_altitude:loc.location_altitude,\n        location_address:loc.location_address,\n        image_hash:loc.image_hash\n      };\n      router.go(-1);\n      await jQuery.post(heap.state.hostname + \"User/locationSetMain\",{location_id});\n      this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\n    },\n    async locationDelete( location_id, index ){\n      try{\n        this.locationList.splice(index,1);\n        await jQuery.post(heap.state.hostname + \"User/locationDelete\",{location_id})\n      }catch{/** */}\n      this.locationListGet();\n    }\n  },\n  data(){\n    return{\n      locationList:[],\n      locationGroupList:[]\n    }\n  }\n}\n</script>","import { render } from \"./UserAddresses.vue?vue&type=template&id=14c21426\"\nimport script from \"./UserAddresses.vue?vue&type=script&lang=js\"\nexport * from \"./UserAddresses.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"W:\\\\Ionic\\\\Tezkel\\\\blank\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","pageDefaultBackLink","ref","$data","length","_component_ion_list","lines","_createElementBlock","_Fragment","_renderList","location","i","_component_ion_item","key","location_id","_createVNode","_component_ion_img","slot","alt","src","_ctx","state","hostname","image_hash","_component_ion_label","onClick","$options","style","location_address","_component_ion_icon","icon","$setup","_component_ion_card","color","_component_ion_card_content","_component_ion_list_header","group_id","group_name","name","components","IonImg","IonLabel","IonItem","IonList","IonListHeader","IonIcon","IonCard","IonCardContent","setup","trash","mounted","this","locationListGet","methods","async","location_group_id","location_group_name","heap","$flash","router","location_group_name_low","String","toLowerCase","modal","modalController","component","UserAddressPicker","showBackdrop","backdropDismiss","swipeToClose","cssClass","presentingElement","$refs","UserAddressPage","$el","componentProps","onDidDismiss","then","locationCreate","data","present","new_location_main","response","jQuery","includeGroupList","locationList","location_list","locationGroupList","location_group_list","loc","is_main","User","$topic","publish","request","location_holder","location_holder_id","location_latitude","location_longitude","err","exception","responseJSON","exception_code","messages","error","index","self","location_altitude","splice","__exports__","render"],"sourceRoot":""}