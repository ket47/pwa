{"version":3,"file":"js/7453-legacy.403a863c.js","mappings":"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","sources":["webpack://tezkel/./src/views/UserAddresses.vue","webpack://tezkel/./src/views/UserAddresses.vue?cfef"],"sourcesContent":["<template>\r\n  <base-layout page-title=\"Мои адреса\" pageDefaultBackLink=\"/user\" ref=\"UserAddressPage\">\r\n        <ion-list v-if=\"locationList.length\" lines=\"full\">\r\n          <ion-item v-for=\"(location,i) in locationList\" :key=\"location.location_id\">\r\n              <ion-img slot=\"start\" alt=\"location icon\" :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\r\n              <ion-label @click=\"locationSetMain(`${location.location_id}`,`${i}`)\" style=\"white-space:normal;cursor:pointer;\">{{ location.location_address }}</ion-label>\r\n              <ion-icon slot=\"end\" :icon=\"trash\" @click=\"locationDelete(`${location.location_id}`,`${i}`)\"></ion-icon>\r\n          </ion-item>\r\n        </ion-list>\r\n        <ion-card v-else color=\"warning\">\r\n          <ion-card-content>\r\n          Пока адреса не добавлены\r\n          </ion-card-content>\r\n        </ion-card>\r\n\r\n        <ion-list>\r\n          <ion-list-header>\r\n            <ion-label>Добавить адрес</ion-label>\r\n          </ion-list-header>\r\n          <ion-item  v-for=\"location in locationGroupList\" :key=\"location.group_id\" @click=\"modalLocationCreate(`${location.group_id}`,`${location.group_name}`)\" style=\"cursor:pointer\">\r\n              <ion-img :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\r\n              <ion-label style=\"margin-left:5px;padding-left:5px;border-left:solid 1px black;white-space:normal\">{{ location.group_name }}</ion-label>\r\n          </ion-item>\r\n        </ion-list>\r\n  </base-layout>\r\n</template>\r\n\r\n\r\n<script>\r\nimport {\r\n  IonImg,\r\n  IonLabel,\r\n  IonItem,\r\n  IonList,\r\n  IonListHeader,\r\n  IonIcon,\r\n  modalController,\r\n  IonCard,\r\n  IonCardContent,\r\n}                         from \"@ionic/vue\";\r\nimport router             from '@/router';\r\nimport heap               from '@/heap';\r\nimport User              from '@/scripts/User.js'\r\nimport jQuery             from 'jquery';\r\nimport UserAddressPicker  from '@/components/UserAddressPicker.vue';\r\n\r\nimport { trash }          from 'ionicons/icons';\r\n\r\nexport default{\r\n  name: 'UserAddresses',\r\n  components: {\r\n  IonImg,\r\n  IonLabel,\r\n  IonItem,\r\n  IonList,\r\n  IonListHeader,\r\n  IonIcon,\r\n  IonCard,\r\n  IonCardContent,\r\n  },\r\n  setup(){\r\n    return { trash };\r\n  },\r\n  mounted(){\r\n    this.locationListGet();\r\n  },\r\n  methods:{\r\n    async modalLocationCreate( location_group_id, location_group_name ) {\r\n      if(!heap.state.user.user_id){\r\n        this.$flash('Чтобы добавленные адреса сохранились, пожалуйста войдите в систему');\r\n        router.push('/user/sign-in');\r\n        return;\r\n      }\r\n      var location_group_name_low=String(location_group_name).toLowerCase();\r\n      const modal = await modalController.create({\r\n        component: UserAddressPicker,\r\n        showBackdrop:true,\r\n        backdropDismiss:true,\r\n        swipeToClose: true,\r\n        cssClass: 'update-profile-modal',\r\n        presentingElement: this.$refs.UserAddressPage.$el,\r\n        componentProps:{\r\n          location_group_name_low\r\n        },\r\n      });\r\n      modal.onDidDismiss().then(location => {\r\n        this.locationCreate(location_group_id,location.data);\r\n      });\r\n      return modal.present();\r\n    },\r\n    async locationListGet(){\r\n      try{\r\n        let new_location_main=null\r\n        const response=await jQuery.get(heap.state.hostname + \"User/locationListGet\",{includeGroupList:1})\r\n        this.locationList=response.location_list;\r\n        this.locationGroupList=response.location_group_list;\r\n        if(this.locationList){\r\n          for(let loc of this.locationList){\r\n            if(loc.is_main!=1)continue;\r\n              new_location_main=loc;\r\n          }\r\n        }\r\n        if( !new_location_main ){\r\n          /**\r\n           * for some reason main location is not present so reload user data\r\n           */\r\n          User.get()\r\n          return\r\n        }\r\n        if(new_location_main && new_location_main?.location_id!=heap.state.user.location_main?.location_id){\r\n          heap.state.user.location_main=new_location_main\r\n          this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\r\n        }\r\n      }catch{/** */}\r\n    },\r\n    async locationCreate(group_id,location){\r\n      if( !location ){\r\n        return;\r\n      }\r\n      let request={\r\n        location_holder:'user',\r\n        location_holder_id:heap.state.user.user_id,\r\n        location_group_id:group_id,\r\n        location_address:location.location_address,\r\n        location_latitude:location.location_latitude,\r\n        location_longitude:location.location_longitude\r\n      };\r\n      try{\r\n        await jQuery.post(heap.state.hostname + \"User/locationCreate\",request)\r\n        if(this.$heap.state.next_route){\r\n          this.$router.push(this.$heap.state.next_route)\r\n          this.$heap.state.next_route=null\r\n        }\r\n        this.locationListGet();\r\n      } catch(err){\r\n        const exception=err.responseJSON;\r\n        const exception_code=exception.messages.error;\r\n        switch(exception_code){\r\n            case 'limit_exeeded':\r\n                this.$flash(\"Больше адресов добавить нельзя\");\r\n                break;\r\n        }\r\n        return false\r\n      }\r\n    },\r\n    async locationSetMain( location_id, index ){\r\n      var self=this;\r\n      var loc=self.locationList[index];\r\n      heap.state.user.location_main={\r\n        location_id:loc.location_id,\r\n        location_latitude:loc.location_latitude,\r\n        location_altitude:loc.location_altitude,\r\n        location_address:loc.location_address,\r\n        image_hash:loc.image_hash\r\n      };\r\n      router.go(-1);\r\n      await jQuery.post(heap.state.hostname + \"User/locationSetMain\",{location_id});\r\n      this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\r\n    },\r\n    async locationDelete( location_id, index ){\r\n      try{\r\n        this.locationList.splice(index,1);\r\n        await jQuery.post(heap.state.hostname + \"User/locationDelete\",{location_id})\r\n      }catch{/** */}\r\n      this.locationListGet();\r\n    }\r\n  },\r\n  data(){\r\n    return{\r\n      locationList:[],\r\n      locationGroupList:[]\r\n    }\r\n  }\r\n}\r\n</script>","import { render } from \"./UserAddresses.vue?vue&type=template&id=d2df3c86\"\nimport script from \"./UserAddresses.vue?vue&type=script&lang=js\"\nexport * from \"./UserAddresses.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"W:\\\\Ionic\\\\Tezkel\\\\blank\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","pageDefaultBackLink","ref","$data","length","_component_ion_list","lines","_createElementBlock","_Fragment","location","i","_component_ion_item","key","location_id","_createVNode","_component_ion_img","slot","alt","src","_ctx","state","hostname","image_hash","_component_ion_label","onClick","$options","style","location_address","_component_ion_icon","icon","$setup","_component_ion_card","color","_component_ion_card_content","_component_ion_list_header","group_id","group_name","name","components","IonImg","IonLabel","IonItem","IonList","IonListHeader","IonIcon","IonCard","IonCardContent","setup","trash","mounted","this","locationListGet","methods","modalLocationCreate","location_group_id","location_group_name","heap","$flash","router","location_group_name_low","String","toLowerCase","modalController","component","UserAddressPicker","showBackdrop","backdropDismiss","swipeToClose","cssClass","presentingElement","$refs","UserAddressPage","$el","componentProps","modal","onDidDismiss","then","locationCreate","data","present","new_location_main","jQuery","includeGroupList","response","locationList","location_list","locationGroupList","location_group_list","loc","is_main","User","$topic","publish","request","location_holder","location_holder_id","location_latitude","location_longitude","$heap","next_route","$router","push","exception","responseJSON","exception_code","messages","error","locationSetMain","index","self","location_altitude","locationDelete","splice","__exports__","render"],"sourceRoot":""}