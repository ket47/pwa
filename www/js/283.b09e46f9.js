"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[283],{9283:function(e,t,i){i.r(t),i.d(t,{default:function(){return p}});var a=i(6252),o=i(3577);function s(e,t,i,s,n,l){const r=(0,a.up)("ion-segment-button"),d=(0,a.up)("ion-segment"),m=(0,a.up)("ion-searchbar"),u=(0,a.up)("ion-img"),c=(0,a.up)("ion-thumbnail"),p=(0,a.up)("ion-text"),h=(0,a.up)("ion-label"),_=(0,a.up)("ion-item"),g=(0,a.up)("ion-list"),w=(0,a.up)("ion-skeleton-text"),f=(0,a.up)("ion-card-content"),y=(0,a.up)("ion-card"),b=(0,a.up)("ion-infinite-scroll-content"),k=(0,a.up)("ion-infinite-scroll"),I=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(I,{pageDefaultBackLink:"/user","page-title":"Модерация"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{scrollable:!0,modelValue:n.moderationType,"onUpdate:modelValue":t[0]||(t[0]=e=>n.moderationType=e),onIonChange:t[1]||(t[1]=e=>l.listTypeChanged(e))},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{value:"images"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Картинки ")])),_:1}),(0,a.Wm)(r,{value:"products"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Товары ")])),_:1}),(0,a.Wm)(r,{value:"stores"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Магазины ")])),_:1}),(0,a.Wm)(r,{value:"couriers"},{default:(0,a.w5)((()=>[(0,a.Uk)(" Курьеры ")])),_:1})])),_:1},8,["modelValue"]),(0,a._)("div",null,["stores"==n.moderationType||"products"==n.moderationType||"couriers"==n.moderationType?((0,a.wg)(),(0,a.j4)(m,{key:0,placeholder:"Фильтр",modelValue:n.filter,"onUpdate:modelValue":t[2]||(t[2]=e=>n.filter=e)},null,8,["modelValue"])):(0,a.kq)("",!0),l.listComputed.length>0?((0,a.wg)(),(0,a.j4)(g,{key:1},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.listComputed,(t=>((0,a.wg)(),(0,a.j4)(_,{key:t.item_id,button:"",detail:"",onClick:e=>l.itemEdit(t)},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{slot:"start",class:(0,o.C_)(t.class)},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.50.50.webp`},null,8,["src"])])),_:2},1032,["class"]),(0,a.Wm)(p,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.item_name),1)])),_:2},1024),(0,a.Wm)(h,{slot:"end"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.date_time),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):1==n.is_loading?((0,a.wg)(),(0,a.j4)(g,{key:2},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)([1,2,3],(e=>(0,a.Wm)(_,{key:e,button:"",detail:""},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{slot:"start",style:{"background-color":"lightgray"}}),(0,a.Wm)(w,{animated:""})])),_:2},1024))),64))])),_:1})):((0,a.wg)(),(0,a.j4)(y,{key:3,color:"light"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Uk)(" Ничего не найдено ")])),_:1})])),_:1})),(0,a.Wm)(k,{onIonInfinite:t[3]||(t[3]=e=>l.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{"loading-spinner":"bubbles","loading-text":"Loading more data..."})])),_:1})])])),_:1})}i(3948);var n=i(2824),l=i(9755),r=i.n(l),d=i(1590),m={components:{IonInfiniteScroll:n.ju,IonInfiniteScrollContent:n.MB,IonItem:n.Ie,IonLabel:n.Q$,IonList:n.q_,IonSegmentButton:n.GO,IonSegment:n.cJ,IonImg:n.Xz,IonThumbnail:n.Bs,IonText:n.yW,IonSkeletonText:n.CK,IonCard:n.PM,IonCardContent:n.FN,IonSearchbar:n.VI},data(){return{items:[],filter:"",is_loading:0,moderationType:"images",holders:{store:"Поставщик",courier:"Курьер",product:"Товар",order:"Заказ",product_group_list:"Категория товара",location_group_list:"Категория местоп.",store_group_list:"Категория поставщ.",user_group_list:"Категория пользователя"}}},computed:{listComputed(){for(let t of this.items){var e;t.image_hash=t.image_hash||t.courier_photo_image_hash,t.item_id=t.image_id||t.store_id||t.courier_id||t.product_id,t.item_name=this.holders[t.image_holder]||(null!==(e=t.store_name)&&void 0!==e?e:t.store_name_new)||t.user_name||t.product_name,t.date_time=this.toLocDateTime(t.updated_at),t.class=t.deleted_at?"deleted":""}return this.items}},methods:{async listLoadMore(e){await this.listLoad(),e.target.complete()},async listReload(){this.items=[],this.listLoad()},async listLoad(){let e={is_disabled:1,is_active:0,name_query:this.filter,offset:this.items.length,limit:15,order:"updated_at"};try{let t;if(this.is_loading=1,"images"==this.moderationType)t=await r().post(`${this.$heap.state.hostname}Image/listGet`,e);else if("products"==this.moderationType){e.name_query_fields="product_name,product_description,product_barcode,product_code",e.reverse="validity";const i=await r().post(`${this.$heap.state.hostname}Product/listGet`,e);t=i.product_list}else"stores"==this.moderationType?(e.name_query_fields="store_name,store_description",e.reverse="validity",t=await r().post(`${this.$heap.state.hostname}Store/listGet`,e)):"couriers"==this.moderationType&&(e.name_query_fields="courier_vehicle,user_phone,user_name",e.order="courier_list.updated_at",t=await r().post(`${this.$heap.state.hostname}Courier/listGet`,e));this.is_loading=0,this.items=this.items.concat(t)}catch(t){}},listTypeChanged(e){e.target.value;this.items=[],this.listLoad()},listFilter(){clearTimeout(this.clock);const e=this;this.clock=setTimeout((()=>{e.listReload()}),300)},toLocDate(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,i)},toLocDateTime(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,i)},itemEdit(e){"images"==this.moderationType&&this.imageEdit(e),"products"==this.moderationType&&this.$go("/catalog/product-edit-"+e.product_id),"stores"==this.moderationType&&this.$go("/catalog/store-edit-"+e.store_id),"couriers"==this.moderationType&&this.$go("/user/courier-dashboard?courier_id="+e.courier_id)},async imageEdit(e){const t={delete:["Удалить","danger"],postpone:["Потом","primary"],enable:["Ок","success"]},i=await n.Fy.create({component:d.Z,componentProps:{image_hash:e.image_hash,actions:t},initialBreakpoint:.75,breakpoints:[.75,1]});this.$topic.on("dismissModal",(()=>{i.dismiss()})),i.present();const a=await i.onDidDismiss();"delete"==a.role&&await this.imageDelete(e),"enable"==a.role&&await this.imageEnable(e),"postpone"==a.role&&await this.imagePostpone(e),this.listReload()},async imageEnable(e){await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0})},async imagePostpone(e){await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0}),await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:1})},async imageDelete(e){await r().post(`${this.$heap.state.hostname}Image/itemDelete`,{image_id:e.image_id})}},mounted(){this.listLoad()},watch:{filter:function(){this.listFilter()}}},u=i(3744);const c=(0,u.Z)(m,[["render",s],["__scopeId","data-v-b3535316"]]);var p=c}}]);
//# sourceMappingURL=283.b09e46f9.js.map