"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[1132],{9158:function(e,l,t){t.d(l,{A:function(){return m}});t(4114);var s=t(641);const n={validate:""},a=(0,s.Lk)("div",{style:{padding:"15px","font-size":"0.8em",color:"#999"}}," Рекомендуем сначала проверить СМС сообщение с паролем, которое было выслано вам при регистрации в сервисе. ",-1),o=(0,s.Lk)("u",{style:{color:"blue"}},"службу поддержки",-1);function r(e,l,t,r,u,i){const d=(0,s.g2)("ion-title"),p=(0,s.g2)("ion-icon"),h=(0,s.g2)("ion-toolbar"),c=(0,s.g2)("ion-header"),_=(0,s.g2)("ion-input"),m=(0,s.g2)("ion-item"),f=(0,s.g2)("ion-list"),b=(0,s.g2)("ion-button"),k=(0,s.g2)("ion-content");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(c,null,{default:(0,s.k6)((()=>[(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.bF)(d,null,{default:(0,s.k6)((()=>[(0,s.eW)("Восстановление пароля")])),_:1}),(0,s.bF)(p,{slot:"end",onClick:l[0]||(l[0]=e=>{i.closeModal()}),icon:r.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,s.bF)(k,null,{default:(0,s.k6)((()=>[(0,s.Lk)("form",n,[(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.bF)(m,null,{default:(0,s.k6)((()=>[(0,s.bF)(_,{label:"Ваш номер телефона","label-placement":"stacked",modelValue:u.userphone,"onUpdate:modelValue":l[1]||(l[1]=e=>u.userphone=e),placeholder:"Ваш телефон",required:""},null,8,["modelValue"])])),_:1}),(0,s.bF)(m,null,{default:(0,s.k6)((()=>[(0,s.bF)(_,{label:"Ваш ник","label-placement":"stacked",modelValue:u.username,"onUpdate:modelValue":l[2]||(l[2]=e=>u.username=e),placeholder:"Имя, указанное вами при регистрации"},null,8,["modelValue"])])),_:1})])),_:1}),(0,s.bF)(b,{onClick:l[3]||(l[3]=e=>i.passwordReset()),expand:"block"},{default:(0,s.k6)((()=>[(0,s.eW)("Создать новый пароль")])),_:1})]),a,(0,s.Lk)("div",{style:{padding:"15px","font-size":"0.8em"},onClick:l[4]||(l[4]=l=>e.$router.push("/page/contacts"))},[(0,s.eW)(" Если у вас возникли сложности с восстановлением пароля, обращайтесь в "),o])])),_:1})],64)}var u=t(972),i=t(5480),d=t(2311),p=t.n(d),h={components:{IonContent:u.W9,IonHeader:u.eU,IonTitle:u.BC,IonToolbar:u.ai,IonList:u.nf,IonItem:u.uz,IonInput:u.$w,IonButton:u.Jm,IonIcon:u.iq},props:["phone"],setup(){return{closeOutline:i.xfX}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return u.OZ.dismiss()},async passwordReset(){if(this.userphone.replace(/\D/g,"").length<11)return void alert("Проверьте ваш номер телефона");if(!this.username)return void alert("Введите ваше имя при регистрации");let e={user_phone:"+"+this.userphone.replace(/\D/g,""),user_name:this.username};try{await p().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$flash(`Ваш новый пароль выслан на номер '${this.userphone}'`),this.closeModal()}catch(s){var l,t;const e=null===s||void 0===s||null===(l=s.responseJSON)||void 0===l||null===(t=l.messages)||void 0===t?void 0:t.error;"user_notfound"==e?this.$flash(`Пользователь с телефоном '${this.userphone}' и именем '${this.username}' не найден`):this.$flash("Не удалось восстановить пароль")}}},mouted(){this.$topic.on("dismissModal",(()=>{this.closeModal()}))}},c=t(6262);const _=(0,c.A)(h,[["render",r]]);var m=_},1132:function(e,l,t){t.r(l),t.d(l,{default:function(){return v}});var s=t(641),n=t(33),a=t(3751);const o={novalidate:""},r={style:{display:"grid","grid-template-columns":"100px auto"}},u={"padding-left":""},i={"padding-left":""},d={"padding-left":""},p={"padding-left":""};function h(e,l,t,h,c,_){const m=(0,s.g2)("ion-card-title"),f=(0,s.g2)("ion-card-header"),b=(0,s.g2)("ion-card-content"),k=(0,s.g2)("ion-card"),g=(0,s.g2)("ion-icon"),v=(0,s.g2)("ion-input"),F=(0,s.g2)("ion-text"),y=(0,s.g2)("ion-item"),x=(0,s.g2)("ion-list"),V=(0,s.g2)("ion-button"),I=(0,s.g2)("ion-col"),$=(0,s.g2)("ion-row"),w=(0,s.g2)("ion-grid"),O=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(O,{"page-title":"Регистрация нового пользователя",pageDefaultBackLink:"/user"},{default:(0,s.k6)((()=>[e.$heap.state.user.user_id>0?((0,s.uX)(),(0,s.Wv)(k,{key:0,style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,s.k6)((()=>[(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.bF)(m,{color:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)((0,n.v_)(e.$heap.state.user.user_name)+" "+(0,n.v_)(e.$heap.state.user.user_surname)+" "+(0,n.v_)(e.$heap.state.user.user_middlename),1)])),_:1})])),_:1}),(0,s.bF)(b,null,{default:(0,s.k6)((()=>[(0,s.eW)(" Вы уже вошли в систему с номером телефона "),(0,s.Lk)("b",null,(0,n.v_)(e.$heap.state.user.user_phone),1)])),_:1})])),_:1})):((0,s.uX)(),(0,s.Wv)(k,{key:1,color:"light"},{default:(0,s.k6)((()=>[(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.bF)(m,{color:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)(" Простая регистрация ")])),_:1})])),_:1}),(0,s.bF)(b,null,{default:(0,s.k6)((()=>[(0,s.eW)(" Для регистрации необходим только ваш номер мобильного телефона и имя, чтобы мы знали как к вам обращаться. ")])),_:1})])),_:1})),(0,s.Lk)("form",o,[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"start",src:h.phonePortraitOutline},null,8,["src"]),(0,s.Lk)("div",r,[(0,s.Lk)("div",null,[(0,s.bF)(v,{readonly:"",label:"Код","label-placement":"stacked",value:"+7"})]),(0,s.Lk)("div",null,[(0,s.bF)(v,{modelValue:c.user_phone,"onUpdate:modelValue":l[0]||(l[0]=e=>c.user_phone=e),onIonChange:l[1]||(l[1]=e=>_.phoneFormat()),name:"phone",type:"tel",inputmode:"tel",placeholder:"(xxx)xxxxxxxxx",required:"",autocomplete:"tel-national",label:"Мобильный телефон*","label-placement":"floating"},null,8,["modelValue"]),(0,s.bF)(F,{color:"danger",slot:"helperText"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.Lk)("p",u,"Проверьте номер телефона",512),[[a.aG,!_.phoneValid&&1==c.submitted]])])),_:1})])])])),_:1}),(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"start",src:h.keyOutline},null,8,["src"]),(0,s.bF)(v,{modelValue:c.user_pass,"onUpdate:modelValue":l[2]||(l[2]=e=>c.user_pass=e),name:"password",type:"password",autocorrect:"off",placeholder:"пароль (минимум 4 символа)",required:"",autocomplete:"new-password",label:"Пароль (минимум 4 символа)*","label-placement":"floating"},null,8,["modelValue"]),(0,s.bF)(F,{color:"danger",slot:"helperText"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.Lk)("p",i,"Пароль должен содержать не менее 4 символов.",512),[[a.aG,!_.passwordValid&&1==c.submitted]])])),_:1})])),_:1}),(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"start",src:h.keyOutline},null,8,["src"]),(0,s.bF)(v,{modelValue:c.user_pass_confirm,"onUpdate:modelValue":l[3]||(l[3]=e=>c.user_pass_confirm=e),type:"password",autocorrect:"off",placeholder:"пароль повтор",required:"",label:"Пароль повтор*","label-placement":"floating"},null,8,["modelValue"]),(0,s.bF)(F,{color:"danger",slot:"helperText"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.Lk)("p",d,"Пароль не совпадает с подтверждением",512),[[a.aG,c.user_pass!=c.user_pass_confirm&&1==c.submitted]])])),_:1})])),_:1}),(0,s.bF)(y,{lines:"none"}),(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"start",src:h.personOutline},null,8,["src"]),(0,s.bF)(v,{modelValue:c.user_name,"onUpdate:modelValue":l[4]||(l[4]=e=>c.user_name=e),name:"username",type:"text",placeholder:"как к вам обращаться?",required:"",autocomplete:"name",label:"Ваше имя*","label-placement":"floating"},null,8,["modelValue"]),(0,s.bF)(F,{color:"danger",slot:"helperText"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.Lk)("p",p,"Проверьте ваш псевдоним",512),[[a.aG,!_.usernameValid&&1==c.submitted]])])),_:1})])),_:1}),(0,s.bF)(y,null,{default:(0,s.k6)((()=>[(0,s.bF)(g,{slot:"start",src:h.atOutline},null,8,["src"]),(0,s.bF)(v,{modelValue:c.user_email,"onUpdate:modelValue":l[5]||(l[5]=e=>c.user_email=e),name:"email",type:"email",placeholder:"е-маил",required:"",autocomplete:"email",label:"Ваш е-маил (желательно заполнить)","label-placement":"floating"},null,8,["modelValue"])])),_:1})])),_:1}),(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)($,{"responsive-sm":""},{default:(0,s.k6)((()=>[(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(V,{onClick:_.onSubmit,expand:"block"},{default:(0,s.k6)((()=>[(0,s.eW)("Зарегистрироваться")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,s.bF)($,{"responsive-sm":""},{default:(0,s.k6)((()=>[(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(V,{color:"light",expand:"block",onClick:l[6]||(l[6]=l=>e.$router.replace("/user/sign-in"))},{default:(0,s.k6)((()=>[(0,s.eW)("Уже есть учетная запись?")])),_:1})])),_:1})])),_:1})])),_:1})])])),_:1})}var c=t(972),_=t(5480),m=t(8701),f=t(9158),b={components:{IonInput:c.$w,IonText:c.IO,IonButton:c.Jm,IonCard:c.b_,IonCardHeader:c.ME,IonCardTitle:c.tN,IonCardContent:c.I9,IonCol:c.hU,IonRow:c.ln,IonGrid:c.lO,IonList:c.nf,IonItem:c.uz,IonIcon:c.iq},setup(){return{phonePortraitOutline:_.g_S,personOutline:_.wAZ,keyOutline:_.uNo,atOutline:_.WFd}},data(){return{submitted:!1,user_pass:null,user_pass_confirm:null,user_phone:null,user_phone_prefix:"7",user_name:null,user_email:null}},computed:{phoneValid(){var e;return 10==(null===(e=this.user_phone)||void 0===e?void 0:e.replace(/\D/g,"").length)},passwordValid(){var e;return(null===(e=this.user_pass)||void 0===e?void 0:e.length)>=4},usernameValid(){var e;return(null===(e=this.user_name)||void 0===e?void 0:e.length)>0}},methods:{async onSubmit(){var e;if(this.submitted=!0,!this.phoneValid||!this.passwordValid||!this.usernameValid||this.user_pass!=this.user_pass_confirm)return;let l={user_phone:this.user_phone_prefix+this.user_phone,user_pass:this.user_pass,user_pass_confirm:this.user_pass,user_name:this.user_name.trim(),user_email:this.user_email,inviter_user_id:null!==(e=localStorage.inviter_user_id)&&void 0!==e?e:0};try{await m.A.signUp(l),this.phoneVerify()}catch(n){var t,s;let e=null===n||void 0===n||null===(t=n.responseJSON)||void 0===t||null===(s=t.messages)||void 0===s?void 0:s.error;if("user_phone_unverified"==e)return void this.phoneVerify();e="unknown";try{const l=Object.keys(JSON.parse(n.responseJSON.messages.error))[0],t=Object.values(JSON.parse(n.responseJSON.messages.error))[0];e=l+"_"+t}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован"),await this.forgotPassConfirm()&&this.forgotPassModal();break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_required":this.$flash("Пароль обязателен для заполнения");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break;default:this.$flash("Не удалось войти зарегистрироваться")}}},passGenerate(){let e="";const l=4,t="abcdefghijklmnopqrstuvwxyz12345678901234567890";for(let s=0;s<l;s++){const l=Math.floor(Math.random()*t.length);e+=t[l]}return e},phoneFormat(){this.user_phone||(this.user_phone="");try{let e=this.user_phone.replace(/\D/g,"");e.length>10&&(e=e.substring(e.length-10)),this.user_phone=e}catch{}},phoneVerify(){try{this.$heap.state.user.tmp_userphone=this.user_phone_prefix+this.user_phone,this.$go("/user/verify-phone")}catch{this.$flash("Не удалось выслать смс с подтверждением")}},async forgotPassModal(){var e,l;this.modalOpen=!0;const t=(null!==(e=this.user_phone_prefix)&&void 0!==e?e:"")+(null!==(l=this.user_phone)&&void 0!==l?l:""),s=await c.OZ.create({component:f.A,componentProps:{phone:t},initialBreakpoint:.5,breakpoints:[.5,.75]});return s.present()},async forgotPassConfirm(){var e,l;const t=(null!==(e=this.user_phone_prefix)&&void 0!==e?e:"")+(null!==(l=this.user_phone)&&void 0!==l?l:""),s=await c.TN.create({header:"Восстановить пароль?",message:`Возможно вы уже регистрировались с телефоном ${t}.\n\nМожем восстановить пароль.`,buttons:[{text:"Отменить",role:"cancel"},{text:"Восстановить",role:"confirm"}]});await s.present();const{role:n}=await s.onDidDismiss();return"confirm"==n}}},k=t(6262);const g=(0,k.A)(b,[["render",h]]);var v=g}}]);
//# sourceMappingURL=1132.1b656f18.js.map