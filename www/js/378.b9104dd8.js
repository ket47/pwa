"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[378],{4378:function(e,o,l){l.r(o),l.d(o,{default:function(){return z}});var s=l(6252),n=l(9963);const t={novalidate:""},a=(0,s.Uk)("Код"),i=(0,s.Uk)("+7 "),r=(0,s.Uk)("Телефон"),d={"padding-left":""},u=(0,s.Uk)("Пароль (Минимум 6 символов)"),p={"padding-left":""},f=(0,s.Uk)("Войти"),h=(0,s.Uk)("Зарегистрироваться"),m=(0,s.Uk)("Забыли пароль?");function c(e,o,l,c,w,_){const k=(0,s.up)("ion-label"),g=(0,s.up)("ion-select-option"),W=(0,s.up)("ion-select"),y=(0,s.up)("ion-col"),v=(0,s.up)("ion-input"),b=(0,s.up)("ion-row"),U=(0,s.up)("ion-text"),V=(0,s.up)("ion-button"),B=(0,s.up)("ion-grid"),I=(0,s.up)("base-layout");return(0,s.wg)(),(0,s.j4)(I,{"page-title":"Вход в систему","page-default-back-link":"/home",errorMessage:w.error},{default:(0,s.w5)((()=>[(0,s._)("form",t,[(0,s.Wm)(B,null,{default:(0,s.w5)((()=>[(0,s.Wm)(b,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,{size:"4"},{default:(0,s.w5)((()=>[(0,s.Wm)(k,{position:"stacked",color:"primary"},{default:(0,s.w5)((()=>[a])),_:1}),(0,s.Wm)(W,{value:w.fields.phonePrefix,onIonChange:o[0]||(o[0]=e=>w.fields.phonePrefix=e.target.value)},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{value:"+7"},{default:(0,s.w5)((()=>[i])),_:1})])),_:1},8,["value"])])),_:1}),(0,s.Wm)(y,{size:"8"},{default:(0,s.w5)((()=>[(0,s.Wm)(k,{position:"stacked",color:"primary"},{default:(0,s.w5)((()=>[r])),_:1}),(0,s.Wm)(v,{modelValue:w.fields.phoneBody,"onUpdate:modelValue":o[1]||(o[1]=e=>w.fields.phoneBody=e),name:"phone",type:"numeric",inputmode:"tel",value:w.fields.phoneBody,onInput:o[2]||(o[2]=e=>{e.target.value=_.phoneValidate(e)}),placeholder:"(900)-000-00-00",spellcheck:"false",autocapitalize:"off",required:""},null,8,["modelValue","value"])])),_:1})])),_:1}),(0,s.Wm)(b,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(U,{color:"danger"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("p",d,"Неверный номер телефона",512),[[n.F8,!_.phoneValid&&1==w.submitted]])])),_:1})])),_:1})])),_:1}),(0,s.Wm)(b,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(k,{position:"stacked",color:"primary"},{default:(0,s.w5)((()=>[u])),_:1}),(0,s.Wm)(v,{modelValue:e.password,"onUpdate:modelValue":o[3]||(o[3]=o=>e.password=o),name:"password",type:"password",value:w.fields.password,autocorrect:"off",onIonInput:o[4]||(o[4]=e=>w.fields.password=e.target.value),placeholder:"Пароль (Минимум 6 символов)",required:""},null,8,["modelValue","value"])])),_:1})])),_:1}),(0,s.Wm)(b,null,{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(U,{color:"danger"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("p",p,"Пароль должен содержать не менее 6 символов.",512),[[n.F8,!_.passwordValid&&1==w.submitted]])])),_:1})])),_:1})])),_:1}),(0,s.Wm)(b,{"responsive-sm":""},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(V,{onClick:_.onSubmit,expand:"block"},{default:(0,s.w5)((()=>[f])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,s.Wm)(b,{"responsive-sm":""},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(V,{color:"light",expand:"block",onClick:o[5]||(o[5]=o=>e.router.push({path:"/sign-up"}))},{default:(0,s.w5)((()=>[h])),_:1})])),_:1})])),_:1}),(0,s.Wm)(b,{"responsive-sm":""},{default:(0,s.w5)((()=>[(0,s.Wm)(y,null,{default:(0,s.w5)((()=>[(0,s.Wm)(V,{onClick:_.openModal,color:"light",expand:"block"},{default:(0,s.w5)((()=>[m])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1},8,["errorMessage"])}var w=l(7873),_=l(3577);const k=(0,s.Uk)("Закрыть"),g={novalidate:""},W=(0,s.Uk)("Имя пользователя"),y=(0,s.Uk)("Подтвердить");function v(e,o,l,n,t,a){const i=(0,s.up)("ion-title"),r=(0,s.up)("ion-button"),d=(0,s.up)("ion-toolbar"),u=(0,s.up)("ion-header"),p=(0,s.up)("ion-label"),f=(0,s.up)("ion-input"),h=(0,s.up)("ion-col"),m=(0,s.up)("ion-row"),c=(0,s.up)("ion-item"),w=(0,s.up)("ion-list"),v=(0,s.up)("ion-content");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(u,null,{default:(0,s.w5)((()=>[(0,s.Wm)(d,null,{default:(0,s.w5)((()=>[(0,s.Wm)(i,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,_.zw)(e.title),1)])),_:1}),(0,s.Wm)(r,{slot:"end",onClick:a.closeModal},{default:(0,s.w5)((()=>[k])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,s.Wm)(v,null,{default:(0,s.w5)((()=>[(0,s._)("form",g,[(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Wm)(c,null,{default:(0,s.w5)((()=>[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(p,{position:"stacked",color:"primary"},{default:(0,s.w5)((()=>[W])),_:1}),(0,s.Wm)(f,{modelValue:t.username,"onUpdate:modelValue":o[0]||(o[0]=e=>t.username=e),name:"username",type:"text",inputmode:"text",value:t.username,onInput:o[1]||(o[1]=e=>t.username=e.target.value),placeholder:"Введите имя пользователя...",required:""},null,8,["modelValue","value"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,s.Wm)(m,{"responsive-sm":""},{default:(0,s.w5)((()=>[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,{onClick:a.passwordReset,expand:"block"},{default:(0,s.w5)((()=>[y])),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1})],64)}var b=l(9755),U=l.n(b),V={name:"ModalUsernameConfirm",props:["phone"],data(){return{username:""}},components:{IonContent:w.W2,IonHeader:w.Gu,IonTitle:w.wd,IonToolbar:w.sr,IonList:w.q_,IonItem:w.Ie},methods:{closeModal(){return w.Fy.dismiss()},async passwordReset(){let e={user_phone:"+"+this.phone.replace(/\D/g,""),user_name:this.username};try{await U().post("https://api.tezkel.com/User/passwordReset",e)}catch{}this.closeModal()}}},B=l(3744);const I=(0,B.Z)(V,[["render",v]]);var C=I,x=l(351),M=l(9127),D=l(2008),P={inject:["$Order"],setup(){(0,w.Yr)((()=>{}))},name:"UserSignIn",data(){return{error:"",submitted:!1,config:{phoneMask:"(000)-000-00-00"},fields:{phonePrefix:"+7",phone:"9785141948",phoneBody:"9785141948",password:"123456"},modalOpen:!1}},computed:{phoneValid(){return 10==this.fields.phoneBody.replace(/\D/g,"").length},passwordValid(){return this.fields.password.length>=6}},methods:{async onSubmit(){if(this.submitted=!0,!this.phoneValid||!this.passwordValid)return!1;let e={user_phone:this.fields.phonePrefix+this.fields.phoneBody.replace(/\D/g,""),user_pass:this.fields.password,user_pass_confirm:this.fields.password};try{await x.Z.signIn(e),this.getUserData()}catch(o){const e=o.responseJSON,l=e.messages.error;switch(l){case"user_not_found":this.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":this.$flash("Неверный пароль");break;case"user_is_disabled":this.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":this.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":this.$flash("Номер телефона не подтвержден"),this.phoneVerify();break}}},async getUserData(){const e=await x.Z.get();D.Z.commit("setUser",e),M.Z.go(-1)},phoneVerify(){var e=this;U().post(D.Z.state.hostname+"User/phoneVerificationSend",{user_phone:"7"+this.fields.phoneBody.replace(/\D/g,"")}).done((function(){M.Z.push({name:"UserVerifyPhone",params:{phone:e.fields.phonePrefix+e.fields.phoneBody.replace(/\D/g,""),password:e.fields.password}})})).fail((function(o){e.error=o.responseJSON.messages.error}))},phoneValidate(e){this.fields.phoneBody=e.target.value,this.fields.phoneBody=this.fields.phoneBody.replace(/\D/g,""),this.fields.phoneBody.length>10&&(this.fields.phoneBody=this.fields.phoneBody.substring(0,10));let o="",l=0;for(let s in this.config.phoneMask){if(!this.fields.phoneBody[l])break;let e=this.config.phoneMask[s];"0"==e?(o+=this.fields.phoneBody[l],l++):o+=e}return this.fields.phoneBody=o,this.fields.phoneBody},async openModal(){this.modalOpen=!0;var e=this;const o=await w.Fy.create({component:C,cssClass:"my-custom-class",componentProps:{phone:e.fields.phonePrefix+e.fields.phoneBody.replace(/\D/g,"")}});return o.present()}}};const Z=(0,B.Z)(P,[["render",c],["__scopeId","data-v-1703f8c9"]]);var z=Z}}]);
//# sourceMappingURL=378.b9104dd8.js.map