"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[751],{6751:function(e,s,a){a.r(s),a.d(s,{default:function(){return P}});var t=a(6252);const l=["src"],n=(0,t.Uk)("аватар 1"),o=["src"],i=(0,t.Uk)("аватар 2"),u=(0,t.Uk)("Данные пользователя"),r=(0,t.Uk)("Ваш псевдоним"),d=(0,t.Uk)("Фамилия (не обязательно)"),p=(0,t.Uk)("Телефон"),m=(0,t.Uk)("Подтвердить"),h=(0,t.Uk)("Подтверждено"),_=(0,t.Uk)("Электронная почта"),f=(0,t.Uk)("Пароль пользователя"),c=(0,t.Uk)("Сбросить"),w=(0,t.Uk)("Изменить"),k=(0,t.Uk)("Новый пароль"),W=(0,t.Uk)("Новый пароль"),g=(0,t.Uk)("Новый пароль (повтор)"),v=(0,t.Uk)("Изменить");function y(e,s,a,y,U,b){const V=(0,t.up)("ion-thumbnail"),$=(0,t.up)("ion-label"),I=(0,t.up)("ion-radio"),C=(0,t.up)("ion-item"),O=(0,t.up)("ion-radio-group"),P=(0,t.up)("ion-item-divider"),x=(0,t.up)("ion-input"),S=(0,t.up)("ion-button"),q=(0,t.up)("ion-list"),D=(0,t.up)("ion-icon"),B=(0,t.up)("ion-col"),N=(0,t.up)("ion-row"),R=(0,t.up)("ion-title"),j=(0,t.up)("ion-toolbar"),J=(0,t.up)("ion-header"),G=(0,t.up)("ion-content"),M=(0,t.up)("ion-modal"),z=(0,t.up)("base-layout");return(0,t.wg)(),(0,t.j4)(z,{"page-title":"Мой профиль",pageDefaultBackLink:"/user"},{default:(0,t.w5)((()=>[(0,t.Wm)(q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(O,{modelValue:U.fields.user_avatar_name,"onUpdate:modelValue":s[2]||(s[2]=e=>U.fields.user_avatar_name=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)(V,{slot:"start"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,l)])),_:1}),(0,t.Wm)($,null,{default:(0,t.w5)((()=>[n])),_:1}),(0,t.Wm)(I,{slot:"end",value:"man",onIonFocus:s[0]||(s[0]=e=>b.save("user_avatar_name",e.target.value))})])),_:1}),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)(V,{slot:"start"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,o)])),_:1}),(0,t.Wm)($,null,{default:(0,t.w5)((()=>[i])),_:1}),(0,t.Wm)(I,{slot:"end",value:"woman",onIonFocus:s[1]||(s[1]=e=>b.save("user_avatar_name",e.target.value))})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(P,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,null,{default:(0,t.w5)((()=>[u])),_:1})])),_:1}),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[r])),_:1}),(0,t.Wm)(x,{modelValue:U.fields.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>U.fields.user_name=e),name:"user_name",type:"text",onChange:s[4]||(s[4]=e=>b.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",required:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[d])),_:1}),(0,t.Wm)(x,{modelValue:U.fields.user_surname,"onUpdate:modelValue":s[5]||(s[5]=e=>U.fields.user_surname=e),name:"user_surname",type:"text",onChange:s[6]||(s[6]=e=>b.save("user_surname",e.target.value)),placeholder:"Фамилия (не обязательно)"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[p])),_:1}),(0,t.Wm)(x,{readonly:"",modelValue:U.fields.user_phone,"onUpdate:modelValue":s[7]||(s[7]=e=>U.fields.user_phone=e)},null,8,["modelValue"]),!U.fields.user_phone||U.fields.user_phone_verified&&"0"!==U.fields.user_phone_verified?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(S,{key:0,slot:"end",onClick:b.phoneVerify,expand:"block"},{default:(0,t.w5)((()=>[m])),_:1},8,["onClick"])),U.fields.user_phone&&U.fields.user_phone_verified&&"0"!==U.fields.user_phone_verified?((0,t.wg)(),(0,t.j4)(S,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,t.w5)((()=>[h])),_:1})):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[_])),_:1}),(0,t.Wm)(x,{modelValue:U.fields.user_email,"onUpdate:modelValue":s[8]||(s[8]=e=>U.fields.user_email=e),name:"user_email",type:"email",onChange:s[9]||(s[9]=e=>b.save("user_email",e.target.value)),placeholder:"Электронная почта"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(P,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,null,{default:(0,t.w5)((()=>[f])),_:1})])),_:1}),(0,t.Wm)(N,{"responsive-sm":""},{default:(0,t.w5)((()=>[(0,t.Wm)(B,null,{default:(0,t.w5)((()=>[(0,t.Wm)(S,{onClick:s[10]||(s[10]=e=>b.passwordReset()),expand:"block"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{icon:y.keyOutline,slot:"start"},null,8,["icon"]),c])),_:1})])),_:1}),(0,t.Wm)(B,null,{default:(0,t.w5)((()=>[(0,t.Wm)(S,{id:"passwordPromptButton",expand:"block"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{icon:y.keyOutline,slot:"start"},null,8,["icon"]),w])),_:1})])),_:1})])),_:1}),(0,t.Wm)(M,{ref:"passwordPrompt",trigger:"passwordPromptButton","initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,t.w5)((()=>[(0,t.Wm)(J,null,{default:(0,t.w5)((()=>[(0,t.Wm)(j,{color:"secondary"},{default:(0,t.w5)((()=>[(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[k])),_:1}),(0,t.Wm)(D,{icon:y.closeOutline,onClick:s[11]||(s[11]=()=>{this.$refs.passwordPrompt.$el.dismiss()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,t.Wm)(G,{class:"ion-padding"},{default:(0,t.w5)((()=>[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{position:"stacked"},{default:(0,t.w5)((()=>[W])),_:1}),(0,t.Wm)(x,{modelValue:U.fields.user_pass,"onUpdate:modelValue":s[12]||(s[12]=e=>U.fields.user_pass=e),type:"text",placeholder:"пароль"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)($,{position:"stacked"},{default:(0,t.w5)((()=>[g])),_:1}),(0,t.Wm)(x,{modelValue:U.fields.user_pass_confirm,"onUpdate:modelValue":s[13]||(s[13]=e=>U.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(S,{onClick:s[14]||(s[14]=e=>b.passwordSave()),expand:"full"},{default:(0,t.w5)((()=>[v])),_:1})])),_:1})])),_:1},8,["initial-breakpoint","breakpoints"])])),_:1})}a(5306),a(8862);var U=a(3741),b=a(8903),V=a(9755),$=a.n(V),I={components:{IonList:U.q_,IonItem:U.Ie,IonLabel:U.Q$,IonThumbnail:U.Bs,IonRadio:U.B7,IonRadioGroup:U.se,IonInput:U.pK,IonCol:U.wI,IonRow:U.Nd,IonItemDivider:U.rH,IonButton:U.YG,IonModal:U.ki,IonHeader:U.Gu,IonTitle:U.wd,IonContent:U.W2,IonIcon:U.gu,IonToolbar:U.sr},setup(){return{closeOutline:b.fID,keyOutline:b.eyg}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{async save(e,s){if("user_phone"==e){if(!this.isPhoneValid)return!1;s=s.replace(/\D/g,"")}var a={};a.user_id=this.$heap.state.user.user_id,a[e]=s,await this.itemUpdate(a),this.fields[e]=s},async itemUpdate(e){try{return await $().post(`${this.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e)),!0}catch(s){let e="unknown";try{const a=Object.keys(JSON.parse(s.responseJSON.messages.error))[0],t=Object.values(JSON.parse(s.responseJSON.messages.error))[0];e=a+"_"+t}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break}return!1}},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{$().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$router.push({name:"UserVerifyPhone",params:{phone:e}})}catch{}},async passwordSave(){if(this.fields.user_pass!=this.fields.user_pass_confirm)return void this.$flash("Пароль и подтверждение не совпадают");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass},s=await this.itemUpdate(e);s&&(this.$refs.passwordPrompt.$el.dismiss(),this.$flash("Пароль изменен"))},async passwordReset(){const e={user_phone:this.fields.user_phone,user_email:this.fields.user_email,user_name:this.fields.user_name};try{await $().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch{}},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let s="",a=0;for(let t in this.config.phoneMask){if(!this.fields.user_phone[a])break;let e=this.config.phoneMask[t];"0"==e?(s+=this.fields.user_phone[a],a++):s+=e}return this.fields.user_phone=s,this.fields.user_phone}},created(){const e=this;this.$topic.on("userGet",(s=>{e.fields=s}))}},C=a(3744);const O=(0,C.Z)(I,[["render",y]]);var P=O}}]);
//# sourceMappingURL=751.96b3df13.js.map