{"version":3,"file":"js/3949.4be0888d.js","mappings":"kMAYoC,uB,WAMb,kB,2NAjBrBA,EAAAA,EAAAA,IAwBcC,EAAAA,CAxBD,aAAW,aAAaC,oBAAoB,QAAQC,IAAI,mB,mBAC/D,IAMW,CANKC,EAAAA,aAAaC,SAAM,WAAnCL,EAAAA,EAAAA,IAMWM,EAAAA,C,MAN0BC,MAAM,Q,mBAC/B,IAAoC,gBAA9CC,EAAAA,EAAAA,IAIWC,EAAAA,GAAAA,MAAAA,EAAAA,EAAAA,IAJsBL,EAAAA,cAAY,CAA3BM,EAASC,M,WAA3BX,EAAAA,EAAAA,IAIWY,EAAAA,CAJqCC,IAAKH,EAASI,a,mBAC1D,IAA4H,EAA5HC,EAAAA,EAAAA,IAA4HC,EAAAA,CAAnHC,KAAK,QAAQC,IAAI,gBAAiBC,IAAG,GAAKC,EAAAA,MAAMC,MAAMC,0BAA0BZ,EAASa,wB,iBAClGR,EAAAA,EAAAA,IAA4JS,EAAAA,CAAhJC,QAAK,GAAEC,EAAAA,gBAAgB,GAAGhB,EAASI,cAAW,GAAMH,KAAMgB,MAAA,2C,mBAA2C,IAA+B,mBAA5BjB,EAASkB,kBAAgB,M,wBAC7Ib,EAAAA,EAAAA,IAAwGc,EAAAA,CAA9FZ,KAAK,MAAOa,KAAMC,EAAAA,MAAQN,QAAK,GAAEC,EAAAA,eAAe,GAAGhB,EAASI,cAAW,GAAMH,M,yEAG7FX,EAAAA,EAAAA,IAKWM,EAAAA,C,MALMC,MAAM,Q,mBACrB,IAGW,EAHXQ,EAAAA,EAAAA,IAGWH,EAAAA,CAHDoB,OAAA,GAAQP,QAAK,eAAEC,EAAAA,uB,mBACvB,IAAgE,EAAhEX,EAAAA,EAAAA,IAAgEc,EAAAA,CAAtDZ,KAAK,QAAQgB,MAAM,UAAWH,KAAMC,EAAAA,iB,kBAC9ChB,EAAAA,EAAAA,IAAuDS,EAAAA,CAA5CS,MAAM,QAAM,C,kBAAC,IAAmB,M,0BAI/ClB,EAAAA,EAAAA,IAQWT,EAAAA,KAAAA,C,kBAPT,IAEkB,EAFlBS,EAAAA,EAAAA,IAEkBmB,EAAAA,KAAAA,C,kBADhB,IAAqC,EAArCnB,EAAAA,EAAAA,IAAqCS,EAAAA,KAAAA,C,kBAA1B,IAAc,M,8BAE3BhB,EAAAA,EAAAA,IAGWC,EAAAA,GAAAA,MAAAA,EAAAA,EAAAA,IAHmBL,EAAAA,mBAAZM,K,WAAlBV,EAAAA,EAAAA,IAGWY,EAAAA,CAHuCC,IAAKH,EAASyB,SAAWV,QAAK,GAAEC,EAAAA,oBAAoB,GAAGhB,EAASyB,WAAQ,GAAMzB,EAAS0B,cAAeT,MAAA,oB,mBACpJ,IAA2F,EAA3FZ,EAAAA,EAAAA,IAA2FC,EAAAA,CAAjFG,IAAG,GAAKC,EAAAA,MAAMC,MAAMC,0BAA0BZ,EAASa,wB,iBACjER,EAAAA,EAAAA,IAAwIS,EAAAA,CAA7HG,MAAA,mGAAuF,C,kBAAC,IAAyB,mBAAtBjB,EAAS0B,YAAU,M,6JA4BvI,GACEC,KAAM,gBACNC,WAAY,CACZC,OAAM,KACNC,SAAQ,KACRC,QAAO,KACPC,QAAO,KACPC,cAAa,KACbC,QAAO,KACPC,QAAO,KACPC,eAAcA,EAAAA,IAEdC,QACE,MAAO,CAAEC,gBAAe,MAACC,MAAKA,EAAAA,IAChC,EACAC,UACEC,KAAKC,iBACP,EACAC,QAAQ,CACNC,0BAA2BC,EAAmBC,GAC5C,IAAIC,EAAAA,EAAAA,MAAAA,KAAAA,QAGF,OAFAN,KAAKO,OAAO,2EACZC,EAAAA,EAAAA,KAAY,iBAGd,IAAIC,EAAwBC,OAAOL,GAAqBM,cACxD,MAAMC,QAAcC,EAAAA,GAAAA,OAAuB,CACzCC,UAAWC,EAAAA,EACXC,cAAa,EACbC,iBAAgB,EAChBC,cAAc,EACdC,SAAU,uBACVC,kBAAmBpB,KAAKqB,MAAMC,gBAAgBC,IAC9CC,eAAe,CACbf,6BAMJ,OAHAG,EAAMa,eAAeC,MAAKnE,IACxByC,KAAK2B,eAAevB,EAAkB7C,EAASqE,KAAK,IAE/ChB,EAAMiB,SACf,EACA1B,wBACE,IAAG,QACD,IAAI2B,EAAkB,KACtB,MAAMC,QAAeC,IAAAA,IAAW1B,EAAAA,EAAAA,MAAAA,SAAsB,uBAAuB,CAAC2B,iBAAiB,IAG/F,GAFAjC,KAAKkC,aAAaH,EAASI,cAC3BnC,KAAKoC,kBAAkBL,EAASM,oBAC7BrC,KAAKkC,aACN,IAAI,IAAII,KAAOtC,KAAKkC,aACF,GAAbI,EAAIC,UACLT,EAAkBQ,GAGxB,IAAKR,EAKH,YADAU,EAAAA,EAAAA,MAGCV,IAAsC,QAAjB,EAAAA,SAAiB,aAAjB,EAAmBnE,eAA0C,QAA/B,EAAE2C,EAAAA,EAAAA,MAAAA,KAAAA,qBAA6B,aAA7B,EAA+B3C,eACrF2C,EAAAA,EAAAA,MAAAA,KAAAA,cAA8BwB,EAC9B9B,KAAKyC,OAAOC,QAAQ,sBAAsBpC,EAAAA,EAAAA,MAAAA,KAAAA,eAEjC,CAAZ,SAAY,CACf,EACAH,qBAAqBnB,EAASzB,GAC5B,IAAKA,EACH,OAEF,IAAIoF,EAAQ,CACVC,gBAAgB,OAChBC,mBAAmBvC,EAAAA,EAAAA,MAAAA,KAAAA,QACnBF,kBAAkBpB,EAClBP,iBAAiBlB,EAASkB,iBAC1BqE,kBAAkBvF,EAASuF,kBAC3BC,mBAAmBxF,EAASwF,oBAE9B,UACQf,IAAAA,KAAY1B,EAAAA,EAAAA,MAAAA,SAAsB,sBAAsBqC,GAC3D3C,KAAKgD,MAAM9E,MAAM+E,aAClBjD,KAAKkD,QAAQC,KAAKnD,KAAKgD,MAAM9E,MAAM+E,YACnCjD,KAAKgD,MAAM9E,MAAM+E,WAAW,MAE9BjD,KAAKC,iBAUP,CATE,MAAMmD,GACN,MAAMC,EAAUD,EAAIE,aACdC,EAAeF,EAAUG,SAASC,MACxC,OAAOF,GACH,IAAK,gBACDvD,KAAKO,OAAO,kCACZ,MAER,OAAO,CACT,CACF,EACAJ,sBAAuBxC,EAAa+F,GAClC,IAAIC,EAAK3D,KACLsC,EAAIqB,EAAKzB,aAAawB,GAC1BpD,EAAAA,EAAAA,MAAAA,KAAAA,cAA8B,CAC5B3C,YAAY2E,EAAI3E,YAChBmF,kBAAkBR,EAAIQ,kBACtBc,kBAAkBtB,EAAIsB,kBACtBnF,iBAAiB6D,EAAI7D,iBACrBL,WAAWkE,EAAIlE,YAEjBoC,EAAAA,EAAAA,IAAW,SACLwB,IAAAA,KAAY1B,EAAAA,EAAAA,MAAAA,SAAsB,uBAAuB,CAAC3C,gBAChEqC,KAAKyC,OAAOC,QAAQ,sBAAsBpC,EAAAA,EAAAA,MAAAA,KAAAA,cAC5C,EACAH,qBAAsBxC,EAAa+F,GACjC,IACE1D,KAAKkC,aAAa2B,OAAOH,EAAM,SACzB1B,IAAAA,KAAY1B,EAAAA,EAAAA,MAAAA,SAAsB,sBAAsB,CAAC3C,eACpD,CAAZ,SAAY,CACbqC,KAAKC,iBACP,EACAE,iCACQqC,EAAAA,EAAAA,IAAAA,qBACNhC,EAAAA,EAAAA,IAAW,EACb,GAEFoB,OACE,MAAM,CACJM,aAAa,GACbE,kBAAkB,GAEtB,G,UC7KF,MAAM0B,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://tezkel/./src/views/UserAddresses.vue","webpack://tezkel/./src/views/UserAddresses.vue?cfef"],"sourcesContent":["<template>\r\n  <base-layout page-title=\"Мои адреса\" pageDefaultBackLink=\"/user\" ref=\"UserAddressPage\">\r\n        <ion-list v-if=\"locationList.length\" lines=\"full\">\r\n          <ion-item v-for=\"(location,i) in locationList\" :key=\"location.location_id\">\r\n              <ion-img slot=\"start\" alt=\"location icon\" :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\r\n              <ion-label @click=\"locationSetMain(`${location.location_id}`,`${i}`)\" style=\"white-space:normal;cursor:pointer;\">{{ location.location_address }}</ion-label>\r\n              <ion-icon slot=\"end\" :icon=\"trash\" @click=\"locationDelete(`${location.location_id}`,`${i}`)\"></ion-icon>\r\n          </ion-item>\r\n        </ion-list>\r\n        <ion-list v-else lines=\"full\">\r\n          <ion-item button @click=\"locationCurrentSet()\">\r\n            <ion-icon slot=\"start\" color=\"primary\" :icon=\"locationOutline\"/>\r\n            <ion-label color=\"dark\">Ваше местоположение</ion-label>\r\n          </ion-item>\r\n        </ion-list>\r\n\r\n        <ion-list>\r\n          <ion-list-header>\r\n            <ion-label>Добавить адрес</ion-label>\r\n          </ion-list-header>\r\n          <ion-item  v-for=\"location in locationGroupList\" :key=\"location.group_id\" @click=\"modalLocationCreate(`${location.group_id}`,`${location.group_name}`)\" style=\"cursor:pointer\">\r\n              <ion-img :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\r\n              <ion-label style=\"margin-left:5px;padding-left:5px;border-left:solid 1px black;white-space:normal\">{{ location.group_name }}</ion-label>\r\n          </ion-item>\r\n        </ion-list>\r\n  </base-layout>\r\n</template>\r\n\r\n\r\n<script>\r\nimport {\r\n  IonImg,\r\n  IonLabel,\r\n  IonItem,\r\n  IonList,\r\n  IonListHeader,\r\n  IonIcon,\r\n  modalController,\r\n  IonCard,\r\n  IonCardContent,\r\n}                         from \"@ionic/vue\";\r\nimport router             from '@/router';\r\nimport heap               from '@/heap';\r\nimport User              from '@/scripts/User.js'\r\nimport jQuery             from 'jquery';\r\nimport UserAddressPicker  from '@/components/UserAddressPicker.vue';\r\n\r\nimport { locationOutline,trash }          from 'ionicons/icons';\r\n\r\n\r\nexport default{\r\n  name: 'UserAddresses',\r\n  components: {\r\n  IonImg,\r\n  IonLabel,\r\n  IonItem,\r\n  IonList,\r\n  IonListHeader,\r\n  IonIcon,\r\n  IonCard,\r\n  IonCardContent,\r\n  },\r\n  setup(){\r\n    return { locationOutline,trash };\r\n  },\r\n  mounted(){\r\n    this.locationListGet();\r\n  },\r\n  methods:{\r\n    async modalLocationCreate( location_group_id, location_group_name ) {\r\n      if(!heap.state.user.user_id){\r\n        this.$flash('Чтобы добавленные адреса сохранились, пожалуйста войдите в систему');\r\n        router.push('/user/sign-in');\r\n        return;\r\n      }\r\n      var location_group_name_low=String(location_group_name).toLowerCase();\r\n      const modal = await modalController.create({\r\n        component: UserAddressPicker,\r\n        showBackdrop:true,\r\n        backdropDismiss:true,\r\n        swipeToClose: true,\r\n        cssClass: 'update-profile-modal',\r\n        presentingElement: this.$refs.UserAddressPage.$el,\r\n        componentProps:{\r\n          location_group_name_low\r\n        },\r\n      });\r\n      modal.onDidDismiss().then(location => {\r\n        this.locationCreate(location_group_id,location.data);\r\n      });\r\n      return modal.present();\r\n    },\r\n    async locationListGet(){\r\n      try{\r\n        let new_location_main=null\r\n        const response=await jQuery.get(heap.state.hostname + \"User/locationListGet\",{includeGroupList:1})\r\n        this.locationList=response.location_list;\r\n        this.locationGroupList=response.location_group_list;\r\n        if(this.locationList){\r\n          for(let loc of this.locationList){\r\n            if(loc.is_main!=1)continue;\r\n              new_location_main=loc;\r\n          }\r\n        }\r\n        if( !new_location_main ){\r\n          /**\r\n           * for some reason main location is not present so reload user data\r\n           */\r\n          User.get()\r\n          return\r\n        }\r\n        if(new_location_main && new_location_main?.location_id!=heap.state.user.location_main?.location_id){\r\n          heap.state.user.location_main=new_location_main\r\n          this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\r\n        }\r\n      }catch{/** */}\r\n    },\r\n    async locationCreate(group_id,location){\r\n      if( !location ){\r\n        return;\r\n      }\r\n      let request={\r\n        location_holder:'user',\r\n        location_holder_id:heap.state.user.user_id,\r\n        location_group_id:group_id,\r\n        location_address:location.location_address,\r\n        location_latitude:location.location_latitude,\r\n        location_longitude:location.location_longitude\r\n      };\r\n      try{\r\n        await jQuery.post(heap.state.hostname + \"User/locationCreate\",request)\r\n        if(this.$heap.state.next_route){\r\n          this.$router.push(this.$heap.state.next_route)\r\n          this.$heap.state.next_route=null\r\n        }\r\n        this.locationListGet();\r\n      } catch(err){\r\n        const exception=err.responseJSON;\r\n        const exception_code=exception.messages.error;\r\n        switch(exception_code){\r\n            case 'limit_exeeded':\r\n                this.$flash(\"Больше адресов добавить нельзя\");\r\n                break;\r\n        }\r\n        return false\r\n      }\r\n    },\r\n    async locationSetMain( location_id, index ){\r\n      var self=this;\r\n      var loc=self.locationList[index];\r\n      heap.state.user.location_main={\r\n        location_id:loc.location_id,\r\n        location_latitude:loc.location_latitude,\r\n        location_altitude:loc.location_altitude,\r\n        location_address:loc.location_address,\r\n        image_hash:loc.image_hash\r\n      };\r\n      router.go(-1);\r\n      await jQuery.post(heap.state.hostname + \"User/locationSetMain\",{location_id});\r\n      this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\r\n    },\r\n    async locationDelete( location_id, index ){\r\n      try{\r\n        this.locationList.splice(index,1);\r\n        await jQuery.post(heap.state.hostname + \"User/locationDelete\",{location_id})\r\n      }catch{/** */}\r\n      this.locationListGet();\r\n    },\r\n    async locationCurrentSet(){\r\n      await User.geo.locationCurrentGet()\r\n      router.go(-1)\r\n    }\r\n  },\r\n  data(){\r\n    return{\r\n      locationList:[],\r\n      locationGroupList:[]\r\n    }\r\n  }\r\n}\r\n</script>","import { render } from \"./UserAddresses.vue?vue&type=template&id=b403e7bc\"\nimport script from \"./UserAddresses.vue?vue&type=script&lang=js\"\nexport * from \"./UserAddresses.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"W:\\\\Ionic\\\\Tezkel\\\\blank\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","pageDefaultBackLink","ref","$data","length","_component_ion_list","lines","_createElementBlock","_Fragment","location","i","_component_ion_item","key","location_id","_createVNode","_component_ion_img","slot","alt","src","_ctx","state","hostname","image_hash","_component_ion_label","onClick","$options","style","location_address","_component_ion_icon","icon","$setup","button","color","_component_ion_list_header","group_id","group_name","name","components","IonImg","IonLabel","IonItem","IonList","IonListHeader","IonIcon","IonCard","IonCardContent","setup","locationOutline","trash","mounted","this","locationListGet","methods","async","location_group_id","location_group_name","heap","$flash","router","location_group_name_low","String","toLowerCase","modal","modalController","component","UserAddressPicker","showBackdrop","backdropDismiss","swipeToClose","cssClass","presentingElement","$refs","UserAddressPage","$el","componentProps","onDidDismiss","then","locationCreate","data","present","new_location_main","response","jQuery","includeGroupList","locationList","location_list","locationGroupList","location_group_list","loc","is_main","User","$topic","publish","request","location_holder","location_holder_id","location_latitude","location_longitude","$heap","next_route","$router","push","err","exception","responseJSON","exception_code","messages","error","index","self","location_altitude","splice","__exports__","render"],"sourceRoot":""}