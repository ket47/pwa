{"version":3,"file":"js/5304-legacy.a1964d1f.js","mappings":"mRACIA,EAAAA,EAAAA,IAIcC,EAAA,CAJD,aAAW,iBAAe,C,kBACnC,SAAAC,EAAA,MAAsF,EAAtFC,EAAAA,EAAAA,IAAsFC,EAAA,CAA1EC,UAAWC,EAAAC,MAAQC,cAAaC,EAAAD,cAAgBE,cAAaD,EAAAE,Y,+DAAa,KACtFC,EAAAA,EAAAA,IAAO,QAAPV,EAAEI,EAAAC,aAAK,IAAAL,OAAA,EAALA,EAAOW,oBAAoB,KAC7BD,EAAAA,EAAAA,IAAEN,EAAAQ,KAAG,O,sEAQb,GACIC,WAAW,CACPC,SAAQA,EAAAA,GAEZC,IAAAA,GACI,MAAM,CACFV,MAAM,KACNO,IAAI,GAEZ,EACAI,QAAQ,CACJ,gBAAMC,GACF,MAAMC,EAAK,IAAIC,KACTC,EAAM,CACRC,eAAe,KACfC,SAAS,EACTC,QAAQ,GACRC,WAAWN,EAAKO,cAAcC,QAAQ,OAAO,KAAKA,QAAQ,WAAW,IACrEC,WAAW,CACP,mBAAsB,CAAC,wBACvB,iBAAoB,CAAC,UAAU,SAAS,UAE5CC,cAAc,gBACdC,UAAU,YAEdC,KAAKC,SAASX,EAClB,EACA,cAAMY,GACF,IACI,MAAMC,EAAYC,KAAKC,MAAMC,aAAaC,eAC1C,GAAGJ,EAGC,YAFAH,KAAKzB,MAAM4B,EAInB,CAAC,MAAAK,GAAY,CACbR,KAAKb,YACT,EACAc,QAAAA,CAAU1B,GACNyB,KAAKzB,MAAMA,EACX+B,aAAaC,cAAcH,KAAKK,UAAUlC,EAC9C,EACA,gBAAMI,CAAY+B,GAEdV,KAAKC,SAASU,OAAOC,OAAO,CAAC,EAAEZ,KAAKzB,MAAMmC,GAC9C,EAEA,mBAAMlC,CAAcgB,EAAUqB,GAC1B,GAAqB,mBAAlBA,GAAyD,oBAAlBA,EAGtC,OAFAP,aAAaQ,WAAW,sBACxBd,KAAKe,QAAQnB,QAAS,qBAGL,2BAAlBiB,IACCA,EAAiB,sBAErB,IACI,MAAMG,EAAQ,CACVC,YAAY,EACZC,kBAAkBlB,KAAKzB,MAAM2C,kBAC7BC,wBAAwBnB,KAAKzB,MAAM6C,kBACnCC,yBAAyBrB,KAAKzB,MAAM+C,oBAElC9B,QAAiB+B,IAAAA,KAAa,GAAEvB,KAAKwB,MAAMC,MAAMC,4BAA4BtB,KAAKK,UAAUO,IAC9FxB,EAAS,GACTQ,KAAKe,QAAQY,KAAM,4BAA2BnC,IAEtD,CAAE,MAAMV,GAAI,IAAA8C,EAAAC,EACR,MAAMC,EAAkB,OAAHhD,QAAG,IAAHA,GAAiB,QAAd8C,EAAH9C,EAAKiD,oBAAY,IAAAH,GAAU,QAAVC,EAAjBD,EAAmBI,gBAAQ,IAAAH,OAAxB,EAAHA,EAA6BI,MAClD,IAAIH,EACA,OAAO,EAEX,OAAOA,GACH,IAAK,iBACD9B,KAAKkC,OAAO,+CAA+C,cAC3D,MACJ,IAAK,kBACDlC,KAAKmC,OAAO,sCACZnC,KAAKoC,OAAOC,QAAQ,gBACpBrC,KAAKsC,IAAI,yBACTtC,KAAKwB,MAAMC,MAAMc,WAAW,gBAAgB/C,EAC5C,MAER,OAAO,CACX,CACJ,GAEJgD,OAAAA,GACIxC,KAAKE,UACT,G,UChGJ,MAAMuC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE,O","sources":["webpack://Tezkel/./src/views/ShipmentDraftView.vue","webpack://Tezkel/./src/views/ShipmentDraftView.vue?ac34"],"sourcesContent":["<template>\r\n    <base-layout page-title=\"Вызов курьера\">\r\n        <ship-comp :orderData=\"order\" @stageCreate=\"onStageCreate\" @orderUpdate=\"itemUpdate\"/>\r\n        {{order?.order_sum_delivery}}\r\n        {{err}}\r\n    </base-layout>\r\n</template>\r\n<script>\r\n\r\nimport jQuery           from \"jquery\";\r\nimport ShipComp          from '@/components/ShipmentComp.vue';\r\n\r\nexport default {\r\n    components:{\r\n        ShipComp,\r\n    },\r\n    data(){\r\n        return{\r\n            order:null,\r\n            err:''\r\n        }\r\n    },\r\n    methods:{\r\n        async itemCreate(){\r\n            const date=new Date()\r\n            const draft={\r\n                order_store_id:null,\r\n                order_id:0,\r\n                entries:[],\r\n                created_at:date.toISOString().replace(/[T]/g,' ').replace(/.\\d\\d\\dZ/,''),\r\n                stage_next:{\r\n                    \"customer_confirmed\": [\"Перейти к оформлению\"],\r\n                    \"customer_deleted\": [\"Удалить\",\"danger\",\"clear\"],\r\n                },\r\n                stage_current:'customer_cart',\r\n                user_role:'customer',\r\n            }\r\n            this.itemSave(draft)\r\n        },\r\n        async itemLoad(){\r\n            try{\r\n                const storedOrder=JSON.parse(localStorage.shipmentDraft)\r\n                if(storedOrder){\r\n                    this.order=storedOrder\r\n                    //this.itemTotalEstimate()\r\n                    return\r\n                }\r\n            }catch{/** */}\r\n            this.itemCreate()\r\n        },\r\n        itemSave( order ){\r\n            this.order=order\r\n            localStorage.shipmentDraft=JSON.stringify(order)\r\n        },\r\n        async itemUpdate( orderUpdate ){\r\n            //orderUpdate.deliveryCalculation=await this.itemTotalEstimate()\r\n            this.itemSave(Object.assign({},this.order,orderUpdate))\r\n        },\r\n\r\n        async onStageCreate(order_id, order_stage_code){\r\n            if(order_stage_code=='customer_purged' || order_stage_code=='customer_deleted' ){\r\n                localStorage.removeItem('shipmentDraft');\r\n                this.$router.replace(`/order/order-list`)\r\n                return\r\n            }\r\n            if(order_stage_code=='customer_action_confirm'){\r\n                order_stage_code='customer_confirmed'\r\n            }\r\n            try{\r\n                const request={\r\n                    is_shopping:0,\r\n                    order_description:this.order.order_description,\r\n                    order_start_location_id:this.order.start_location_id,\r\n                    order_finish_location_id:this.order.finish_location_id,\r\n                }\r\n                const order_id = await jQuery.post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(request))\r\n                if( order_id>0 ){\r\n                    this.$router.push(`/modal/shipment-checkout-${order_id}`)\r\n                }\r\n            } catch(err){\r\n                const exception_code=err?.responseJSON?.messages?.error;\r\n                if(!exception_code){\r\n                    return false;\r\n                }\r\n                switch(exception_code){\r\n                    case 'order_is_empty':\r\n                        this.$alert(\"К сожалению, товара не осталось в наличии ☹️\",\"Заказ пуст\");\r\n                        break;\r\n                    case 'address_not_set':\r\n                        this.$flash(\"Необходимо добавить адрес доставки\")\r\n                        this.$topic.publish('dismissModal')\r\n                        this.$go('/modal/user-addresses')\r\n                        this.$heap.state.next_route='/order/order-'+order_id;\r\n                        break;\r\n                }\r\n                return false\r\n            }\r\n        },\r\n    },\r\n    mounted(){\r\n        this.itemLoad()\r\n    }\r\n}\r\n</script>","import { render } from \"./ShipmentDraftView.vue?vue&type=template&id=34ee3713\"\nimport script from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\nexport * from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","_$data$order","_createVNode","_component_ship_comp","orderData","$data","order","onStageCreate","$options","onOrderUpdate","itemUpdate","_toDisplayString","order_sum_delivery","err","components","ShipComp","data","methods","itemCreate","date","Date","draft","order_store_id","order_id","entries","created_at","toISOString","replace","stage_next","stage_current","user_role","this","itemSave","itemLoad","storedOrder","JSON","parse","localStorage","shipmentDraft","_unused","stringify","orderUpdate","Object","assign","order_stage_code","removeItem","$router","request","is_shopping","order_description","order_start_location_id","start_location_id","order_finish_location_id","finish_location_id","jQuery","$heap","state","hostname","push","_err$responseJSON","_err$responseJSON$mes","exception_code","responseJSON","messages","error","$alert","$flash","$topic","publish","$go","next_route","mounted","__exports__","render"],"sourceRoot":""}