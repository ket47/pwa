"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[757],{6769:function(t,o,e){e.d(o,{Z:function(){return p}});var n=e(6252);function i(t,o,e,i,a,s){const l=(0,n.up)("ion-icon"),r=(0,n.up)("ion-button"),c=(0,n.up)("ion-buttons"),d=(0,n.up)("ion-label"),u=(0,n.up)("ion-toolbar"),p=(0,n.up)("ion-searchbar"),m=(0,n.up)("ion-header"),_=(0,n.up)("ymap-marker"),g=(0,n.up)("yandex-map"),h=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,{slot:"start"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{onClick:o[0]||(o[0]=t=>i.closeModal()),color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{icon:i.closeOutline,slot:"start"},null,8,["icon"]),(0,n.Uk)(" Закрыть ")])),_:1})])),_:1}),(0,n.Wm)(d,{size:"large"},{default:(0,n.w5)((()=>[(0,n.Uk)("Добавление адреса")])),_:1}),(0,n.Wm)(c,{slot:"end"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{strong:!0,onClick:o[1]||(o[1]=t=>s.pickAddress()),color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{src:i.checkmark,slot:"start"},null,8,["src"]),(0,n.Uk)(" Ок ")])),_:1})])),_:1})])),_:1}),(0,n.Wm)(p,{id:"suggest",placeholder:"название улицы, номер дома"})])),_:1}),(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,{coords:a.coords,zoom:16,onClick:o[2]||(o[2]=t=>s.onClick(t)),style:{height:"100%"},settings:a.settings},{default:(0,n.w5)((()=>[(0,n.Wm)(_,{coords:a.coords,"marker-id":"1",properties:a.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"])])),_:1})],64)}var a=e(8534),s=(e(4916),e(3123),e(3948),e(5069),e(1632)),l=e(5836),r=e(8903),c={components:{IonContent:s.W2,IonToolbar:s.sr,IonButton:s.YG,IonButtons:s.Sm,IonSearchbar:s.VI,IonHeader:s.Gu,IonIcon:s.gu,yandexMap:l.xR,ymapMarker:l.Jk},setup(){const t=function(){s.Fy.dismiss()};return{closeModal:t,locationOutline:r.Iv7,closeOutline:r.fID,checkmark:r.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",o=this.$heap.state.settings.location,e=JSON.parse(o.mapCenter);return{settings:{apiKey:o.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},locationType:t,locSettings:o,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:e}},methods:{pickAddress(){var t=this;return(0,a.Z)((function*(){try{var o;const e=yield window.ymaps.geocode(t.coords);t.selectedAddress=null===(o=e.geoObjects.get(0))||void 0===o?void 0:o.getAddressLine()}catch(n){console.log(n)}var e={location_address:t.filterAddress(t.selectedAddress),location_latitude:t.coords[0],location_longitude:t.coords[1]};s.Fy.dismiss(e)}))()},filterAddress(t){const o=this.locSettings.addressErase.split(", "),e=t.split(", ");let n=[];for(const i of e)o.find((t=>t==i))||n.push(i);return n.reverse().join(", ")},onClick(t){t&&t.get&&(this.coords=t.get("coords"))}},mounted(){var t=this;return(0,a.Z)((function*(){yield(0,l.xk)();let o=window.ymaps;const e=JSON.parse("["+t.locSettings.mapBoundaries[0]+"]"),n=new o.SuggestView("suggest",{boundedBy:e});n.events.add("select",(e=>{t.selectedAddress=e.get("item").displayName,o.geocode(t.selectedAddress).then((o=>{t.coords=o.geoObjects.get(0).geometry.getCoordinates()}))})),t.$flash("Получаем местоположение устройства"),o.geolocation.get().then((o=>{t.coords=o.geoObjects.position,t.$flash("На карте отмечено ваше местоположение")}))}))()}},d=e(3744);const u=(0,d.Z)(c,[["render",i]]);var p=u},9757:function(t,o,e){e.r(o),e.d(o,{default:function(){return L}});var n=e(6252),i=e(3577);const a=t=>((0,n.dD)("data-v-2f4587c4"),t=t(),(0,n.Cn)(),t),s={style:{color:"var(--ion-color-primary)"}},l=a((()=>(0,n._)("p",null,"Вы сможете заказать из ресторанов и магазинов в пределах радиуса доставки.",-1))),r=a((()=>(0,n._)("p",null,"Вы пока не добавили адрес доставки заказа.",-1))),c=a((()=>(0,n._)("p",null,"Для поиска ресторанов и магазинов будет использоваться адрес по умолчанию.",-1)));function d(t,o,e,a,d,u){const p=(0,n.up)("ion-card-subtitle"),m=(0,n.up)("ion-card-header"),_=(0,n.up)("ion-card-content"),g=(0,n.up)("ion-card"),h=(0,n.up)("ion-img"),f=(0,n.up)("ion-label"),w=(0,n.up)("ion-icon"),k=(0,n.up)("ion-item"),y=(0,n.up)("ion-list"),v=(0,n.up)("ion-list-header"),C=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(C,{"page-title":"Мои адреса",pageDefaultBackLink:"/user",ref:"UserAddressPage"},{default:(0,n.w5)((()=>[u.mainAddress?((0,n.wg)(),(0,n.j4)(g,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Адрес доставки заказа ")])),_:1})])),_:1}),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n._)("p",null,[(0,n.Uk)("Вы выбрали "),(0,n._)("b",s,(0,i.zw)(u.mainAddress.location_address),1),(0,n.Uk)(", как адрес доставки заказов.")]),l])),_:1})])),_:1})):((0,n.wg)(),(0,n.j4)(g,{key:1},{default:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" Адрес не установлен ")])),_:1})])),_:1}),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[r,c])),_:1})])),_:1})),d.locationList.length?((0,n.wg)(),(0,n.j4)(y,{key:2,lines:"full"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(d.locationList,((o,e)=>((0,n.wg)(),(0,n.j4)(k,{key:o.location_id},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,n.Wm)(f,{onClick:t=>u.locationSetMain(`${o.location_id}`,`${e}`),style:{"white-space":"normal",cursor:"pointer"},class:(0,i.C_)(1==o.is_main?"is_main":"")},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.location_address),1)])),_:2},1032,["onClick","class"]),(0,n.Wm)(w,{slot:"end",icon:a.trashOutline,onClick:t=>u.locationDelete(`${o.location_id}`,`${e}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(y,null,{default:(0,n.w5)((()=>[(0,n.Wm)(v,null,{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Добавить адрес")])),_:1})])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(d.locationGroupList,(o=>((0,n.wg)(),(0,n.j4)(k,{key:o.group_id,onClick:t=>u.modalLocationCreate(`${o.group_id}`,`${o.group_name}`),style:{cursor:"pointer"}},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(o.group_name),1)])),_:2},1024),(0,n.Wm)(w,{src:a.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)}var u=e(8534),p=(e(3948),e(1632)),m=e(4658),_=e(2008),g=e(351),h=e(9755),f=e.n(h),w=e(6769),k=e(8903),y={name:"UserAddresses",components:{IonImg:p.Xz,IonLabel:p.Q$,IonItem:p.Ie,IonList:p.q_,IonListHeader:p.yh,IonIcon:p.gu,IonCard:p.PM,IonCardHeader:p.Zi,IonCardContent:p.FN,IonCardSubtitle:p.tO},setup(){return{locationOutline:k.Iv7,trashOutline:k.gtu,addOutline:k.s6O}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{modalLocationCreate(t,o){var e=this;return(0,u.Z)((function*(){if(!_.Z.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&e.$go("/user/sign-in"));var n=String(o).toLowerCase();const i=yield p.Fy.create({component:w.Z,showBackdrop:!0,componentProps:{location_group_name_low:n}});return i.onDidDismiss().then((o=>{e.locationCreate(t,o.data)})),i.present()}))()},locationListGet(){var t=this;return(0,u.Z)((function*(){try{var o,e;let n=null;const i=yield f().get(_.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(t.locationList=i.location_list,t.locationGroupList=i.location_group_list,t.locationList)for(let o of t.locationList)1==o.is_main&&(n=o);if(!n)return void g.Z.get();n&&(null===(o=n)||void 0===o?void 0:o.location_id)!=(null===(e=_.Z.state.user.location_main)||void 0===e?void 0:e.location_id)&&(_.Z.state.user.location_main=n,t.$topic.publish("userMainLocationSet",_.Z.state.user.location_main))}catch(n){}}))()},locationCreate(t,o){var e=this;return(0,u.Z)((function*(){if(!o)return;let n={location_holder:"user",location_holder_id:_.Z.state.user.user_id,location_group_id:t,location_address:o.location_address,location_latitude:o.location_latitude,location_longitude:o.location_longitude};try{yield f().post(_.Z.state.hostname+"User/locationCreate",n),e.$heap.state.next_route&&(e.$go(e.$heap.state.next_route),e.$heap.state.next_route=null),e.locationListGet()}catch(i){const t=i.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":e.$flash("Больше адресов добавить нельзя");break}return!1}}))()},locationSetMain(t,o){var e=this;return(0,u.Z)((function*(){var n=e,i=n.locationList[o];_.Z.state.user.location_main={location_id:i.location_id,location_latitude:i.location_latitude,location_longitude:i.location_longitude,location_address:i.location_address,image_hash:i.image_hash},m.Z.go(-1),yield f().post(_.Z.state.hostname+"User/locationSetMain",{location_id:t}),e.$topic.publish("userMainLocationSet",_.Z.state.user.location_main)}))()},locationDelete(t,o){var e=this;return(0,u.Z)((function*(){if(confirm("Удалить адрес доставки?")){try{e.locationList.splice(o,1),yield f().post(_.Z.state.hostname+"User/locationDelete",{location_id:t})}catch(n){}e.locationListGet()}}))()},locationCurrentSet(){var t=this;return(0,u.Z)((function*(){const o=yield p.G0.create({message:"Определяем ваше местоположение"});o.present();try{yield g.Z.geo.locationCurrentGet(),t.$flash("Ваше местоположение определено")}catch(e){console.log(e),t.$flash("Не удалось получить ваше местоположение")}o.dismiss(),m.Z.go(-1)}))()}},data(){return{locationList:[],locationGroupList:[]}}},v=e(3744);const C=(0,v.Z)(y,[["render",d],["__scopeId","data-v-2f4587c4"]]);var L=C}}]);
//# sourceMappingURL=757-legacy.05ce7825.js.map