"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[1338],{1338:function(e,t,o){o.r(t),o.d(t,{default:function(){return V}});var i=o(6252),n=o(3577);const l=["onClick"],s=["onClick"],r={slot:"start"},a={style:{color:"var(--ion-color-primary)"}},d={style:{padding:"5px"}},u={key:0,style:{padding:"5px"}},c=(0,i._)("b",null,"Доставить:",-1),m={key:1,style:{padding:"10px","background-color":"#eee",color:"#333","border-radius":"10px"}},_={style:{display:"grid","grid-template-columns":"40px auto 20px",width:"100%"}},h={style:{padding:"3px",color:"var(--ion-color-primary)"}},p={style:{padding:"3px",color:"#333"}},w={style:{padding:"3px",color:"#999"}},f={style:{padding:"3px",color:"#333"}},k={key:4,style:{display:"flex","align-items":"center","justify-content":"center",height:"70vh"}},g={key:0,style:{width:"max-content","text-align":"center"}},y=(0,i._)("br",null,null,-1),v={key:1,style:{width:"max-content","text-align":"center"}},b=(0,i._)("br",null,null,-1);function W(e,t,o,W,j,L){const I=(0,i.up)("ion-segment-button"),z=(0,i.up)("ion-segment"),C=(0,i.up)("ion-text"),x=(0,i.up)("ion-label"),$=(0,i.up)("ion-item"),D=(0,i.up)("ion-icon"),U=(0,i.up)("ion-chip"),O=(0,i.up)("ion-img"),T=(0,i.up)("ion-avatar"),q=(0,i.up)("ion-list"),S=(0,i.up)("ion-note"),J=(0,i.up)("ion-accordion"),G=(0,i.up)("ion-accordion-group"),M=(0,i.up)("ion-list-header"),Z=(0,i.up)("ion-skeleton-text"),R=(0,i.up)("ion-infinite-scroll-content"),B=(0,i.up)("ion-infinite-scroll"),N=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(N,{"page-title":"Заказы",hideBackLink:"true"},{default:(0,i.w5)((()=>{var o,N,Y,A,F,H;return[(0,i.Wm)(z,{"swipe-gesture":"true",modelValue:j.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>j.orderType=e),onIonChange:t[1]||(t[1]=e=>L.listTypeChanged(e)),scrollable:!0},{default:(0,i.w5)((()=>[j.courierJobsInclude?((0,i.wg)(),(0,i.j4)(I,{key:0,value:"jobs"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Задания ")])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(I,{value:"active"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Активные ")])),_:1}),(0,i.Wm)(I,{value:"done"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Завершенные ")])),_:1})])),_:1},8,["modelValue"]),(null===(o=j.orderList)||void 0===o?void 0:o.length)>0?((0,i.wg)(),(0,i.j4)(q,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(L.orderListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>L.itemClick(t)},[(0,i.Wm)($,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Uk)("#"+(0,n.zw)(t.order_id),1)])),_:2},1024),1==t.is_shipment?((0,i.wg)(),(0,i.j4)(x,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)("Вызов курьера "+(0,n.zw)(t.store_name),1)])),_:2},1024)):((0,i.wg)(),(0,i.j4)(x,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name),1)])),_:2},1024)),(0,i.Wm)(C,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.date),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)($,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{slot:"start",icon:t.icon,color:"primary"},null,8,["icon"]),(0,i.Wm)(C,null,{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(U,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.stage_current_name?((0,i.wg)(),(0,i.j4)(U,{key:0,color:t.stage_color},{default:(0,i.w5)((()=>[1==t.is_canceled?((0,i.wg)(),(0,i.j4)(D,{key:0,icon:W.banOutline},null,8,["icon"])):((0,i.wg)(),(0,i.j4)(D,{key:1,icon:W.checkmarkOutline},null,8,["icon"])),(0,i.Wm)(x,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.stage_current_name),1)])),_:2},1024)])),_:2},1032,["color"])):(0,i.kq)("",!0)])),_:2},1024)])),_:2},1024),t.image_hash?((0,i.wg)(),(0,i.j4)(T,{key:0,slot:"end"},{default:(0,i.w5)((()=>[(0,i.Wm)(O,{style:{"border-radius":"10px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024)],8,l)))),128))])),_:1})):(0,i.kq)("",!0),"jobs"==j.orderType&&(null===(N=j.jobList)||void 0===N?void 0:N.length)>0?((0,i.wg)(),(0,i.j4)(G,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(J,{value:"oldjobs"},{default:(0,i.w5)((()=>[(0,i.Wm)($,{slot:"header",color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Задания")])),_:1})])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(L.jobListComputed,(e=>((0,i.wg)(),(0,i.iD)("div",{slot:"content",key:e.order_id,onClick:t=>L.itemClick(e)},[(0,i.Wm)($,{lines:"none",color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{slot:"start",icon:W.rocketOutline,color:"primary"},null,8,["icon"]),1==e.is_shipment?((0,i.wg)(),(0,i.j4)(x,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)("Вызов курьера "+(0,n.zw)(e.store_name),1)])),_:2},1024)):((0,i.wg)(),(0,i.j4)(x,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.store_name),1)])),_:2},1024)),(0,i.Wm)(C,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.date_time),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)($,{lines:"full",color:"light"},{default:(0,i.w5)((()=>[(0,i._)("b",r,[(0,i._)("b",a,(0,n.zw)(e.distance_km),1)]),(0,i.Wm)(C,{style:{"margin-bottom":"3px"}},{default:(0,i.w5)((()=>[(0,i._)("div",d,[(0,i.Uk)((0,n.zw)(e.location_address)+" ",1),e.location_comment?((0,i.wg)(),(0,i.j4)(S,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.location_comment),1)])),_:2},1024)):(0,i.kq)("",!0)]),e.finish_location_address?((0,i.wg)(),(0,i.iD)("div",u,[c,(0,i.Uk)(" "+(0,n.zw)(e.finish_location_address)+" ",1),e.finish_location_comment?((0,i.wg)(),(0,i.j4)(S,{key:0},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.finish_location_comment),1)])),_:2},1024)):(0,i.kq)("",!0)])):(0,i.kq)("",!0),e.order_description?((0,i.wg)(),(0,i.iD)("div",m,(0,n.zw)(e.order_description),1)):(0,i.kq)("",!0)])),_:2},1024)])),_:2},1024)],8,s)))),128))])),_:1})])),_:1})):(0,i.kq)("",!0),"jobs"==j.orderType&&(null===(Y=j.routeList)||void 0===Y?void 0:Y.length)>0?((0,i.wg)(),(0,i.j4)(q,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(M,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Маршрут")])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(L.routeListComputed,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.job_id},[(0,i.Wm)($,{lines:"none",style:{"--inner-padding-bottom":"0px"},onClick:t=>L.itemClickConfirm(e)},{default:(0,i.w5)((()=>[(0,i.Wm)(C,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(e.job_name)+" ("+(0,n.zw)(e.courier_name||"-")+") ",1)])),_:2},1024),(0,i.Wm)(U,{slot:"end",color:e.stage_color},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{icon:W.checkmarkOutline},null,8,["icon"]),(0,i.Wm)(x,{color:"dark"},{default:(0,i.w5)((()=>[(0,i._)("small",null,(0,n.zw)(e.stage_label),1)])),_:2},1024)])),_:2},1032,["color"])])),_:2},1032,["onClick"]),(0,i.Wm)($,{lines:"full",onClick:t=>L.itemClickConfirm(e)},{default:(0,i.w5)((()=>[(0,i._)("div",_,[(0,i._)("div",h,[(0,i._)("b",null,(0,n.zw)(e.start_plan_date),1)]),(0,i._)("div",p,[(0,i._)("small",null,(0,n.zw)(e.start_address),1)]),(0,i._)("div",null,[(0,i.Wm)(D,{icon:W.square,style:(0,n.j5)(`color:${e.start_color}`)},null,8,["icon","style"])]),(0,i._)("div",w,(0,n.zw)(e.finish_plan_date),1),(0,i._)("div",f,[(0,i._)("small",null,(0,n.zw)(e.finish_address),1)]),(0,i._)("div",null,[(0,i.Wm)(D,{icon:W.square,style:(0,n.j5)(`color:${e.finish_color}`)},null,8,["icon","style"])])])])),_:2},1032,["onClick"])])))),128))])),_:1})):(0,i.kq)("",!0),["active","done"].includes(j.orderType)&&null==j.orderList?((0,i.wg)(),(0,i.j4)(q,{key:3},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3],(e=>(0,i._)("div",{key:e},[(0,i.Wm)($,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{style:{width:"50px"},slot:"start"}),(0,i.Wm)(Z,{style:{width:"100%"}}),(0,i.Wm)(Z,{style:{width:"50px"},slot:"end"})])),_:1}),(0,i.Wm)($,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{animated:"",style:{width:"30px",height:"30px","border-radius":"50px"},slot:"start"}),(0,i.Wm)(U,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Wm)(x,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{animated:"",style:{width:"80px"}})])),_:1})])),_:1}),(0,i.Wm)(U,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{icon:W.checkmarkOutline},null,8,["icon"]),(0,i.Wm)(x,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{animated:"",style:{width:"80px"}})])),_:1})])),_:1}),(0,i.Wm)(Z,{animated:"",style:{width:"40px",height:"40px","border-radius":"10px"},slot:"end"})])),_:1})]))),64))])),_:1})):j.orderList&&0!=(null===(A=j.orderList)||void 0===A?void 0:A.length)||j.jobList&&0!=(null===(F=j.jobList)||void 0===F?void 0:F.length)||j.routeList&&0!=(null===(H=j.routeList)||void 0===H?void 0:H.length)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",k,[e.$heap.getters.userIsLogged?((0,i.wg)(),(0,i.iD)("div",g,[(0,i.Wm)(D,{icon:W.sparklesOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Заказов нет")])),_:1}),y,(0,i.Wm)(S,{onClick:t[2]||(t[2]=t=>e.$router.replace("/")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("но вы можете создать новый")])),_:1})])):((0,i.wg)(),(0,i.iD)("div",v,[(0,i.Wm)(D,{icon:W.informationOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Необходимо войти в систему")])),_:1}),b,(0,i.Wm)(S,{onClick:t[3]||(t[3]=t=>e.$router.replace("/user/sign-in")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("вход в систему")])),_:1})]))])),(0,i.Wm)(B,{onIonInfinite:t[4]||(t[4]=e=>L.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{"loading-spinner":"bubbles","loading-text":"Загрузка..."})])),_:1})]})),_:1})}var j=o(4929),L=o(8903),I=o(8764),z=o(7782),C=o(351),x=o(9042);const $={class:"center_chip"},D={class:"center_chip"},U={class:"center_chip"};function O(e,t,o,l,s,r){const a=(0,i.up)("ion-title"),d=(0,i.up)("ion-icon"),u=(0,i.up)("ion-toolbar"),c=(0,i.up)("ion-header"),m=(0,i.up)("ion-avatar"),_=(0,i.up)("ion-text"),h=(0,i.up)("ion-label"),p=(0,i.up)("ion-item"),w=(0,i.up)("ion-chip"),f=(0,i.up)("ion-note"),k=(0,i.up)("ion-skeleton-text"),g=(0,i.up)("ion-button"),y=(0,i.up)("ion-item-group"),v=(0,i.up)("ion-list"),b=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Просмотр задания")])),_:1}),(0,i.Wm)(d,{slot:"end",onClick:t[0]||(t[0]=e=>{r.close()}),icon:l.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[o.orderData?((0,i.wg)(),(0,i.j4)(v,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Курьер "+(0,n.zw)(e.$heap.state.user.user_name),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(p,{lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",$,[(0,i.Wm)(w,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Uk)((0,n.zw)(null===(e=o.orderData)||void 0===e?void 0:e.distance_km),1)]})),_:1})])),_:1})])])),_:1}),(0,i.Wm)(p,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.store_name),1)])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.location_address),1)])),_:1})])),_:1})])),_:1}),r.start_finish_distance_km?((0,i.wg)(),(0,i.j4)(p,{key:0,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",D,[(0,i.Wm)(w,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(r.start_finish_distance_km),1)])),_:1})])),_:1})])])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",U,[(0,i.Wm)(w,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{animated:"",style:{width:"100%"}})])),_:1})])])),_:1})),s.job?((0,i.wg)(),(0,i.j4)(p,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Покупатель")])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>{var e,t;return[(0,i.Uk)((0,n.zw)(null===(e=s.job.finish_location)||void 0===e?void 0:e.location_address)+(0,n.zw)(null===(t=s.job.finish_location)||void 0===t?void 0:t.location_comment),1)]})),_:1})])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Покупатель")])),_:1}),(0,i.Wm)(k,{animated:"",style:{width:"60%"}}),(0,i.Wm)(k,{animated:"",style:{width:"80%"}})])),_:1})])),_:1})),s.job?((0,i.wg)(),(0,i.j4)(y,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{onClick:t[1]||(t[1]=e=>r.deliveryStart()),expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Взять задание")])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})):(0,i.kq)("",!0)])),_:1})],64)}var T={props:["orderData"],components:{IonList:j.q_,IonItemGroup:j.Ub,IonTitle:j.wd,IonButton:j.YG,IonSkeletonText:j.CK,IonNote:j.uN,IonChip:j.hM,IonItem:j.Ie,IonLabel:j.Q$,IonText:j.yW,IonAvatar:j.BJ,IonIcon:j.gu,IonHeader:j.Gu,IonToolbar:j.sr,IonContent:j.W2},setup(){return{storefrontOutline:L.qRG,locationOutline:L.Iv7,flagOutline:L.FMn,closeOutline:L.fID}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){var e,t;return null!==(e=this.job)&&void 0!==e&&e.start_finish_distance?Math.round((null===(t=this.job)||void 0===t?void 0:t.start_finish_distance)/1e3)+"км":"-"}},methods:{async jobGet(){try{let e=await z.Z.api.itemJobGet(this.orderData.order_id);e.finish_location_address=e.finish_location_address.split(",").reverse().join(","),this.job=e}catch(o){var e,t;const i=null===(e=o.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.error;if("notfound"==i)return void this.$flash("Задание не найдено");if("notready"==i)return void this.$flash("Вы заняты или не открыли смену")}},async deliveryStart(){var e,t;const o=null===(e=C.Z.courier)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.courier_id;try{await z.Z.api.itemJobStart(this.orderData.order_id,o),1==this.job.is_shipment?this.$go("/order/shipment-"+this.orderData.order_id):this.$go("/order/order-"+this.orderData.order_id)}catch(l){var i,n;const e=null===(i=l.responseJSON)||void 0===i||null===(n=i.messages)||void 0===n?void 0:n.error;"notfound"==e&&this.$flash("Задание не найдено"),"notready"==e&&this.$flash("Смена курьера не открыта"),"notsearching"!=e&&"idle"!=e||this.$flash("Заданию уже назначен курьер")}x.Z.publish("dismissModal")},close(){x.Z.publish("dismissModal")}}},q=o(3744);const S=(0,q.Z)(T,[["render",O],["__scopeId","data-v-1e3194ea"]]);var J=S;const G={style:{color:"#999"}},M=["href"],Z=["href"];function R(e,t,o,l,s,r){const a=(0,i.up)("ion-item"),d=(0,i.up)("ion-icon"),u=(0,i.up)("ion-list"),c=(0,i.up)("ion-button"),m=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.j4)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[(0,i._)("h4",G,(0,n.zw)(o.job.job_name)+" ["+(0,n.zw)(o.job.stage_label)+"]",1)])),_:1}),(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[(0,i._)("h6",null,"Забрать до "+(0,n.zw)(o.job.start_plan_date),1)])),_:1}),(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{slot:"end",icon:l.square,size:"large",style:(0,n.j5)(`color:${o.job.start_color}`)},null,8,["icon","style"]),(0,i._)("a",{href:`https://yandex.ru/maps/?pt=${o.job.start_longitude},${o.job.start_latitude}&z=19&l=map,trf`,target:"_new",style:{color:"#999"}},(0,n.zw)(o.job.start_address),9,M)])),_:1}),(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[(0,i._)("h6",null,"Привезти до "+(0,n.zw)(o.job.finish_plan_date),1)])),_:1}),(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{slot:"end",icon:l.square,size:"large",style:(0,n.j5)(`color:${o.job.finish_color}`)},null,8,["icon","style"]),(0,i._)("a",{href:`https://yandex.ru/maps/?pt=${o.job.finish_longitude},${o.job.finish_latitude}&z=19&l=map,trf`,target:"_new",style:{color:"#999"}},(0,n.zw)(o.job.finish_address),9,Z)])),_:1}),(0,i.Wm)(a)])),_:1}),"awaited"==o.job.stage?((0,i.wg)(),(0,i.j4)(c,{key:0,onClick:t[0]||(t[0]=e=>r.jobTake()),expand:"block",color:"success"},{default:(0,i.w5)((()=>[(0,i.Uk)("Взять задание")])),_:1})):((0,i.wg)(),(0,i.j4)(c,{key:1,onClick:t[1]||(t[1]=e=>r.itemOpen()),expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Открыть заказ")])),_:1})),(0,i.Wm)(c,{onClick:t[2]||(t[2]=e=>r.close()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)("Закрыть")])),_:1})])),_:1})}var B=o(9755),N=o.n(B),Y={props:["job"],components:{IonList:j.q_,IonButton:j.YG,IonItem:j.Ie,IonIcon:j.gu,IonContent:j.W2},setup(){return{square:L.h62}},data(){return{}},methods:{async jobTake(){try{const e={order_id:this.job.order_id};await N().post(`${this.$heap.state.hostname}DeliveryJob/itemTake`,e),this.itemOpen(),this.$topic.publish("dismissModal"),j.Fy.dismiss(null,"confirm")}catch(o){var e,t;const i=null===(e=o.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.error;"forbidden"==i&&this.$flash("Не хватает прав"),"notfound"==i&&this.$flash("Задание не найдено"),"notready"==i&&this.$flash("Ваш статус должен быть 'ГОТОВ'"),"notsearching"!=i&&"idle"!=i||this.$flash("Заданию уже назначен курьер")}},itemOpen(){1==this.job.is_shipment?this.$go(`/order/shipment-${this.job.order_id}`):this.$go(`/order/order-${this.job.order_id}`)},close(){j.Fy.dismiss(null,"cancel")}}};const A=(0,q.Z)(Y,[["render",R],["__scopeId","data-v-7e8272dd"]]);var F=A,H={components:{IonSegment:j.cJ,IonSegmentButton:j.GO,IonIcon:j.gu,IonAvatar:j.BJ,IonText:j.yW,IonLabel:j.Q$,IonItem:j.Ie,IonList:j.q_,IonChip:j.hM,IonNote:j.uN,IonImg:j.Xz,IonInfiniteScroll:j.ju,IonInfiniteScrollContent:j.MB,IonSkeletonText:j.CK,IonAccordionGroup:j.eh,IonAccordion:j.We},setup(){return{sparklesOutline:L.Fcs,storefrontOutline:L.qRG,timeOutline:L.bdY,ordersIcon:I,rocketOutline:L.G$D,ribbonOutline:L.Muk,checkmarkOutline:L.TjA,informationOutline:L.cQG,banOutline:L.L6S,square:L.h62}},data(){return{jobList:null,routeList:null,orderList:null,orderType:"active",courierJobsInclude:null,clock:null}},computed:{orderListComputed(){for(let e of this.orderList){switch(e.user_role){case"customer":e.icon=I;break;case"admin":e.icon=L.Muk;break;case"courier":e.icon=L.G$D;break;case"supplier":e.icon=L.qRG;break}e.date=this.toLocDate(e.created_at),e.stage_color="customer_cart"==e.stage_current?"light":"primary",e.stage_color="1"==e.is_canceled?"danger":e.stage_color}return this.orderList},jobListComputed(){for(let e of this.jobList)e.location_address||(e.location_address=""),e.distance?e.distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="",e.date_time=this.toLocDateTime(e.created_at);return this.jobList},routeListComputed(){if(!this.routeList)return[];const e={scheduled:"Запланирован",awaited:"Очередь",inited:"Собирается",assigned:"Назначен",started:"В пути"};for(let t of this.routeList){const o=new Date(1e3*(1*t.start_plan+1*t.finish_arrival_time)),i=new Date(1e3*t.start_plan);t.start_plan_date=i.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"}),t.finish_plan_date=o.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"}),t.stage_label=e[t.stage]||"-",t.stage_color=["scheduled","awaited"].includes(t.stage)?"light":"primary",t.is_courier_job=1}return this.routeList}},mounted(){this.$topic.on("courierStatusChange",(()=>{this.courierReadinessCheck()})),this.$topic.on("userGet",(()=>{this.listLoad(this.orderType,"reload")})),this.courierReadinessCheck()},methods:{toLocDate(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,o)},toLocDateTime(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,o)},courierReadinessCheck(){this.courierJobsInclude=C.Z.courier.isCourier()||C.Z.isAdmin(),0==this.courierJobsInclude&&(this.orderType="active")},async listLoad(e,t="reload"){var o;if("jobs"==e)return this.autoReload(e),void this.listJobLoad();let i="system_finish";"active"==e&&(this.autoReload(e),i="active_only");const n={order_group_type:i,offset:0,limit:(null===(o=this.orderList)||void 0===o?void 0:o.length)||10};var l,s;"append"==t&&(n.offset=null!==(l=null===(s=this.orderList)||void 0===s?void 0:s.length)&&void 0!==l?l:0,n.limit=10);let r=await z.Z.api.listLoad(n);var a;(this.orderType=e,"append"==t)&&(null!==(a=this.orderList)&&void 0!==a||(this.orderList=[]),r=this.orderList.concat(r));this.orderList=r,this.jobList=null},async listLoadMore(e){await this.listLoad(this.orderType,"append"),e.target.complete()},listTypeChanged(e){const t=e.target.value;this.orderList=null,this.listLoad(t)},async listJobLoad(){try{var e,t;const o=null===(e=C.Z.courier)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.courier_id;this.jobList=await z.Z.api.listJobGet(o),this.orderList=null,this.listRouteLoad()}catch(n){var o,i;const e=null===(o=n.responseJSON)||void 0===o||null===(i=o.messages)||void 0===i?void 0:i.error;"notready"==e&&(C.Z.courier.status="notready",this.courierReadinessCheck())}},async listRouteLoad(){try{const e={};this.routeList=await N().post(`${this.$heap.state.hostname}DeliveryJob/listGet`,e)}catch(o){var e,t;null===(e=o.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t||t.error}},autoReload(e){clearTimeout(this.clock);const t=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((()=>{this.listLoad(this.orderType)}),t))},ionViewDidEnter(){this.courierReadinessCheck(),this.listLoad(this.orderType)},ionViewDidLeave(){clearTimeout(this.clock)},async itemClickConfirm(e){const t=await j.Fy.create({component:F,componentProps:{job:e},initialBreakpoint:.5,breakpoints:[.5]});this.$topic.on("dismissModal",(()=>{t.dismiss()})),await t.present();const{data:o,role:i}=await t.onDidDismiss();"confirm"==i&&this.itemOpen(e.order_id,e.is_shipment)},async itemClick(e){if(e.is_courier_job){const t=await j.Fy.create({component:J,componentProps:{orderData:e},initialBreakpoint:.6,breakpoints:[0,.6,.75]}),o=function(){t.dismiss()};return x.Z.on("dismissModal",o),t.present()}this.itemOpen(e.order_id,e.is_shipment)},itemOpen(e,t){1==t?this.$go(`/order/shipment-${e}`):this.$go(`/order/order-${e}`)}}};const K=(0,q.Z)(H,[["render",W]]);var V=K}}]);
//# sourceMappingURL=1338.1a080f9e.js.map