"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[746],{4405:function(e,t,o){var r=o(2008);const i={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const t=e.locations[0].distance,o=e.store_time_preparation||0;return i.deliveryTimeCalculate(t,o)},deliveryTimeCalculate(e,t){var o;t=parseInt(null!==(o=t)&&void 0!==o?o:r.Z.getters.settings.delivery.timePreparationDefault);const i=parseInt(r.Z.getters.settings.delivery.timeDelta),n=parseInt(r.Z.getters.settings.delivery.speed),s=5*Math.round(e/n*60/5)+t,l=s>i?s-i:s,a=l+i;return{time:s,timeMin:l,timeMax:a}}};t["Z"]=i},9625:function(e,t,o){o.d(t,{Z:function(){return W}});var r=o(6252),i=o(3577);const n={class:"delivery-adress",style:{"font-size":"1em"}},s={class:"center"},l=(0,r.Uk)("Адрес"),a={class:"center"},d={key:0,class:"delivery-time"},u=(0,r.Uk)("мин"),c=(0,r.Uk)(" Выбрать адрес доставки ");function m(e,t,o,m,p,y){const _=(0,r.up)("ion-text"),h=(0,r.up)("ion-icon"),k=(0,r.up)("ion-note"),f=(0,r.up)("ion-label"),w=(0,r.up)("ion-item"),v=(0,r.up)("ion-textarea");return(0,r.wg)(),(0,r.iD)(r.HY,null,[y.isMainLocationSet?((0,r.wg)(),(0,r.iD)("div",{key:0,onClick:t[0]||(t[0]=e=>y.selectDeliveryAddress()),class:"selector"},[(0,r._)("div",n,[(0,r._)("div",s,[(0,r.Wm)(_,{size:"small",color:"medium"},{default:(0,r.w5)((()=>[l])),_:1}),(0,r.Wm)(h,{icon:m.chevronDownOutline,color:"medium"},null,8,["icon"])]),(0,r._)("div",a,[(0,r.Wm)(h,{slot:"start",color:"secondary",icon:m.location},null,8,["icon"]),(0,r.Wm)(_,{color:"dark"},{default:(0,r.w5)((()=>{var t,o;return[(0,r._)("b",null,(0,i.zw)(null===(t=e.$heap.state.user)||void 0===t||null===(o=t.location_main)||void 0===o?void 0:o.location_address),1)]})),_:1})])]),o.deliveryTime?((0,r.wg)(),(0,r.iD)("div",d,[(0,r.Wm)(_,{style:{"font-size":"24px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(o.deliveryTime.time),1)])),_:1}),(0,r.Wm)(k,{style:{"font-size":"10px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,r.w5)((()=>[u])),_:1})])):(0,r.kq)("",!0)])):((0,r.wg)(),(0,r.j4)(w,{key:1,detail:"",button:"",onClick:t[1]||(t[1]=e=>y.selectDeliveryAddress()),class:"selector"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{slot:"start",style:{color:"var(--ion-color-primary)"},icon:m.location},null,8,["icon"]),(0,r.Wm)(f,null,{default:(0,r.w5)((()=>[c])),_:1})])),_:1})),o.showComment&&e.$heap.state.user.location_main?((0,r.wg)(),(0,r.j4)(w,{key:2},{default:(0,r.w5)((()=>[(0,r.Wm)(v,{placeholder:"комментарий к адресу",onChange:t[2]||(t[2]=e=>y.locationCommentChanged()),modelValue:e.$heap.state.user.location_main.location_comment,"onUpdate:modelValue":t[3]||(t[3]=t=>e.$heap.state.user.location_main.location_comment=t)},null,8,["modelValue"])])),_:1})):(0,r.kq)("",!0)],64)}o(8862);var p=o(3741),y=o(8903),_=o(2008),h=o(5642),k=o(9042),f=o(9755),w=o.n(f),v={props:["deliveryTime","showComment"],components:{IonIcon:p.gu,IonTextarea:p.g2,IonImg:p.Xz,IonText:p.yW,IonNote:p.uN,IonLabel:p.Q$,IonItem:p.Ie},setup(){return{location:y.xhW,chevronDownOutline:y.Y$3}},data(){return{location_main:_.Z.state.user.location_main}},created(){let e=this;k.Z.on("userMainLocationSet",(t=>{e.location_main=t})),k.Z.on("userGet",(t=>{e.location_main=t.location_main}))},methods:{selectDeliveryAddress(){h.Z.push("/user/user-addresses")},async locationCommentChanged(){const e={location_id:_.Z.state.user.location_main.location_id,location_comment:_.Z.state.user.location_main.location_comment};w().post(this.$heap.state.hostname+"Location/itemUpdate",JSON.stringify(e))}},computed:{isSignedIn(){return _.Z.state.user.user_id&&_.Z.state.user.user_id>-1},isMainLocationSet(){return this.location_main?1:0}}},g=o(3744);const C=(0,g.Z)(v,[["render",m],["__scopeId","data-v-77ce2b03"]]);var W=C},4746:function(e,t,o){o.r(t),o.d(t,{default:function(){return we}});var r=o(6252),i=o(3577);const n=e=>((0,r.dD)("data-v-7c3e5f36"),e=e(),(0,r.Cn)(),e),s=(0,r.Uk)("Способы доставки"),l={for:"delivery_by_courier"},a=(0,r.Uk)("Доставит "),d={slot:"end"},u=["checked"],c={for:"delivery_by_store"},m=(0,r.Uk)("Доставит "),p={slot:"end"},y=["checked"],_=n((()=>(0,r._)("label",{for:"pickup_by_customer"},"Самовывоз",-1))),h={slot:"end"},k=["checked"],f=(0,r.Uk)("Способы оплаты"),w=n((()=>(0,r._)("label",{for:"payment_card"},"Оплата картой",-1))),v={slot:"end"},g=["checked"],C=n((()=>(0,r._)("label",{for:"payment_cash"},"Оплата наличными",-1))),W={slot:"end"},I=["checked"],$=n((()=>(0,r._)("label",{for:"payment_cash_store"},"Оплата наличными продавцу",-1))),b={slot:"end"},O=["checked"],R=(0,r.Uk)("Итог"),B=(0,r.Uk)(" Сумма заказа "),S={slot:"start"},T={class:"righttop_badge"},U={slot:"start"},L={class:"righttop_badge"},z=(0,r.Uk)(" Выберите скидку "),D=(0,r.Uk)(" Доставка "),x=(0,r.Uk)(" Итого к оплате "),q=(0,r.Uk)(" Я согласен(на) с "),j=(0,r.Uk)("офертой об оказании услуг доставки"),G=(0,r.Uk)("Вернуться"),Z=(0,r.Uk)("Продолжить");function P(e,t,o,n,P,A){const M=(0,r.up)("user-address-widget"),N=(0,r.up)("ion-item-divider"),F=(0,r.up)("ion-textarea"),V=(0,r.up)("ion-item"),H=(0,r.up)("ion-icon"),Y=(0,r.up)("ion-text"),E=(0,r.up)("ion-badge"),J=(0,r.up)("router-link"),K=(0,r.up)("ion-checkbox"),X=(0,r.up)("ion-list"),Q=(0,r.up)("ion-card-content"),ee=(0,r.up)("ion-card"),te=(0,r.up)("ion-col"),oe=(0,r.up)("ion-row"),re=(0,r.up)("ion-button"),ie=(0,r.up)("ion-grid"),ne=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(ne,{pageTitle:"Оформление заказа",pageDefaultBackLink:"/order/order-list"},{default:(0,r.w5)((()=>[(0,r.Wm)(M,{deliveryTime:P.deliveryTime,showComment:"1"},null,8,["deliveryTime"]),P.order?((0,r.wg)(),(0,r.j4)(X,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(N,null,{default:(0,r.w5)((()=>{var e,t;return[(0,r.Uk)("Заказ #"+(0,i.zw)(null===(e=P.order)||void 0===e?void 0:e.order_id)+' из "'+(0,i.zw)(null===(t=P.order)||void 0===t?void 0:t.store.store_name)+'"',1)]})),_:1}),(0,r.Wm)(V,null,{default:(0,r.w5)((()=>[(0,r.Wm)(F,{rows:"3",placeholder:"комментарий к заказу",onChange:t[0]||(t[0]=e=>A.orderDescriptionChanged()),modelValue:P.order.order_description,"onUpdate:modelValue":t[1]||(t[1]=e=>P.order.order_description=e)},null,8,["modelValue"])])),_:1}),P.storeIsReady?((0,r.wg)(),(0,r.j4)(N,{key:0},{default:(0,r.w5)((()=>[s])),_:1})):(0,r.kq)("",!0),A.deliveryByCourierRule?((0,r.wg)(),(0,r.j4)(V,{key:1,button:"",onClick:t[2]||(t[2]=e=>A.tariffRuleSet(A.deliveryByCourierRule))},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),(0,r._)("label",l,[a,(0,r._)("b",null,(0,i.zw)(e.$heap.state.settings.app_title),1)]),(0,r._)("div",d,[(0,r._)("input",{type:"radio",name:"deliveryBy",id:"delivery_by_courier",value:"courier",checked:A.deliveryByCourierRuleChecked},null,8,u)])])),_:1})):(0,r.kq)("",!0),A.deliveryByStoreRule?((0,r.wg)(),(0,r.j4)(V,{key:2,button:"",onClick:t[3]||(t[3]=e=>A.tariffRuleSet(A.deliveryByStoreRule))},{default:(0,r.w5)((()=>{var e;return[(0,r.Wm)(H,{icon:n.rocketOutline,slot:"start"},null,8,["icon"]),(0,r._)("label",c,[m,(0,r._)("b",null,(0,i.zw)(null===(e=P.order)||void 0===e?void 0:e.store.store_name),1)]),(0,r._)("div",p,[(0,r._)("input",{type:"radio",name:"deliveryBy",id:"delivery_by_store",value:"store",checked:A.deliveryByStoreRuleChecked},null,8,y)])]})),_:1})):(0,r.kq)("",!0),A.pickupByCustomerRule?((0,r.wg)(),(0,r.j4)(V,{key:3,button:"",onClick:t[4]||(t[4]=e=>A.tariffRuleSet(A.pickupByCustomerRule))},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.storefrontOutline,slot:"start"},null,8,["icon"]),_,(0,r._)("div",h,[(0,r._)("input",{type:"radio",name:"deliveryBy",id:"pickup_by_customer",value:"store",checked:A.pickupByCustomerRuleChecked},null,8,k)])])),_:1})):(0,r.kq)("",!0),P.storeIsReady?((0,r.wg)(),(0,r.j4)(N,{key:4},{default:(0,r.w5)((()=>[f])),_:1})):(0,r.kq)("",!0),1==P.tariffRule.paymentByCard?((0,r.wg)(),(0,r.j4)(V,{key:5,button:"",onClick:t[5]||(t[5]=e=>P.paymentType="use_card")},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.cardOutline,slot:"start",color:"primary"},null,8,["icon"]),w,(0,r._)("div",v,[(0,r._)("input",{type:"radio",name:"paymentType",id:"payment_card",value:"card",checked:"use_card"==P.paymentType},null,8,g)])])),_:1})):(0,r.kq)("",!0),1==P.tariffRule.paymentByCash?((0,r.wg)(),(0,r.j4)(V,{key:6,button:"",onClick:t[6]||(t[6]=e=>P.paymentType="use_cash")},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),C,(0,r._)("div",W,[(0,r._)("input",{type:"radio",name:"paymentType",id:"payment_cash",value:"cash",checked:"use_cash"==P.paymentType},null,8,I)])])),_:1})):(0,r.kq)("",!0),1==P.tariffRule.paymentByCashStore?((0,r.wg)(),(0,r.j4)(V,{key:7,button:"",onClick:t[7]||(t[7]=e=>P.paymentType="use_cash_store")},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),$,(0,r._)("div",b,[(0,r._)("input",{type:"radio",name:"paymentType",id:"payment_cash_store",value:"cash",checked:"use_cash_store"==P.paymentType},null,8,O)])])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(N,null,{default:(0,r.w5)((()=>[R])),_:1}),(0,r.Wm)(V,null,{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.cubeOutline,slot:"start",color:"primary"},null,8,["icon"]),B,(0,r.Wm)(Y,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(P.order.order_sum_product)+(0,i.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),P.promo?((0,r.wg)(),(0,r.j4)(V,{key:8,button:"",onClick:t[8]||(t[8]=e=>A.promoPick()),color:"success"},{default:(0,r.w5)((()=>[(0,r._)("div",S,[(0,r.Wm)(H,{icon:n.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,r._)("sup",T,[P.promoCount>0?((0,r.wg)(),(0,r.j4)(E,{key:0,color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(P.promoCount),1)])),_:1})):(0,r.kq)("",!0)])]),(0,r.Uk)(" "+(0,i.zw)(P.promo.promo_name)+" ",1),(0,r.Wm)(Y,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)("-"+(0,i.zw)(P.order.order_sum_promo)+(0,i.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):((0,r.wg)(),(0,r.j4)(V,{key:9,button:"",detail:"",onClick:t[9]||(t[9]=e=>A.promoPick())},{default:(0,r.w5)((()=>[(0,r._)("div",U,[(0,r.Wm)(H,{icon:n.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,r._)("sup",L,[P.promoCount>0?((0,r.wg)(),(0,r.j4)(E,{key:0,color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(P.promoCount),1)])),_:1})):(0,r.kq)("",!0)])]),z])),_:1})),P.order_sum_delivery>0?((0,r.wg)(),(0,r.j4)(V,{key:10},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),D,(0,r.Wm)(Y,{slot:"end"},{default:(0,r.w5)((()=>{var t;return[(0,r.Uk)((0,i.zw)(null!==(t=P.order_sum_delivery)&&void 0!==t?t:0)+(0,i.zw)(e.$heap.state.currencySign),1)]})),_:1})])),_:1})):(0,r.kq)("",!0),A.order_sum_total>0?((0,r.wg)(),(0,r.j4)(V,{key:11},{default:(0,r.w5)((()=>[(0,r.Wm)(H,{icon:n.walletOutline,slot:"start",color:"primary"},null,8,["icon"]),x,(0,r.Wm)(Y,{slot:"end"},{default:(0,r.w5)((()=>[(0,r._)("b",null,(0,i.zw)(A.order_sum_total),1),(0,r.Uk)((0,i.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(V,{lines:"none"},{default:(0,r.w5)((()=>[(0,r.Wm)(Y,{style:{"font-size":"0.9em"}},{default:(0,r.w5)((()=>[q,(0,r.Wm)(J,{to:"/page/rules-customer"},{default:(0,r.w5)((()=>[j])),_:1})])),_:1}),(0,r.Wm)(K,{slot:"end",modelValue:P.termsAccepted,"onUpdate:modelValue":t[10]||(t[10]=e=>P.termsAccepted=e)},null,8,["modelValue"])])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(ie,null,{default:(0,r.w5)((()=>[A.checkoutError?((0,r.wg)(),(0,r.j4)(oe,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(te,null,{default:(0,r.w5)((()=>[(0,r.Wm)(ee,{color:"warning"},{default:(0,r.w5)((()=>[(0,r.Wm)(Q,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(A.checkoutError),1)])),_:1})])),_:1})])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(oe,null,{default:(0,r.w5)((()=>[(0,r.Wm)(te,null,{default:(0,r.w5)((()=>[(0,r.Wm)(re,{expand:"block",color:"medium",onClick:t[11]||(t[11]=e=>A.cancel())},{default:(0,r.w5)((()=>[G])),_:1})])),_:1}),(0,r.Wm)(te,null,{default:(0,r.w5)((()=>[(0,r.Wm)(re,{expand:"block",onClick:t[12]||(t[12]=e=>A.proceed()),disabled:A.checkoutError},{default:(0,r.w5)((()=>[Z])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})])),_:1})}o(8862);var A=o(7782),M=o(4405),N=o(9042),F=o(5642),V=o(9755),H=o.n(V),Y=o(8764),E=o(8903),J=o(3741),K=o(9625);const X=(0,r.Uk)("Оплата картой"),Q=["src"],ee={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},te=["src"];function oe(e,t,o,i,n,s){const l=(0,r.up)("ion-title"),a=(0,r.up)("ion-icon"),d=(0,r.up)("ion-toolbar"),u=(0,r.up)("ion-header"),c=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Wm)(l,{slot:"start"},{default:(0,r.w5)((()=>[X])),_:1}),(0,r.Wm)(a,{icon:i.closeOutline,onClick:t[0]||(t[0]=e=>{i.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r._)("iframe",{src:n.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"calc( 100% - 5px )",border:"none"},onLoad:t[1]||(t[1]=e=>s.onLoad())},null,40,Q),n.loadAnimation?((0,r.wg)(),(0,r.iD)("div",ee,[(0,r._)("img",{src:i.loading},null,8,te)])):(0,r.kq)("",!0)])),_:1})],64)}var re=o(659),ie={components:{IonTitle:J.wd,IonIcon:J.gu,IonToolbar:J.sr,IonHeader:J.Gu,IonContent:J.W2},props:["order_data"],setup(){const e=function(){J.Fy.dismiss()};return{closeModal:e,closeOutline:E.fID,loading:re}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{async postToIframe(){try{this.paymentLink=await H().post(this.$heap.state.hostname+"CardAcquirer/paymentLinkGet",this.order_data)}catch(e){this.$flash("Нет возможности принять оплату картой"),this.closeModal()}},onLoad(){this.loadAnimation=0},listenFrame(){let e=this;window.addEventListener("message",(t=>{"paymentOk"!=t.data&&"paymentNo"!=t.data||e.closeModal()}))}}},ne=o(3744);const se=(0,ne.Z)(ie,[["render",oe]]);var le=se;const ae=(0,r.Uk)("Ваши доступные скидки"),de=(0,r.Uk)("Без скидки"),ue=(0,r.Uk)("К сожалению, доступных скидок нет."),ce=(0,r.Uk)("Показать все ваши скидки "),me={key:0};function pe(e,t,o,n,s,l){const a=(0,r.up)("ion-title"),d=(0,r.up)("ion-icon"),u=(0,r.up)("ion-toolbar"),c=(0,r.up)("ion-header"),m=(0,r.up)("ion-skeleton-text"),p=(0,r.up)("ion-item"),y=(0,r.up)("ion-list"),_=(0,r.up)("ion-text"),h=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(u,{color:"secondary"},{default:(0,r.w5)((()=>[(0,r.Wm)(a,null,{default:(0,r.w5)((()=>[ae])),_:1}),(0,r.Wm)(d,{icon:n.closeOutline,onClick:t[0]||(t[0]=t=>e.$topic.publish("dismissModal")),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,r.Wm)(h,null,{default:(0,r.w5)((()=>[null==s.promoList?((0,r.wg)(),(0,r.j4)(y,{key:0},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.iD)(r.HY,null,(0,r.Ko)([1,2,3],(e=>(0,r.Wm)(p,{lines:"none",key:e},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:n.giftOutline,color:"primary"},null,8,["icon"]),(0,r.Wm)(m,{style:{width:"70%"}}),(0,r.Wm)(m,{slot:"end",style:{width:"50px"}})])),_:2},1024))),64))])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(y,null,{default:(0,r.w5)((()=>{var o;return[null!==(o=s.promoList)&&void 0!==o&&o.length?((0,r.wg)(),(0,r.j4)(p,{key:0,button:"",onClick:t[1]||(t[1]=e=>l.promoPick({}))},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:n.banOutline,color:"danger"},null,8,["icon"]),(0,r.Wm)(_,null,{default:(0,r.w5)((()=>[de])),_:1}),(0,r.Wm)(_,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Uk)("0"+(0,i.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):((0,r.wg)(),(0,r.j4)(p,{key:1},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:n.giftOutline,color:"medium"},null,8,["icon"]),(0,r.Wm)(_,{color:"medium"},{default:(0,r.w5)((()=>[ue])),_:1})])),_:1})),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.promoList,(t=>((0,r.wg)(),(0,r.j4)(p,{key:t.promo_id,button:"",onClick:e=>l.promoPick(t)},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{slot:"start",icon:n.giftOutline,color:"primary"},null,8,["icon"]),(0,r.Wm)(_,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(t.promo_name),1)])),_:2},1024),(0,r.Wm)(_,{slot:"end",color:"success"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(t.promo_value)+(0,i.zw)(e.$heap.state.currencySign),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),(0,r.Wm)(p,{button:"",detail:"",onClick:t[2]||(t[2]=t=>{e.$router.push("/user/user-promo"),e.$topic.publish("dismissModal")})},{default:(0,r.w5)((()=>[(0,r.Wm)(_,null,{default:(0,r.w5)((()=>{var e;return[ce,null!==(e=s.promoList)&&void 0!==e&&e.length?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("span",me,"или получить ещё"))]})),_:1})])),_:1})]})),_:1})])),_:1})],64)}var ye={components:{IonIcon:J.gu,IonToolbar:J.sr,IonHeader:J.Gu,IonContent:J.W2,IonTitle:J.wd,IonList:J.q_,IonItem:J.Ie,IonText:J.yW,IonSkeletonText:J.CK},setup(){return{giftOutline:E._$o,closeOutline:E.fID,banOutline:E.L6S}},data(){return{promoList:null}},mounted(){this.listGet()},methods:{async listGet(){try{const e={type:"active",user_id:this.$heap.state.user.user_id};this.promoList=await H().post(`${this.$heap.state.hostname}Promo/listGet`,e)}catch(e){}},promoPick(e){J.Fy.dismiss(e)}}};const _e=(0,ne.Z)(ye,[["render",pe]]);var he=_e,ke={components:{UserAddressWidget:K.Z,IonTextarea:J.g2,IonItemDivider:J.rH,IonIcon:J.gu,IonItem:J.Ie,IonList:J.q_,IonText:J.yW,IonButton:J.YG,IonCol:J.wI,IonRow:J.Nd,IonGrid:J.jY,IonCheckbox:J.nz,IonCard:J.PM,IonCardContent:J.FN,IonBadge:J.yp},setup(){return{cardOutline:E.pvm,cashOutline:E.zaw,giftOutline:E._$o,cubeOutline:E.XFf,walletOutline:E.S5P,pieChartOutline:E.qlh,storefrontOutline:E.qRG,ordersIcon:Y,rocketOutline:E.G$D,documentTextOutline:E.L82}},data(){return{order:null,order_sum_delivery:0,promo:null,promoCount:0,deliveryTime:{},termsAccepted:1,storeIsReady:0,errNotfound:0,paymentType:"use_card",tariffRule:{},tariffRuleList:[]}},computed:{checkoutError(){return!!this.order&&(this.order_sum_total<2*this.order.order_sum_promo?`Сумма к оплате со скидкой ${this.order.order_sum_promo}${this.$heap.state.currencySign} должна быть больше чем ${2*this.order.order_sum_promo}${this.$heap.state.currencySign}`:1*this.order.order_sum_product<1*this.order.store.store_minimal_order?`Сумма заказа у "${this.order.store.store_name}" должна быть больше чем ${this.order.store.store_minimal_order}${this.$heap.state.currencySign}`:1*this.order_sum_total<=1*this.order_sum_delivery?`Сумма к оплате должна быть больше чем ${this.order_sum_delivery}${this.$heap.state.currencySign}`:this.order_sum_total<=10?"Сумма к оплате слишком маленькая":0==this.storeIsReady?`К сожалению, "${this.order.store.store_name}" не готов к заказам`:(0==this.termsAccepted||1==this.errNotfound)&&"К сожалению, мы не можем доставить вам заказ, без согласия с условиями")},order_sum_total(){return this.order.order_sum_product-this.order.order_sum_promo+this.order_sum_delivery},deliveryByCourierRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.deliveryByCourier)).shift()},deliveryByCourierRuleChecked(){return 1==this.tariffRule.deliveryByCourier},deliveryByStoreRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.deliveryByStore)).shift()},deliveryByStoreRuleChecked(){return 1==this.tariffRule.deliveryByStore},pickupByCustomerRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.pickupByCustomer)).shift()},pickupByCustomerRuleChecked(){return 1==this.tariffRule.pickupByCustomer}},mounted(){this.checkoutDataGet()},ionViewDidEnter(){this.checkoutDataGet()},methods:{async itemLoad(){try{this.order=await H().post(`${this.$heap.state.hostname}Order/itemGet`,{order_id:this.order.order_id}),0==this.order_sum_delivery&&(this.order_sum_delivery,this.order.order_sum_delivery),this.$heap.commit("setCurrentOrder",this.order)}catch(e){}},async checkoutDataGet(){if(this.order=this.$heap.state.currentOrder,!this.order)return this.$flash("Заказ не найден"),void this.$router.push("/order/order-list");if("customer_confirmed"==this.order.stage_current)try{const e=await H().post(`${this.$heap.state.hostname}Order/itemCheckoutDataGet`,{order_id:this.order.order_id});this.deliveryTime=M.Z.deliveryTimeCalculate(e.Location_distanceHolderGet,null),this.promo=e.Promo_itemLinkGet,this.promoCount=e.Promo_listGet,this.storeIsReady=Array.isArray(e.Store_deliveryOptions)?1:0,this.tariffRuleList=e.Store_deliveryOptions,this.tariffRuleSet(this.tariffRuleList[0]||{})}catch(e){const t=null===e||void 0===e?void 0:e.responseJSON;if(!t)return!1;const o=t.messages.error;switch(o){case"not_ready":this.storeIsReady=0;break;case"no_tariff":this.storeIsReady=0;break;default:this.errNotfound=1}return!1}else F.Z.push("order-"+this.order.order_id)},tariffRuleSet(e){this.tariffRule=e,this.order_sum_delivery=e.order_sum_delivery,this.paymentType="use_card",1==e.paymentByCashStore?this.paymentType="use_cash_store":1==e.paymentByCash&&(this.paymentType="use_cash")},async orderDescriptionChanged(){const e={order_id:this.order.order_id,order_description:this.order.order_description};A.Z.api.itemUpdate(e)},async proceed(){const e={order_id:this.order.order_id,tariff_id:this.tariffRule.tariff_id,deliveryByStore:this.deliveryByStoreRuleChecked?1:0,deliveryByCourier:this.deliveryByCourierRuleChecked?1:0,pickupByCustomer:this.pickupByCustomerRuleChecked?1:0,paymentByCard:"use_card"==this.paymentType?1:0,paymentByCash:"use_cash"==this.paymentType?1:0,paymentByCashStore:"use_cash_store"==this.paymentType?1:0};try{await H().post(`${this.$heap.state.hostname}Order/itemCheckoutDataSet`,JSON.stringify(e))}catch(t){const e=null===t||void 0===t?void 0:t.responseJSON;if(!e)return!1;e.messages.error;return this.$flash("С заказом возникла проблема"),!1}console.log(e)},async cancel(){this.$router.push("order-"+this.order.order_id)},async paymentFormOpen(e){const t=this,o=await J.Fy.create({component:le,componentProps:{order_data:e},initialBreakpoint:.85,breakpoints:[0,.85,.95]}),r=function(){o.dismiss()};return N.Z.on("dismissModal",r),o.onDidDismiss().then((()=>{t.paymentStatusCheck()})),o.present()},async paymentStatusCheck(){const e={order_id:this.order.order_id};try{const t=await H().post(this.$heap.state.hostname+"CardAcquirer/statusGet",e);"OK"==t&&F.Z.push("order-"+this.order.order_id)}catch(r){var t,o;this.$flash("Данный заказ не может быть оплачен");const e=null===(t=r.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;"wrong_status"==e&&F.Z.push("order-"+this.order.order_id)}},async promoPick(){var e;const t=await J.Fy.create({component:he,showBackdrop:!0,backdropDismiss:!0,initialBreakpoint:.6,breakpoints:[0,.6,.75]});t.present(),this.$topic.on("dismissModal",(()=>{t.dismiss()}));const o=await t.onDidDismiss();this.promoLink(o.data),null!==o&&void 0!==o&&null!==(e=o.data)&&void 0!==e&&e.promo_id?this.promo=o.data:this.promo=null},async promoLink(e){try{const t={promo_id:null===e||void 0===e?void 0:e.promo_id,order_id:this.order.order_id};await H().post(`${this.$heap.state.hostname}Promo/itemLink`,t),this.itemLoad()}catch(t){}},async promoGet(){try{const e={order_id:this.order.order_id};return await H().post(`${this.$heap.state.hostname}Promo/itemLinkGet`,e)}catch(e){}},async promoCountGet(){try{const e={mode:"count",type:"active",user_id:this.$heap.state.user.user_id};return await H().post(`${this.$heap.state.hostname}Promo/listGet`,e)}catch(e){}}}};const fe=(0,ne.Z)(ke,[["render",P],["__scopeId","data-v-7c3e5f36"]]);var we=fe},659:function(e,t,o){e.exports=o.p+"img/loading.30880178.svg"}}]);
//# sourceMappingURL=746.1760b6a1.js.map