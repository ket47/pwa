"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[9519],{9519:function(e,t,l){l.r(t),l.d(t,{default:function(){return _}});var i=l(6252),a=l(3577);function n(e,t,l,n,u,o){const s=(0,i.up)("ion-icon"),r=(0,i.up)("ion-label"),m=(0,i.up)("ion-item"),d=(0,i.up)("ion-list"),c=(0,i.up)("ion-title"),p=(0,i.up)("ion-button"),g=(0,i.up)("ion-buttons"),_=(0,i.up)("ion-toolbar"),f=(0,i.up)("ion-header"),h=(0,i.up)("ion-input"),w=(0,i.up)("ion-textarea"),k=(0,i.up)("image-tile-comp"),W=(0,i.up)("ion-select-option"),M=(0,i.up)("ion-select"),b=(0,i.up)("ion-col"),I=(0,i.up)("ion-row"),v=(0,i.up)("ion-grid"),V=(0,i.up)("ion-content"),U=(0,i.up)("ion-modal"),O=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(O,{pageDefaultBackLink:"/user","page-title":"Рассылка"},{default:(0,i.w5)((()=>{var e;return[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,{button:"",onClick:t[0]||(t[0]=e=>o.itemCreate())},{default:(0,i.w5)((()=>[(0,i.Wm)(s,{slot:"start",src:n.addOutline},null,8,["src"]),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить Рассылку")])),_:1})])),_:1})])),_:1}),(null===(e=u.mailingList)||void 0===e?void 0:e.length)>0?((0,i.wg)(),(0,i.j4)(d,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(u.mailingList,(e=>((0,i.wg)(),(0,i.j4)(m,{key:e.mailing_id,onClick:t=>o.itemGet(e.mailing_id)},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("#"+(0,a.zw)(e.mailing_id)+" "+(0,a.zw)(e.subject_template),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(U,{ref:"modal",onWillDismiss:t[13]||(t[13]=e=>u.isMailingOpen=!1),"is-open":u.isMailingOpen,"initial-breakpoint":.75,breakpoints:[.75,1]},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Рассылка #"+(0,a.zw)(u.currentMailing.mailing_id),1)])),_:1}),(0,i.Wm)(g,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{onClick:t[1]||(t[1]=e=>u.isMailingOpen=!1)},{default:(0,i.w5)((()=>[(0,i.Wm)(s,{src:n.closeOutline},null,8,["src"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.Wm)(V,{class:"ion-padding"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>{var e,l;return[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:u.currentMailing.user_filter.phones,"onUpdate:modelValue":t[2]||(t[2]=e=>u.currentMailing.user_filter.phones=e),label:"Телефоны получателей","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:u.currentMailing.subject_template,"onUpdate:modelValue":t[3]||(t[3]=e=>u.currentMailing.subject_template=e),label:"Тема","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:u.currentMailing.text_template,"onUpdate:modelValue":t[4]||(t[4]=e=>u.currentMailing.text_template=e),label:"Сообщение","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(k,{images:null===(e=u.currentMailing)||void 0===e?void 0:e.images,image_holder:"mailing",image_holder_id:null===(l=u.currentMailing)||void 0===l?void 0:l.mailing_id,hide_if_empty:"true",controller:"Admin/Mailing",ref:"mailingImgs"},null,8,["images","image_holder_id"]),(0,i.Wm)(m,{lines:"none",onClick:t[5]||(t[5]=e=>this.$refs.mailingImgs.take_photo())},{default:(0,i.w5)((()=>[(0,i.Wm)(s,{src:n.addOutline,slot:"start"},null,8,["src"]),(0,i.Uk)(" Добавить фото ")])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:u.currentMailing.link,"onUpdate:modelValue":t[6]||(t[6]=e=>u.currentMailing.link=e),label:"Link","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(M,{label:"Транспорт","label-placement":"stacked",modelValue:u.currentMailing.transport,"onUpdate:modelValue":t[7]||(t[7]=e=>u.currentMailing.transport=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{value:"push"},{default:(0,i.w5)((()=>[(0,i.Uk)("Push")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(M,{label:"Рингтон","label-placement":"stacked",modelValue:u.currentMailing.sound,"onUpdate:modelValue":t[8]||(t[8]=e=>u.currentMailing.sound=e),value:"default"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{value:""},{default:(0,i.w5)((()=>[(0,i.Uk)("-")])),_:1}),(0,i.Wm)(W,{value:"default"},{default:(0,i.w5)((()=>[(0,i.Uk)("стандарт")])),_:1}),(0,i.Wm)(W,{value:"short.wav"},{default:(0,i.w5)((()=>[(0,i.Uk)("Короткий")])),_:1}),(0,i.Wm)(W,{value:"medium.wav"},{default:(0,i.w5)((()=>[(0,i.Uk)("Средний")])),_:1}),(0,i.Wm)(W,{value:"long.wav"},{default:(0,i.w5)((()=>[(0,i.Uk)("Длинный")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:u.currentMailing.start_at,"onUpdate:modelValue":t[9]||(t[9]=e=>u.currentMailing.start_at=e),type:"datetime-local",label:"Начало запуска","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{onClick:t[10]||(t[10]=e=>o.itemDelete()),color:"danger",fill:"clear",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:1}),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{onClick:t[11]||(t[11]=e=>o.itemUpdate()),expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Сохранить")])),_:1})])),_:1}),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{onClick:t[12]||(t[12]=e=>o.itemStart()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(s,{slot:"start",src:n.playOutline},null,8,["src"]),(0,i.Uk)(" Запустить ")])),_:1})])),_:1})])),_:1})])),_:1})]})),_:1})])),_:1})])),_:1},8,["is-open"])]})),_:1})}l(8862);var u=l(2824),o=l(8903),s=l(4405),r=l(9755),m=l.n(r),d=l(8095),c={components:{ImageTileComp:d.Z,IonList:u.q_,IonItem:u.Ie,IonLabel:u.Q$,IonIcon:u.gu,IonModal:u.ki,IonHeader:u.Gu,IonToolbar:u.sr,IonButtons:u.Sm,IonTitle:u.wd,IonButton:u.YG,IonContent:u.W2,IonInput:u.pK,IonTextarea:u.g2,IonSelect:u.t9,IonSelectOption:u.n0,IonGrid:u.jY,IonRow:u.Nd,IonCol:u.wI},setup(){return{addOutline:o.s6O,refreshOutline:o.D3P,imageOutline:o.Eu9,closeOutline:o.fID,playOutline:o.AO3}},data(){return{currentMailing:{},mailingList:null,isMailingOpen:!1}},computed:{},methods:{async itemCreate(){const e={subject_template:"new mailing"};try{const t=await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemCreate`,e);this.itemGet(t)}catch(t){}},async itemGet(e){const t={mailing_id:e};try{var l;const e=await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemGet`,t);null!==(l=e.user_filter)&&void 0!==l||(e.user_filter={}),this.currentMailing=e,this.isMailingOpen=!0}catch(i){}},async itemUpdate(){const e=this.currentMailing;try{await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemUpdate`,JSON.stringify(e)),this.isMailingOpen=!1,this.listGet()}catch(t){}},async itemDelete(){if(!confirm("Вы уверенны?"))return;const e={mailing_id:this.currentMailing.mailing_id};try{await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemDelete`,e),this.isMailingOpen=!1,this.listGet()}catch(t){}},itemValidate(){if(this.currentMailing.start_at)if(this.currentMailing.user_filter.phones)if(this.currentMailing.subject_template)if(this.currentMailing.text_template){if(this.currentMailing.transport)return!0;alert("Транспорт не заполнен")}else alert("Содержание не заполнено");else alert("Заголовок не заполнен");else alert("Получатели не заполнены");else alert("Начало рассылки не заполнено")},async itemStart(){if(!this.itemValidate()||!confirm(`Запустить рассылку в ${this.currentMailing.start_at}?`))return;const e={mailing_id:this.currentMailing.mailing_id};try{await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemStart`,e),this.isMailingOpen=!1,this.listGet()}catch(t){}},async listGet(){this.mailingList=await s.Z.prePost(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{});try{this.mailingList=await s.Z.post(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{})}catch(e){console.log(e)}}},ionViewDidEnter(){this.listGet()},mounted(){this.listGet()}},p=l(3744);const g=(0,p.Z)(c,[["render",n],["__scopeId","data-v-9a2b530e"]]);var _=g}}]);
//# sourceMappingURL=9519.cdff9ed0.js.map