{"version":3,"file":"js/2107.b06c3c6b.js","mappings":"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","sources":["webpack://Tezkel/./src/views/UserVerifyPhone.vue","webpack://Tezkel/./src/views/UserVerifyPhone.vue?cefe"],"sourcesContent":["<template>\r\n  <base-layout page-title=\"Подтверждение телефона\" pageDefaultBackLink=\"/user\">\r\n      <ion-card color=\"light\">\r\n        <ion-card-header>\r\n          <ion-card-title color=\"primary\">\r\n            Подтверждение номера телефона\r\n          </ion-card-title>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          <p>Мы выслали вам смс с кодом подтверждения на номер <b>{{user_phone}}</b>. Введите 4 цифры из смс ниже</p>\r\n          <hr/>\r\n          <p>Поступление СМС на ваш телефон может занять до 2 минут.</p>\r\n        </ion-card-content>\r\n      </ion-card>\r\n\r\n      <form novalidate>\r\n        <ion-list>\r\n          <ion-item>\r\n                <ion-input\r\n                  v-model=\"verification_code\"\r\n                  type=\"numeric\"\r\n                  inputmode=\"numeric\"\r\n                  maxlength=\"4\"\r\n                  pattern=\"\\d{4}\"\r\n                  placeholder=\"- - - -\"\r\n                  enterkeyhint=\"go\"\r\n                  required\r\n                  autocomplete=\"one-time-code\"\r\n                  label=\"Код подтверждения из смс\"\r\n                  label-placement=\"stacked\"\r\n                ></ion-input>\r\n          </ion-item>\r\n        </ion-list>\r\n\r\n        <ion-row responsive-sm>\r\n          <ion-col>\r\n            <ion-button @click=\"onSubmit()\" expand=\"block\">Подтвердить</ion-button>\r\n          </ion-col>\r\n        </ion-row>\r\n\r\n        <ion-row responsive-sm>\r\n          <ion-col>\r\n            <ion-button @click=\"is_sent=false;smsSend()\" expand=\"block\" color=\"light\" :disabled=\"timeToResend>0\">Послать снова {{timeLeft}}</ion-button>\r\n          </ion-col>\r\n        </ion-row>\r\n      </form>\r\n  </base-layout>\r\n</template>\r\n\r\n<script>\r\nimport { \r\n  IonCol,\r\n  IonInput,\r\n  IonRow,\r\n  IonButton,\r\n  IonCard,\r\n  IonCardHeader,\r\n  IonCardTitle,\r\n  IonCardContent,\r\n  IonItem,\r\n  IonList,\r\n}                     from '@ionic/vue';\r\nimport jQuery         from \"jquery\";\r\nimport User           from '@/scripts/User.js';\r\n\r\nexport default  {\r\n  name:'UserVerifyPhone',\r\n  components:{\r\n  IonCol,\r\n  IonInput,\r\n  IonRow,\r\n  IonButton,\r\n  IonCard,\r\n  IonCardHeader,\r\n  IonCardTitle,\r\n  IonCardContent,\r\n  IonItem,\r\n  IonList,\r\n  },\r\n  data(){\r\n    return {\r\n      verification_code:null,\r\n      user_phone:this.$heap.state.user.tmp_userphone||this.$route.params.user_phone||this.$route.query.user_phone||'',//this.$heap.state.user.tmp_userphone seems is more reliable\r\n      is_sent:false,\r\n      timeToResend:120\r\n    }\r\n  },\r\n  async created(){\r\n    this.smsSend();\r\n    if( navigator.credentials ){\r\n      try{\r\n        const otp=await navigator.credentials.get({\r\n          otp: {transport:[\"sms\"]}\r\n        })\r\n        this.verification_code = otp.code\r\n      } catch (err){\r\n        console.log(err)\r\n      }\r\n    }\r\n  },\r\n  ionViewDidEnter(){\r\n    this.smsSend();\r\n  },\r\n  computed:{\r\n    timeLeft(){\r\n      const min=Math.floor(this.timeToResend/60);\r\n      const sec=this.timeToResend-60*min;\r\n      return `${min}:${sec}`\r\n    }\r\n  },\r\n  methods:{\r\n    clockStart(){\r\n      if(this.timeToResend<=0){\r\n        return\r\n      }\r\n      this.timeToResend--\r\n      setTimeout(()=>this.clockStart(),1000)\r\n    },\r\n    async smsSend(){\r\n      if(this.is_sent){\r\n        return\r\n      }\r\n      //this.user_phone=this.$route.params.user_phone||this.$route.query.user_phone||'';\r\n      if(!this.user_phone){\r\n        this.$router.replace('/user')\r\n        return;\r\n      }\r\n      let requestData = {\r\n        user_phone: this.user_phone\r\n      }\r\n      try{\r\n        this.is_sent=true\r\n        await jQuery.post( `${this.$heap.state.hostname}User/phoneVerificationSend`, requestData)\r\n        this.timeToResend=120\r\n        this.clockStart()\r\n      }catch{/** */}\r\n    },\r\n    async onSubmit() {\r\n      if( !this.verification_code || String(this.verification_code).length!=4 ){\r\n        return\r\n      }\r\n      try{\r\n        await jQuery.post( `${this.$heap.state.hostname}/User/phoneVerificationCheck`, {user_phone: this.user_phone, verification_code: this.verification_code})\r\n        this.$flash(\"Номер телефона верифицирован\")\r\n        this.$router.replace('/user')\r\n        await User.autoSignIn()\r\n        this.$go('/catalog')\r\n      } catch(err){\r\n        const message=err.responseJSON.messages.error\r\n        switch(message){\r\n          case 'verification_not_found':\r\n            this.$flash(\"Код верификации устарел\")\r\n            this.$router.replace('/modal/user-authorize')\r\n            break;\r\n        }\r\n        this.$flash(\"Не удалось верифицировать телефон\")\r\n      }\r\n    },\r\n  },\r\n  watch:{\r\n    \"verification_code\":function(newval,oldval){\r\n      this.onSubmit()\r\n    }\r\n  }\r\n}\r\n</script>","import { render } from \"./UserVerifyPhone.vue?vue&type=template&id=83460fa8\"\nimport script from \"./UserVerifyPhone.vue?vue&type=script&lang=js\"\nexport * from \"./UserVerifyPhone.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","novalidate","_createBlock","_component_base_layout","pageDefaultBackLink","default","_withCtx","_createVNode","_component_ion_card","color","_component_ion_card_header","_component_ion_card_title","_createTextVNode","_","_component_ion_card_content","_toDisplayString","$data","user_phone","_hoisted_1","_hoisted_2","_hoisted_3","_component_ion_list","_component_ion_item","_component_ion_input","modelValue","verification_code","_cache","$event","type","inputmode","maxlength","pattern","placeholder","enterkeyhint","required","autocomplete","label","_component_ion_row","_component_ion_col","_component_ion_button","onClick","$options","onSubmit","expand","is_sent","smsSend","disabled","timeToResend","timeLeft","name","components","IonCol","IonInput","IonRow","IonButton","IonCard","IonCardHeader","IonCardTitle","IonCardContent","IonItem","IonList","data","this","$heap","state","user","tmp_userphone","$route","params","query","created","navigator","credentials","otp","get","transport","code","err","console","log","ionViewDidEnter","computed","min","Math","floor","sec","methods","clockStart","setTimeout","$router","replace","requestData","jQuery","hostname","String","length","$flash","User","autoSignIn","$go","message","responseJSON","messages","error","watch","newval","oldval","__exports__","render"],"sourceRoot":""}