"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[488],{488:function(t,o,e){e.r(o),e.d(o,{default:function(){return k}});var i=e(6252),a=e(3577);const n=(0,i.Uk)("Ваше местоположение"),s=(0,i.Uk)("Добавить адрес");function l(t,o,e,l,c,r){const u=(0,i.up)("ion-img"),d=(0,i.up)("ion-label"),h=(0,i.up)("ion-icon"),_=(0,i.up)("ion-item"),p=(0,i.up)("ion-list"),m=(0,i.up)("ion-list-header"),g=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(g,{"page-title":"Мои адреса",pageDefaultBackLink:"/user",ref:"UserAddressPage"},{default:(0,i.w5)((()=>[c.locationList.length?((0,i.wg)(),(0,i.j4)(p,{key:0,lines:"full"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(c.locationList,((o,e)=>((0,i.wg)(),(0,i.j4)(_,{key:o.location_id},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.Wm)(d,{onClick:t=>r.locationSetMain(`${o.location_id}`,`${e}`),style:{"white-space":"normal",cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(o.location_address),1)])),_:2},1032,["onClick"]),(0,i.Wm)(h,{slot:"end",icon:l.trashOutline,onClick:t=>r.locationDelete(`${o.location_id}`,`${e}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:1,lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{button:"",onClick:o[0]||(o[0]=t=>r.locationCurrentSet())},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{slot:"start",color:"primary",icon:l.locationOutline},null,8,["icon"]),(0,i.Wm)(d,{color:"dark"},{default:(0,i.w5)((()=>[n])),_:1})])),_:1})])),_:1})),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[s])),_:1})])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(c.locationGroupList,(o=>((0,i.wg)(),(0,i.j4)(_,{key:o.group_id,onClick:t=>r.modalLocationCreate(`${o.group_id}`,`${o.group_name}`),style:{cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(o.group_name),1)])),_:2},1024),(0,i.Wm)(h,{src:l.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)}e(3948);var c=e(3716),r=e(2395),u=e(2008),d=e(351),h=e(9755),_=e.n(h),p=e(3206),m=e(8903),g={name:"UserAddresses",components:{IonImg:c.Xz,IonLabel:c.Q$,IonItem:c.Ie,IonList:c.q_,IonListHeader:c.yh,IonIcon:c.gu},setup(){return{locationOutline:m.Iv7,trashOutline:m.gtu,addOutline:m.s6O}},mounted(){this.locationListGet()},methods:{async modalLocationCreate(t,o){if(!u.Z.state.user.user_id)return this.$flash("Чтобы добавленные адреса сохранились, пожалуйста войдите в систему"),void r.Z.push("/user/sign-in");var e=String(o).toLowerCase();const i=await c.Fy.create({component:p.Z,showBackdrop:!0,backdropDismiss:!0,canDismiss:!0,cssClass:"update-profile-modal",presentingElement:this.$refs.UserAddressPage.$el,componentProps:{location_group_name_low:e}});return i.onDidDismiss().then((o=>{this.locationCreate(t,o.data)})),i.present()},async locationListGet(){try{var t,o;let e=null;const i=await _().get(u.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=i.location_list,this.locationGroupList=i.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(e=t);if(!e)return void d.Z.get();e&&(null===(t=e)||void 0===t?void 0:t.location_id)!=(null===(o=u.Z.state.user.location_main)||void 0===o?void 0:o.location_id)&&(u.Z.state.user.location_main=e,this.$topic.publish("userMainLocationSet",u.Z.state.user.location_main))}catch{}},async locationCreate(t,o){if(!o)return;let e={location_holder:"user",location_holder_id:u.Z.state.user.user_id,location_group_id:t,location_address:o.location_address,location_latitude:o.location_latitude,location_longitude:o.location_longitude};try{await _().post(u.Z.state.hostname+"User/locationCreate",e),this.$heap.state.next_route&&(this.$router.push(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(i){const t=i.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,o){var e=this,i=e.locationList[o];u.Z.state.user.location_main={location_id:i.location_id,location_latitude:i.location_latitude,location_altitude:i.location_altitude,location_address:i.location_address,image_hash:i.image_hash},r.Z.go(-1),await _().post(u.Z.state.hostname+"User/locationSetMain",{location_id:t}),this.$topic.publish("userMainLocationSet",u.Z.state.user.location_main)},async locationDelete(t,o){try{this.locationList.splice(o,1),await _().post(u.Z.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()},async locationCurrentSet(){await d.Z.geo.locationCurrentGet(),r.Z.go(-1)}},data(){return{locationList:[],locationGroupList:[]}}},w=e(3744);const f=(0,w.Z)(g,[["render",l]]);var k=f}}]);
//# sourceMappingURL=488.9026481b.js.map