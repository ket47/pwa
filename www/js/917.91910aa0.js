"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[917],{6917:function(e,s,o){o.r(s),o.d(s,{default:function(){return Z}});var n=o(6252),t=o(3577),l=o(9963);const a=(0,n.Uk)(" Вы уже вошли в систему с номером телефона "),u={novalidate:""},r={style:{display:"grid","grid-template-columns":"100px auto"}},i=(0,n.Uk)("Код"),p=(0,n.Uk)("+7"),d=(0,n.Uk)("Мобильный телефон*"),h={"padding-left":""},_={"padding-left":""},c=(0,n.Uk)("Пароль (Минимум 4 символа)*"),m={"padding-left":""},f=(0,n.Uk)("Войти"),w=(0,n.Uk)("Зарегистрироваться"),k=(0,n.Uk)("Забыли пароль?");function g(e,s,o,g,W,I){const b=(0,n.up)("ion-card-title"),v=(0,n.up)("ion-card-header"),y=(0,n.up)("ion-card-content"),x=(0,n.up)("ion-card"),$=(0,n.up)("ion-label"),V=(0,n.up)("ion-input"),U=(0,n.up)("ion-text"),C=(0,n.up)("ion-item"),D=(0,n.up)("ion-list"),F=(0,n.up)("ion-button"),O=(0,n.up)("ion-col"),S=(0,n.up)("ion-row"),q=(0,n.up)("ion-grid"),z=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(z,{"page-title":"Вход в систему",pageDefaultBackLink:"/user"},{default:(0,n.w5)((()=>[e.$heap.state.user.user_id>0?((0,n.wg)(),(0,n.j4)(x,{key:0,style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,n.w5)((()=>[(0,n.Wm)(v,null,{default:(0,n.w5)((()=>[(0,n.Wm)(b,{color:"primary"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,t.zw)(e.$heap.state.user.user_name)+" "+(0,t.zw)(e.$heap.state.user.user_surname)+" "+(0,t.zw)(e.$heap.state.user.user_middlename),1)])),_:1})])),_:1}),(0,n.Wm)(y,null,{default:(0,n.w5)((()=>[a,(0,n._)("b",null,(0,t.zw)(e.$heap.state.user.user_phone),1)])),_:1})])),_:1})):(0,n.kq)("",!0),(0,n._)("form",u,[(0,n.Wm)(D,null,{default:(0,n.w5)((()=>[(0,n.Wm)(C,{lines:"full"},{default:(0,n.w5)((()=>[(0,n._)("div",r,[(0,n._)("div",null,[(0,n.Wm)($,{position:"stacked"},{default:(0,n.w5)((()=>[i])),_:1}),(0,n.Wm)(V,{readonly:""},{default:(0,n.w5)((()=>[p])),_:1})]),(0,n._)("div",null,[(0,n.Wm)($,{position:"stacked"},{default:(0,n.w5)((()=>[d])),_:1}),(0,n.Wm)(V,{modelValue:W.user_phone,"onUpdate:modelValue":s[0]||(s[0]=e=>W.user_phone=e),onIonChange:s[1]||(s[1]=e=>I.phoneFormat()),name:"phone",type:"tel",inputmode:"tel",placeholder:"(xxx)xxxxxxxxx",required:""},null,8,["modelValue"]),(0,n.Wm)(U,{color:"danger",slot:"helper"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n._)("p",h,"Неверный номер телефона",512),[[l.F8,!I.phoneValid&&1==W.submitted]])])),_:1})])]),(0,n.Wm)(U,{color:"danger",slot:"helper"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n._)("p",_,"Неверный номер телефона",512),[[l.F8,!I.phoneValid&&1==W.submitted]])])),_:1})])),_:1}),(0,n.Wm)(C,{lines:"full"},{default:(0,n.w5)((()=>[(0,n.Wm)($,{position:"stacked"},{default:(0,n.w5)((()=>[c])),_:1}),(0,n.Wm)(V,{modelValue:W.user_pass,"onUpdate:modelValue":s[2]||(s[2]=e=>W.user_pass=e),name:"password",type:"password",autocorrect:"off",placeholder:"Пароль (Минимум 4 символа)",required:""},null,8,["modelValue"]),(0,n.Wm)(U,{color:"danger",slot:"helper"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n._)("p",m,"Пароль должен содержать не менее 4 символов.",512),[[l.F8,!I.passwordValid&&1==W.submitted]])])),_:1})])),_:1})])),_:1}),(0,n.Wm)(q,null,{default:(0,n.w5)((()=>[(0,n.Wm)(S,{"responsive-sm":""},{default:(0,n.w5)((()=>[(0,n.Wm)(O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(F,{onClick:I.onSubmit,expand:"block"},{default:(0,n.w5)((()=>[f])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,n.Wm)(S,{"responsive-sm":""},{default:(0,n.w5)((()=>[(0,n.Wm)(O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(F,{color:"light",expand:"block",onClick:s[3]||(s[3]=s=>e.$router.push({path:"/user/sign-up"}))},{default:(0,n.w5)((()=>[w])),_:1})])),_:1})])),_:1}),(0,n.Wm)(S,{"responsive-sm":""},{default:(0,n.w5)((()=>[(0,n.Wm)(O,null,{default:(0,n.w5)((()=>[(0,n.Wm)(F,{onClick:I.openModal,color:"light",expand:"block"},{default:(0,n.w5)((()=>[k])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1})}o(5306);var W=o(4852);const I=(0,n.Uk)("Напоминание пароля"),b={novalidate:""},v=(0,n.Uk)("Номер телефона"),y=(0,n.Uk)("Имя пользователя"),x=(0,n.Uk)("Выслать пароль");function $(e,s,o,t,l,a){const u=(0,n.up)("ion-title"),r=(0,n.up)("ion-icon"),i=(0,n.up)("ion-toolbar"),p=(0,n.up)("ion-header"),d=(0,n.up)("ion-label"),h=(0,n.up)("ion-input"),_=(0,n.up)("ion-item"),c=(0,n.up)("ion-list"),m=(0,n.up)("ion-button"),f=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(i,{color:"secondary"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[I])),_:1}),(0,n.Wm)(r,{slot:"end",onClick:s[0]||(s[0]=e=>{a.closeModal()}),icon:t.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n._)("form",b,[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[v])),_:1}),(0,n.Wm)(h,{modelValue:l.userphone,"onUpdate:modelValue":s[1]||(s[1]=e=>l.userphone=e),placeholder:"Ваш телефон"},null,8,["modelValue"])])),_:1}),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[y])),_:1}),(0,n.Wm)(h,{modelValue:l.username,"onUpdate:modelValue":s[2]||(s[2]=e=>l.username=e),placeholder:"Введите имя пользователя..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,n.Wm)(m,{onClick:s[3]||(s[3]=e=>a.passwordReset()),expand:"full"},{default:(0,n.w5)((()=>[x])),_:1})])])),_:1})],64)}var V=o(8903),U=o(9755),C=o.n(U),D={components:{IonContent:W.W2,IonHeader:W.Gu,IonTitle:W.wd,IonToolbar:W.sr,IonList:W.q_,IonItem:W.Ie,IonInput:W.pK,IonButton:W.YG,IonIcon:W.gu,IonLabel:W.Q$},props:["phone"],setup(){return{closeOutline:V.fID}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return W.Fy.dismiss()},async passwordReset(){let e={user_phone:"+"+this.userphone.replace(/\D/g,""),user_name:this.username};try{await C().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$flash(`Ваш новый пароль выслан на номер '${this.userphone}'`)}catch(n){var s,o;const e=null===n||void 0===n||null===(s=n.responseJSON)||void 0===s||null===(o=s.messages)||void 0===o?void 0:o.error;"user_notfound"==e?this.$flash(`Пользователь с телефоном '${this.userphone}' и именем '${this.username}' не найден`):this.$flash("Не удалось восстановить пароль")}this.closeModal()}}},F=o(3744);const O=(0,F.Z)(D,[["render",$]]);var S=O,q=o(351),z=o(1008),M={components:{IonLabel:W.Q$,IonCol:W.wI,IonInput:W.pK,IonRow:W.Nd,IonText:W.yW,IonButton:W.YG,IonGrid:W.jY,IonCard:W.PM,IonCardHeader:W.Zi,IonCardTitle:W.Dq,IonCardContent:W.FN,IonList:W.q_,IonItem:W.Ie},data(){return{submitted:!1,user_pass:null,user_phone:null,user_phone_prefix:"7",modalOpen:!1}},computed:{phoneValid(){var e;return 10==(null===(e=this.user_phone)||void 0===e?void 0:e.replace(/\D/g,"").length)},passwordValid(){var e;return(null===(e=this.user_pass)||void 0===e?void 0:e.length)>=4}},created(){var e;const s=JSON.parse(null!==(e=localStorage.signInData)&&void 0!==e?e:"{}");s&&s.user_phone&&(this.user_phone=s.user_phone,this.phoneFormat()),s&&s.user_pass&&(this.user_pass=s.user_pass)},methods:{async onSubmit(){if(this.submitted=!0,!this.phoneValid||!this.passwordValid)return!1;let e={user_phone:this.user_phone_prefix+this.user_phone,user_pass:this.user_pass,user_pass_confirm:this.user_pass};try{await q.Z.signIn(e),await q.Z.get(),z.Z.go(-1)}catch(s){const e=s.responseJSON,o=e.messages.error;switch(o){case"user_not_found":this.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":this.$flash("Неверный пароль");break;case"user_is_disabled":this.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":this.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":this.$flash("Номер телефона не подтвержден"),localStorage.signInData=JSON.stringify({user_phone:this.user_phone_prefix+this.user_phone,user_pass:this.user_pass}),this.phoneVerify();break;default:this.$flash("Не удалось войти в систему")}}},phoneFormat(){this.user_phone||(this.user_phone="");try{let e=this.user_phone.replace(/\D/g,"");e.length>10&&(e=e.substring(e.length-10)),this.user_phone=e}catch{}},async openModal(){var e,s;this.modalOpen=!0;const o=null!==(e=null!==(s=this.user_phone_prefix)&&void 0!==s?s:""+this.user_phone)&&void 0!==e?e:"",n=await W.Fy.create({component:S,componentProps:{phone:o},initialBreakpoint:.5,breakpoints:[.5,.75]});return n.present()},phoneVerify(){let e={user_phone:this.user_phone_prefix+this.user_phone};try{this.$router.push({name:"UserVerifyPhone",query:e})}catch{this.$flash("Не удалось выслать смс с подтверждением")}}}};const N=(0,F.Z)(M,[["render",g],["__scopeId","data-v-0b343164"]]);var Z=N}}]);
//# sourceMappingURL=917.91910aa0.js.map