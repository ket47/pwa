"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2226],{7327:function(e,n,t){t.d(n,{Z:function(){return p}});var i=t(6252),r=t(3577),a=(0,i.Uk)("Просмотр фотографии");function o(e,n,t,o,l,s){var c=(0,i.up)("ion-title"),u=(0,i.up)("ion-icon"),d=(0,i.up)("ion-toolbar"),p=(0,i.up)("ion-header"),m=(0,i.up)("ion-button"),h=(0,i.up)("ion-col"),g=(0,i.up)("ion-row"),f=(0,i.up)("ion-grid"),k=(0,i.up)("ion-img"),v=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(p,null,{default:(0,i.w5)((function(){return[(0,i.Wm)(d,{color:"secondary"},{default:(0,i.w5)((function(){return[(0,i.Wm)(c,null,{default:(0,i.w5)((function(){return[a]})),_:1}),(0,i.Wm)(u,{icon:o.closeOutline,onClick:n[0]||(n[0]=function(e){o.closeModal()}),slot:"end",size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,i.Wm)(v,null,{default:(0,i.w5)((function(){return[t.actions?((0,i.wg)(),(0,i.j4)(f,{key:0},{default:(0,i.w5)((function(){return[(0,i.Wm)(g,null,{default:(0,i.w5)((function(){return[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.actions,(function(e,n){return(0,i.wg)(),(0,i.j4)(h,{key:n},{default:(0,i.w5)((function(){var t;return[e[0]?((0,i.wg)(),(0,i.j4)(m,{key:0,onClick:function(t){return s.actionCreate(n,e[1])},expand:"block",color:null!==(t=e[1])&&void 0!==t?t:"primary"},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,r.zw)(e[0]),1)]})),_:2},1032,["onClick","color"])):(0,i.kq)("",!0)]})),_:2},1024)})),128))]})),_:1})]})),_:1})):(0,i.kq)("",!0),(0,i.Wm)(k,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".1000.1000.webp"},null,8,["src"])]})),_:1})],64)}var l=t(8903),s=t(8292),c={props:["image_hash","actions"],components:{IonIcon:s.gu,IonToolbar:s.sr,IonHeader:s.Gu,IonImg:s.Xz,IonContent:s.W2,IonTitle:s.wd,IonButton:s.YG,IonCol:s.wI,IonRow:s.Nd,IonGrid:s.jY},setup(){var e=function(){s.Fy.dismiss()};return{closeModal:e,closeOutline:l.fID}},methods:{actionCreate(e,n){("danger"!=n||confirm("Вы уверены?"))&&s.Fy.dismiss(null,e)}}},u=t(3744);const d=(0,u.Z)(c,[["render",o]]);var p=d},2226:function(e,n,t){t.d(n,{Z:function(){return x}});var i=t(6252),r=t(3577),a=(0,i.Uk)("Фотографии"),o={key:0,class:"image_grid"},l=["onClick"],s={key:0},c={key:1},u={key:0,class:"image_controls"},d=["id"];function p(e,n,t,p,m,h){var g,f=(0,i.up)("ion-label"),k=(0,i.up)("ion-icon"),v=(0,i.up)("ion-item"),w=(0,i.up)("ion-img"),_=(0,i.up)("ion-avatar");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(v,{lines:"none",onClick:n[0]||(n[0]=function(e){m.editMode=!m.editMode,m.editMode&&h.load()})},{default:(0,i.w5)((function(){return[t.title?((0,i.wg)(),(0,i.j4)(f,{key:0,color:"imageList?.length?'':medium"},{default:(0,i.w5)((function(){return[(0,i.Uk)((0,r.zw)(t.title),1)]})),_:1})):((0,i.wg)(),(0,i.j4)(f,{key:1,color:"imageList?.length?'':medium"},{default:(0,i.w5)((function(){return[a]})),_:1})),m.editMode?((0,i.wg)(),(0,i.j4)(k,{key:2,slot:"end",icon:p.settingsSharp,color:"primary"},null,8,["icon"])):((0,i.wg)(),(0,i.j4)(k,{key:3,slot:"end",icon:p.settingsOutline},null,8,["icon"]))]})),_:1}),null!==(g=h.imageList)&&void 0!==g&&g.length?((0,i.wg)(),(0,i.iD)("div",o,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(h.imageList,(function(n){return(0,i.wg)(),(0,i.iD)("div",{key:n.image_id,style:{position:"relative"}},[(0,i._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:function(e){return h.imagePreview(n.image_hash)}},[n.deleted_at?((0,i.wg)(),(0,i.iD)("div",s,"будет удалено")):1==n.is_disabled?((0,i.wg)(),(0,i.iD)("div",c,"на модерации")):(0,i.kq)("",!0)],8,l),(0,i.Wm)(_,{onClick:function(e){return h.imagePreview(n.image_hash)},class:(0,r.C_)(n.class)},{default:(0,i.w5)((function(){return[(0,i.Wm)(w,{src:e.$heap.state.hostname+"image/get.php/"+n.image_hash+".100.100.webp"},null,8,["src"])]})),_:2},1032,["onClick","class"]),m.editMode?((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(k,{icon:p.chevronBackCircleOutline,onClick:function(e){return h.back(n)}},null,8,["icon","onClick"]),h.isAdmin&&1==n.is_disabled?((0,i.wg)(),(0,i.j4)(k,{key:0,icon:p.checkmarkCircle,color:"success",onClick:function(e){return h.enable(n)}},null,8,["icon","onClick"])):(0,i.kq)("",!0),n.deleted_at?((0,i.wg)(),(0,i.j4)(k,{key:1,icon:p.addCircle,color:"success",onClick:function(e){return h.restore(n)}},null,8,["icon","onClick"])):((0,i.wg)(),(0,i.j4)(k,{key:2,icon:p.trash,color:"danger",onClick:function(e){return h.remove(n)}},null,8,["icon","onClick"])),(0,i.Wm)(k,{icon:p.chevronForwardCircleOutline,onClick:function(e){return h.forward(n)}},null,8,["icon","onClick"])])):(0,i.kq)("",!0)])})),128))])):(0,i.kq)("",!0),(0,i._)("input",{type:"file",id:m.fileUploaderId,accept:".png, .jpg, .jpeg, .webp, .gif",onChange:n[1]||(n[1]=function(e){return h.uploadImage(e)}),style:{display:"none"}},null,40,d)])}var m=t(6835),h=t(8534),g=t(8903),f=t(8292),k=t(7327),v=t(9755),w=t.n(v),_=t(9042),I=t(351),b={props:["images","image_holder","image_holder_id","controller","title"],components:{IonLabel:f.Q$,IonIcon:f.gu,IonItem:f.Ie,IonImg:f.Xz,IonAvatar:f.BJ},setup(){return{settingsOutline:g.C$N,settingsSharp:g.kiF,chevronBackCircleOutline:g.CK0,chevronForwardCircleOutline:g.esm,trash:g._Ij,addCircle:g.ZWo,checkmarkCircle:g.I1A}},data(){var e;return{images_loaded:null,editMode:!1,fileUploaderId:(null!==(e=this.image_holder)&&void 0!==e?e:this.controller)+this.image_holder_id}},computed:{imageList(){var e=this.images_loaded||this.images,n=[];for(var t in e)e[t].deleted_at?(e[t].class=" deleted",this.editMode&&n.push(e[t])):1==e[t].is_disabled?(e[t].class=" disabled",this.editMode&&n.push(e[t])):n.push(e[t]);return n},isAdmin(){return I.Z.isAdmin()}},methods:{back(e){var n=this;return(0,h.Z)((0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().post(n.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"});case 3:n.load(),t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](0);case 8:case"end":return t.stop()}}),t,null,[[0,6]])})))()},forward(e){var n=this;return(0,h.Z)((0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().post(n.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"});case 3:n.load(),t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](0);case 8:case"end":return t.stop()}}),t,null,[[0,6]])})))()},remove(e){var n=this;return(0,h.Z)((0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().post(n.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id});case 3:n.load(),n.$flash("Фото перемещено в корзину и будет удалено"),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},restore(e){var n=this;return(0,h.Z)((0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().post(n.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id});case 3:n.load(),n.$flash("Фото перемещено извлечено из корзины"),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},enable(e){var n=this;return(0,h.Z)((0,m.Z)().mark((function t(){return(0,m.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w().post(n.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0});case 3:n.load(),t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](0);case 8:case"end":return t.stop()}}),t,null,[[0,6]])})))()},load(){var e=this;return(0,h.Z)((0,m.Z)().mark((function n(){var t,i;return(0,m.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i={image_holder_id:e.image_holder_id,image_holder:null!==(t=e.image_holder)&&void 0!==t?t:e.controller,is_disabled:1,is_deleted:1,is_active:1},n.next=3,w().post(e.$heap.state.hostname+"Image/listGet",i);case 3:e.images_loaded=n.sent;case 4:case"end":return n.stop()}}),n)})))()},imagePreview(e){return(0,h.Z)((0,m.Z)().mark((function n(){var t,i;return(0,m.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,f.Fy.create({component:k.Z,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[.5,1]});case 2:return t=n.sent,i=function(){t.dismiss()},_.Z.on("dismissModal",i),n.abrupt("return",t.present());case 6:case"end":return n.stop()}}),n)})))()},uploadImage(e){var n=this;return(0,h.Z)((0,m.Z)().mark((function t(){var i,r,a,o,l,s;return(0,m.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new FormData,i.append("files[]",e.target.files[0]),i.set("image_holder_id",n.image_holder_id),n.image_holder&&i.set("image_holder",n.image_holder),r={url:n.$heap.state.hostname+n.controller+"/fileUpload",type:"POST",data:i,processData:!1,contentType:!1},t.prev=5,t.next=8,w().ajax(r);case 8:n.load(),t.next=20;break;case 11:if(t.prev=11,t.t0=t["catch"](5),"limit_exeeded"!=(null===t.t0||void 0===t.t0||null===(a=t.t0.responseJSON)||void 0===a||null===(o=a.messages)||void 0===o?void 0:o.error)){t.next=16;break}return n.$flash("Уже загружено максимальное количество фото"),t.abrupt("return");case 16:if("no_valid_images"!=(null===t.t0||void 0===t.t0||null===(l=t.t0.responseJSON)||void 0===l||null===(s=l.messages)||void 0===s?void 0:s.error)){t.next=19;break}return n.$flash("Формат файла не поддерживается"),t.abrupt("return");case 19:n.$flash("Не удалось загрузить фото");case 20:case"end":return t.stop()}}),t,null,[[5,11]])})))()},take_photo(){w()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}},C=t(3744);const Z=(0,C.Z)(b,[["render",p],["__scopeId","data-v-5ec0cc30"]]);var x=Z}}]);
//# sourceMappingURL=2226-legacy.b617c017.js.map