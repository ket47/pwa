"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[2118],{2118:function(t,e,o){o.d(e,{Z:function(){return L}});o(7658),o(1817);var l=o(6252),n=o(3577);const i=t=>((0,l.dD)("data-v-5d3dd6c5"),t=t(),(0,l.Cn)(),t),a={key:0},r=i((()=>(0,l._)("h1",null,"Ваш заказ",-1))),s=i((()=>(0,l._)("p",null,[(0,l._)("b",null,"Курьер")],-1))),d=i((()=>(0,l._)("h1",null,"Детали перевозки",-1))),c=i((()=>(0,l._)("b",null,"Откуда:",-1))),u=i((()=>(0,l._)("b",null,"Куда:",-1))),m=i((()=>(0,l._)("h1",null,"Условия перевозки",-1))),p={key:1},h=i((()=>(0,l._)("div",{slot:"end",style:{position:"relative",width:"120px","min-height":"48px","background-color":"var(--ion-color-light)"}},null,-1)));function g(t,e,o,i,g,_){const w=(0,l.up)("ion-label"),k=(0,l.up)("ion-item"),f=(0,l.up)("ion-textarea"),y=((0,l.up)("ymap-marker"),(0,l.up)("yandex-map"),(0,l.up)("ion-img")),W=(0,l.up)("ion-thumbnail"),C=(0,l.up)("ion-icon"),v=(0,l.up)("ion-note"),I=(0,l.up)("ion-text"),b=(0,l.up)("ion-checkbox"),D=(0,l.up)("ion-list"),x=(0,l.up)("ion-card-title"),S=(0,l.up)("ion-card-header"),O=(0,l.up)("ion-card-content"),$=(0,l.up)("ion-card"),L=(0,l.up)("ion-button"),j=(0,l.up)("ion-col"),U=(0,l.up)("ion-row"),V=(0,l.up)("ion-grid"),F=(0,l.up)("ion-skeleton-text");return o.orderData?((0,l.wg)(),(0,l.iD)("div",a,[(0,l.Wm)(D,{lines:"none"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[r,s])),_:1})])),_:1}),(0,l.Wm)(k,{lines:"none"},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{ref:"description",modelValue:g.orderLocal.order_description,"onUpdate:modelValue":e[0]||(e[0]=t=>g.orderLocal.order_description=t),rows:"5",label:"",placeholder:"напишите, что будем везти",style:{"background-color":"var(--ion-color-light)","border-radius":"10px"},onIonInput:e[1]||(e[1]=t=>_.itemUpdate()),debounce:"50"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[d])),_:1})])),_:1}),(0,l.kq)("",!0),o.orderData.locationStart?((0,l.wg)(),(0,l.j4)(k,{key:1,button:"",onClick:e[2]||(e[2]=t=>_.locationStartSelect())},{default:(0,l.w5)((()=>{var e;return[null!==(e=o.orderData.locationStart)&&void 0!==e&&e.image_hash?((0,l.wg)(),(0,l.j4)(W,{key:0,slot:"start",style:{"--size":"25px"}},{default:(0,l.w5)((()=>{var e;return[(0,l.Wm)(y,{src:`${t.$heap.state.hostname}image/get.php/${null===(e=o.orderData.locationStart)||void 0===e?void 0:e.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,l.wg)(),(0,l.j4)(C,{key:1,color:"primary",src:i.locationOutline,slot:"start"},null,8,["src"])),(0,l.Wm)(I,null,{default:(0,l.w5)((()=>[c,(0,l.Uk)(),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(o.orderData.locationStart.location_address),1)])),_:1})])),_:1})]})),_:1})):((0,l.wg)(),(0,l.j4)(k,{key:2,button:"","detail-icon":i.addOutline,onClick:e[3]||(e[3]=t=>_.locationStartSelect())},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{color:"medium",src:i.locationOutline,slot:"start"},null,8,["src"]),(0,l.Wm)(I,{color:"medium"},{default:(0,l.w5)((()=>[(0,l.Uk)("Откуда забрать?")])),_:1}),(0,l.Wm)(C,{color:"warning",src:i.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),o.orderData.locationFinish?((0,l.wg)(),(0,l.j4)(k,{key:3,button:"",onClick:e[4]||(e[4]=t=>_.locationFinishSelect())},{default:(0,l.w5)((()=>{var e;return[null!==(e=o.orderData.locationFinish)&&void 0!==e&&e.image_hash?((0,l.wg)(),(0,l.j4)(W,{key:0,slot:"start",style:{"--size":"25px"}},{default:(0,l.w5)((()=>{var e;return[(0,l.Wm)(y,{src:`${t.$heap.state.hostname}image/get.php/${null===(e=o.orderData.locationFinish)||void 0===e?void 0:e.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,l.wg)(),(0,l.j4)(C,{key:1,color:"primary",src:i.flagOutline,slot:"start"},null,8,["src"])),(0,l.Wm)(I,null,{default:(0,l.w5)((()=>[u,(0,l.Uk)(),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(o.orderData.locationFinish.location_address),1)])),_:1})])),_:1})]})),_:1})):((0,l.wg)(),(0,l.j4)(k,{key:4,button:"","detail-icon":i.addOutline,onClick:e[5]||(e[5]=t=>_.locationFinishSelect())},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{color:"medium",src:i.flagOutline,slot:"start"},null,8,["src"]),(0,l.Wm)(I,{color:"medium"},{default:(0,l.w5)((()=>[(0,l.Uk)("Куда отвезти?")])),_:1}),(0,l.Wm)(C,{color:"warning",src:i.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[m])),_:1})])),_:1}),(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(C,{src:i.helpCircleOutline,slot:"start",onClick:e[6]||(e[6]=e=>t.$router.push("/page/rules-customer#dimentions"))},null,8,["src"]),(0,l.Wm)(b,{modelValue:g.isDimentionValid,"onUpdate:modelValue":e[7]||(e[7]=t=>g.isDimentionValid=t)},{default:(0,l.w5)((()=>[(0,l.Uk)("Посылка меньше 40см и легче 10кг")])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l.Wm)(C,{src:i.helpCircleOutline,slot:"start",onClick:e[8]||(e[8]=e=>t.$router.push("/page/rules-customer#contents"))},null,8,["src"]),(0,l.Wm)(b,{modelValue:g.isContentValid,"onUpdate:modelValue":e[9]||(e[9]=t=>g.isContentValid=t)},{default:(0,l.w5)((()=>[(0,l.Uk)("Посылка без запрещенных вещей")])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.kq)("",!0),o.orderData.order_objection?((0,l.wg)(),(0,l.j4)($,{key:1,color:"warning"},{default:(0,l.w5)((()=>[(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l.Wm)(x,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Проблема с заказом")])),_:1})])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(o.orderData.order_objection),1)])),_:1})])),_:1})):(0,l.kq)("",!0),_.isReadyToCheckout?((0,l.wg)(),(0,l.j4)(V,{key:2},{default:(0,l.w5)((()=>[(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(_.nextStageButtons,((t,e)=>((0,l.wg)(),(0,l.j4)(j,{key:e},{default:(0,l.w5)((()=>{var i,a;return[t[0]?((0,l.wg)(),(0,l.j4)(L,{key:0,onClick:l=>_.stageCreate(o.orderData.order_id,e,t[1]),expand:"block",color:null!==(i=t[1])&&void 0!==i?i:"primary",fill:null!==(a=t[2])&&void 0!==a?a:"solid"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{slot:"start",src:t.icon},null,8,["src"]),(0,l.Uk)(" "+(0,n.zw)(t[0]),1)])),_:2},1032,["onClick","color","fill"])):(0,l.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):((0,l.wg)(),(0,l.j4)(V,{key:3},{default:(0,l.w5)((()=>[(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[o.orderData.order_description?o.orderData.locationStart?o.orderData.locationFinish?g.isContentValid&&g.isDimentionValid?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(L,{key:3,onClick:e[13]||(e[13]=t=>g.isContentValid=g.isDimentionValid=1),expand:"block",color:"light"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Согласен с условиями ")])),_:1})):((0,l.wg)(),(0,l.j4)(L,{key:2,onClick:e[12]||(e[12]=t=>_.locationFinishSelect()),expand:"block",color:"light"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Куда отвезти ")])),_:1})):((0,l.wg)(),(0,l.j4)(L,{key:1,onClick:e[11]||(e[11]=t=>_.locationStartSelect()),expand:"block",color:"light"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Откуда забрать ")])),_:1})):((0,l.wg)(),(0,l.j4)(L,{key:0,onClick:e[10]||(e[10]=e=>t.$refs.description.$el.setFocus()),expand:"block",color:"light"},{default:(0,l.w5)((()=>[(0,l.Uk)(" Заполнить описание ")])),_:1}))])),_:1})])),_:1})])),_:1}))])):((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(k,{detail:"",button:"",lines:"none"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{slot:"start",icon:i.storefrontOutline},null,8,["icon"]),(0,l.Wm)(F,{animated:"",style:{width:"200px"}})])),_:1}),(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.iD)(l.HY,null,(0,l.Ko)([1,2,3],(t=>(0,l.Wm)(k,{key:t},{default:(0,l.w5)((()=>[(0,l.Wm)(W,{style:{"background-color":"var(--ion-color-light)"}}),(0,l.Wm)(V,null,{default:(0,l.w5)((()=>[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l.Wm)(F,{animated:"",style:{width:"100%"}})])),_:1}),(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l.Wm)(w,{color:"primary"},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{animated:"",style:{width:"100px"}})])),_:1})])),_:1})])),_:1})])),_:1}),h])),_:2},1024))),64))])),_:1}),(0,l.Wm)(V,null,{default:(0,l.w5)((()=>[(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[((0,l.wg)(),(0,l.iD)(l.HY,null,(0,l.Ko)([1,2],(t=>(0,l.Wm)(j,{key:t},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{color:"light",style:{width:"100%"}})])),_:2},1024))),64))])),_:1})])),_:1})]))}o(3948),o(6699);var _=o(4929),w=o(8903),k=o(5836);_.wd,_.sr,_.W2,_.Gu,_.gu,_.Ie,_.YG,_.nz,_.g2,_.PM,_.FN;var f=o(3744);function y(t,e,o,i,a,r){const s=(0,l.up)("ion-title"),d=(0,l.up)("ion-icon"),c=(0,l.up)("ion-item"),u=(0,l.up)("ion-toolbar"),m=(0,l.up)("ion-header"),p=(0,l.up)("ion-img"),h=(0,l.up)("ion-label"),g=(0,l.up)("ion-list"),_=(0,l.up)("ion-list-header"),w=(0,l.up)("ion-content");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{lines:"none"},{default:(0,l.w5)((()=>[(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Мои адреса")])),_:1}),(0,l.Wm)(d,{slot:"end",onClick:e[0]||(e[0]=t=>{r.modalClose()}),icon:i.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[a.locationList.length?((0,l.wg)(),(0,l.j4)(g,{key:0,lines:"full"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.locationList,((e,o)=>((0,l.wg)(),(0,l.j4)(c,{key:e.location_id},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,l.Wm)(h,{onClick:t=>r.locationSelect(e),style:{"white-space":"normal",cursor:"pointer"},class:(0,n.C_)(1==e.is_main?"is_main":"")},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.location_address),1)])),_:2},1032,["onClick","class"]),(0,l.Wm)(d,{slot:"end",icon:i.trashOutline,onClick:t=>r.locationDelete(`${e.location_id}`,`${o}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,l.kq)("",!0),(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Добавить адрес")])),_:1})])),_:1}),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.locationGroupList,(e=>((0,l.wg)(),(0,l.j4)(c,{key:e.group_id,onClick:t=>r.modalLocationCreate(`${e.group_id}`,`${e.group_name}`),style:{cursor:"pointer"}},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(e.group_name),1)])),_:2},1024),(0,l.Wm)(d,{src:i.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}var W=o(2008),C=o(351),v=o(9755),I=o.n(v),b=o(5236),D={components:{IonImg:_.Xz,IonLabel:_.Q$,IonItem:_.Ie,IonList:_.q_,IonListHeader:_.yh,IonIcon:_.gu,IonHeader:_.Gu,IonToolbar:_.sr,IonTitle:_.wd,IonContent:_.W2},setup(){return{locationOutline:w.Iv7,trashOutline:w.gtu,addOutline:w.s6O,closeOutline:w.fID}},data(){return{locationList:[],locationGroupList:[]}},mounted(){this.locationListGet(),this.$topic.on("dismissModal",(()=>this.modalClose()))},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{modalClose(){_.Fy.dismiss(null,"cancel")},async modalLocationCreate(t,e){if(!W.Z.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/user/sign-in"));var o=String(e).toLowerCase();const l=await _.Fy.create({component:b.Z,showBackdrop:!0,componentProps:{location_group_name_low:o}});return l.onDidDismiss().then((e=>{this.locationCreate(t,e.data)})),l.present()},async locationListGet(){try{let t=null;const e=await I().get(W.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=e.location_list,this.locationGroupList=e.location_group_list,this.locationList)for(let o of this.locationList)1==o.is_main&&(t=o);if(!t)return void C.Z.get()}catch(t){}},async locationCreate(t,e){if(!e)return;let o={location_holder:"user",location_holder_id:W.Z.state.user.user_id,location_group_id:t,location_address:e.location_address,location_latitude:e.location_latitude,location_longitude:e.location_longitude};try{await I().post(W.Z.state.hostname+"User/locationCreate",o),this.locationListGet()}catch(l){const t=l.responseJSON,e=t.messages.error;switch(e){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},locationSelect(t){_.Fy.dismiss(t,"confirm")},async locationDelete(t,e){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(e,1),await I().post(W.Z.state.hostname+"User/locationDelete",{location_id:t})}catch(o){}this.locationListGet()}}}};const x=(0,f.Z)(D,[["render",y],["__scopeId","data-v-1f3c9982"]]);var S=x,O={props:["orderData"],components:{yandexMap:k.xR,ymapMarker:k.Jk,IonIcon:_.gu,IonText:_.yW,IonLabel:_.Q$,IonItem:_.Ie,IonList:_.q_,IonChip:_.hM,IonImg:_.Xz,IonThumbnail:_.Bs,IonNote:_.uN,IonButton:_.YG,IonCol:_.wI,IonRow:_.Nd,IonGrid:_.jY,IonSkeletonText:_.CK,IonCard:_.PM,IonCardHeader:_.Zi,IonCardContent:_.FN,IonCardTitle:_.Dq,IonAvatar:_.BJ,IonItemDivider:_.rH,IonTextarea:_.g2,IonCheckbox:_.nz},setup(){return{add:w.IHx,remove:w.OdJ,trash:w._Ij,rocketOutline:w.G$D,storefrontOutline:w.qRG,checkmarkOutline:w.TjA,cubeOutline:w.XFf,walletOutline:w.S5P,banOutline:w.L6S,giftOutline:w._$o,cardOutline:w.pvm,ribbonOutline:w.Muk,chatboxEllipsesOutline:w._Pt,locationOutline:w.Iv7,flagOutline:w.FMn,chevronDown:w.Dd1,addOutline:w.s6O,checkmark:w.d29,cashOutline:w.zaw,businessOutline:w.c1X,alertCircleOutline:w.nLD,helpCircleOutline:w.Sm}},data(){return{isDimentionValid:0,isContentValid:0,orderLocal:{}}},computed:{orderTotal(){let t=0;for(let l in null===(e=this.orderData)||void 0===e?void 0:e.entries){var e,o;let n=null===(o=this.orderData)||void 0===o?void 0:o.entries[l];n&&n.entry_quantity&&n.entry_price&&(t+=n.entry_quantity*n.entry_price-(n.entry_discount||0))}return Math.round(t)},isReadyToCheckout(){return this.orderData.order_description&&this.orderData.locationStart&&this.orderData.locationFinish&&this.isContentValid&&this.isDimentionValid},isEditable(){return this.atCorrection||this.atCart},atCorrection(){return!("supplier"!=this.orderData.user_role&&"admin"!=this.orderData.user_role||!["supplier_corrected"].includes(this.orderData.stage_current))},atCart(){return!("customer"!=this.orderData.user_role&&"admin"!=this.orderData.user_role||!["customer_cart"].includes(this.orderData.stage_current))},nextStageButtons(){let t={};for(let e in this.orderData.stage_next)this.orderData.stage_next[e][0]&&(t[e]=this.orderData.stage_next[e],t[e].icon=w.TjA,e.includes("admin")?t[e].icon=w.Muk:e.includes("delivery")?t[e].icon=w.G$D:e.includes("supplier")&&(t[e].icon=w.qRG));return t}},methods:{stageCreate(t,e,o){("danger"!=o||confirm("Вы уверены?"))&&this.$emit("stageCreate",t,e)},async itemUpdate(){this.$emit("orderUpdate",this.orderLocal)},async locationSelect(){const t=document.querySelector("ion-router-outlet"),e=await _.Fy.create({component:S,canDismiss:!0,backdropDismiss:!0,keyboardClose:!0,presentingElement:t});e.present();const{data:o,role:l}=await e.onWillDismiss();return o},async locationStartSelect(){var t;this.orderLocal.locationStart=await this.locationSelect(),this.orderLocal.start_location_id=null===(t=this.orderLocal.locationStart)||void 0===t?void 0:t.location_id,this.itemUpdate()},async locationFinishSelect(){var t;this.orderLocal.locationFinish=await this.locationSelect(),this.orderLocal.finish_location_id=null===(t=this.orderLocal.locationFinish)||void 0===t?void 0:t.location_id,this.itemUpdate()}},mounted(){this.orderLocal=this.orderData||{}},watch:{"orderData.order_description":function(t){this.orderLocal.order_description=t}}};const $=(0,f.Z)(O,[["render",g],["__scopeId","data-v-5d3dd6c5"]]);var L=$},5236:function(t,e,o){o.d(e,{Z:function(){return h}});var l=o(6252),n=o(3577);const i={style:{position:"absolute",top:"0px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},a={slot:"end",style:{color:"#666"}};function r(t,e,o,r,s,d){const c=(0,l.up)("ymap-marker"),u=(0,l.up)("yandex-map"),m=(0,l.up)("ion-searchbar"),p=(0,l.up)("ion-item"),h=(0,l.up)("ion-content"),g=(0,l.up)("ion-icon"),_=(0,l.up)("ion-button"),w=(0,l.up)("ion-toolbar");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(u,{onClick:e[0]||(e[0]=t=>d.onClick(t)),style:{height:"100%"},coords:s.coords,zoom:16,settings:s.settings,controls:["zoomControl"]},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{coords:s.coords,"marker-id":"1",properties:s.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,l._)("div",i,[(0,l.Wm)(m,{debounce:"500",modelValue:s.addressSearchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>s.addressSearchQuery=t),onIonInput:e[2]||(e[2]=t=>d.suggestionsGet()),placeholder:"поиск адреса",style:{margin:"0px","padding-bottom":"0px"}},null,8,["modelValue"]),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.suggestions,((t,e)=>((0,l.wg)(),(0,l.j4)(p,{key:e,onClick:e=>d.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,l.w5)((()=>[(0,l.Uk)((0,n.zw)(t.subtitle.text)+" "+(0,n.zw)(t.title.text)+" ",1),(0,l._)("span",a,(0,n.zw)(t.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,{strong:!0,onClick:e[3]||(e[3]=t=>d.pickAddress()),color:"primary",expand:"block"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{src:r.checkmark,slot:"start"},null,8,["src"]),(0,l.Uk)(" Ок ")])),_:1}),(0,l.Wm)(_,{onClick:e[4]||(e[4]=t=>r.closeModal()),color:"light",expand:"block"},{default:(0,l.w5)((()=>[(0,l.Uk)("Закрыть")])),_:1})])),_:1})],64)}o(3948),o(7658);var s=o(4929),d=o(5836),c=o(8903),u={components:{IonContent:s.W2,IonToolbar:s.sr,IonButton:s.YG,IonSearchbar:s.VI,IonIcon:s.gu,IonItem:s.Ie,yandexMap:d.xR,ymapMarker:d.Jk},setup(){const t=function(){s.Fy.dismiss()};return{closeModal:t,locationOutline:c.Iv7,closeOutline:c.fID,checkmark:c.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",e=this.$heap.state.settings.location,o=JSON.parse(e.mapCenter);return{settings:{apiKey:e.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},suggestions:[],addressSearchQuery:null,locationType:t,locSettings:e,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t;const e=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=e.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(o){}var e={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1]};s.Fy.dismiss(e)},filterAddress(t){const e=this.locSettings.addressErase.split(", "),o=t.split(", ");let l=[];for(const n of o)e.find((t=>t==n))||l.push(n);return l.reverse().join(", ")},onClick(t){t&&t.get&&(this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,e=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${e}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),l=await o.json();this.suggestions=l.results||[]}catch(t){}else this.suggestions=[]},async suggestionSelect(t,e){this.selectedAddress=t,this.geocode(e)},async geocode(t){try{this.suggestions=[];const e=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${e}&format=json&results=1&uri=${t}`),l=await o.json(),n=l.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=n.Point.pos.split(" ").reverse()}catch(e){console.log(e)}}},async mounted(){await(0,d.xk)();let t=window.ymaps;this.$flash("Получаем местоположение устройства"),t.geolocation.get().then((t=>{this.coords=t.geoObjects.position,this.$flash("На карте отмечено ваше местоположение")}))}},m=o(3744);const p=(0,m.Z)(u,[["render",r]]);var h=p}}]);
//# sourceMappingURL=2118.1a1b9865.js.map