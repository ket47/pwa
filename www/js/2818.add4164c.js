"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2818],{2818:function(e,l,s){s.r(l),s.d(l,{default:function(){return f}});var t=s(641);const a=["src"],n=["src"];function i(e,l,s,i,o,r){const u=(0,t.g2)("ion-icon"),d=(0,t.g2)("ion-input"),_=(0,t.g2)("ion-item"),h=(0,t.g2)("ion-button"),p=(0,t.g2)("ion-label"),c=(0,t.g2)("ion-list-header"),f=(0,t.g2)("ion-avatar"),b=(0,t.g2)("ion-segment-button"),m=(0,t.g2)("ion-segment"),k=(0,t.g2)("ion-list"),g=(0,t.g2)("ion-item-divider"),F=(0,t.g2)("ion-col"),v=(0,t.g2)("ion-row"),y=(0,t.g2)("ion-title"),w=(0,t.g2)("ion-toolbar"),$=(0,t.g2)("ion-header"),V=(0,t.g2)("ion-content"),O=(0,t.g2)("ion-modal"),I=(0,t.g2)("base-layout");return(0,t.uX)(),(0,t.Wv)(I,{"page-title":"Мой профиль"},{default:(0,t.k6)(()=>[(0,t.bF)(k,null,{default:(0,t.k6)(()=>[(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.personOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(d,{modelValue:o.fields.user_name,"onUpdate:modelValue":l[0]||(l[0]=e=>o.fields.user_name=e),name:"user_name",type:"text",onChange:l[1]||(l[1]=e=>r.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",label:"Ваш псевдоним","label-placement":"stacked",required:""},null,8,["modelValue"])]),_:1}),(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.giftOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(d,{modelValue:o.fields.user_birthday,"onUpdate:modelValue":l[2]||(l[2]=e=>o.fields.user_birthday=e),placeholder:"День рождения",label:"День рождения","label-placement":"stacked",name:"user_birthday",type:"date",onChange:l[3]||(l[3]=e=>r.save("user_birthday",e.target.value)),readonly:o.birthday_is_set},null,8,["modelValue","readonly"])]),_:1}),(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.callOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(d,{readonly:"",modelValue:o.fields.user_phone,"onUpdate:modelValue":l[4]||(l[4]=e=>o.fields.user_phone=e),label:"Телефон","label-placement":"stacked"},null,8,["modelValue"]),!o.fields.user_phone||o.fields.user_phone_verified&&"0"!==o.fields.user_phone_verified?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(h,{key:0,slot:"end",onClick:r.phoneVerify,expand:"block"},{default:(0,t.k6)(()=>l[20]||(l[20]=[(0,t.eW)("Подтвердить")])),_:1,__:[20]},8,["onClick"])),o.fields.user_phone&&o.fields.user_phone_verified&&"0"!==o.fields.user_phone_verified?((0,t.uX)(),(0,t.Wv)(h,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,t.k6)(()=>l[21]||(l[21]=[(0,t.eW)("Подтверждено")])),_:1,__:[21]})):(0,t.Q3)("",!0)]),_:1}),(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.atOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(d,{modelValue:o.fields.user_email,"onUpdate:modelValue":l[5]||(l[5]=e=>o.fields.user_email=e),name:"user_email",type:"email",onChange:l[6]||(l[6]=e=>r.save("user_email",e.target.value)),placeholder:"Электронная почта",label:"Электронная почта","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,t.bF)(c,null,{default:(0,t.k6)(()=>[(0,t.bF)(p,null,{default:(0,t.k6)(()=>l[22]||(l[22]=[(0,t.eW)("Аватар")])),_:1,__:[22]})]),_:1}),(0,t.bF)(_,{lines:"none"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{mode:"ios",modelValue:o.fields.user_avatar_name,"onUpdate:modelValue":l[7]||(l[7]=e=>o.fields.user_avatar_name=e),onIonChange:l[8]||(l[8]=e=>r.save("user_avatar_name",e.target.value))},{default:(0,t.k6)(()=>[(0,t.bF)(b,{value:"man"},{default:(0,t.k6)(()=>[(0,t.bF)(f,null,{default:(0,t.k6)(()=>[(0,t.Lk)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,a)]),_:1})]),_:1}),(0,t.bF)(b,{value:"woman"},{default:(0,t.k6)(()=>[(0,t.bF)(f,null,{default:(0,t.k6)(()=>[(0,t.Lk)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,n)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,t.bF)(g,null,{default:(0,t.k6)(()=>[(0,t.bF)(p,null,{default:(0,t.k6)(()=>l[23]||(l[23]=[(0,t.eW)("Пароль")])),_:1,__:[23]})]),_:1}),(0,t.bF)(v,{"responsive-sm":""},{default:(0,t.k6)(()=>[(0,t.bF)(F,null,{default:(0,t.k6)(()=>[(0,t.bF)(h,{onClick:l[9]||(l[9]=e=>r.passwordReset()),expand:"block",color:"medium",fill:"outline"},{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.keyOutline,slot:"start"},null,8,["icon"]),l[24]||(l[24]=(0,t.eW)("Сбросить"))]),_:1,__:[24]})]),_:1}),(0,t.bF)(F,null,{default:(0,t.k6)(()=>[(0,t.bF)(h,{onClick:l[10]||(l[10]=e=>o.passwordPromptShow=!0),expand:"block",color:"medium",fill:"outline"},{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.keyOutline,slot:"start"},null,8,["icon"]),l[25]||(l[25]=(0,t.eW)("Изменить "))]),_:1,__:[25]})]),_:1})]),_:1}),(0,t.bF)(g,null,{default:(0,t.k6)(()=>[(0,t.bF)(p,null,{default:(0,t.k6)(()=>l[26]||(l[26]=[(0,t.eW)("Удаление профиля")])),_:1,__:[26]})]),_:1}),(0,t.bF)(v,{"responsive-sm":""},{default:(0,t.k6)(()=>[(0,t.bF)(F,null,{default:(0,t.k6)(()=>[(0,t.bF)(h,{onClick:l[11]||(l[11]=e=>o.deletePromptShow=!0),expand:"block",fill:"outline",color:"danger"},{default:(0,t.k6)(()=>[(0,t.bF)(u,{icon:i.trashOutline,slot:"start"},null,8,["icon"]),l[27]||(l[27]=(0,t.eW)(" Удалить профиль "))]),_:1,__:[27]})]),_:1}),(0,t.bF)(F)]),_:1}),(0,t.bF)(O,{isOpen:o.passwordPromptShow,"initial-breakpoint":.8,breakpoints:[0,.4,.8]},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(w,null,{default:(0,t.k6)(()=>[(0,t.bF)(y,null,{default:(0,t.k6)(()=>l[28]||(l[28]=[(0,t.eW)("Новый пароль")])),_:1,__:[28]}),(0,t.bF)(u,{icon:i.closeOutline,onClick:l[12]||(l[12]=e=>o.passwordPromptShow=!1),slot:"end",size:"large"},null,8,["icon"])]),_:1})]),_:1}),(0,t.bF)(V,{class:"ion-padding"},{default:(0,t.k6)(()=>[(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(d,{modelValue:o.fields.user_pass_current,"onUpdate:modelValue":l[13]||(l[13]=e=>o.fields.user_pass_current=e),type:"password",placeholder:"нет пароля",label:"Действующий пароль","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(d,{modelValue:o.fields.user_pass,"onUpdate:modelValue":l[14]||(l[14]=e=>o.fields.user_pass=e),type:"text",placeholder:"пароль",label:"Новый пароль","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,t.bF)(_,null,{default:(0,t.k6)(()=>[(0,t.bF)(d,{modelValue:o.fields.user_pass_confirm,"onUpdate:modelValue":l[15]||(l[15]=e=>o.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)",label:"Новый пароль (повтор)","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,t.bF)(h,{onClick:l[16]||(l[16]=e=>r.passwordSave()),expand:"block"},{default:(0,t.k6)(()=>l[29]||(l[29]=[(0,t.eW)("Изменить")])),_:1,__:[29]})]),_:1})]),_:1},8,["isOpen"]),(0,t.bF)(O,{isOpen:o.deletePromptShow,"initial-breakpoint":.8,breakpoints:[0,.4,.8]},{default:(0,t.k6)(()=>[(0,t.bF)($,null,{default:(0,t.k6)(()=>[(0,t.bF)(w,{color:"danger"},{default:(0,t.k6)(()=>[(0,t.bF)(y,null,{default:(0,t.k6)(()=>l[30]||(l[30]=[(0,t.eW)("Удаление учетной записи")])),_:1,__:[30]}),(0,t.bF)(u,{icon:i.closeOutline,onClick:l[17]||(l[17]=e=>o.deletePromptShow=!1),slot:"end",size:"large"},null,8,["icon"])]),_:1})]),_:1}),(0,t.bF)(V,{class:"ion-padding"},{default:(0,t.k6)(()=>[(0,t.bF)(_,{lines:"none",style:{"margin-bottom":"15px"}},{default:(0,t.k6)(()=>l[31]||(l[31]=[(0,t.Lk)("div",null,[(0,t.Lk)("p",null,"Ваши персональные данные будут безвозвратно удалены."),(0,t.Lk)("p",null," Повторная регистрация по этому номеру телефона будет невозможна! ")],-1)])),_:1,__:[31]}),(0,t.bF)(h,{onClick:l[18]||(l[18]=e=>r.deleteAccount()),expand:"block",color:"danger"},{default:(0,t.k6)(()=>l[32]||(l[32]=[(0,t.eW)("Удалить аккаунт")])),_:1,__:[32]}),(0,t.bF)(h,{onClick:l[19]||(l[19]=e=>o.deletePromptShow=!1),expand:"block",color:"light"},{default:(0,t.k6)(()=>l[33]||(l[33]=[(0,t.eW)("Закрыть")])),_:1,__:[33]})]),_:1})]),_:1},8,["isOpen"])]),_:1})}var o=s(5634),r=s(5480),u=s(2311),d=s.n(u),_=s(8701),h={components:{IonList:o.nf,IonItem:o.uz,IonLabel:o.he,IonInput:o.$w,IonCol:o.hU,IonRow:o.ln,IonItemDivider:o.Dg,IonButton:o.Jm,IonModal:o.Sb,IonHeader:o.eU,IonTitle:o.BC,IonContent:o.W9,IonIcon:o.iq,IonToolbar:o.ai,IonSegment:o.Gp,IonSegmentButton:o.eP,IonAvatar:o.mC,IonListHeader:o.AF},setup(){return{closeOutline:r.xfX,keyOutline:r.uNo,trashOutline:r.P1A,callOutline:r.bNN,personOutline:r.wAZ,atOutline:r.WFd,giftOutline:r.Lsq}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1,deletePromptShow:!1,birthday_is_set:0}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{async save(e,l){if("user_phone"==e){if(!this.isPhoneValid)return!1;l=l.replace(/\D/g,"")}var s={};s.user_id=this.$heap.state.user.user_id,s[e]=l,await this.itemUpdate(s),this.fields[e]=l},async itemUpdate(e){try{const l=await d().post(`${this.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e));if("ok"==l)return this.$flash("Сохранено"),!0}catch(l){let e="unknown";try{const s=Object.keys(JSON.parse(l.responseJSON.messages.error))[0],t=Object.values(JSON.parse(l.responseJSON.messages.error))[0];e=s+"_"+t}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_wrong":this.$flash("Действующий пароль не верный");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break}return!1}_.A.get()},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{d().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$go({name:"UserVerifyPhone",params:{phone:e}})}catch{}},async passwordSave(){if(this.fields.user_pass!=this.fields.user_pass_confirm)return void this.$flash("Пароль и подтверждение не совпадают");if(!this.fields.user_pass)return void this.$flash("Пароль не заполнен");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass,user_pass_current:this.fields.user_pass_current},l=await this.itemUpdate(e);l&&(this.passwordPromptShow=!1,this.$flash("Пароль изменен"))},async passwordReset(){if(!confirm("Выслать новый пароль на телефон и электронную почту?"))return;const e={user_phone:this.fields.user_phone,user_email:this.fields.user_email,user_name:this.fields.user_name};try{await d().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch{}},async deleteAccount(){try{const e={user_id:this.$heap.state.user.user_id};await d().post(`${this.$heap.state.hostname}User/itemDelete`,e),this.deletePromptShow=!1,await _.A.signOut(),await this.$go("/user")}catch{this.$flash("Не удалось удалить аккаунт. Проверьте пароль")}},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let l="",s=0;for(let t in this.config.phoneMask){if(!this.fields.user_phone[s])break;let e=this.config.phoneMask[t];"0"==e?(l+=this.fields.user_phone[s],s++):l+=e}return this.fields.user_phone=l,this.fields.user_phone}},created(){this.$topic.on("userGet",e=>{this.fields=e,this.fields["user_birthday"]&&(this.fields["user_birthday"]=this.fields["user_birthday"].split(" ")[0]),this.birthday_is_set=!!e.user_birthday})}},p=s(6262);const c=(0,p.A)(h,[["render",i]]);var f=c}}]);
//# sourceMappingURL=2818.add4164c.js.map