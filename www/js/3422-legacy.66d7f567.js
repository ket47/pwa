"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[3422],{4480:function(e,r,t){var n=t(2109),o=t(2092).filter,i=t(1194),a=i("filter");n({target:"Array",proto:!0,forced:!a},{filter:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})},4405:function(e,r,t){t(4916),t(5306);var n=t(2008),o={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;var r=e.locations[0].distance,t=e.store_time_preparation||0;return o.deliveryTimeCalculate(r,t)},deliveryTimeCalculate(e,r){var t;r=parseInt(null!==(t=r)&&void 0!==t?t:n.Z.getters.settings.delivery.timePreparationDefault);var o=parseInt(n.Z.getters.settings.delivery.timeDelta),i=parseInt(n.Z.getters.settings.delivery.speed),a=5*Math.round(e/i*60/5)+r,u=a>o?a-o:a,l=u+o;return{time:a,timeMin:u,timeMax:l}},render(e,r){for(var t in r)e=e.replace(`{{${t}}}`,r[t]);return e=e.replace(/{{\.}}/,"-"),e}};r["Z"]=o},5265:function(e,r,t){t.d(r,{Z:function(){return w}});var n=t(6252),o=(0,n.Uk)("Привязка новой карты"),i=(0,n.Uk)("Оплата картой"),a=["src"],u={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},l=["src"];function s(e,r,t,s,c,d){var p=this,m=(0,n.up)("ion-title"),f=(0,n.up)("ion-icon"),_=(0,n.up)("ion-toolbar"),y=(0,n.up)("ion-header"),v=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(y,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(_,{color:"secondary"},{default:(0,n.w5)((function(){return["card_registering"==p.order_data?((0,n.wg)(),(0,n.j4)(m,{key:0},{default:(0,n.w5)((function(){return[o]})),_:1})):((0,n.wg)(),(0,n.j4)(m,{key:1},{default:(0,n.w5)((function(){return[i]})),_:1})),(0,n.Wm)(f,{icon:s.closeOutline,onClick:r[0]||(r[0]=function(e){s.closeModal()}),slot:"end",size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,n.Wm)(v,null,{default:(0,n.w5)((function(){return[(0,n._)("iframe",{src:c.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"calc( 100% - 5px )",border:"none"},onLoad:r[1]||(r[1]=function(e){return d.onLoad()})},null,40,a),c.loadAnimation?((0,n.wg)(),(0,n.iD)("div",u,[(0,n._)("img",{src:s.loading},null,8,l)])):(0,n.kq)("",!0)]})),_:1})],64)}var c=t(6835),d=t(8534),p=t(8292),m=t(8903),f=t(659),_=t(9755),y=t.n(_),v={components:{IonTitle:p.wd,IonIcon:p.gu,IonToolbar:p.sr,IonHeader:p.Gu,IonContent:p.W2},props:["order_data"],setup(){var e=function(){p.Fy.dismiss()};return{closeModal:e,closeOutline:m.fID,cardOutline:m.pvm,loading:f}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{postToIframe(){var e=this;return(0,d.Z)((0,c.Z)().mark((function r(){var t,n,o;return(0,c.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,"card_registering"!=e.order_data){r.next=6;break}return r.next=4,y().post(e.$heap.state.hostname+"CardAcquirer/cardRegisterLinkGet");case 4:return e.paymentLink=r.sent,r.abrupt("return");case 6:return r.next=8,y().post(e.$heap.state.hostname+"CardAcquirer/paymentLinkGet",e.order_data);case 8:e.paymentLink=r.sent,r.next=16;break;case 11:r.prev=11,r.t0=r["catch"](0),o=null===r.t0||void 0===r.t0||null===(t=r.t0.responseJSON)||void 0===t||null===(n=t.messages)||void 0===n?void 0:n.error,"nocardid"==o?e.$flash("Не удалось добавить карту"):e.$flash("Нет возможности принять оплату картой"),e.closeModal();case 16:case"end":return r.stop()}}),r,null,[[0,11]])})))()},onLoad(){this.loadAnimation=0},listenFrame(){var e=this;window.addEventListener("message",(function(r){"paymentOk"!=r.data&&"paymentNo"!=r.data||e.closeModal()}))}}},h=t(3744);const k=(0,h.Z)(v,[["render",s]]);var w=k},9064:function(e,r,t){t.d(r,{Z:function(){return x}});var n=t(6252),o=t(3577),i={class:"delivery-adress",style:{"font-size":"1em"}},a={class:"center"},u=(0,n.Uk)("Адрес доставки заказа"),l={class:"center"},s={key:0,class:"delivery-time"},c=(0,n.Uk)("мин"),d=(0,n.Uk)(" Выбрать адрес доставки ");function p(e,r,t,p,m,f){var _=(0,n.up)("ion-text"),y=(0,n.up)("ion-icon"),v=(0,n.up)("ion-note"),h=(0,n.up)("ion-label"),k=(0,n.up)("ion-item"),w=(0,n.up)("ion-textarea");return(0,n.wg)(),(0,n.iD)(n.HY,null,[f.isMainLocationSet?((0,n.wg)(),(0,n.iD)("div",{key:0,onClick:r[0]||(r[0]=function(e){return f.selectDeliveryAddress()}),class:"selector"},[(0,n._)("div",i,[(0,n._)("div",a,[(0,n.Wm)(_,{size:"small",color:"medium"},{default:(0,n.w5)((function(){return[u]})),_:1}),(0,n.Wm)(y,{icon:p.chevronDownOutline,color:"medium"},null,8,["icon"])]),(0,n._)("div",l,[(0,n.Wm)(y,{slot:"start",color:"secondary",icon:p.location},null,8,["icon"]),(0,n.Wm)(_,{color:"dark"},{default:(0,n.w5)((function(){var r,t;return[(0,n._)("b",null,(0,o.zw)(null===(r=e.$heap.state.user)||void 0===r||null===(t=r.location_main)||void 0===t?void 0:t.location_address),1)]})),_:1})])]),t.deliveryTime?((0,n.wg)(),(0,n.iD)("div",s,[(0,n.Wm)(_,{style:{"font-size":"24px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(t.deliveryTime.time),1)]})),_:1}),(0,n.Wm)(v,{style:{"font-size":"10px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,n.w5)((function(){return[c]})),_:1})])):(0,n.kq)("",!0)])):((0,n.wg)(),(0,n.j4)(k,{key:1,detail:"",button:"",onClick:r[1]||(r[1]=function(e){return f.selectDeliveryAddress()}),class:"selector"},{default:(0,n.w5)((function(){return[(0,n.Wm)(y,{slot:"start",style:{color:"var(--ion-color-primary)"},icon:p.location},null,8,["icon"]),(0,n.Wm)(h,null,{default:(0,n.w5)((function(){return[d]})),_:1})]})),_:1})),t.showComment&&e.$heap.state.user.location_main?((0,n.wg)(),(0,n.j4)(k,{key:2},{default:(0,n.w5)((function(){return[(0,n.Wm)(w,{rows:"1",placeholder:"комментарий к адресу",onChange:r[2]||(r[2]=function(e){return f.locationCommentChanged()}),modelValue:e.$heap.state.user.location_main.location_comment,"onUpdate:modelValue":r[3]||(r[3]=function(r){return e.$heap.state.user.location_main.location_comment=r})},null,8,["modelValue"])]})),_:1})):(0,n.kq)("",!0)],64)}var m=t(6835),f=t(8534),_=(t(8862),t(8292)),y=t(8903),v=t(2008),h=t(6488),k=t(9042),w=t(9755),g=t.n(w),C={props:["deliveryTime","showComment"],components:{IonIcon:_.gu,IonTextarea:_.g2,IonText:_.yW,IonNote:_.uN,IonLabel:_.Q$,IonItem:_.Ie},setup(){return{location:y.xhW,chevronDownOutline:y.Y$3}},data(){return{location_main:v.Z.state.user.location_main}},created(){var e=this;k.Z.on("userMainLocationSet",(function(r){e.location_main=r})),k.Z.on("userGet",(function(r){e.location_main=r.location_main}))},methods:{selectDeliveryAddress(){h.Z.push("/user/user-addresses")},locationCommentChanged(){var e=this;return(0,f.Z)((0,m.Z)().mark((function r(){var t;return(0,m.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:t={location_id:v.Z.state.user.location_main.location_id,location_comment:v.Z.state.user.location_main.location_comment},g().post(e.$heap.state.hostname+"Location/itemUpdate",JSON.stringify(t));case 2:case"end":return r.stop()}}),r)})))()}},computed:{isSignedIn(){return v.Z.state.user.user_id&&v.Z.state.user.user_id>-1},isMainLocationSet(){return this.location_main?1:0}}},b=t(3744);const $=(0,b.Z)(C,[["render",p],["__scopeId","data-v-48384b7b"]]);var x=$},3422:function(e,r,t){t.r(r),t.d(r,{default:function(){return $e}});var n=t(6252),o=t(3577),i=function(e){return(0,n.dD)("data-v-40aecfe4"),e=e(),(0,n.Cn)(),e},a=i((function(){return(0,n._)("label",{for:"store_correction_allow",style:{"font-size":"0.9em"},color:"medium"}," Разрешить изменять заказ ",-1)})),u=(0,n.Uk)("Способы доставки"),l={for:"delivery_by_courier"},s=(0,n.Uk)("Доставит "),c={slot:"end"},d=["checked"],p={for:"delivery_by_store"},m=(0,n.Uk)("Доставит "),f={slot:"end"},_=["checked"],y=i((function(){return(0,n._)("label",{for:"pickup_by_customer"},"Самовывоз",-1)})),v={slot:"end"},h=["checked"],k=(0,n.Uk)("Способы оплаты"),w=i((function(){return(0,n._)("label",{for:"payment_cash"},"Оплата наличными",-1)})),g={slot:"end"},C=["checked"],b=i((function(){return(0,n._)("label",{for:"payment_cash_store"},"Оплата наличными продавцу",-1)})),$={slot:"end"},x=["checked"],W={key:7},Z=i((function(){return(0,n._)("label",{for:"payment_card"},"Оплата картой без привязки",-1)})),I={slot:"end"},O=["checked"],R={for:"use_card_recurrent"},B={slot:"end"},S=["checked"],T=(0,n.Uk)("Выбрать другую карту"),U=(0,n.Uk)("Привязать карту"),L=(0,n.Uk)("Итог"),z=(0,n.Uk)(" Сумма заказа "),D={key:8},j={slot:"start"},q={class:"righttop_badge"},A={slot:"start"},G={class:"righttop_badge"},P=(0,n.Uk)(" Выберите скидку "),M={key:9},N={slot:"start"},V=(0,n.Uk)(" Скидка доступна при доставке "),F=(0,n.Uk)(" Доставка "),H=(0,n.Uk)(" Итого к оплате "),E=(0,n.Uk)(" Я согласен(на) с "),J=(0,n.Uk)("офертой об оказании услуг доставки"),Y=(0,n.Uk)("Оплатить картой"),K=(0,n.Uk)("Послать заказ");function Q(e,r,t,i,Q,X){var ee=(0,n.up)("user-address-widget"),re=(0,n.up)("ion-item-divider"),te=(0,n.up)("ion-textarea"),ne=(0,n.up)("ion-item"),oe=(0,n.up)("ion-checkbox"),ie=(0,n.up)("ion-icon"),ae=(0,n.up)("ion-img"),ue=(0,n.up)("ion-label"),le=(0,n.up)("ion-text"),se=(0,n.up)("ion-badge"),ce=(0,n.up)("router-link"),de=(0,n.up)("ion-list"),pe=(0,n.up)("ion-card-content"),me=(0,n.up)("ion-card"),fe=(0,n.up)("ion-button"),_e=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(_e,{pageTitle:"Оформление заказа",pageDefaultBackLink:"/order/order-list"},{default:(0,n.w5)((function(){return[(0,n.Wm)(ee,{deliveryTime:Q.deliveryTime,showComment:"1"},null,8,["deliveryTime"]),Q.order?((0,n.wg)(),(0,n.j4)(de,{key:0},{default:(0,n.w5)((function(){var t;return[(0,n.Wm)(re,null,{default:(0,n.w5)((function(){var e,r,t;return[(0,n.Uk)("Заказ #"+(0,o.zw)(null===(e=Q.order)||void 0===e?void 0:e.order_id)+' из "'+(0,o.zw)(null===(r=Q.order)||void 0===r||null===(t=r.store)||void 0===t?void 0:t.store_name)+'"',1)]})),_:1}),(0,n.Wm)(ne,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(te,{rows:"2",placeholder:"комментарий к заказу",onChange:r[0]||(r[0]=function(e){return X.orderDescriptionChanged()}),modelValue:Q.order.order_description,"onUpdate:modelValue":r[1]||(r[1]=function(e){return Q.order.order_description=e})},null,8,["modelValue"])]})),_:1}),(0,n.Wm)(ne,null,{default:(0,n.w5)((function(){return[a,(0,n.Wm)(oe,{slot:"end",id:"store_correction_allow",modelValue:Q.storeCorrectionAllow,"onUpdate:modelValue":r[2]||(r[2]=function(e){return Q.storeCorrectionAllow=e})},null,8,["modelValue"])]})),_:1}),Q.storeIsReady?((0,n.wg)(),(0,n.j4)(re,{key:0},{default:(0,n.w5)((function(){return[u]})),_:1})):(0,n.kq)("",!0),X.deliveryByCourierRule?((0,n.wg)(),(0,n.j4)(ne,{key:1,button:"",onClick:r[3]||(r[3]=function(e){return X.tariffRuleSet(X.deliveryByCourierRule)})},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),(0,n._)("label",l,[s,(0,n._)("b",null,(0,o.zw)(e.$heap.state.settings.app_title),1)]),(0,n._)("div",c,[(0,n._)("input",{type:"radio",name:"deliveryBy",id:"delivery_by_courier",value:"courier",checked:X.deliveryByCourierRuleChecked},null,8,d)])]})),_:1})):(0,n.kq)("",!0),X.deliveryByStoreRule?((0,n.wg)(),(0,n.j4)(ne,{key:2,button:"",onClick:r[4]||(r[4]=function(e){return X.tariffRuleSet(X.deliveryByStoreRule)})},{default:(0,n.w5)((function(){var e,r;return[(0,n.Wm)(ie,{icon:i.rocketOutline,slot:"start"},null,8,["icon"]),(0,n._)("label",p,[m,(0,n._)("b",null,(0,o.zw)(null===(e=Q.order)||void 0===e||null===(r=e.store)||void 0===r?void 0:r.store_name),1)]),(0,n._)("div",f,[(0,n._)("input",{type:"radio",name:"deliveryBy",id:"delivery_by_store",value:"store",checked:X.deliveryByStoreRuleChecked},null,8,_)])]})),_:1})):(0,n.kq)("",!0),X.pickupByCustomerRule?((0,n.wg)(),(0,n.j4)(ne,{key:3,button:"",onClick:r[5]||(r[5]=function(e){return X.tariffRuleSet(X.pickupByCustomerRule)})},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.storefrontOutline,slot:"start"},null,8,["icon"]),y,(0,n._)("div",v,[(0,n._)("input",{type:"radio",name:"deliveryBy",id:"pickup_by_customer",value:"store",checked:X.pickupByCustomerRuleChecked},null,8,h)])]})),_:1})):(0,n.kq)("",!0),Q.storeIsReady?((0,n.wg)(),(0,n.j4)(re,{key:4},{default:(0,n.w5)((function(){return[k]})),_:1})):(0,n.kq)("",!0),1==Q.tariffRule.paymentByCash?((0,n.wg)(),(0,n.j4)(ne,{key:5,button:"",onClick:r[6]||(r[6]=function(e){return Q.paymentType="use_cash"})},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),w,(0,n._)("div",g,[(0,n._)("input",{type:"radio",name:"paymentType",id:"payment_cash",value:"cash",checked:"use_cash"==Q.paymentType},null,8,C)])]})),_:1})):(0,n.kq)("",!0),1==Q.tariffRule.paymentByCashStore?((0,n.wg)(),(0,n.j4)(ne,{key:6,button:"",onClick:r[7]||(r[7]=function(e){return Q.paymentType="use_cash_store"})},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),b,(0,n._)("div",$,[(0,n._)("input",{type:"radio",name:"paymentType",id:"payment_cash_store",value:"cash",checked:"use_cash_store"==Q.paymentType},null,8,x)])]})),_:1})):(0,n.kq)("",!0),1==Q.tariffRule.paymentByCard?((0,n.wg)(),(0,n.iD)("div",W,[(0,n.Wm)(ne,{button:"",onClick:r[8]||(r[8]=function(e){return Q.paymentType="use_card"})},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.cardOutline,slot:"start",color:"primary"},null,8,["icon"]),Z,(0,n._)("div",I,[(0,n._)("input",{type:"radio",name:"paymentType",id:"payment_card",value:"card",checked:"use_card"==Q.paymentType},null,8,O)])]})),_:1}),null!==(t=Q.bankCard)&&void 0!==t&&t.card_type?((0,n.wg)(),(0,n.j4)(ne,{key:0,button:"",onClick:r[9]||(r[9]=function(e){return Q.paymentType="use_card_recurrent"})},{default:(0,n.w5)((function(){var e;return["mir"==Q.bankCard.card_type?((0,n.wg)(),(0,n.j4)(ae,{key:0,class:"card_type",src:`/img/icons/card-${Q.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==Q.bankCard.card_type?((0,n.wg)(),(0,n.j4)(ae,{key:1,class:"card_type",src:`/img/icons/card-${Q.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==Q.bankCard.card_type?((0,n.wg)(),(0,n.j4)(ae,{key:2,class:"card_type",src:`/img/icons/card-${Q.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):((0,n.wg)(),(0,n.j4)(ie,{key:3,src:i.cardOutline,slot:"start",color:"primary"},null,8,["src"])),(0,n._)("label",R,"Оплата картой "+(0,o.zw)(null===(e=Q.bankCard)||void 0===e?void 0:e.card_mask),1),(0,n._)("div",B,[(0,n._)("input",{type:"radio",name:"paymentType",id:"use_card_recurrent",value:"registered_card",checked:"use_card_recurrent"==Q.paymentType},null,8,S)])]})),_:1})):(0,n.kq)("",!0),Q.recurrentPaymentAllow?((0,n.wg)(),(0,n.j4)(ne,{key:1,button:"",detail:"",onClick:r[10]||(r[10]=function(r){return e.$router.push("/user/user-cards")})},{default:(0,n.w5)((function(){var e;return[null!==(e=Q.bankCard)&&void 0!==e&&e.card_type?((0,n.wg)(),(0,n.j4)(ue,{key:0,color:"medium"},{default:(0,n.w5)((function(){return[T]})),_:1})):((0,n.wg)(),(0,n.j4)(ue,{key:1,color:"medium"},{default:(0,n.w5)((function(){return[U]})),_:1}))]})),_:1})):(0,n.kq)("",!0)])):(0,n.kq)("",!0),(0,n.Wm)(re,null,{default:(0,n.w5)((function(){return[L]})),_:1}),(0,n.Wm)(ne,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.cubeOutline,slot:"start",color:"primary"},null,8,["icon"]),z,(0,n.Wm)(le,{slot:"end"},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(Q.order.order_sum_product)+(0,o.zw)(e.$heap.state.currencySign),1)]})),_:1})]})),_:1}),X.deliveryByCourierRuleChecked?((0,n.wg)(),(0,n.iD)("div",D,[Q.promo?((0,n.wg)(),(0,n.j4)(ne,{key:0,button:"",onClick:r[11]||(r[11]=function(e){return X.promoPick()}),color:"success"},{default:(0,n.w5)((function(){return[(0,n._)("div",j,[(0,n.Wm)(ie,{icon:i.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,n._)("sup",q,[Q.promoCount>0?((0,n.wg)(),(0,n.j4)(se,{key:0,color:"secondary"},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(Q.promoCount),1)]})),_:1})):(0,n.kq)("",!0)])]),(0,n.Uk)(" "+(0,o.zw)(Q.promo.promo_name)+" ",1),(0,n.Wm)(le,{slot:"end"},{default:(0,n.w5)((function(){return[(0,n.Uk)("-"+(0,o.zw)(Q.order.order_sum_promo)+(0,o.zw)(e.$heap.state.currencySign),1)]})),_:1})]})),_:1})):((0,n.wg)(),(0,n.j4)(ne,{key:1,button:"",detail:"",onClick:r[12]||(r[12]=function(e){return X.promoPick()})},{default:(0,n.w5)((function(){return[(0,n._)("div",A,[(0,n.Wm)(ie,{icon:i.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,n._)("sup",G,[Q.promoCount>0?((0,n.wg)(),(0,n.j4)(se,{key:0,color:"secondary"},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(Q.promoCount),1)]})),_:1})):(0,n.kq)("",!0)])]),P]})),_:1}))])):((0,n.wg)(),(0,n.iD)("div",M,[(0,n.Wm)(ne,null,{default:(0,n.w5)((function(){return[(0,n._)("div",N,[(0,n.Wm)(ie,{icon:i.giftOutline,color:"medium",style:{"font-size":"1.5em"}},null,8,["icon"])]),(0,n.Wm)(le,{color:"medium"},{default:(0,n.w5)((function(){return[V,(0,n._)("b",null,(0,o.zw)(e.$heap.state.settings.app_title),1)]})),_:1})]})),_:1})])),Q.order_sum_delivery>0?((0,n.wg)(),(0,n.j4)(ne,{key:10},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),F,(0,n.Wm)(le,{slot:"end"},{default:(0,n.w5)((function(){var r;return[(0,n.Uk)((0,o.zw)(null!==(r=Q.order_sum_delivery)&&void 0!==r?r:0)+(0,o.zw)(e.$heap.state.currencySign),1)]})),_:1})]})),_:1})):(0,n.kq)("",!0),X.order_sum_total>0?((0,n.wg)(),(0,n.j4)(ne,{key:11},{default:(0,n.w5)((function(){return[(0,n.Wm)(ie,{icon:i.walletOutline,slot:"start",color:"primary"},null,8,["icon"]),H,(0,n.Wm)(le,{slot:"end"},{default:(0,n.w5)((function(){return[(0,n._)("b",null,(0,o.zw)(X.order_sum_total),1),(0,n.Uk)((0,o.zw)(e.$heap.state.currencySign),1)]})),_:1})]})),_:1})):(0,n.kq)("",!0),(0,n.Wm)(ne,{lines:"none"},{default:(0,n.w5)((function(){return[(0,n.Wm)(le,{style:{"font-size":"0.9em"}},{default:(0,n.w5)((function(){return[E,(0,n.Wm)(ce,{to:"/page/rules-customer"},{default:(0,n.w5)((function(){return[J]})),_:1})]})),_:1}),(0,n.Wm)(oe,{slot:"end",modelValue:Q.termsAccepted,"onUpdate:modelValue":r[13]||(r[13]=function(e){return Q.termsAccepted=e})},null,8,["modelValue"])]})),_:1})]})),_:1})):(0,n.kq)("",!0),X.checkoutError?((0,n.wg)(),(0,n.j4)(me,{key:1,color:"warning"},{default:(0,n.w5)((function(){return[(0,n.Wm)(pe,null,{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(X.checkoutError),1)]})),_:1})]})),_:1})):(0,n.kq)("",!0),"use_card"==Q.paymentType||"use_card_recurrent"==Q.paymentType?((0,n.wg)(),(0,n.j4)(fe,{key:2,expand:"block",onClick:r[14]||(r[14]=function(e){return X.proceed()}),disabled:X.checkoutError},{default:(0,n.w5)((function(){return[Y]})),_:1},8,["disabled"])):((0,n.wg)(),(0,n.j4)(fe,{key:3,expand:"block",onClick:r[15]||(r[15]=function(e){return X.proceed()}),disabled:X.checkoutError},{default:(0,n.w5)((function(){return[K]})),_:1},8,["disabled"]))]})),_:1})}var X=t(6835),ee=t(8534),re=(t(4480),t(1539),t(4916),t(5306),t(8862),t(7782)),te=t(4405),ne=t(9042),oe=t(6488),ie=t(9755),ae=t.n(ie),ue=t(8764),le=t(8903),se=t(8292),ce=t(9064),de=t(5265),pe=(0,n.Uk)("Ваши доступные скидки"),me=(0,n.Uk)("Без скидки"),fe=(0,n.Uk)("К сожалению, доступных скидок нет."),_e=(0,n.Uk)("Показать все ваши скидки "),ye={key:0};function ve(e,r,t,i,a,u){var l=(0,n.up)("ion-title"),s=(0,n.up)("ion-icon"),c=(0,n.up)("ion-toolbar"),d=(0,n.up)("ion-header"),p=(0,n.up)("ion-skeleton-text"),m=(0,n.up)("ion-item"),f=(0,n.up)("ion-list"),_=(0,n.up)("ion-text"),y=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(d,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(c,{color:"secondary"},{default:(0,n.w5)((function(){return[(0,n.Wm)(l,null,{default:(0,n.w5)((function(){return[pe]})),_:1}),(0,n.Wm)(s,{icon:i.closeOutline,onClick:r[0]||(r[0]=function(r){return e.$topic.publish("dismissModal")}),slot:"end",size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,n.Wm)(y,null,{default:(0,n.w5)((function(){return[null==a.promoList?((0,n.wg)(),(0,n.j4)(f,{key:0},{default:(0,n.w5)((function(){return[((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([1,2,3],(function(e){return(0,n.Wm)(m,{lines:"none",key:e},{default:(0,n.w5)((function(){return[(0,n.Wm)(s,{slot:"start",icon:i.giftOutline,color:"primary"},null,8,["icon"]),(0,n.Wm)(p,{style:{width:"70%"}}),(0,n.Wm)(p,{slot:"end",style:{width:"50px"}})]})),_:2},1024)})),64))]})),_:1})):(0,n.kq)("",!0),(0,n.Wm)(f,null,{default:(0,n.w5)((function(){var t;return[null!==(t=a.promoList)&&void 0!==t&&t.length?((0,n.wg)(),(0,n.j4)(m,{key:0,button:"",onClick:r[1]||(r[1]=function(e){return u.promoPick({})})},{default:(0,n.w5)((function(){return[(0,n.Wm)(s,{slot:"start",icon:i.banOutline,color:"danger"},null,8,["icon"]),(0,n.Wm)(_,null,{default:(0,n.w5)((function(){return[me]})),_:1}),(0,n.Wm)(_,{slot:"end"},{default:(0,n.w5)((function(){return[(0,n.Uk)("0"+(0,o.zw)(e.$heap.state.currencySign),1)]})),_:1})]})),_:1})):((0,n.wg)(),(0,n.j4)(m,{key:1},{default:(0,n.w5)((function(){return[(0,n.Wm)(s,{slot:"start",icon:i.giftOutline,color:"medium"},null,8,["icon"]),(0,n.Wm)(_,{color:"medium"},{default:(0,n.w5)((function(){return[fe]})),_:1})]})),_:1})),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.promoList,(function(r){return(0,n.wg)(),(0,n.j4)(m,{key:r.promo_id,button:"",onClick:function(e){return u.promoPick(r)}},{default:(0,n.w5)((function(){return[(0,n.Wm)(s,{slot:"start",icon:i.giftOutline,color:"primary"},null,8,["icon"]),(0,n.Wm)(_,null,{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(r.promo_name),1)]})),_:2},1024),(0,n.Wm)(_,{slot:"end",color:"success"},{default:(0,n.w5)((function(){return[(0,n.Uk)((0,o.zw)(r.promo_value)+(0,o.zw)(e.$heap.state.currencySign),1)]})),_:2},1024)]})),_:2},1032,["onClick"])})),128)),(0,n.Wm)(m,{button:"",detail:"",onClick:r[2]||(r[2]=function(r){e.$router.push("/user/user-promo"),e.$topic.publish("dismissModal")})},{default:(0,n.w5)((function(){return[(0,n.Wm)(_,null,{default:(0,n.w5)((function(){var e;return[_e,null!==(e=a.promoList)&&void 0!==e&&e.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("span",ye,"или получить ещё"))]})),_:1})]})),_:1})]})),_:1})]})),_:1})],64)}var he={components:{IonIcon:se.gu,IonToolbar:se.sr,IonHeader:se.Gu,IonContent:se.W2,IonTitle:se.wd,IonList:se.q_,IonItem:se.Ie,IonText:se.yW,IonSkeletonText:se.CK},setup(){return{giftOutline:le._$o,closeOutline:le.fID,banOutline:le.L6S}},data(){return{promoList:null}},mounted(){this.listGet()},methods:{listGet(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t={type:"active",user_id:e.$heap.state.user.user_id},r.next=4,ae().post(`${e.$heap.state.hostname}Promo/listGet`,t);case 4:e.promoList=r.sent,r.next=9;break;case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()},promoPick(e){se.Fy.dismiss(e)}}},ke=t(3744);const we=(0,ke.Z)(he,[["render",ve]]);var ge=we,Ce={components:{UserAddressWidget:ce.Z,IonTextarea:se.g2,IonItemDivider:se.rH,IonIcon:se.gu,IonItem:se.Ie,IonList:se.q_,IonText:se.yW,IonButton:se.YG,IonCheckbox:se.nz,IonCard:se.PM,IonCardContent:se.FN,IonBadge:se.yp,IonImg:se.Xz,IonLabel:se.Q$},setup(){return{cardOutline:le.pvm,cashOutline:le.zaw,giftOutline:le._$o,cubeOutline:le.XFf,walletOutline:le.S5P,pieChartOutline:le.qlh,storefrontOutline:le.qRG,ordersIcon:ue,rocketOutline:le.G$D,documentTextOutline:le.L82}},data(){var e,r;return{order_id:this.$route.params.id,order:null,order_sum_delivery:0,storeCorrectionAllow:0==localStorage.storeCorrectionAllow?0:1,promo:null,promoCount:0,deliveryTime:{},termsAccepted:1,storeIsReady:0,errNotfound:0,paymentType:"use_card",bankCard:null,recurrentPaymentAllow:1==(null===(e=this.$heap.state.settings)||void 0===e||null===(r=e.other)||void 0===r?void 0:r.recurrentPaymentAllow)?1:0,tariffRule:{},tariffRuleList:[]}},computed:{checkoutError(){var e,r,t,n,o,i,a,u;return!!this.order&&(this.order_sum_total<2*this.order.order_sum_promo?`Сумма к оплате со скидкой ${this.order.order_sum_promo}${this.$heap.state.currencySign} должна быть больше чем ${2*this.order.order_sum_promo}${this.$heap.state.currencySign}`:1*this.order.order_sum_product<1*(null===(e=this.order)||void 0===e||null===(r=e.store)||void 0===r?void 0:r.store_minimal_order)?`Сумма заказа у "${null===(t=this.order)||void 0===t||null===(n=t.store)||void 0===n?void 0:n.store_name}" должна быть больше чем ${null===(o=this.order)||void 0===o||null===(i=o.store)||void 0===i?void 0:i.store_minimal_order}${this.$heap.state.currencySign}`:1*this.order_sum_total<=1*this.order_sum_delivery?`Сумма к оплате должна быть больше чем ${this.order_sum_delivery}${this.$heap.state.currencySign}`:this.order_sum_total<=10?"Сумма к оплате слишком маленькая":0==this.storeIsReady?`К сожалению, ${(null===(a=this.order)||void 0===a||null===(u=a.store)||void 0===u?void 0:u.store_name)||"продавец"} не готов к заказам`:0==this.termsAccepted?"К сожалению, мы не можем доставить вам заказ, без согласия с условиями":1==this.errNotfound?"Заказ удален":1==this.tariffRule.deliveryByCourier&&0==this.tariffRule.deliveryIsReady&&"К сожалению, нет доступных курьеров")},order_sum_total(){return this.order.order_sum_product-this.order.order_sum_promo+this.order_sum_delivery},deliveryByCourierRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((function(e){return 1==e.deliveryByCourier})).shift()},deliveryByCourierRuleChecked(){return 1==this.tariffRule.deliveryByCourier},deliveryByStoreRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((function(e){return 1==e.deliveryByStore})).shift()},deliveryByStoreRuleChecked(){return 1==this.tariffRule.deliveryByStore},pickupByCustomerRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((function(e){return 1==e.pickupByCustomer})).shift()},pickupByCustomerRuleChecked(){return 1==this.tariffRule.pickupByCustomer}},mounted(){this.checkoutDataGet()},ionViewDidEnter(){this.checkoutDataGet()},methods:{itemLoad(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ae().post(`${e.$heap.state.hostname}Order/itemGet`,{order_id:e.order_id});case 3:e.order=r.sent,0==e.order_sum_delivery&&(e.order_sum_delivery,e.order.order_sum_delivery),e.$heap.commit("setCurrentOrder",e.order),r.next=10;break;case 8:r.prev=8,r.t0=r["catch"](0);case 10:case"end":return r.stop()}}),r,null,[[0,8]])})))()},checkoutDataGet(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t,n,o;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.order=e.$heap.state.currentOrder,e.order){r.next=4;break}return r.next=4,e.itemLoad();case 4:if(e.order){r.next=7;break}return e.$flash("Заказ не найден"),r.abrupt("return");case 7:if("customer_confirmed"==e.order.stage_current){r.next=10;break}return e.$router.replace("order-"+e.order.order_id),r.abrupt("return");case 10:return r.prev=10,r.next=13,ae().post(`${e.$heap.state.hostname}Order/itemCheckoutDataGet`,{order_id:e.order.order_id});case 13:t=r.sent,e.deliveryTime=te.Z.deliveryTimeCalculate(t.Location_distanceHolderGet,null),e.promo=t.Promo_itemLinkGet,e.promoCount=t.Promo_listGet,e.storeIsReady=Array.isArray(t.Store_deliveryOptions)?1:0,e.bankCard=null===t||void 0===t?void 0:t.bankCard,e.tariffRuleList=t.Store_deliveryOptions,e.tariffRuleSet(e.tariffRuleList[0]||{}),r.next=36;break;case 23:if(r.prev=23,r.t0=r["catch"](10),n=null===r.t0||void 0===r.t0?void 0:r.t0.responseJSON,n){r.next=28;break}return r.abrupt("return",!1);case 28:o=n.messages.error,r.t1=o,r.next="not_ready"===r.t1||"no_tariff"===r.t1?32:34;break;case 32:return e.storeIsReady=0,r.abrupt("break",35);case 34:e.errNotfound=1;case 35:return r.abrupt("return",!1);case 36:case"end":return r.stop()}}),r,null,[[10,23]])})))()},tariffRuleSet(e){var r;this.tariffRule=e,this.order_sum_delivery=e.order_sum_delivery,this.paymentType="use_card",null!==(r=this.bankCard)&&void 0!==r&&r.card_type&&(this.paymentType="use_card_recurrent"),1==e.paymentByCashStore?this.paymentType="use_cash_store":1==e.paymentByCash&&(this.paymentType="use_cash"),1!=e.deliveryByCourier&&null!=this.promo&&(this.promoLink({order_id:this.order_id}),this.promo=null)},orderDescriptionChanged(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:t={order_id:e.order.order_id,order_description:e.order.order_description},re.Z.api.itemUpdate(t);case 2:case"end":return r.stop()}}),r)})))()},proceed(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t,n,o,i,a,u;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t={order_id:e.order.order_id,tariff_id:e.tariffRule.tariff_id,deliveryByStore:e.deliveryByStoreRuleChecked?1:0,deliveryByCourier:e.deliveryByCourierRuleChecked?1:0,pickupByCustomer:e.pickupByCustomerRuleChecked?1:0,paymentByCard:"use_card"==e.paymentType?1:0,paymentByCardRecurrent:"use_card_recurrent"==e.paymentType?1:0,paymentByCash:"use_cash"==e.paymentType?1:0,paymentByCashStore:"use_cash_store"==e.paymentType?1:0,storeCorrectionAllow:e.storeCorrectionAllow?1:0},localStorage.storeCorrectionAllow=e.storeCorrectionAllow?1:0,r.prev=2,r.next=5,ae().post(`${e.$heap.state.hostname}Order/itemCheckoutDataSet`,JSON.stringify(t));case 5:r.next=15;break;case 7:if(r.prev=7,r.t0=r["catch"](2),n=null===r.t0||void 0===r.t0?void 0:r.t0.responseJSON,n){r.next=12;break}return r.abrupt("return",!1);case 12:return n.messages.error,e.$flash("С заказом возникла проблема"),r.abrupt("return",!1);case 15:if(1!=t.paymentByCard){r.next=18;break}return e.paymentFormOpen({order_id:e.order.order_id,order_sum_total:e.order_sum_total,user_id:e.order.owner_id}),r.abrupt("return");case 18:if(1!=t.paymentByCardRecurrent){r.next=29;break}return o={order_id:e.order.order_id,card_id:e.bankCard.card_id},r.prev=20,r.next=23,ae().post(`${e.$heap.state.hostname}CardAcquirer/paymentDo`,o);case 23:r.next=29;break;case 25:return r.prev=25,r.t1=r["catch"](20),e.$flash("Оплата привязанной картой не удалась"),r.abrupt("return",!1);case 29:return r.prev=29,r.next=32,re.Z.api.itemStageCreate(e.order.order_id,"customer_start");case 32:e.$router.replace("/order/order-"+e.order.order_id),r.next=48;break;case 35:r.prev=35,r.t2=r["catch"](29),u=null===r.t2||void 0===r.t2||null===(i=r.t2.responseJSON)||void 0===i||null===(a=i.messages)||void 0===a?void 0:a.error,r.t3=u,r.next="order_is_empty"===r.t3?41:"address_not_set"===r.t3?43:47;break;case 41:return e.$alert("К сожалению, товара не осталось в наличии &#9785;","Заказ пуст"),r.abrupt("break",47);case 43:return e.$flash("Необходимо добавить адрес доставки"),e.$topic.publish("dismissModal"),e.$router.push("/user/user-addresses"),r.abrupt("break",47);case 47:return r.abrupt("return",!1);case 48:case"end":return r.stop()}}),r,null,[[2,7],[20,25],[29,35]])})))()},cancel(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:e.$router.replace("order-"+e.order.order_id);case 1:case"end":return r.stop()}}),r)})))()},paymentFormOpen(e){var r=this;return(0,ee.Z)((0,X.Z)().mark((function t(){var n,o,i;return(0,X.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=r,t.next=3,se.Fy.create({component:de.Z,componentProps:{order_data:e},initialBreakpoint:.85,breakpoints:[0,.85,.95]});case 3:return o=t.sent,i=function(){o.dismiss()},ne.Z.on("dismissModal",i),o.onDidDismiss().then((function(){n.paymentStatusCheck()})),t.abrupt("return",o.present());case 8:case"end":return t.stop()}}),t)})))()},paymentStatusCheck(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t,n,o,i,a;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t={order_id:e.order.order_id},r.prev=1,r.next=4,ae().post(e.$heap.state.hostname+"CardAcquirer/statusGet",t);case 4:n=r.sent,"OK"==n&&oe.Z.replace("order-"+e.order.order_id),r.next=13;break;case 8:r.prev=8,r.t0=r["catch"](1),e.$flash("Данный заказ не может быть оплачен"),a=null===(o=r.t0.responseJSON)||void 0===o||null===(i=o.messages)||void 0===i?void 0:i.error,"wrong_status"==a&&oe.Z.replace("order-"+e.order.order_id);case 13:case"end":return r.stop()}}),r,null,[[1,8]])})))()},promoPick(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t,n,o;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,se.Fy.create({component:ge,showBackdrop:!0,backdropDismiss:!0,initialBreakpoint:.6,breakpoints:[0,.6,.75]});case 2:return n=r.sent,n.present(),e.$topic.on("dismissModal",(function(){n.dismiss()})),r.next=7,n.onDidDismiss();case 7:o=r.sent,e.promoLink(o.data),null!==o&&void 0!==o&&null!==(t=o.data)&&void 0!==t&&t.promo_id?e.promo=o.data:e.promo=null;case 10:case"end":return r.stop()}}),r)})))()},promoLink(e){var r=this;return(0,ee.Z)((0,X.Z)().mark((function t(){var n;return(0,X.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={promo_id:null===e||void 0===e?void 0:e.promo_id,order_id:r.order.order_id},t.next=4,ae().post(`${r.$heap.state.hostname}Promo/itemLink`,n);case 4:r.itemLoad(),t.next=9;break;case 7:t.prev=7,t.t0=t["catch"](0);case 9:case"end":return t.stop()}}),t,null,[[0,7]])})))()},promoGet(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t={order_id:e.order.order_id},r.next=4,ae().post(`${e.$heap.state.hostname}Promo/itemLinkGet`,t);case 4:return r.abrupt("return",r.sent);case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()},promoCountGet(){var e=this;return(0,ee.Z)((0,X.Z)().mark((function r(){var t;return(0,X.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t={mode:"count",type:"active",user_id:e.$heap.state.user.user_id},r.next=4,ae().post(`${e.$heap.state.hostname}Promo/listGet`,t);case 4:return r.abrupt("return",r.sent);case 7:r.prev=7,r.t0=r["catch"](0);case 9:case"end":return r.stop()}}),r,null,[[0,7]])})))()}}};const be=(0,ke.Z)(Ce,[["render",Q],["__scopeId","data-v-40aecfe4"]]);var $e=be},659:function(e,r,t){e.exports=t.p+"img/loading.30880178.svg"},8764:function(e,r,t){e.exports=t.p+"img/orders.ea36eab8.svg"}}]);
//# sourceMappingURL=3422-legacy.66d7f567.js.map