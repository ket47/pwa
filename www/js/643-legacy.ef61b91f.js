(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[643],{4699:function(e,s,a){var l=a(9781),t=a(1702),n=a(1956),o=a(5656),r=a(5296).f,u=t(r),i=t([].push),d=function(e){return function(s){var a,t=o(s),r=n(t),d=r.length,p=0,m=[];while(d>p)a=r[p++],l&&!u(t,a)||i(m,e?[a,t[a]]:t[a]);return m}};e.exports={entries:d(!0),values:d(!1)}},2479:function(e,s,a){var l=a(2109),t=a(4699).values;l({target:"Object",stat:!0},{values:function(e){return t(e)}})},6643:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return h}});var l=a(6252);const t=["src"],n=["src"];function o(e,s,a,o,r,u){const i=(0,l.up)("ion-thumbnail"),d=(0,l.up)("ion-label"),p=(0,l.up)("ion-radio"),m=(0,l.up)("ion-item"),f=(0,l.up)("ion-radio-group"),_=(0,l.up)("ion-item-divider"),h=(0,l.up)("ion-input"),c=(0,l.up)("ion-button"),w=(0,l.up)("ion-list"),k=(0,l.up)("ion-icon"),v=(0,l.up)("ion-col"),W=(0,l.up)("ion-row"),g=(0,l.up)("ion-title"),b=(0,l.up)("ion-toolbar"),y=(0,l.up)("ion-header"),U=(0,l.up)("ion-content"),V=(0,l.up)("ion-modal"),$=(0,l.up)("base-layout");return(0,l.wg)(),(0,l.j4)($,{"page-title":"Мой профиль"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,{modelValue:r.fields.user_avatar_name,"onUpdate:modelValue":s[2]||(s[2]=e=>r.fields.user_avatar_name=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(i,{slot:"start"},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,t)])),_:1}),(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)("аватар 1")])),_:1}),(0,l.Wm)(p,{slot:"end",value:"man",onIonFocus:s[0]||(s[0]=e=>u.save("user_avatar_name",e.target.value))})])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(i,{slot:"start"},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,n)])),_:1}),(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)("аватар 2")])),_:1}),(0,l.Wm)(p,{slot:"end",value:"woman",onIonFocus:s[1]||(s[1]=e=>u.save("user_avatar_name",e.target.value))})])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Данные пользователя")])),_:1})])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("Ваш псевдоним")])),_:1}),(0,l.Wm)(h,{modelValue:r.fields.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>r.fields.user_name=e),name:"user_name",type:"text",onChange:s[4]||(s[4]=e=>u.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",required:""},null,8,["modelValue"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("Фамилия (не обязательно)")])),_:1}),(0,l.Wm)(h,{modelValue:r.fields.user_surname,"onUpdate:modelValue":s[5]||(s[5]=e=>r.fields.user_surname=e),name:"user_surname",type:"text",onChange:s[6]||(s[6]=e=>u.save("user_surname",e.target.value)),placeholder:"Фамилия (не обязательно)"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("Телефон")])),_:1}),(0,l.Wm)(h,{readonly:"",modelValue:r.fields.user_phone,"onUpdate:modelValue":s[7]||(s[7]=e=>r.fields.user_phone=e)},null,8,["modelValue"]),!r.fields.user_phone||r.fields.user_phone_verified&&"0"!==r.fields.user_phone_verified?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(c,{key:0,slot:"end",onClick:u.phoneVerify,expand:"block"},{default:(0,l.w5)((()=>[(0,l.Uk)("Подтвердить")])),_:1},8,["onClick"])),r.fields.user_phone&&r.fields.user_phone_verified&&"0"!==r.fields.user_phone_verified?((0,l.wg)(),(0,l.j4)(c,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,l.w5)((()=>[(0,l.Uk)("Подтверждено")])),_:1})):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)("Электронная почта")])),_:1}),(0,l.Wm)(h,{modelValue:r.fields.user_email,"onUpdate:modelValue":s[8]||(s[8]=e=>r.fields.user_email=e),name:"user_email",type:"email",onChange:s[9]||(s[9]=e=>u.save("user_email",e.target.value)),placeholder:"Электронная почта"},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Пароль пользователя")])),_:1})])),_:1}),(0,l.Wm)(W,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{onClick:s[10]||(s[10]=e=>u.passwordReset()),expand:"block"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,l.Uk)("Сбросить")])),_:1})])),_:1}),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{id:"passwordPromptButton",expand:"block"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,l.Uk)("Изменить")])),_:1})])),_:1})])),_:1}),(0,l.Wm)(V,{ref:"passwordPrompt",trigger:"passwordPromptButton","initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,{color:"secondary"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Новый пароль")])),_:1}),(0,l.Wm)(k,{icon:o.closeOutline,onClick:s[11]||(s[11]=()=>{this.$refs.passwordPrompt.$el.dismiss()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,l.Wm)(U,{class:"ion-padding"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked"},{default:(0,l.w5)((()=>[(0,l.Uk)("Новый пароль")])),_:1}),(0,l.Wm)(h,{modelValue:r.fields.user_pass,"onUpdate:modelValue":s[12]||(s[12]=e=>r.fields.user_pass=e),type:"text",placeholder:"пароль"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked"},{default:(0,l.w5)((()=>[(0,l.Uk)("Новый пароль (повтор)")])),_:1}),(0,l.Wm)(h,{modelValue:r.fields.user_pass_confirm,"onUpdate:modelValue":s[13]||(s[13]=e=>r.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(c,{onClick:s[14]||(s[14]=e=>u.passwordSave()),expand:"full"},{default:(0,l.w5)((()=>[(0,l.Uk)("Изменить")])),_:1})])),_:1})])),_:1},8,["initial-breakpoint","breakpoints"])])),_:1})}var r=a(8534),u=(a(4916),a(5306),a(8862),a(2479),a(1632)),i=a(8903),d=a(9755),p=a.n(d),m={components:{IonList:u.q_,IonItem:u.Ie,IonLabel:u.Q$,IonThumbnail:u.Bs,IonRadio:u.B7,IonRadioGroup:u.se,IonInput:u.pK,IonCol:u.wI,IonRow:u.Nd,IonItemDivider:u.rH,IonButton:u.YG,IonModal:u.ki,IonHeader:u.Gu,IonTitle:u.wd,IonContent:u.W2,IonIcon:u.gu,IonToolbar:u.sr},setup(){return{closeOutline:i.fID,keyOutline:i.eyg}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{save(e,s){var a=this;return(0,r.Z)((function*(){if("user_phone"==e){if(!a.isPhoneValid)return!1;s=s.replace(/\D/g,"")}var l={};l.user_id=a.$heap.state.user.user_id,l[e]=s,yield a.itemUpdate(l),a.fields[e]=s}))()},itemUpdate(e){var s=this;return(0,r.Z)((function*(){try{return yield p().post(`${s.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e)),!0}catch(a){let e="unknown";try{const s=Object.keys(JSON.parse(a.responseJSON.messages.error))[0],l=Object.values(JSON.parse(a.responseJSON.messages.error))[0];e=s+"_"+l}catch(l){}switch(e){case"user_phone_notunique":s.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":s.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":s.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":s.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":s.$flash("Такой е-маил уже используется");break;case"user_pass_short":s.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":s.$flash("Пароль не совпадает с подтверждением");break}return!1}}))()},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{p().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$go({name:"UserVerifyPhone",params:{phone:e}})}catch(s){}},passwordSave(){var e=this;return(0,r.Z)((function*(){if(e.fields.user_pass!=e.fields.user_pass_confirm)return void e.$flash("Пароль и подтверждение не совпадают");const s={user_id:e.$heap.state.user.user_id,user_pass:e.fields.user_pass},a=yield e.itemUpdate(s);a&&(e.$refs.passwordPrompt.$el.dismiss(),e.$flash("Пароль изменен"))}))()},passwordReset(){var e=this;return(0,r.Z)((function*(){const s={user_phone:e.fields.user_phone,user_email:e.fields.user_email,user_name:e.fields.user_name};try{yield p().post(`${e.$heap.state.hostname}User/passwordReset`,s),e.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch(a){}}))()},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let s="",a=0;for(let l in this.config.phoneMask){if(!this.fields.user_phone[a])break;let e=this.config.phoneMask[l];"0"==e?(s+=this.fields.user_phone[a],a++):s+=e}return this.fields.user_phone=s,this.fields.user_phone}},created(){const e=this;this.$topic.on("userGet",(s=>{e.fields=s}))}},f=a(3744);const _=(0,f.Z)(m,[["render",o]]);var h=_}}]);
//# sourceMappingURL=643-legacy.ef61b91f.js.map