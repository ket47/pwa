"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[5579],{1608:function(t,e,o){o.d(e,{Z:function(){return _}});var i=o(6252),n=o(3577);const l={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},a={slot:"end",style:{color:"#666"}};function r(t,e,o,r,s,c){const d=(0,i.up)("ymap-marker"),u=(0,i.up)("yandex-map"),m=(0,i.up)("ion-searchbar"),h=(0,i.up)("ion-item"),p=(0,i.up)("ion-content"),_=(0,i.up)("ion-textarea"),g=(0,i.up)("ion-icon"),w=(0,i.up)("ion-button"),f=(0,i.up)("ion-toolbar");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{onClick:e[0]||(e[0]=t=>c.onClick(t)),style:{height:"100%"},coords:s.coords,zoom:16,settings:s.settings,controls:["zoomControl"]},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{coords:s.coords,"marker-id":"1",properties:s.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,i._)("div",l,[(0,i.Wm)(m,{debounce:"500",modelValue:s.addressSearchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>s.addressSearchQuery=t),onIonInput:e[2]||(e[2]=t=>c.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.suggestions,((t,e)=>((0,i.wg)(),(0,i.j4)(h,{key:e,onClick:e=>c.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.subtitle.text)+" "+(0,n.zw)(t.title.text)+" ",1),(0,i._)("span",a,(0,n.zw)(t.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{label:"комментарий к адресу","label-placement":"floating",modelValue:s.addressComment,"onUpdate:modelValue":e[3]||(e[3]=t=>s.addressComment=t)},null,8,["modelValue"]),(0,i.Wm)(w,{strong:!0,onClick:e[4]||(e[4]=t=>c.pickAddress()),color:"primary",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{src:r.checkmark,slot:"start"},null,8,["src"]),(0,i.Uk)(" Ок ")])),_:1}),(0,i.Wm)(w,{onClick:e[5]||(e[5]=t=>r.closeModal()),color:"light",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Закрыть")])),_:1})])),_:1})],64)}o(3948),o(7658);var s=o(4929),c=o(5836),d=o(8903),u=o(351),m={components:{IonContent:s.W2,IonToolbar:s.sr,IonButton:s.YG,IonSearchbar:s.VI,IonIcon:s.gu,IonItem:s.Ie,IonTextarea:s.g2,yandexMap:c.xR,ymapMarker:c.Jk},setup(){const t=function(){s.Fy.dismiss()};return{closeModal:t,locationOutline:d.Iv7,closeOutline:d.fID,checkmark:d.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",e=this.$heap.state.settings.location,o=JSON.parse(e.mapCenter);return{settings:{apiKey:e.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},suggestions:[],addressSearchQuery:null,locationType:t,locSettings:e,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o,addressComment:""}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t;const e=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=e.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(o){}var e={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};s.Fy.dismiss(e)},filterAddress(t){const e=this.locSettings.addressErase.split(", "),o=t.split(", ");let i=[];for(const n of o)e.find((t=>t==n))||i.push(n);return i.reverse().join(", ")},onClick(t){t&&t.get&&(this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,e=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${e}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),i=await o.json();this.suggestions=i.results||[]}catch(t){}else this.suggestions=[]},async suggestionSelect(t,e){this.selectedAddress=t,this.geocode(e)},async geocode(t){try{this.suggestions=[];const e=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${e}&format=json&results=1&uri=${t}`),i=await o.json(),n=i.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=n.Point.pos.split(" ").reverse()}catch(e){console.log(e)}}},async mounted(){await(0,c.xk)();window.ymaps;const t=u.Z.geo.lastStoredGet();if(null!==t&&void 0!==t&&t.location_latitude)this.coords=[t.location_latitude,t.location_longitude];else{const{coords:t}=await u.Z.geo.get();this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}}},h=o(3744);const p=(0,h.Z)(m,[["render",r]]);var _=p},5579:function(t,e,o){o.r(e),o.d(e,{default:function(){return F}});var i=o(6252);function n(t,e,o,n,l,a){const r=(0,i.up)("shipment-draft-comp"),s=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(s,{"page-title":"Вызов курьера"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{orderData:l.order,onStageCreate:a.onStageCreate,onOrderUpdate:a.itemUpdate,onLocationCommentUpdate:a.locationCommentUpdate},null,8,["orderData","onStageCreate","onOrderUpdate","onLocationCommentUpdate"])])),_:1})}o(4916),o(5306),o(8862),o(7658);var l=o(9755),a=o.n(l),r=(o(1817),o(3577));const s=t=>((0,i.dD)("data-v-4b2180d7"),t=t(),(0,i.Cn)(),t),c={key:0},d=s((()=>(0,i._)("h1",null,"Ваш заказ",-1))),u=s((()=>(0,i._)("p",null,[(0,i._)("b",null,"Курьер отвезет вашу посылку")],-1))),m={key:1},h=s((()=>(0,i._)("b",null,"Откуда:",-1))),p={key:3},_=s((()=>(0,i._)("b",null,"Куда:",-1))),g={key:1},w=s((()=>(0,i._)("div",{slot:"end",style:{position:"relative",width:"120px","min-height":"48px","background-color":"var(--ion-color-light)"}},null,-1)));function f(t,e,o,n,l,a){const s=(0,i.up)("ion-label"),f=(0,i.up)("ion-item"),y=(0,i.up)("ion-textarea"),k=(0,i.up)("ion-item-divider"),v=((0,i.up)("ymap-marker"),(0,i.up)("yandex-map"),(0,i.up)("ion-img")),C=(0,i.up)("ion-thumbnail"),W=(0,i.up)("ion-icon"),S=(0,i.up)("ion-note"),I=(0,i.up)("ion-text"),b=(0,i.up)("ion-input"),D=(0,i.up)("ion-list"),L=(0,i.up)("ion-accordion"),$=(0,i.up)("ion-accordion-group"),U=(0,i.up)("ion-card-content"),x=(0,i.up)("ion-card"),O=(0,i.up)("ion-button"),j=(0,i.up)("ion-col"),z=(0,i.up)("ion-row"),F=(0,i.up)("ion-grid"),T=(0,i.up)("ion-skeleton-text");return o.orderData?((0,i.wg)(),(0,i.iD)("div",c,[(0,i.Wm)(D,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[d,u])),_:1})])),_:1}),(0,i.Wm)(f,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{ref:"description",modelValue:l.orderLocal.order_description,"onUpdate:modelValue":e[0]||(e[0]=t=>l.orderLocal.order_description=t),rows:"5",label:"",placeholder:"напишите, что будем везти",style:{"background-color":"var(--ion-color-light)","border-radius":"10px"},onIonInput:e[1]||(e[1]=t=>a.itemUpdate()),debounce:"50"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Детали перевозки")])),_:1}),(0,i.kq)("",!0),l.orderLocal.locationStart?((0,i.wg)(),(0,i.iD)("div",m,[(0,i.Wm)(f,{button:"",onClick:e[2]||(e[2]=t=>a.locationStartSelect())},{default:(0,i.w5)((()=>{var e;return[null!==(e=l.orderLocal.locationStart)&&void 0!==e&&e.image_hash?((0,i.wg)(),(0,i.j4)(C,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,i.w5)((()=>{var e;return[(0,i.Wm)(v,{src:`${t.$heap.state.hostname}image/get.php/${null===(e=l.orderLocal.locationStart)||void 0===e?void 0:e.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,i.wg)(),(0,i.j4)(W,{key:1,color:"primary",src:n.locationOutline,slot:"start"},null,8,["src"])),(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[h,(0,i.Uk)(),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(l.orderLocal.locationStart.location_address),1)])),_:1})])),_:1})]})),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,{modelValue:l.orderLocal.locationStart.location_comment,"onUpdate:modelValue":e[3]||(e[3]=t=>l.orderLocal.locationStart.location_comment=t),placeholder:"комментарий к адресу отправителя",label:"",debounce:"700",onIonInput:e[4]||(e[4]=t=>a.locationCommentUpdate("locationStart"))},null,8,["modelValue"])])),_:1})])):((0,i.wg)(),(0,i.j4)(f,{key:2,button:"","detail-icon":n.addOutline,onClick:e[5]||(e[5]=t=>a.locationStartSelect())},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{color:"medium",src:n.locationOutline,slot:"start"},null,8,["src"]),(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Откуда забрать?")])),_:1}),(0,i.Wm)(W,{color:"warning",src:n.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),l.orderLocal.locationFinish?((0,i.wg)(),(0,i.iD)("div",p,[o.orderData.locationFinish?((0,i.wg)(),(0,i.j4)(f,{key:0,button:"",onClick:e[6]||(e[6]=t=>a.locationFinishSelect())},{default:(0,i.w5)((()=>{var e;return[null!==(e=o.orderData.locationFinish)&&void 0!==e&&e.image_hash?((0,i.wg)(),(0,i.j4)(C,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,i.w5)((()=>{var e;return[(0,i.Wm)(v,{src:`${t.$heap.state.hostname}image/get.php/${null===(e=o.orderData.locationFinish)||void 0===e?void 0:e.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,i.wg)(),(0,i.j4)(W,{key:1,color:"primary",src:n.flagOutline,slot:"start"},null,8,["src"])),(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[_,(0,i.Uk)(),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(o.orderData.locationFinish.location_address),1)])),_:1})])),_:1})]})),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,{modelValue:l.orderLocal.locationFinish.location_comment,"onUpdate:modelValue":e[7]||(e[7]=t=>l.orderLocal.locationFinish.location_comment=t),placeholder:"комментарий к адресу получателя",label:"",debounce:"700",onIonInput:e[8]||(e[8]=t=>a.locationCommentUpdate("locationFinish"))},null,8,["modelValue"])])),_:1})])):((0,i.wg)(),(0,i.j4)(f,{key:4,button:"","detail-icon":n.addOutline,onClick:e[9]||(e[9]=t=>a.locationFinishSelect())},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{color:"medium",src:n.flagOutline,slot:"start"},null,8,["src"]),(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Куда отвезти?")])),_:1}),(0,i.Wm)(W,{color:"warning",src:n.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Итог")])),_:1}),(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,{slot:"header"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{icon:n.walletOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Итого: ")])),_:1}),(0,i.Wm)(s,{slot:"end",color:"primary"},{default:(0,i.w5)((()=>{var e,o;return[(0,i.Uk)((0,r.zw)(null!==(e=null===(o=l.orderLocal.deliveryCalculation)||void 0===o?void 0:o.sum)&&void 0!==e?e:0)+(0,r.zw)(t.$heap.state.currencySign),1)]})),_:1})])),_:1}),(0,i.Wm)(D,{slot:"content"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Вызов курьера")])),_:1}),(0,i.Wm)(s,{slot:"end",color:"primary"},{default:(0,i.w5)((()=>{var e,o;return[(0,i.Uk)((0,r.zw)(null!==(e=null===(o=l.orderLocal.deliveryCalculation)||void 0===o?void 0:o.cost)&&void 0!==e?e:0)+(0,r.zw)(t.$heap.state.currencySign),1)]})),_:1})])),_:1}),(0,i.Wm)(f,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{color:"medium"},{default:(0,i.w5)((()=>{var e,o;return[(0,i.Uk)("Расстояние по карте "+(0,r.zw)(a.deliveryDistanceKm)+"км по "+(0,r.zw)(null!==(e=null===(o=l.orderLocal.deliveryCalculation)||void 0===o?void 0:o.fee)&&void 0!==e?e:0)+(0,r.zw)(t.$heap.state.currencySign),1)]})),_:1}),(0,i.Wm)(s,{slot:"end",color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(a.deliveryFeeTotal)+(0,r.zw)(t.$heap.state.currencySign),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),a.checkoutError?((0,i.wg)(),(0,i.j4)(x,{key:0,color:"warning"},{default:(0,i.w5)((()=>[(0,i.Wm)(U,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(a.checkoutError),1)])),_:1})])),_:1})):(0,i.kq)("",!0),a.isReadyToCheckout?((0,i.wg)(),(0,i.j4)(F,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.nextStageButtons,((t,e)=>((0,i.wg)(),(0,i.j4)(j,{key:e},{default:(0,i.w5)((()=>{var n,l;return[t[0]?((0,i.wg)(),(0,i.j4)(O,{key:0,onClick:i=>a.stageCreate(o.orderData.order_id,e,t[1]),expand:"block",color:null!==(n=t[1])&&void 0!==n?n:"primary",fill:null!==(l=t[2])&&void 0!==l?l:"solid"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{slot:"start",src:t.icon},null,8,["src"]),(0,i.Uk)(" "+(0,r.zw)(t[0]),1)])),_:2},1032,["onClick","color","fill"])):(0,i.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(F,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(j,null,{default:(0,i.w5)((()=>[o.orderData.order_description?o.orderData.locationStart?o.orderData.locationFinish?l.isContentValid&&l.isDimentionValid?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(O,{key:3,onClick:e[13]||(e[13]=t=>l.isContentValid=l.isDimentionValid=1),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Согласиться с условиями ")])),_:1})):((0,i.wg)(),(0,i.j4)(O,{key:2,onClick:e[12]||(e[12]=t=>a.locationFinishSelect()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Куда отвезти ")])),_:1})):((0,i.wg)(),(0,i.j4)(O,{key:1,onClick:e[11]||(e[11]=t=>a.locationStartSelect()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Откуда забрать ")])),_:1})):((0,i.wg)(),(0,i.j4)(O,{key:0,onClick:e[10]||(e[10]=e=>t.$refs.description.$el.setFocus()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Заполнить описание ")])),_:1}))])),_:1})])),_:1})])),_:1}))])):((0,i.wg)(),(0,i.iD)("div",g,[(0,i.Wm)(f,{detail:"",button:"",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{slot:"start",icon:n.storefrontOutline},null,8,["icon"]),(0,i.Wm)(T,{animated:"",style:{width:"200px"}})])),_:1}),(0,i.Wm)(D,null,{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3],(t=>(0,i.Wm)(f,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(C,{style:{"background-color":"var(--ion-color-light)"}}),(0,i.Wm)(F,null,{default:(0,i.w5)((()=>[(0,i.Wm)(j,null,{default:(0,i.w5)((()=>[(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(T,{animated:"",style:{width:"100%"}})])),_:1}),(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{animated:"",style:{width:"100px"}})])),_:1})])),_:1})])),_:1})])),_:1}),w])),_:2},1024))),64))])),_:1}),(0,i.Wm)(F,null,{default:(0,i.w5)((()=>[(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2],(t=>(0,i.Wm)(j,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(O,{color:"light",style:{width:"100%"}})])),_:2},1024))),64))])),_:1})])),_:1})]))}o(6699);var y=o(4929),k=o(8903),v=o(5836);function C(t,e,o,n,l,a){const s=(0,i.up)("ion-title"),c=(0,i.up)("ion-icon"),d=(0,i.up)("ion-item"),u=(0,i.up)("ion-toolbar"),m=(0,i.up)("ion-header"),h=(0,i.up)("ion-img"),p=(0,i.up)("ion-label"),_=(0,i.up)("ion-list"),g=(0,i.up)("ion-list-header"),w=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Мои адреса")])),_:1}),(0,i.Wm)(c,{slot:"end",onClick:e[0]||(e[0]=t=>{a.modalClose()}),icon:n.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[l.locationList.length?((0,i.wg)(),(0,i.j4)(_,{key:0,lines:"full"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.locationList,((e,o)=>((0,i.wg)(),(0,i.j4)(d,{key:e.location_id},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.Wm)(p,{onClick:t=>a.locationSelect(e),style:{"white-space":"normal",cursor:"pointer"},class:(0,r.C_)(1==e.is_main?"is_main":"")},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.location_address),1)])),_:2},1032,["onClick","class"]),(0,i.Wm)(c,{slot:"end",icon:n.trashOutline,onClick:t=>a.locationDelete(`${e.location_id}`,`${o}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить адрес")])),_:1})])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.locationGroupList,(e=>((0,i.wg)(),(0,i.j4)(d,{key:e.group_id,onClick:t=>a.modalLocationCreate(`${e.group_id}`,`${e.group_name}`),style:{cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.group_name),1)])),_:2},1024),(0,i.Wm)(c,{src:n.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}o(3948);var W=o(2008),S=o(351),I=o(1608),b={components:{IonImg:y.Xz,IonLabel:y.Q$,IonItem:y.Ie,IonList:y.q_,IonListHeader:y.yh,IonIcon:y.gu,IonHeader:y.Gu,IonToolbar:y.sr,IonTitle:y.wd,IonContent:y.W2},setup(){return{locationOutline:k.Iv7,trashOutline:k.gtu,addOutline:k.s6O,closeOutline:k.fID}},data(){return{locationList:[],locationGroupList:[]}},mounted(){this.locationListGet(),this.$topic.on("dismissModal",(()=>this.modalClose()))},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{modalClose(){y.Fy.dismiss(null,"cancel")},async modalLocationCreate(t,e){if(!W.Z.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/user/sign-in"));var o=String(e).toLowerCase();const i=await y.Fy.create({component:I.Z,showBackdrop:!0,componentProps:{location_group_name_low:o}});return i.onDidDismiss().then((e=>{this.locationCreate(t,e.data)})),i.present()},async locationListGet(){try{let t=null;const e=await a().get(W.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=e.location_list,this.locationGroupList=e.location_group_list,this.locationList)for(let o of this.locationList)1==o.is_main&&(t=o);if(!t)return void S.Z.get()}catch(t){}},async locationCreate(t,e){if(!e)return;let o={location_holder:"user",location_holder_id:W.Z.state.user.user_id,location_group_id:t,location_address:e.location_address,location_latitude:e.location_latitude,location_longitude:e.location_longitude};try{await a().post(W.Z.state.hostname+"User/locationCreate",o),this.locationListGet()}catch(i){const t=i.responseJSON,e=t.messages.error;switch(e){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},locationSelect(t){y.Fy.dismiss(t,"confirm")},async locationDelete(t,e){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(e,1),await a().post(W.Z.state.hostname+"User/locationDelete",{location_id:t})}catch(o){}this.locationListGet()}}}},D=o(3744);const L=(0,D.Z)(b,[["render",C],["__scopeId","data-v-1f3c9982"]]);var $=L,U={props:["orderData"],components:{yandexMap:v.xR,ymapMarker:v.Jk,IonIcon:y.gu,IonText:y.yW,IonLabel:y.Q$,IonItem:y.Ie,IonList:y.q_,IonImg:y.Xz,IonThumbnail:y.Bs,IonNote:y.uN,IonButton:y.YG,IonCol:y.wI,IonRow:y.Nd,IonGrid:y.jY,IonSkeletonText:y.CK,IonCard:y.PM,IonCardHeader:y.Zi,IonCardContent:y.FN,IonCardTitle:y.Dq,IonItemDivider:y.rH,IonTextarea:y.g2,IonInput:y.pK,IonAccordion:y.We,IonAccordionGroup:y.eh},setup(){return{add:k.IHx,remove:k.OdJ,trash:k._Ij,rocketOutline:k.G$D,storefrontOutline:k.qRG,checkmarkOutline:k.TjA,cubeOutline:k.XFf,walletOutline:k.S5P,banOutline:k.L6S,giftOutline:k._$o,cardOutline:k.pvm,ribbonOutline:k.Muk,chatboxEllipsesOutline:k._Pt,locationOutline:k.Iv7,flagOutline:k.FMn,chevronDown:k.Dd1,addOutline:k.s6O,checkmark:k.d29,cashOutline:k.zaw,businessOutline:k.c1X,alertCircleOutline:k.nLD,helpCircleOutline:k.Sm}},data(){return{isDimentionValid:1,isContentValid:1,orderLocal:{}}},computed:{checkoutError(){var t,e;const o=null!==(t=null===(e=this.orderLocal.deliveryCalculation)||void 0===e?void 0:e.error)&&void 0!==t?t:null;if("no_input"==o)return"Выберите адрес забора и доставки посылки";if("start_center_toofar"==o)return"Адрес получения посылки слишком удален";if("finish_center_toofar"==o)return"Адрес доставки посылки слишком удален";if("start_finish_toofar"==o){var i;const t=Math.round((null===(i=this.orderLocal.deliveryCalculation)||void 0===i?void 0:i.max_distance)/100)/10;return`Расстояние по карте между адресами ${this.deliveryDistanceKm}км, больше максимального в ${t}км`}return null},deliveryDistanceKm(){var t;return Math.round((null===(t=this.orderLocal.deliveryCalculation)||void 0===t?void 0:t.deliveryDistance)/100)/10},deliveryFeeTotal(){var t,e;const o=null!==(t=null===(e=this.orderLocal.deliveryCalculation)||void 0===e?void 0:e.fee)&&void 0!==t?t:0;return Math.round(o*this.deliveryDistanceKm)},isReadyToCheckout(){return this.orderData.order_description&&this.orderData.locationStart&&this.orderData.locationFinish&&!this.checkoutError},nextStageButtons(){let t={};for(let e in this.orderData.stage_next)this.orderData.stage_next[e][0]&&(t[e]=this.orderData.stage_next[e],t[e].icon=k.TjA,e.includes("admin")?t[e].icon=k.Muk:e.includes("delivery")?t[e].icon=k.G$D:e.includes("supplier")&&(t[e].icon=k.qRG));return t}},methods:{stageCreate(t,e,o){("danger"!=o||confirm("Вы уверены?"))&&this.$emit("stageCreate",t,e)},async itemUpdate(t="skipRefresh"){const e=this.orderLocal;e.mode=t,this.$emit("orderUpdate",e)},async locationSelect(){const t=document.querySelector("ion-router-outlet"),e=await y.Fy.create({component:$,canDismiss:!0,backdropDismiss:!0,keyboardClose:!0,presentingElement:t});e.present();const{data:o,role:i}=await e.onWillDismiss();return o},async locationStartSelect(){var t;this.orderLocal.locationStart=await this.locationSelect(),this.orderLocal.start_location_id=null===(t=this.orderLocal.locationStart)||void 0===t?void 0:t.location_id,this.itemUpdate("refreshTotalEstimates")},async locationFinishSelect(){var t;this.orderLocal.locationFinish=await this.locationSelect(),this.orderLocal.finish_location_id=null===(t=this.orderLocal.locationFinish)||void 0===t?void 0:t.location_id,this.itemUpdate("refreshTotalEstimates")},async locationCommentUpdate(t){const e=this.orderLocal[t],o={location_id:e.location_id,location_comment:e.location_comment};this.$emit("locationCommentUpdate",o),this.itemUpdate()}},async created(){this.orderLocal=this.orderData},watch:{orderData:async function(t){this.orderLocal=t,this.orderLocal}}};const x=(0,D.Z)(U,[["render",f],["__scopeId","data-v-4b2180d7"]]);var O=x,j={components:{ShipmentDraftComp:O},data(){return{order:null,errorCode:null}},methods:{async itemCreate(){const t=new Date,e={order_store_id:null,order_id:0,entries:[],created_at:t.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.itemSave(e)},async itemLoad(){try{const t=JSON.parse(localStorage.shipmentDraft);if(t)return t.deliveryCalculation=await this.itemTotalEstimate(t.start_location_id,t.finish_location_id),void(this.order=t)}catch(t){}this.itemCreate()},itemSave(t){this.order=t,localStorage.shipmentDraft=JSON.stringify(t)},async itemUpdate(t){console.log(t.mode),"refreshTotalEstimates"==t.mode&&(t.deliveryCalculation=await this.itemTotalEstimate(t.start_location_id,t.finish_location_id)),this.itemSave(Object.assign({},this.order,t))},async locationCommentUpdate(t){try{await a().post(`${this.$heap.state.hostname}Location/itemUpdate`,JSON.stringify(t)),this.$flash("сохранено")}catch(e){}},async itemTotalEstimate(t,e){if(!t||!e)return;const o={start_location_id:t,finish_location_id:e};try{return await a().post(`${this.$heap.state.hostname}Shipment/itemDeliverySumEstimate`,o)}catch(i){}},async onStageCreate(t,e){if("customer_purged"==e||"customer_deleted"==e)return localStorage.removeItem("shipmentDraft"),void this.$router.replace("/order/order-list");"customer_action_confirm"==e&&(e="customer_confirmed");try{const t={is_shopping:0,order_description:this.order.order_description,order_start_location_id:this.order.start_location_id,order_finish_location_id:this.order.finish_location_id},e=await a().post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(t));e>0&&this.$router.push(`/modal/shipment-checkout-${e}`)}catch(n){var o,i;const e=null===n||void 0===n||null===(o=n.responseJSON)||void 0===o||null===(i=o.messages)||void 0===i?void 0:i.error;if(!e)return!1;switch(e){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии ☹️","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+t;break}return!1}}},mounted(){this.itemLoad()}};const z=(0,D.Z)(j,[["render",n]]);var F=z}}]);
//# sourceMappingURL=5579-legacy.23610f61.js.map