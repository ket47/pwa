"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[643],{6643:function(e,s,a){a.r(s),a.d(s,{default:function(){return _}});var t=a(6252);const l=["src"],n=["src"];function o(e,s,a,o,i,u){const r=(0,t.up)("ion-thumbnail"),d=(0,t.up)("ion-label"),p=(0,t.up)("ion-radio"),m=(0,t.up)("ion-item"),h=(0,t.up)("ion-radio-group"),_=(0,t.up)("ion-item-divider"),f=(0,t.up)("ion-input"),c=(0,t.up)("ion-button"),w=(0,t.up)("ion-list"),k=(0,t.up)("ion-icon"),W=(0,t.up)("ion-col"),g=(0,t.up)("ion-row"),v=(0,t.up)("ion-title"),y=(0,t.up)("ion-toolbar"),U=(0,t.up)("ion-header"),b=(0,t.up)("ion-content"),V=(0,t.up)("ion-modal"),$=(0,t.up)("base-layout");return(0,t.wg)(),(0,t.j4)($,{"page-title":"Мой профиль"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,null,{default:(0,t.w5)((()=>[(0,t.Wm)(h,{modelValue:i.fields.user_avatar_name,"onUpdate:modelValue":s[2]||(s[2]=e=>i.fields.user_avatar_name=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{slot:"start"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,l)])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Uk)("аватар 1")])),_:1}),(0,t.Wm)(p,{slot:"end",value:"man",onIonFocus:s[0]||(s[0]=e=>u.save("user_avatar_name",e.target.value))})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,{slot:"start"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,n)])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Uk)("аватар 2")])),_:1}),(0,t.Wm)(p,{slot:"end",value:"woman",onIonFocus:s[1]||(s[1]=e=>u.save("user_avatar_name",e.target.value))})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Данные пользователя")])),_:1})])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("Ваш псевдоним")])),_:1}),(0,t.Wm)(f,{modelValue:i.fields.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>i.fields.user_name=e),name:"user_name",type:"text",onChange:s[4]||(s[4]=e=>u.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",required:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("Фамилия (не обязательно)")])),_:1}),(0,t.Wm)(f,{modelValue:i.fields.user_surname,"onUpdate:modelValue":s[5]||(s[5]=e=>i.fields.user_surname=e),name:"user_surname",type:"text",onChange:s[6]||(s[6]=e=>u.save("user_surname",e.target.value)),placeholder:"Фамилия (не обязательно)"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("Телефон")])),_:1}),(0,t.Wm)(f,{readonly:"",modelValue:i.fields.user_phone,"onUpdate:modelValue":s[7]||(s[7]=e=>i.fields.user_phone=e)},null,8,["modelValue"]),!i.fields.user_phone||i.fields.user_phone_verified&&"0"!==i.fields.user_phone_verified?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(c,{key:0,slot:"end",onClick:u.phoneVerify,expand:"block"},{default:(0,t.w5)((()=>[(0,t.Uk)("Подтвердить")])),_:1},8,["onClick"])),i.fields.user_phone&&i.fields.user_phone_verified&&"0"!==i.fields.user_phone_verified?((0,t.wg)(),(0,t.j4)(c,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,t.w5)((()=>[(0,t.Uk)("Подтверждено")])),_:1})):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("Электронная почта")])),_:1}),(0,t.Wm)(f,{modelValue:i.fields.user_email,"onUpdate:modelValue":s[8]||(s[8]=e=>i.fields.user_email=e),name:"user_email",type:"email",onChange:s[9]||(s[9]=e=>u.save("user_email",e.target.value)),placeholder:"Электронная почта"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Пароль пользователя")])),_:1})])),_:1}),(0,t.Wm)(g,{"responsive-sm":""},{default:(0,t.w5)((()=>[(0,t.Wm)(W,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{onClick:s[10]||(s[10]=e=>u.passwordReset()),expand:"block"},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,t.Uk)("Сбросить")])),_:1})])),_:1}),(0,t.Wm)(W,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{id:"passwordPromptButton",expand:"block"},{default:(0,t.w5)((()=>[(0,t.Wm)(k,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,t.Uk)("Изменить")])),_:1})])),_:1})])),_:1}),(0,t.Wm)(V,{ref:"passwordPrompt",trigger:"passwordPromptButton","initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,t.w5)((()=>[(0,t.Wm)(U,null,{default:(0,t.w5)((()=>[(0,t.Wm)(y,{color:"secondary"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Новый пароль")])),_:1}),(0,t.Wm)(k,{icon:o.closeOutline,onClick:s[11]||(s[11]=()=>{this.$refs.passwordPrompt.$el.dismiss()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,t.Wm)(b,{class:"ion-padding"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked"},{default:(0,t.w5)((()=>[(0,t.Uk)("Новый пароль")])),_:1}),(0,t.Wm)(f,{modelValue:i.fields.user_pass,"onUpdate:modelValue":s[12]||(s[12]=e=>i.fields.user_pass=e),type:"text",placeholder:"пароль"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked"},{default:(0,t.w5)((()=>[(0,t.Uk)("Новый пароль (повтор)")])),_:1}),(0,t.Wm)(f,{modelValue:i.fields.user_pass_confirm,"onUpdate:modelValue":s[13]||(s[13]=e=>i.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(c,{onClick:s[14]||(s[14]=e=>u.passwordSave()),expand:"full"},{default:(0,t.w5)((()=>[(0,t.Uk)("Изменить")])),_:1})])),_:1})])),_:1},8,["initial-breakpoint","breakpoints"])])),_:1})}a(4916),a(5306),a(8862);var i=a(1632),u=a(8903),r=a(9755),d=a.n(r),p={components:{IonList:i.q_,IonItem:i.Ie,IonLabel:i.Q$,IonThumbnail:i.Bs,IonRadio:i.B7,IonRadioGroup:i.se,IonInput:i.pK,IonCol:i.wI,IonRow:i.Nd,IonItemDivider:i.rH,IonButton:i.YG,IonModal:i.ki,IonHeader:i.Gu,IonTitle:i.wd,IonContent:i.W2,IonIcon:i.gu,IonToolbar:i.sr},setup(){return{closeOutline:u.fID,keyOutline:u.eyg}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{async save(e,s){if("user_phone"==e){if(!this.isPhoneValid)return!1;s=s.replace(/\D/g,"")}var a={};a.user_id=this.$heap.state.user.user_id,a[e]=s,await this.itemUpdate(a),this.fields[e]=s},async itemUpdate(e){try{return await d().post(`${this.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e)),!0}catch(s){let e="unknown";try{const a=Object.keys(JSON.parse(s.responseJSON.messages.error))[0],t=Object.values(JSON.parse(s.responseJSON.messages.error))[0];e=a+"_"+t}catch(a){}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break}return!1}},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{d().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$go({name:"UserVerifyPhone",params:{phone:e}})}catch(s){}},async passwordSave(){if(this.fields.user_pass!=this.fields.user_pass_confirm)return void this.$flash("Пароль и подтверждение не совпадают");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass},s=await this.itemUpdate(e);s&&(this.$refs.passwordPrompt.$el.dismiss(),this.$flash("Пароль изменен"))},async passwordReset(){const e={user_phone:this.fields.user_phone,user_email:this.fields.user_email,user_name:this.fields.user_name};try{await d().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch(s){}},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let s="",a=0;for(let t in this.config.phoneMask){if(!this.fields.user_phone[a])break;let e=this.config.phoneMask[t];"0"==e?(s+=this.fields.user_phone[a],a++):s+=e}return this.fields.user_phone=s,this.fields.user_phone}},created(){const e=this;this.$topic.on("userGet",(s=>{e.fields=s}))}},m=a(3744);const h=(0,m.Z)(p,[["render",o]]);var _=h}}]);
//# sourceMappingURL=643.94c658cd.js.map