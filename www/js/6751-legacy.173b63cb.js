(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[6751],{4699:function(e,n,t){var r=t(9781),u=t(1702),a=t(1956),s=t(5656),o=t(5296).f,l=u(o),i=u([].push),d=function(e){return function(n){var t,u=s(n),o=a(u),d=o.length,f=0,p=[];while(d>f)t=o[f++],r&&!l(u,t)||i(p,e?[t,u[t]]:u[t]);return p}};e.exports={entries:d(!0),values:d(!1)}},2479:function(e,n,t){var r=t(2109),u=t(4699).values;r({target:"Object",stat:!0},{values:function(e){return u(e)}})},6751:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return P}});var r=t(6252),u=["src"],a=(0,r.Uk)("аватар 1"),s=["src"],o=(0,r.Uk)("аватар 2"),l=(0,r.Uk)("Данные пользователя"),i=(0,r.Uk)("Ваш псевдоним"),d=(0,r.Uk)("Фамилия (не обязательно)"),f=(0,r.Uk)("Телефон"),p=(0,r.Uk)("Подтвердить"),c=(0,r.Uk)("Подтверждено"),m=(0,r.Uk)("Электронная почта"),_=(0,r.Uk)("Пароль пользователя"),h=(0,r.Uk)("Сбросить"),w=(0,r.Uk)("Изменить"),k=(0,r.Uk)("Новый пароль"),v=(0,r.Uk)("Новый пароль"),b=(0,r.Uk)("Новый пароль (повтор)"),W=(0,r.Uk)("Изменить");function g(e,n,t,g,U,V){var $=this,I=(0,r.up)("ion-thumbnail"),y=(0,r.up)("ion-label"),x=(0,r.up)("ion-radio"),O=(0,r.up)("ion-item"),Z=(0,r.up)("ion-radio-group"),C=(0,r.up)("ion-item-divider"),P=(0,r.up)("ion-input"),S=(0,r.up)("ion-button"),q=(0,r.up)("ion-list"),D=(0,r.up)("ion-icon"),j=(0,r.up)("ion-col"),B=(0,r.up)("ion-row"),N=(0,r.up)("ion-title"),R=(0,r.up)("ion-toolbar"),J=(0,r.up)("ion-header"),G=(0,r.up)("ion-content"),M=(0,r.up)("ion-modal"),z=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(z,{"page-title":"Мой профиль",pageDefaultBackLink:"/user"},{default:(0,r.w5)((function(){return[(0,r.Wm)(q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(Z,{modelValue:U.fields.user_avatar_name,"onUpdate:modelValue":n[2]||(n[2]=function(e){return U.fields.user_avatar_name=e})},{default:(0,r.w5)((function(){return[(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r._)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,u)]})),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[a]})),_:1}),(0,r.Wm)(x,{slot:"end",value:"man",onIonFocus:n[0]||(n[0]=function(e){return V.save("user_avatar_name",e.target.value)})})]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r._)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,s)]})),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[o]})),_:1}),(0,r.Wm)(x,{slot:"end",value:"woman",onIonFocus:n[1]||(n[1]=function(e){return V.save("user_avatar_name",e.target.value)})})]})),_:1})]})),_:1},8,["modelValue"]),(0,r.Wm)(C,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[l]})),_:1})]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{position:"stacked",color:"primary"},{default:(0,r.w5)((function(){return[i]})),_:1}),(0,r.Wm)(P,{modelValue:U.fields.user_name,"onUpdate:modelValue":n[3]||(n[3]=function(e){return U.fields.user_name=e}),name:"user_name",type:"text",onChange:n[4]||(n[4]=function(e){return V.save("user_name",e.target.value)}),placeholder:"как к вам обращаться?",required:""},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{position:"stacked",color:"primary"},{default:(0,r.w5)((function(){return[d]})),_:1}),(0,r.Wm)(P,{modelValue:U.fields.user_surname,"onUpdate:modelValue":n[5]||(n[5]=function(e){return U.fields.user_surname=e}),name:"user_surname",type:"text",onChange:n[6]||(n[6]=function(e){return V.save("user_surname",e.target.value)}),placeholder:"Фамилия (не обязательно)"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{position:"stacked",color:"primary"},{default:(0,r.w5)((function(){return[f]})),_:1}),(0,r.Wm)(P,{readonly:"",modelValue:U.fields.user_phone,"onUpdate:modelValue":n[7]||(n[7]=function(e){return U.fields.user_phone=e})},null,8,["modelValue"]),!U.fields.user_phone||U.fields.user_phone_verified&&"0"!==U.fields.user_phone_verified?(0,r.kq)("",!0):((0,r.wg)(),(0,r.j4)(S,{key:0,slot:"end",onClick:V.phoneVerify,expand:"block"},{default:(0,r.w5)((function(){return[p]})),_:1},8,["onClick"])),U.fields.user_phone&&U.fields.user_phone_verified&&"0"!==U.fields.user_phone_verified?((0,r.wg)(),(0,r.j4)(S,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,r.w5)((function(){return[c]})),_:1})):(0,r.kq)("",!0)]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{position:"stacked",color:"primary"},{default:(0,r.w5)((function(){return[m]})),_:1}),(0,r.Wm)(P,{modelValue:U.fields.user_email,"onUpdate:modelValue":n[8]||(n[8]=function(e){return U.fields.user_email=e}),name:"user_email",type:"email",onChange:n[9]||(n[9]=function(e){return V.save("user_email",e.target.value)}),placeholder:"Электронная почта"},null,8,["modelValue"])]})),_:1})]})),_:1}),(0,r.Wm)(C,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[_]})),_:1})]})),_:1}),(0,r.Wm)(B,{"responsive-sm":""},{default:(0,r.w5)((function(){return[(0,r.Wm)(j,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(S,{onClick:n[10]||(n[10]=function(e){return V.passwordReset()}),expand:"block"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{icon:g.keyOutline,slot:"start"},null,8,["icon"]),h]})),_:1})]})),_:1}),(0,r.Wm)(j,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(S,{id:"passwordPromptButton",expand:"block"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{icon:g.keyOutline,slot:"start"},null,8,["icon"]),w]})),_:1})]})),_:1})]})),_:1}),(0,r.Wm)(M,{ref:"passwordPrompt",trigger:"passwordPromptButton","initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,r.w5)((function(){return[(0,r.Wm)(J,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(R,{color:"secondary"},{default:(0,r.w5)((function(){return[(0,r.Wm)(N,null,{default:(0,r.w5)((function(){return[k]})),_:1}),(0,r.Wm)(D,{icon:g.closeOutline,onClick:n[11]||(n[11]=function(){$.$refs.passwordPrompt.$el.dismiss()}),slot:"end",size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,r.Wm)(G,{class:"ion-padding"},{default:(0,r.w5)((function(){return[(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{position:"stacked"},{default:(0,r.w5)((function(){return[v]})),_:1}),(0,r.Wm)(P,{modelValue:U.fields.user_pass,"onUpdate:modelValue":n[12]||(n[12]=function(e){return U.fields.user_pass=e}),type:"text",placeholder:"пароль"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{position:"stacked"},{default:(0,r.w5)((function(){return[b]})),_:1}),(0,r.Wm)(P,{modelValue:U.fields.user_pass_confirm,"onUpdate:modelValue":n[13]||(n[13]=function(e){return U.fields.user_pass_confirm=e}),type:"text",placeholder:"пароль (повтор)"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(S,{onClick:n[14]||(n[14]=function(e){return V.passwordSave()}),expand:"full"},{default:(0,r.w5)((function(){return[W]})),_:1})]})),_:1})]})),_:1},8,["initial-breakpoint","breakpoints"])]})),_:1})}var U=t(6835),V=t(8534),$=(t(4916),t(5306),t(8862),t(2479),t(8292)),I=t(8903),y=t(9755),x=t.n(y),O={components:{IonList:$.q_,IonItem:$.Ie,IonLabel:$.Q$,IonThumbnail:$.Bs,IonRadio:$.B7,IonRadioGroup:$.se,IonInput:$.pK,IonCol:$.wI,IonRow:$.Nd,IonItemDivider:$.rH,IonButton:$.YG,IonModal:$.ki,IonHeader:$.Gu,IonTitle:$.wd,IonContent:$.W2,IonIcon:$.gu,IonToolbar:$.sr},setup(){return{closeOutline:I.fID,keyOutline:I.eyg}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{save(e,n){var t=this;return(0,V.Z)((0,U.Z)().mark((function r(){var u;return(0,U.Z)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if("user_phone"!=e){r.next=4;break}if(t.isPhoneValid){r.next=3;break}return r.abrupt("return",!1);case 3:n=n.replace(/\D/g,"");case 4:return u={},u.user_id=t.$heap.state.user.user_id,u[e]=n,r.next=9,t.itemUpdate(u);case 9:t.fields[e]=n;case 10:case"end":return r.stop()}}),r)})))()},itemUpdate(e){var n=this;return(0,V.Z)((0,U.Z)().mark((function t(){var r,u,a;return(0,U.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,x().post(`${n.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e));case 3:return t.abrupt("return",!0);case 6:t.prev=6,t.t0=t["catch"](0),r="unknown";try{u=Object.keys(JSON.parse(t.t0.responseJSON.messages.error))[0],a=Object.values(JSON.parse(t.t0.responseJSON.messages.error))[0],r=u+"_"+a}catch(s){}t.t1=r,t.next="user_phone_notunique"===t.t1?13:"user_phone_required"===t.t1||"user_phone_invalid"===t.t1||"user_phone_short"===t.t1?15:"user_name_required"===t.t1||"user_name_short"===t.t1?17:"user_email_invalid"===t.t1?19:"user_email_notunique"===t.t1?21:"user_pass_short"===t.t1?23:"user_pass_notmatches"===t.t1?25:27;break;case 13:return n.$flash("Пользователь с таким телефоном уже зарегистрирован"),t.abrupt("break",27);case 15:return n.$flash("Проверьте номер телефона"),t.abrupt("break",27);case 17:return n.$flash("Проверьте ваш псевдоним"),t.abrupt("break",27);case 19:return n.$flash("Проверьте ваш е-маил"),t.abrupt("break",27);case 21:return n.$flash("Такой е-маил уже используется"),t.abrupt("break",27);case 23:return n.$flash("Пароль слишком короткий"),t.abrupt("break",27);case 25:return n.$flash("Пароль не совпадает с подтверждением"),t.abrupt("break",27);case 27:return t.abrupt("return",!1);case 28:case"end":return t.stop()}}),t,null,[[0,6]])})))()},phoneVerify(){var e=this.fields.user_phone.replace(/\D/g,"");try{x().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$router.push({name:"UserVerifyPhone",params:{phone:e}})}catch(n){}},passwordSave(){var e=this;return(0,V.Z)((0,U.Z)().mark((function n(){var t,r;return(0,U.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.fields.user_pass==e.fields.user_pass_confirm){n.next=3;break}return e.$flash("Пароль и подтверждение не совпадают"),n.abrupt("return");case 3:return t={user_id:e.$heap.state.user.user_id,user_pass:e.fields.user_pass},n.next=6,e.itemUpdate(t);case 6:r=n.sent,r&&(e.$refs.passwordPrompt.$el.dismiss(),e.$flash("Пароль изменен"));case 8:case"end":return n.stop()}}),n)})))()},passwordReset(){var e=this;return(0,V.Z)((0,U.Z)().mark((function n(){var t;return(0,U.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t={user_phone:e.fields.user_phone,user_email:e.fields.user_email,user_name:e.fields.user_name},n.prev=1,n.next=4,x().post(`${e.$heap.state.hostname}User/passwordReset`,t);case 4:e.$alert("Вам был выслан новый пароль","Пароль сброшен"),n.next=9;break;case 7:n.prev=7,n.t0=n["catch"](1);case 9:case"end":return n.stop()}}),n,null,[[1,7]])})))()},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));var n="",t=0;for(var r in this.config.phoneMask){if(!this.fields.user_phone[t])break;var u=this.config.phoneMask[r];"0"==u?(n+=this.fields.user_phone[t],t++):n+=u}return this.fields.user_phone=n,this.fields.user_phone}},created(){var e=this;this.$topic.on("userGet",(function(n){e.fields=n}))}},Z=t(3744);const C=(0,Z.Z)(O,[["render",g]]);var P=C}}]);
//# sourceMappingURL=6751-legacy.173b63cb.js.map