"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[2892],{5432:function(e,t,o){o.d(t,{A:function(){return _}});var l=o(641),i=o(33);const n={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},a={slot:"end",style:{color:"#666"}};function r(e,t,o,r,s,c){const d=(0,l.g2)("ymap-marker"),u=(0,l.g2)("yandex-map"),h=(0,l.g2)("ion-searchbar"),m=(0,l.g2)("ion-item"),p=(0,l.g2)("ion-content"),_=(0,l.g2)("ion-textarea"),k=(0,l.g2)("ion-icon"),g=(0,l.g2)("ion-button"),f=(0,l.g2)("ion-toolbar");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{onClick:t[0]||(t[0]=e=>c.onClick(e)),style:{height:"100%"},coords:s.coords,zoom:16,settings:s.settings,controls:["zoomControl"]},{default:(0,l.k6)((()=>[(0,l.bF)(d,{coords:s.coords,"marker-id":"1",properties:s.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,l.Lk)("div",n,[(0,l.bF)(h,{debounce:"500",modelValue:s.addressSearchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>s.addressSearchQuery=e),onIonInput:t[2]||(t[2]=e=>c.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.suggestions,((e,t)=>((0,l.uX)(),(0,l.Wv)(m,{key:t,onClick:t=>c.suggestionSelect(`${e.subtitle.text}, ${e.title.text}`,e.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.subtitle.text)+" "+(0,i.v_)(e.title.text)+" ",1),(0,l.Lk)("span",a,(0,i.v_)(e.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,l.bF)(f,null,{default:(0,l.k6)((()=>[(0,l.bF)(_,{label:"комментарий к адресу","label-placement":"floating",modelValue:s.addressComment,"onUpdate:modelValue":t[3]||(t[3]=e=>s.addressComment=e)},null,8,["modelValue"]),(0,l.bF)(g,{strong:!0,onClick:t[4]||(t[4]=e=>c.pickAddress()),color:"primary",expand:"block"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{src:r.checkmark,slot:"start"},null,8,["src"]),(0,l.eW)(" Ок ")])),_:1}),(0,l.bF)(g,{onClick:t[5]||(t[5]=e=>r.closeModal()),color:"light",expand:"block"},{default:(0,l.k6)((()=>[(0,l.eW)("Закрыть")])),_:1})])),_:1})],64)}o(4114);var s=o(5654),c=o(5221),d=o(5480),u=o(8701),h={components:{IonContent:s.W9,IonToolbar:s.ai,IonButton:s.Jm,IonSearchbar:s.S1,IonIcon:s.iq,IonItem:s.uz,IonTextarea:s.nc,yandexMap:c.IK,ymapMarker:c.cT},setup(){const e=function(){s.OZ.dismiss()};return{closeModal:e,locationOutline:d.UN$,closeOutline:d.xfX,checkmark:d.AIp}},props:{location_group_name_low:String,location_group_id:Number},data(){let e=this.location_group_name_low+" адрес",t=this.$heap.state.settings.location,o=JSON.parse(t.mapCenter);return{settings:{apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:e},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationType:e,locSettings:t,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o,addressComment:""}},methods:{async pickAddress(){try{if(!this.selectedAddress){var e;const t=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(e=t.geoObjects.get(0))||void 0===e?void 0:e.getAddressLine()}}catch(o){}var t={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};s.OZ.dismiss(t)},filterAddress(e){const t=this.locSettings.addressErase.split(", "),o=e.split(", ");let l=[];for(const i of o)t.find((e=>e==i))||l.push(i);return l.reverse().join(", ")},onClick(e){e&&e.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=e.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const e=this.$heap.state.settings.location.ymapSuggestionApiKey,t=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${e}&lang=ru_RU&ll=${t}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),l=await o.json();this.suggestions=l.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(e,t){this.selectedAddress=e,this.geocode(t)},async geocode(e){try{this.suggestions=[];const t=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${t}&format=json&results=1&uri=${e}`),l=await o.json(),i=l.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=i.Point.pos.split(" ").reverse()}catch(t){console.log(t)}}},async mounted(){await(0,c.wc)();const e=u.A.geo.lastStoredGet();null!==e&&void 0!==e&&e.location_latitude&&(this.coords=[e.location_latitude,e.location_longitude]);const t=await u.A.geo.get();if(this.markDeviceOnMap&&t){const{coords:e}=t;this.coords=[e.latitude,e.longitude],this.$flash("На карте отмечено ваше местоположение")}}},m=o(6262);const p=(0,m.A)(h,[["render",r]]);var _=p},2892:function(e,t,o){o.r(t),o.d(t,{default:function(){return w}});var l=o(641);function i(e,t,o,i,n,a){const r=(0,l.g2)("shipment-draft-comp"),s=(0,l.g2)("base-layout");return(0,l.uX)(),(0,l.Wv)(s,{"page-title":"Вызов курьера"},{default:(0,l.k6)((()=>[(0,l.bF)(r,{orderData:n.order,onStageCreate:a.onStageCreate,onOrderUpdate:a.itemUpdate,onLocationUpdate:a.locationUpdate},null,8,["orderData","onStageCreate","onOrderUpdate","onLocationUpdate"])])),_:1})}o(4114),o(3110);var n=o(2311),a=o.n(n),r=o(33);const s=e=>((0,l.Qi)("data-v-9f1645a4"),e=e(),(0,l.jt)(),e),c={key:0},d=s((()=>(0,l.Lk)("h1",null,"Ваш заказ",-1))),u=s((()=>(0,l.Lk)("p",null,[(0,l.Lk)("b",null,"Курьер отвезет вашу посылку")],-1))),h={key:0},m={key:2},p={key:1},_=s((()=>(0,l.Lk)("div",{slot:"end",style:{position:"relative",width:"120px","min-height":"48px","background-color":"var(--ion-color-light)"}},null,-1)));function k(e,t,o,i,n,a){const s=(0,l.g2)("ion-label"),k=(0,l.g2)("ion-item"),g=(0,l.g2)("ion-textarea"),f=(0,l.g2)("ion-item-divider"),v=(0,l.g2)("ion-icon"),b=(0,l.g2)("ion-img"),y=(0,l.g2)("ion-thumbnail"),F=(0,l.g2)("ion-text"),C=(0,l.g2)("ion-chip"),S=(0,l.g2)("ion-list"),L=(0,l.g2)("ion-accordion"),O=(0,l.g2)("ion-accordion-group"),W=(0,l.g2)("ion-checkbox"),x=(0,l.g2)("ion-card-content"),I=(0,l.g2)("ion-card"),$=(0,l.g2)("ion-button"),D=(0,l.g2)("ion-col"),w=(0,l.g2)("ion-row"),V=(0,l.g2)("ion-grid"),X=(0,l.g2)("ion-skeleton-text");return o.orderData?((0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(S,{lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(s,null,{default:(0,l.k6)((()=>[d,u])),_:1})])),_:1}),(0,l.bF)(k,{lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(g,{ref:"description",modelValue:n.orderLocal.order_description,"onUpdate:modelValue":t[0]||(t[0]=e=>n.orderLocal.order_description=e),rows:"5",label:"",placeholder:"напишите, что будем везти",style:{"background-color":"var(--ion-color-light)","border-radius":"10px"},onIonInput:t[1]||(t[1]=e=>a.itemUpdate()),debounce:"50"},null,8,["modelValue"])])),_:1}),(0,l.bF)(f,null,{default:(0,l.k6)((()=>[(0,l.eW)("Детали перевозки")])),_:1}),n.orderLocal.locationStart?((0,l.uX)(),(0,l.CE)("div",h,[(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{color:"medium",src:i.locationOutline,slot:"start"},null,8,["src"]),(0,l.eW)(" Откуда ")])),_:1}),(0,l.bF)(k,{button:"",detail:"",onClick:t[2]||(t[2]=e=>a.locationStartSelect())},{default:(0,l.k6)((()=>{var t;return[null!==(t=n.orderLocal.locationStart)&&void 0!==t&&t.image_hash?((0,l.uX)(),(0,l.Wv)(y,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,l.k6)((()=>{var t;return[(0,l.bF)(b,{src:`${e.$heap.state.hostname}image/get.php/${null===(t=n.orderLocal.locationStart)||void 0===t?void 0:t.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,l.uX)(),(0,l.Wv)(v,{key:1,color:"primary",src:i.locationOutline,slot:"start"},null,8,["src"])),(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(n.orderLocal.locationStart.location_address),1)])),_:1})]})),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[n.orderLocal.locationStart.location_comment?((0,l.uX)(),(0,l.CE)("div",{key:0,onClick:t[3]||(t[3]=e=>a.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"10px",display:"inline-block"}},(0,r.v_)(n.orderLocal.locationStart.location_comment),1)):((0,l.uX)(),(0,l.Wv)(C,{key:1,color:"medium",onClick:t[4]||(t[4]=e=>a.locationCommentEdit("locationStart"))},{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.addOutline},null,8,["src"]),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)("комментарий")])),_:1})])),_:1})),n.orderLocal.locationStart.location_phone?((0,l.uX)(),(0,l.Wv)(C,{key:2,color:"medium",onClick:t[5]||(t[5]=e=>a.locationPhoneEdit("locationStart"))},{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.callOutline},null,8,["src"]),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(n.orderLocal.locationStart.location_phone),1)])),_:1})])),_:1})):((0,l.uX)(),(0,l.Wv)(C,{key:3,color:"medium",onClick:t[6]||(t[6]=e=>a.locationPhoneEdit("locationStart"))},{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.addOutline},null,8,["src"]),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)("телефон")])),_:1})])),_:1}))])])),_:1})])):((0,l.uX)(),(0,l.Wv)(k,{key:1,button:"","detail-icon":i.addOutline,onClick:t[7]||(t[7]=e=>a.locationStartSelect())},{default:(0,l.k6)((()=>[(0,l.bF)(v,{color:"medium",src:i.locationOutline,slot:"start"},null,8,["src"]),(0,l.bF)(F,{color:"medium"},{default:(0,l.k6)((()=>[(0,l.eW)("Откуда забрать?")])),_:1}),(0,l.bF)(v,{color:"warning",src:i.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),n.orderLocal.locationFinish?((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{color:"medium",src:i.flagOutline,slot:"start"},null,8,["src"]),(0,l.eW)(" Куда ")])),_:1}),(0,l.bF)(k,{button:"",detail:"",onClick:t[8]||(t[8]=e=>a.locationFinishSelect())},{default:(0,l.k6)((()=>{var t;return[null!==(t=o.orderData.locationFinish)&&void 0!==t&&t.image_hash?((0,l.uX)(),(0,l.Wv)(y,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,l.k6)((()=>{var t;return[(0,l.bF)(b,{src:`${e.$heap.state.hostname}image/get.php/${null===(t=o.orderData.locationFinish)||void 0===t?void 0:t.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,l.uX)(),(0,l.Wv)(v,{key:1,color:"primary",src:i.flagOutline,slot:"start"},null,8,["src"])),(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(o.orderData.locationFinish.location_address),1)])),_:1})]})),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[n.orderLocal.locationFinish.location_comment?((0,l.uX)(),(0,l.CE)("div",{key:0,onClick:t[9]||(t[9]=e=>a.locationCommentEdit("locationFinish")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"10px",display:"inline-block"}},(0,r.v_)(n.orderLocal.locationFinish.location_comment),1)):((0,l.uX)(),(0,l.Wv)(C,{key:1,color:"medium",onClick:t[10]||(t[10]=e=>a.locationCommentEdit("locationFinish"))},{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.addOutline},null,8,["src"]),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)("комментарий")])),_:1})])),_:1})),n.orderLocal.locationFinish.location_phone?((0,l.uX)(),(0,l.Wv)(C,{key:2,color:"medium",onClick:t[11]||(t[11]=e=>a.locationPhoneEdit("locationFinish"))},{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.callOutline},null,8,["src"]),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(n.orderLocal.locationFinish.location_phone),1)])),_:1})])),_:1})):((0,l.uX)(),(0,l.Wv)(C,{key:3,color:"medium",onClick:t[12]||(t[12]=e=>a.locationPhoneEdit("locationFinish"))},{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.addOutline},null,8,["src"]),(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)("телефон")])),_:1})])),_:1}))])])),_:1})])):((0,l.uX)(),(0,l.Wv)(k,{key:3,button:"","detail-icon":i.addOutline,onClick:t[13]||(t[13]=e=>a.locationFinishSelect())},{default:(0,l.k6)((()=>[(0,l.bF)(v,{color:"medium",src:i.flagOutline,slot:"start"},null,8,["src"]),(0,l.bF)(F,{color:"medium"},{default:(0,l.k6)((()=>[(0,l.eW)("Куда отвезти?")])),_:1}),(0,l.bF)(v,{color:"warning",src:i.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),(0,l.bF)(f,null,{default:(0,l.k6)((()=>[(0,l.eW)("Итог")])),_:1}),(0,l.bF)(O,null,{default:(0,l.k6)((()=>[(0,l.bF)(L,null,{default:(0,l.k6)((()=>[(0,l.bF)(k,{slot:"header",lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{icon:i.walletOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,l.bF)(F,{color:"medium"},{default:(0,l.k6)((()=>[(0,l.eW)("Итого: ")])),_:1}),(0,l.bF)(s,{slot:"end",color:"primary"},{default:(0,l.k6)((()=>{var t,o;return[(0,l.eW)((0,r.v_)(null!==(t=null===(o=n.orderLocal.deliveryCalculation)||void 0===o?void 0:o.sum)&&void 0!==t?t:0)+(0,r.v_)(e.$heap.state.currencySign),1)]})),_:1})])),_:1}),(0,l.bF)(S,{slot:"content"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{color:"medium"},{default:(0,l.k6)((()=>[(0,l.eW)("Вызов курьера")])),_:1}),(0,l.bF)(s,{slot:"end",color:"primary"},{default:(0,l.k6)((()=>{var t,o;return[(0,l.eW)((0,r.v_)(null!==(t=null===(o=n.orderLocal.deliveryCalculation)||void 0===o?void 0:o.cost)&&void 0!==t?t:0)+(0,r.v_)(e.$heap.state.currencySign),1)]})),_:1})])),_:1}),(0,l.bF)(k,{lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{color:"medium"},{default:(0,l.k6)((()=>{var t,o;return[(0,l.eW)("Расстояние по карте "+(0,r.v_)(a.deliveryDistanceKm)+"км по "+(0,r.v_)(null!==(t=null===(o=n.orderLocal.deliveryCalculation)||void 0===o?void 0:o.fee)&&void 0!==t?t:0)+(0,r.v_)(e.$heap.state.currencySign),1)]})),_:1}),(0,l.bF)(s,{slot:"end",color:"primary"},{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(a.deliveryFeeTotal)+(0,r.v_)(e.$heap.state.currencySign),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.bF)(O,null,{default:(0,l.k6)((()=>[(0,l.bF)(L,{"toggle-icon-slot":"start"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{slot:"header",lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(W,{checked:a.isValidAll,onIonChange:t[14]||(t[14]=e=>a.toggleValid(e.target.checked))},{default:(0,l.k6)((()=>[(0,l.eW)("Посылка отвечает условиям")])),_:1},8,["checked"])])),_:1}),(0,l.bF)(S,{slot:"content"},{default:(0,l.k6)((()=>[(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.helpCircleOutline,slot:"start"},null,8,["src"]),(0,l.bF)(W,{modelValue:n.isValidSenderReciever,"onUpdate:modelValue":t[15]||(t[15]=e=>n.isValidSenderReciever=e)},{default:(0,l.k6)((()=>[(0,l.eW)("Получатель и отправитель на связи")])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.helpCircleOutline,slot:"start",onClick:t[16]||(t[16]=t=>e.$router.push("/page/rules-customer#dimentions"))},null,8,["src"]),(0,l.bF)(W,{modelValue:n.isValidDimention,"onUpdate:modelValue":t[17]||(t[17]=e=>n.isValidDimention=e)},{default:(0,l.k6)((()=>[(0,l.eW)("Меньше 40 × 40 × 25 см")])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.helpCircleOutline,slot:"start",onClick:t[18]||(t[18]=t=>e.$router.push("/page/rules-customer#dimentions"))},null,8,["src"]),(0,l.bF)(W,{modelValue:n.isValidDimention,"onUpdate:modelValue":t[19]||(t[19]=e=>n.isValidDimention=e)},{default:(0,l.k6)((()=>[(0,l.eW)("Легче 8кг")])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.helpCircleOutline,slot:"start",onClick:t[20]||(t[20]=t=>e.$router.push("/page/rules-customer#contents"))},null,8,["src"]),(0,l.bF)(W,{modelValue:n.isValidContent,"onUpdate:modelValue":t[21]||(t[21]=e=>n.isValidContent=e)},{default:(0,l.k6)((()=>[(0,l.eW)("Без запрещенных вещей")])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{src:i.helpCircleOutline,slot:"start",onClick:t[22]||(t[22]=t=>e.$router.push("/page/rules-customer#contents"))},null,8,["src"]),(0,l.bF)(W,{modelValue:n.isValidReadyness,"onUpdate:modelValue":t[23]||(t[23]=e=>n.isValidReadyness=e)},{default:(0,l.k6)((()=>[(0,l.eW)("Уже готова к перевозке")])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),a.checkoutError?((0,l.uX)(),(0,l.Wv)(I,{key:0,color:"warning"},{default:(0,l.k6)((()=>[(0,l.bF)(x,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(a.checkoutError),1)])),_:1})])),_:1})):(0,l.Q3)("",!0),a.isReadyToCheckout?((0,l.uX)(),(0,l.Wv)(V,{key:1},{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.nextStageButtons,((e,t)=>((0,l.uX)(),(0,l.Wv)(D,{key:t},{default:(0,l.k6)((()=>{var i,n;return[e[0]?((0,l.uX)(),(0,l.Wv)($,{key:0,onClick:l=>a.stageCreate(o.orderData.order_id,t,e[1]),expand:"block",color:null!==(i=e[1])&&void 0!==i?i:"primary",fill:null!==(n=e[2])&&void 0!==n?n:"solid"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{slot:"start",src:e.icon},null,8,["src"]),(0,l.eW)(" "+(0,r.v_)(e[0]),1)])),_:2},1032,["onClick","color","fill"])):(0,l.Q3)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):((0,l.uX)(),(0,l.Wv)(V,{key:2},{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[(0,l.bF)(D,null,{default:(0,l.k6)((()=>[o.orderData.order_description?o.orderData.locationStart?o.orderData.locationFinish?a.isValidAll?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)($,{key:3,onClick:t[27]||(t[27]=e=>a.toggleValid(1)),expand:"block",color:"light"},{default:(0,l.k6)((()=>[(0,l.eW)(" Согласиться с условиями ")])),_:1})):((0,l.uX)(),(0,l.Wv)($,{key:2,onClick:t[26]||(t[26]=e=>a.locationFinishSelect()),expand:"block",color:"light"},{default:(0,l.k6)((()=>[(0,l.eW)(" Куда отвезти ")])),_:1})):((0,l.uX)(),(0,l.Wv)($,{key:1,onClick:t[25]||(t[25]=e=>a.locationStartSelect()),expand:"block",color:"light"},{default:(0,l.k6)((()=>[(0,l.eW)(" Откуда забрать ")])),_:1})):((0,l.uX)(),(0,l.Wv)($,{key:0,onClick:t[24]||(t[24]=t=>e.$refs.description.$el.setFocus()),expand:"block",color:"light"},{default:(0,l.k6)((()=>[(0,l.eW)(" Заполнить описание ")])),_:1}))])),_:1})])),_:1})])),_:1}))])):((0,l.uX)(),(0,l.CE)("div",p,[(0,l.bF)(k,{detail:"",button:"",lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{slot:"start",icon:i.storefrontOutline},null,8,["icon"]),(0,l.bF)(X,{animated:"",style:{width:"200px"}})])),_:1}),(0,l.bF)(S,null,{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([1,2,3],(e=>(0,l.bF)(k,{key:e},{default:(0,l.k6)((()=>[(0,l.bF)(y,{style:{"background-color":"var(--ion-color-light)"}}),(0,l.bF)(V,null,{default:(0,l.k6)((()=>[(0,l.bF)(D,null,{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[(0,l.bF)(X,{animated:"",style:{width:"100%"}})])),_:1}),(0,l.bF)(w,null,{default:(0,l.k6)((()=>[(0,l.bF)(s,{color:"primary"},{default:(0,l.k6)((()=>[(0,l.bF)(X,{animated:"",style:{width:"100px"}})])),_:1})])),_:1})])),_:1})])),_:1}),_])),_:2},1024))),64))])),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([1,2],(e=>(0,l.bF)(D,{key:e},{default:(0,l.k6)((()=>[(0,l.bF)($,{color:"light",style:{width:"100%"}})])),_:2},1024))),64))])),_:1})])),_:1})]))}var g=o(5654),f=o(5480);function v(e,t,o,i,n,a){const s=(0,l.g2)("ion-title"),c=(0,l.g2)("ion-icon"),d=(0,l.g2)("ion-item"),u=(0,l.g2)("ion-toolbar"),h=(0,l.g2)("ion-header"),m=(0,l.g2)("ion-img"),p=(0,l.g2)("ion-label"),_=(0,l.g2)("ion-list"),k=(0,l.g2)("ion-list-header"),g=(0,l.g2)("ion-content");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(d,{lines:"none"},{default:(0,l.k6)((()=>[(0,l.bF)(s,null,{default:(0,l.k6)((()=>[(0,l.eW)("Мои адреса")])),_:1}),(0,l.bF)(c,{slot:"end",onClick:t[0]||(t[0]=e=>{a.modalClose()}),icon:i.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,l.bF)(g,null,{default:(0,l.k6)((()=>[n.locationList.length?((0,l.uX)(),(0,l.Wv)(_,{key:0,lines:"full"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.locationList,((t,o)=>((0,l.uX)(),(0,l.Wv)(d,{key:t.location_id},{default:(0,l.k6)((()=>[(0,l.bF)(m,{slot:"start",alt:"location icon",src:`${e.$heap.state.hostname}/image/get.php/${t.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,l.bF)(p,{onClick:e=>a.locationSelect(t),style:{"white-space":"normal",cursor:"pointer"},class:(0,r.C4)(1==t.is_main?"is_main":"")},{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(t.location_address),1)])),_:2},1032,["onClick","class"]),(0,l.bF)(c,{slot:"end",icon:i.trashOutline,onClick:e=>a.locationDelete(`${t.location_id}`,`${o}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(k,null,{default:(0,l.k6)((()=>[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.eW)("Добавить адрес")])),_:1})])),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(n.locationGroupList,(t=>((0,l.uX)(),(0,l.Wv)(d,{key:t.group_id,onClick:e=>a.modalLocationCreate(`${t.group_id}`,`${t.group_name}`),style:{cursor:"pointer"}},{default:(0,l.k6)((()=>[(0,l.bF)(m,{src:`${e.$heap.state.hostname}/image/get.php/${t.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(t.group_name),1)])),_:2},1024),(0,l.bF)(c,{src:i.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}var b=o(5538),y=o(8701),F=o(5432),C={components:{IonImg:g.KW,IonLabel:g.he,IonItem:g.uz,IonList:g.nf,IonListHeader:g.AF,IonIcon:g.iq,IonHeader:g.eU,IonToolbar:g.ai,IonTitle:g.BC,IonContent:g.W9},setup(){return{locationOutline:f.UN$,trashOutline:f.P1A,addOutline:f.EKF,closeOutline:f.xfX}},data(){return{locationList:[],locationGroupList:[]}},mounted(){this.locationListGet()},computed:{mainAddress(){var e;return null===(e=this.locationList)||void 0===e?void 0:e.find((e=>1==e.is_main))}},methods:{modalClose(){g.OZ.dismiss(null,"cancel")},async modalLocationCreate(e,t){if(!b.A.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/modal/user-authorize"));var o=String(t).toLowerCase();const l=await g.OZ.create({component:F.A,showBackdrop:!0,componentProps:{location_group_name_low:o}});return l.onDidDismiss().then((t=>{this.locationCreate(e,t.data)})),l.present()},async locationListGet(){try{let e=null;const t=await a().get(b.A.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=t.location_list,this.locationGroupList=t.location_group_list,this.locationList)for(let o of this.locationList)1==o.is_main&&(e=o);if(!e)return void y.A.get()}catch{}},async locationCreate(e,t){if(!t)return;let o={location_holder:"user",location_holder_id:b.A.state.user.user_id,location_group_id:e,location_address:t.location_address,location_latitude:t.location_latitude,location_longitude:t.location_longitude};try{await a().post(b.A.state.hostname+"User/locationCreate",o),this.locationListGet()}catch(l){const e=l.responseJSON,t=e.messages.error;switch(t){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},locationSelect(e){g.OZ.dismiss(e,"confirm")},async locationDelete(e,t){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(t,1),await a().post(b.A.state.hostname+"User/locationDelete",{location_id:e})}catch{}this.locationListGet()}}}},S=o(6262);const L=(0,S.A)(C,[["render",v],["__scopeId","data-v-417f0a66"]]);var O=L,W={props:["orderData"],components:{IonIcon:g.iq,IonText:g.IO,IonLabel:g.he,IonItem:g.uz,IonList:g.nf,IonImg:g.KW,IonThumbnail:g.Zx,IonButton:g.Jm,IonCol:g.hU,IonRow:g.ln,IonGrid:g.lO,IonSkeletonText:g.ds,IonCard:g.b_,IonCardContent:g.I9,IonItemDivider:g.Dg,IonTextarea:g.nc,IonAccordion:g.xk,IonAccordionGroup:g.YH,IonChip:g.ZB,IonCheckbox:g.eY},setup(){return{add:f.WQq,remove:f.TFI,trash:f.dco,rocketOutline:f.hGQ,storefrontOutline:f.te8,checkmarkOutline:f.g1L,cubeOutline:f.a7r,walletOutline:f.eF1,banOutline:f.Av6,giftOutline:f.Lsq,cardOutline:f.VR9,ribbonOutline:f.rp8,chatboxEllipsesOutline:f.Pkp,locationOutline:f.UN$,flagOutline:f.NBP,chevronDown:f.uaq,addOutline:f.EKF,checkmark:f.AIp,cashOutline:f.A3w,businessOutline:f.FL4,alertCircleOutline:f.ndb,helpCircleOutline:f.W2C,callOutline:f.bNN}},data(){return{isValidReadyness:1,isValidSenderReciever:1,isValidDimention:1,isValidWeight:1,isValidContent:1,orderLocal:{}}},computed:{checkoutError(){var e,t,o,l,i,n;const a=null!==(e=null===(t=this.orderLocal.deliveryCalculation)||void 0===t?void 0:t.error)&&void 0!==e?e:null;if("no_input"==a||!this.orderData.locationStart||!this.orderData.locationFinish)return"Выберите адрес отправителя и получателя";if("start_center_toofar"==a)return"Адрес отправителя посылки слишком удален";if("finish_center_toofar"==a)return"Адрес получателя посылки слишком удален";if("start_finish_toofar"==a){var r;const e=Math.round((null===(r=this.orderLocal.deliveryCalculation)||void 0===r?void 0:r.max_distance)/100)/10;return`Расстояние по карте между адресами ${this.deliveryDistanceKm}км, больше максимального в ${e}км`}return null!==(o=null===(l=this.orderLocal.deliveryCalculation)||void 0===l?void 0:l.fee)&&void 0!==o&&o?null!==(i=null===(n=this.orderLocal.deliveryCalculation)||void 0===n?void 0:n.deliveryDistance)&&void 0!==i&&i?null:"Отправитель и получатель в одной точке":"Тариф доставки не установлен"},deliveryDistanceKm(){var e;return Math.round((null===(e=this.orderLocal.deliveryCalculation)||void 0===e?void 0:e.deliveryDistance)/100)/10||0},deliveryFeeTotal(){var e,t;const o=null!==(e=null===(t=this.orderLocal.deliveryCalculation)||void 0===t?void 0:t.fee)&&void 0!==e?e:0;return Math.round(o*this.deliveryDistanceKm)},isReadyToCheckout(){return this.orderData.order_description&&this.orderData.locationStart&&this.orderData.locationFinish&&!this.checkoutError&&this.isValidAll},isValidAll(){return this.isValidContent&&this.isValidDimention&&this.isValidReadyness&&this.isValidWeight&&this.isValidSenderReciever},nextStageButtons(){let e={};for(let t in this.orderData.stage_next)this.orderData.stage_next[t][0]&&(e[t]=this.orderData.stage_next[t],e[t].icon=f.g1L,t.includes("admin")?e[t].icon=f.rp8:t.includes("delivery")?e[t].icon=f.hGQ:t.includes("supplier")&&(e[t].icon=f.te8));return e}},methods:{stageCreate(e,t,o){("danger"!=o||confirm("Вы уверены?"))&&this.$emit("stageCreate",e,t)},async itemUpdate(e="skipRefresh"){const t=this.orderLocal;t.mode=e,this.$emit("orderUpdate",t)},async locationSelect(){try{const e=document.querySelector("ion-router-outlet"),t=await g.OZ.create({component:O,canDismiss:!0,backdropDismiss:!0,keyboardClose:!0,presentingElement:e});t.present();const{data:o,role:l}=await t.onWillDismiss();return o}catch{}},async locationStartSelect(){var e;this.orderLocal.locationStart=await this.locationSelect(),this.orderLocal.start_location_id=null===(e=this.orderLocal.locationStart)||void 0===e?void 0:e.location_id,this.itemUpdate("refreshTotalEstimates")},async locationFinishSelect(){var e;this.orderLocal.locationFinish=await this.locationSelect(),this.orderLocal.finish_location_id=null===(e=this.orderLocal.locationFinish)||void 0===e?void 0:e.location_id,this.itemUpdate("refreshTotalEstimates")},async locationPhoneEdit(e){var t;let o=null!==(t=this.orderLocal[e].location_phone)&&void 0!==t?t:"";const l=await g.TN.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:o}]});try{await l.present();const{data:t,role:i}=await l.onDidDismiss();"confirm"==i&&(o=t.values.phone.replace(/\D/g,"").replace(/^7/,""),o&&(10!=o.length&&this.$flash("Проверьте правильность телефона"),o="+7"+o)),"cancel"==i&&(o=""),this.orderLocal[e].location_phone=o;const n=this.orderLocal[e],a={location_id:n.location_id,location_phone:o};this.$emit("locationUpdate",a),this.itemUpdate()}catch(i){console.log(i)}},async locationCommentEdit(e){var t;let o=null!==(t=this.orderLocal[e].location_comment)&&void 0!==t?t:"";const l=await g.TN.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:o}]});try{await l.present();const{data:t,role:i}=await l.onDidDismiss();o=t.values.comment,"cancel"==i&&(o=""),this.orderLocal[e].location_comment=o;const n=this.orderLocal[e],a={location_id:n.location_id,location_comment:o};this.$emit("locationUpdate",a),this.itemUpdate()}catch(i){console.log(i)}},toggleValid(e){this.isValidContent=this.isValidDimention=this.isValidWeight=this.isValidReadyness=this.isValidSenderReciever=e}},async created(){this.orderLocal=this.orderData},watch:{orderData:async function(e){this.orderLocal=e,this.orderLocal}}};const x=(0,S.A)(W,[["render",k],["__scopeId","data-v-9f1645a4"]]);var I=x,$={components:{ShipmentDraftComp:I},data(){return{order:null,errorCode:null}},methods:{async itemCreate(){const e=new Date,t={order_store_id:null,order_id:0,entries:[],created_at:e.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.itemSave(t)},async itemLoad(){try{const e=JSON.parse(localStorage.shipmentDraft);if(e)return e.deliveryCalculation=await this.itemTotalEstimate(e.start_location_id,e.finish_location_id),void(this.order=e)}catch{}this.itemCreate()},itemSave(e){this.order=e,localStorage.shipmentDraft=JSON.stringify(e)},async itemUpdate(e){console.log(e.mode),"refreshTotalEstimates"==e.mode&&(e.deliveryCalculation=await this.itemTotalEstimate(e.start_location_id,e.finish_location_id)),this.itemSave(Object.assign({},this.order,e))},async locationUpdate(e){try{await a().post(`${this.$heap.state.hostname}Location/itemUpdate`,JSON.stringify(e)),this.$flash("сохранено")}catch{}},async itemTotalEstimate(e,t){if(!e||!t)return;const o={start_location_id:e,finish_location_id:t};try{return await a().post(`${this.$heap.state.hostname}Shipment/itemDeliverySumEstimate`,o)}catch(l){}},async onStageCreate(e,t){if("customer_purged"==t||"customer_deleted"==t)return localStorage.removeItem("shipmentDraft"),void this.$router.replace("/order/order-list");"customer_action_confirm"==t&&(t="customer_confirmed");try{const e={is_shopping:0,order_description:this.order.order_description,order_start_location_id:this.order.start_location_id,order_finish_location_id:this.order.finish_location_id,order_sum_delivery:this.order.deliveryCalculation.sum},t=await a().post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(e));t>0&&this.$router.push(`/modal/shipment-checkout-${t}`)}catch(i){var o,l;const t=null===i||void 0===i||null===(o=i.responseJSON)||void 0===o||null===(l=o.messages)||void 0===l?void 0:l.error;if(!t)return!1;switch(t){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии ☹️","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+e;break}return!1}}},mounted(){this.itemLoad()}};const D=(0,S.A)($,[["render",i]]);var w=D}}]);
//# sourceMappingURL=2892.d9e8c426.js.map