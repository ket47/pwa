"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[1723],{1723:function(e,t,o){o.d(t,{A:function(){return W}});o(4114);var l=o(641),i=o(33);const n={key:0},a={key:0},s={key:2},r={key:1};function c(e,t,o,c,d,u){const h=(0,l.g2)("ion-label"),_=(0,l.g2)("ion-item"),m=(0,l.g2)("ion-textarea"),p=(0,l.g2)("ion-item-divider"),k=(0,l.g2)("ion-icon"),g=(0,l.g2)("ion-img"),b=(0,l.g2)("ion-thumbnail"),f=(0,l.g2)("ion-text"),v=(0,l.g2)("ion-chip"),y=(0,l.g2)("ion-list"),F=(0,l.g2)("ion-accordion"),C=(0,l.g2)("ion-accordion-group"),L=(0,l.g2)("ion-checkbox"),W=(0,l.g2)("ion-card-content"),x=(0,l.g2)("ion-card"),I=(0,l.g2)("ion-button"),O=(0,l.g2)("ion-col"),S=(0,l.g2)("ion-row"),w=(0,l.g2)("ion-grid"),V=(0,l.g2)("ion-skeleton-text");return o.orderData?((0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(y,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(h,null,{default:(0,l.k6)(()=>t[29]||(t[29]=[(0,l.Lk)("h1",null,"Создание зявки",-1),(0,l.Lk)("p",null,[(0,l.Lk)("b",null,"Курьер отвезет вашу посылку")],-1)])),_:1,__:[29]})]),_:1}),(0,l.bF)(_,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(m,{ref:"description",modelValue:d.orderLocal.order_description,"onUpdate:modelValue":t[0]||(t[0]=e=>d.orderLocal.order_description=e),rows:"5",label:"",placeholder:"напишите, что будем везти",style:{"background-color":"var(--ion-color-light)","border-radius":"10px"},onIonInput:t[1]||(t[1]=e=>u.itemUpdate()),debounce:"50"},null,8,["modelValue"])]),_:1}),(0,l.bF)(p,null,{default:(0,l.k6)(()=>t[30]||(t[30]=[(0,l.eW)("Доставка")])),_:1,__:[30]}),d.orderLocal.locationStart?((0,l.uX)(),(0,l.CE)("div",a,[(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{color:"medium",src:c.locationOutline,slot:"start"},null,8,["src"]),t[31]||(t[31]=(0,l.eW)(" Откуда "))]),_:1,__:[31]}),(0,l.bF)(_,{button:"",detail:"",onClick:t[2]||(t[2]=e=>u.locationStartSelect())},{default:(0,l.k6)(()=>{var t;return[null!==(t=d.orderLocal.locationStart)&&void 0!==t&&t.image_hash?((0,l.uX)(),(0,l.Wv)(b,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,l.k6)(()=>{var t;return[(0,l.bF)(g,{src:`${e.$heap.state.hostname}image/get.php/${null===(t=d.orderLocal.locationStart)||void 0===t?void 0:t.image_hash}.150.150.webp`},null,8,["src"])]}),_:1})):((0,l.uX)(),(0,l.Wv)(k,{key:1,color:"primary",src:c.locationOutline,slot:"start"},null,8,["src"])),(0,l.bF)(f,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(d.orderLocal.locationStart.location_address),1)]),_:1})]}),_:1}),(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[d.orderLocal.locationStart.location_comment?((0,l.uX)(),(0,l.CE)("div",{key:0,onClick:t[3]||(t[3]=e=>u.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"10px",display:"inline-block"}},(0,i.v_)(d.orderLocal.locationStart.location_comment),1)):((0,l.uX)(),(0,l.Wv)(v,{key:1,color:"medium",onClick:t[4]||(t[4]=e=>u.locationCommentEdit("locationStart"))},{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.addOutline},null,8,["src"]),(0,l.bF)(h,null,{default:(0,l.k6)(()=>t[32]||(t[32]=[(0,l.eW)("комментарий")])),_:1,__:[32]})]),_:1})),d.orderLocal.locationStart.location_phone?((0,l.uX)(),(0,l.Wv)(v,{key:2,color:"medium",onClick:t[5]||(t[5]=e=>u.locationPhoneEdit("locationStart"))},{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.callOutline},null,8,["src"]),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(d.orderLocal.locationStart.location_phone),1)]),_:1})]),_:1})):((0,l.uX)(),(0,l.Wv)(v,{key:3,color:"medium",onClick:t[6]||(t[6]=e=>u.locationPhoneEdit("locationStart"))},{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.addOutline},null,8,["src"]),(0,l.bF)(h,null,{default:(0,l.k6)(()=>t[33]||(t[33]=[(0,l.eW)("телефон")])),_:1,__:[33]})]),_:1}))])]),_:1})])):((0,l.uX)(),(0,l.Wv)(_,{key:1,button:"","detail-icon":c.addOutline,onClick:t[7]||(t[7]=e=>u.locationStartSelect())},{default:(0,l.k6)(()=>[(0,l.bF)(k,{color:"medium",src:c.locationOutline,slot:"start"},null,8,["src"]),(0,l.bF)(f,{color:"medium"},{default:(0,l.k6)(()=>t[34]||(t[34]=[(0,l.eW)("Откуда забрать?")])),_:1,__:[34]}),(0,l.bF)(k,{color:"warning",src:c.alertCircleOutline,slot:"end"},null,8,["src"])]),_:1},8,["detail-icon"])),d.orderLocal.locationFinish?((0,l.uX)(),(0,l.CE)("div",s,[(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{color:"medium",src:c.flagOutline,slot:"start"},null,8,["src"]),t[35]||(t[35]=(0,l.eW)(" Куда "))]),_:1,__:[35]}),(0,l.bF)(_,{button:"",detail:"",onClick:t[8]||(t[8]=e=>u.locationFinishSelect())},{default:(0,l.k6)(()=>{var t;return[null!==(t=o.orderData.locationFinish)&&void 0!==t&&t.image_hash?((0,l.uX)(),(0,l.Wv)(b,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,l.k6)(()=>{var t;return[(0,l.bF)(g,{src:`${e.$heap.state.hostname}image/get.php/${null===(t=o.orderData.locationFinish)||void 0===t?void 0:t.image_hash}.150.150.webp`},null,8,["src"])]}),_:1})):((0,l.uX)(),(0,l.Wv)(k,{key:1,color:"primary",src:c.flagOutline,slot:"start"},null,8,["src"])),(0,l.bF)(f,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(o.orderData.locationFinish.location_address),1)]),_:1})]}),_:1}),(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[d.orderLocal.locationFinish.location_comment?((0,l.uX)(),(0,l.CE)("div",{key:0,onClick:t[9]||(t[9]=e=>u.locationCommentEdit("locationFinish")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"10px",display:"inline-block"}},(0,i.v_)(d.orderLocal.locationFinish.location_comment),1)):((0,l.uX)(),(0,l.Wv)(v,{key:1,color:"medium",onClick:t[10]||(t[10]=e=>u.locationCommentEdit("locationFinish"))},{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.addOutline},null,8,["src"]),(0,l.bF)(h,null,{default:(0,l.k6)(()=>t[36]||(t[36]=[(0,l.eW)("комментарий")])),_:1,__:[36]})]),_:1})),d.orderLocal.locationFinish.location_phone?((0,l.uX)(),(0,l.Wv)(v,{key:2,color:"medium",onClick:t[11]||(t[11]=e=>u.locationPhoneEdit("locationFinish"))},{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.callOutline},null,8,["src"]),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(d.orderLocal.locationFinish.location_phone),1)]),_:1})]),_:1})):((0,l.uX)(),(0,l.Wv)(v,{key:3,color:"medium",onClick:t[12]||(t[12]=e=>u.locationPhoneEdit("locationFinish"))},{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.addOutline},null,8,["src"]),(0,l.bF)(h,null,{default:(0,l.k6)(()=>t[37]||(t[37]=[(0,l.eW)("телефон")])),_:1,__:[37]})]),_:1}))])]),_:1})])):((0,l.uX)(),(0,l.Wv)(_,{key:3,button:"","detail-icon":c.addOutline,onClick:t[13]||(t[13]=e=>u.locationFinishSelect())},{default:(0,l.k6)(()=>[(0,l.bF)(k,{color:"medium",src:c.flagOutline,slot:"start"},null,8,["src"]),(0,l.bF)(f,{color:"medium"},{default:(0,l.k6)(()=>t[38]||(t[38]=[(0,l.eW)("Куда отвезти?")])),_:1,__:[38]}),(0,l.bF)(k,{color:"warning",src:c.alertCircleOutline,slot:"end"},null,8,["src"])]),_:1},8,["detail-icon"])),(0,l.bF)(p,null,{default:(0,l.k6)(()=>t[39]||(t[39]=[(0,l.eW)("Итог")])),_:1,__:[39]}),(0,l.bF)(C,null,{default:(0,l.k6)(()=>[(0,l.bF)(F,null,{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"header",lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{icon:c.walletOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,l.bF)(f,{color:"medium"},{default:(0,l.k6)(()=>t[40]||(t[40]=[(0,l.eW)("Итого: ")])),_:1,__:[40]}),(0,l.bF)(h,{slot:"end",color:"primary"},{default:(0,l.k6)(()=>{var t;return[(0,l.eW)((0,i.v_)((null===(t=d.orderLocal.deliveryCalculation)||void 0===t?void 0:t.sum)??0)+(0,i.v_)(e.$heap.state.currencySign),1)]}),_:1})]),_:1}),(0,l.bF)(y,{slot:"content"},{default:(0,l.k6)(()=>[(0,l.bF)(_,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(f,{color:"medium"},{default:(0,l.k6)(()=>t[41]||(t[41]=[(0,l.eW)("Вызов курьера")])),_:1,__:[41]}),(0,l.bF)(h,{slot:"end",color:"primary"},{default:(0,l.k6)(()=>{var t;return[(0,l.eW)((0,i.v_)((null===(t=d.orderLocal.deliveryCalculation)||void 0===t?void 0:t.cost)??0)+(0,i.v_)(e.$heap.state.currencySign),1)]}),_:1})]),_:1}),(0,l.bF)(_,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(f,{color:"medium"},{default:(0,l.k6)(()=>{var t;return[(0,l.eW)("Расстояние по карте "+(0,i.v_)(u.deliveryDistanceKm)+"км по "+(0,i.v_)((null===(t=d.orderLocal.deliveryCalculation)||void 0===t?void 0:t.fee)??0)+(0,i.v_)(e.$heap.state.currencySign),1)]}),_:1}),(0,l.bF)(h,{slot:"end",color:"primary"},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(u.deliveryFeeTotal)+(0,i.v_)(e.$heap.state.currencySign),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),(0,l.bF)(C,null,{default:(0,l.k6)(()=>[(0,l.bF)(F,{"toggle-icon-slot":"start"},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"header",lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(L,{checked:u.isValidAll,onIonChange:t[14]||(t[14]=e=>u.toggleValid(e.target.checked))},{default:(0,l.k6)(()=>t[42]||(t[42]=[(0,l.eW)("Посылка отвечает условиям")])),_:1,__:[42]},8,["checked"])]),_:1}),(0,l.bF)(y,{slot:"content"},{default:(0,l.k6)(()=>[(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.helpCircleOutline,slot:"start"},null,8,["src"]),(0,l.bF)(L,{modelValue:d.isValidSenderReciever,"onUpdate:modelValue":t[15]||(t[15]=e=>d.isValidSenderReciever=e)},{default:(0,l.k6)(()=>t[43]||(t[43]=[(0,l.eW)("Получатель и отправитель на связи")])),_:1,__:[43]},8,["modelValue"])]),_:1}),(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.helpCircleOutline,slot:"start",onClick:t[16]||(t[16]=t=>e.$router.push("/page/rules-customer#dimentions"))},null,8,["src"]),(0,l.bF)(L,{modelValue:d.isValidDimention,"onUpdate:modelValue":t[17]||(t[17]=e=>d.isValidDimention=e)},{default:(0,l.k6)(()=>t[44]||(t[44]=[(0,l.eW)("Меньше 40 × 40 × 25 см")])),_:1,__:[44]},8,["modelValue"])]),_:1}),(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.helpCircleOutline,slot:"start",onClick:t[18]||(t[18]=t=>e.$router.push("/page/rules-customer#dimentions"))},null,8,["src"]),(0,l.bF)(L,{modelValue:d.isValidDimention,"onUpdate:modelValue":t[19]||(t[19]=e=>d.isValidDimention=e)},{default:(0,l.k6)(()=>t[45]||(t[45]=[(0,l.eW)("Легче 8кг")])),_:1,__:[45]},8,["modelValue"])]),_:1}),(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.helpCircleOutline,slot:"start",onClick:t[20]||(t[20]=t=>e.$router.push("/page/rules-customer#contents"))},null,8,["src"]),(0,l.bF)(L,{modelValue:d.isValidContent,"onUpdate:modelValue":t[21]||(t[21]=e=>d.isValidContent=e)},{default:(0,l.k6)(()=>t[46]||(t[46]=[(0,l.eW)("Без запрещенных вещей")])),_:1,__:[46]},8,["modelValue"])]),_:1}),(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(k,{src:c.helpCircleOutline,slot:"start",onClick:t[22]||(t[22]=t=>e.$router.push("/page/rules-customer#contents"))},null,8,["src"]),(0,l.bF)(L,{modelValue:d.isValidReadyness,"onUpdate:modelValue":t[23]||(t[23]=e=>d.isValidReadyness=e)},{default:(0,l.k6)(()=>t[47]||(t[47]=[(0,l.eW)("Уже готова к перевозке")])),_:1,__:[47]},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u.checkoutError?((0,l.uX)(),(0,l.Wv)(x,{key:0,color:"warning"},{default:(0,l.k6)(()=>[(0,l.bF)(W,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(u.checkoutError),1)]),_:1})]),_:1})):(0,l.Q3)("",!0),u.isReadyToCheckout?((0,l.uX)(),(0,l.Wv)(w,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(S,null,{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.nextStageButtons,(e,t)=>((0,l.uX)(),(0,l.Wv)(O,{key:t},{default:(0,l.k6)(()=>[e[0]?((0,l.uX)(),(0,l.Wv)(I,{key:0,onClick:l=>u.stageCreate(o.orderData.order_id,t,e[1]),expand:"block",color:e[1]??"primary",fill:e[2]??"solid"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{slot:"start",src:e.icon},null,8,["src"]),(0,l.eW)(" "+(0,i.v_)(e[0]),1)]),_:2},1032,["onClick","color","fill"])):(0,l.Q3)("",!0)]),_:2},1024))),128))]),_:1})]),_:1})):((0,l.uX)(),(0,l.Wv)(w,{key:2},{default:(0,l.k6)(()=>[(0,l.bF)(S,null,{default:(0,l.k6)(()=>[(0,l.bF)(O,null,{default:(0,l.k6)(()=>[o.orderData.order_description?o.orderData.locationStart?o.orderData.locationFinish?u.isValidAll?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(I,{key:3,onClick:t[27]||(t[27]=e=>u.toggleValid(1)),expand:"block",color:"light"},{default:(0,l.k6)(()=>t[51]||(t[51]=[(0,l.eW)(" Согласиться с условиями ")])),_:1,__:[51]})):((0,l.uX)(),(0,l.Wv)(I,{key:2,onClick:t[26]||(t[26]=e=>u.locationFinishSelect()),expand:"block",color:"light"},{default:(0,l.k6)(()=>t[50]||(t[50]=[(0,l.eW)(" Куда отвезти ")])),_:1,__:[50]})):((0,l.uX)(),(0,l.Wv)(I,{key:1,onClick:t[25]||(t[25]=e=>u.locationStartSelect()),expand:"block",color:"light"},{default:(0,l.k6)(()=>t[49]||(t[49]=[(0,l.eW)(" Откуда забрать ")])),_:1,__:[49]})):((0,l.uX)(),(0,l.Wv)(I,{key:0,onClick:t[24]||(t[24]=t=>e.$refs.description.$el.setFocus()),expand:"block",color:"light"},{default:(0,l.k6)(()=>t[48]||(t[48]=[(0,l.eW)(" Заполнить описание ")])),_:1,__:[48]}))]),_:1})]),_:1}),(0,l.bF)(I,{onClick:t[28]||(t[28]=e=>u.stageCreate(o.orderData.order_id,"customer_deleted","")),expand:"block",fill:"clear"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{slot:"start",src:c.checkmarkOutline},null,8,["src"]),t[52]||(t[52]=(0,l.eW)(" Удалить "))]),_:1,__:[52]})]),_:1}))])):((0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(_,{detail:"",button:"",lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{slot:"start",icon:c.storefrontOutline},null,8,["icon"]),(0,l.bF)(V,{animated:"",style:{width:"200px"}})]),_:1}),(0,l.bF)(y,null,{default:(0,l.k6)(()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([1,2,3],e=>(0,l.bF)(_,{key:e},{default:(0,l.k6)(()=>[(0,l.bF)(b,{style:{"background-color":"var(--ion-color-light)"}}),(0,l.bF)(w,null,{default:(0,l.k6)(()=>[(0,l.bF)(O,null,{default:(0,l.k6)(()=>[(0,l.bF)(S,null,{default:(0,l.k6)(()=>[(0,l.bF)(V,{animated:"",style:{width:"100%"}})]),_:1}),(0,l.bF)(S,null,{default:(0,l.k6)(()=>[(0,l.bF)(h,{color:"primary"},{default:(0,l.k6)(()=>[(0,l.bF)(V,{animated:"",style:{width:"100px"}})]),_:1})]),_:1})]),_:1})]),_:1}),t[53]||(t[53]=(0,l.Lk)("div",{slot:"end",style:{position:"relative",width:"120px","min-height":"48px","background-color":"var(--ion-color-light)"}},null,-1))]),_:2,__:[53]},1024)),64))]),_:1}),(0,l.bF)(w,null,{default:(0,l.k6)(()=>[(0,l.bF)(S,null,{default:(0,l.k6)(()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([1,2],e=>(0,l.bF)(O,{key:e},{default:(0,l.k6)(()=>[(0,l.bF)(I,{color:"light",style:{width:"100%"}})]),_:2},1024)),64))]),_:1})]),_:1})]))}var d=o(5634),u=o(5480);const h={class:"ion-padding"};function _(e,t,o,n,a,s){const r=(0,l.g2)("ion-title"),c=(0,l.g2)("ion-icon"),d=(0,l.g2)("ion-item"),u=(0,l.g2)("ion-toolbar"),_=(0,l.g2)("ion-header"),m=(0,l.g2)("ion-img"),p=(0,l.g2)("ion-label"),k=(0,l.g2)("ion-list"),g=(0,l.g2)("ion-button"),b=(0,l.g2)("ion-content");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(_,null,{default:(0,l.k6)(()=>[(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)(d,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(r,null,{default:(0,l.k6)(()=>t[3]||(t[3]=[(0,l.eW)("Мои адреса")])),_:1,__:[3]}),(0,l.bF)(c,{slot:"end",onClick:t[0]||(t[0]=e=>{s.modalClose()}),icon:n.closeOutline,size:"large"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),(0,l.bF)(b,null,{default:(0,l.k6)(()=>[a.locationList.length?((0,l.uX)(),(0,l.Wv)(k,{key:0,lines:"full"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.locationList,(t,o)=>((0,l.uX)(),(0,l.Wv)(d,{key:t.location_id},{default:(0,l.k6)(()=>[(0,l.bF)(m,{slot:"start",alt:"location icon",src:`${e.$heap.state.hostname}/image/get.php/${t.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,l.bF)(p,{onClick:e=>s.locationSelect(t),style:{"white-space":"normal",cursor:"pointer"},class:(0,i.C4)(1==t.is_main?"is_main":"")},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(t.location_address),1)]),_:2},1032,["onClick","class"]),(0,l.bF)(c,{slot:"end",icon:n.trashOutline,onClick:e=>s.locationDelete(`${t.location_id}`,`${o}`)},null,8,["icon","onClick"])]),_:2},1024))),128))]),_:1})):(0,l.Q3)("",!0),(0,l.Lk)("div",h,[(0,l.bF)(g,{expand:"block",onClick:t[1]||(t[1]=e=>s.modalLocationCreate())},{default:(0,l.k6)(()=>[(0,l.bF)(c,{src:n.locationOutline,slot:"start"},null,8,["src"]),t[4]||(t[4]=(0,l.eW)(" Добавить адрес"))]),_:1,__:[4]}),(0,l.bF)(g,{onClick:t[2]||(t[2]=e=>{s.modalClose()}),color:"light",expand:"block"},{default:(0,l.k6)(()=>t[5]||(t[5]=[(0,l.eW)("Назад")])),_:1,__:[5]})])]),_:1})],64)}o(8111),o(116);var m=o(5538),p=o(8701),k=o(2311),g=o.n(k),b=o(6420),f={components:{IonImg:d.KW,IonLabel:d.he,IonItem:d.uz,IonList:d.nf,IonButton:d.Jm,IonIcon:d.iq,IonHeader:d.eU,IonToolbar:d.ai,IonTitle:d.BC,IonContent:d.W9},setup(){return{locationOutline:u.UN$,trashOutline:u.P1A,addOutline:u.EKF,closeOutline:u.xfX}},data(){return{locationList:[],locationGroupList:[]}},mounted(){this.locationListGet()},computed:{mainAddress(){var e;return null===(e=this.locationList)||void 0===e?void 0:e.find(e=>1==e.is_main)}},methods:{modalClose(){d.OZ.dismiss(null,"cancel")},async modalLocationCreate(e,t){if(!m.A.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/modal/user-authorize"));const o=await d.OZ.create({component:b.A,showBackdrop:!0,componentProps:{locationGroupList:this.locationGroupList}});return o.onDidDismiss().then(e=>{const t=e.data;t&&this.locationCreate(t)}),o.present()},async locationListGet(){try{let e=null;const t=await g().get(m.A.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=t.location_list,this.locationGroupList=t.location_group_list,this.locationList)for(let o of this.locationList)1==o.is_main&&(e=o);if(!e)return void p.A.get()}catch{}},async locationCreate(e){let t={location_holder:"user",location_holder_id:m.A.state.user.user_id,location_group_id:e.location_group_id,location_address:e.location_address,location_latitude:e.location_latitude,location_longitude:e.location_longitude,location_comment:e.location_comment};try{await g().post(m.A.state.hostname+"User/locationCreate",t),await this.locationListGet(),this.locationList[0]&&this.locationSelect(this.locationList[0])}catch(o){const e=o.responseJSON,t=e.messages.error;switch(t){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},locationSelect(e){d.OZ.dismiss(e,"confirm")},async locationDelete(e,t){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(t,1),await g().post(m.A.state.hostname+"User/locationDelete",{location_id:e})}catch{}this.locationListGet()}}}},v=o(6262);const y=(0,v.A)(f,[["render",_],["__scopeId","data-v-d81514ee"]]);var F=y,C={props:["orderData"],components:{IonIcon:d.iq,IonText:d.IO,IonLabel:d.he,IonItem:d.uz,IonList:d.nf,IonImg:d.KW,IonThumbnail:d.Zx,IonButton:d.Jm,IonCol:d.hU,IonRow:d.ln,IonGrid:d.lO,IonSkeletonText:d.ds,IonCard:d.b_,IonCardContent:d.I9,IonItemDivider:d.Dg,IonTextarea:d.nc,IonAccordion:d.xk,IonAccordionGroup:d.YH,IonChip:d.ZB,IonCheckbox:d.eY},setup(){return{add:u.WQq,remove:u.TFI,trash:u.dco,rocketOutline:u.hGQ,storefrontOutline:u.te8,checkmarkOutline:u.g1L,cubeOutline:u.a7r,walletOutline:u.eF1,banOutline:u.Av6,giftOutline:u.Lsq,cardOutline:u.VR9,ribbonOutline:u.rp8,chatboxEllipsesOutline:u.Pkp,locationOutline:u.UN$,flagOutline:u.NBP,chevronDown:u.uaq,addOutline:u.EKF,checkmark:u.AIp,cashOutline:u.A3w,businessOutline:u.FL4,alertCircleOutline:u.ndb,helpCircleOutline:u.W2C,callOutline:u.bNN}},data(){return{isValidReadyness:1,isValidSenderReciever:1,isValidDimention:1,isValidWeight:1,isValidContent:1,orderLocal:{}}},computed:{checkoutError(){var e,t,o;if(!this.orderData.locationStart||!this.orderData.locationFinish)return;const l=(null===(e=this.orderLocal.deliveryCalculation)||void 0===e?void 0:e.error)??null;if("no_input"==l)return"Выберите адрес отправителя и получателя";if("start_center_toofar"==l)return"Адрес отправителя посылки слишком удален";if("finish_center_toofar"==l)return"Адрес получателя посылки слишком удален";if("start_finish_toofar"==l){var i;const e=Math.round((null===(i=this.orderLocal.deliveryCalculation)||void 0===i?void 0:i.max_distance)/100)/10;return`Расстояние по карте между адресами ${this.deliveryDistanceKm}км, больше максимального в ${e}км`}return this.orderLocal.deliveryCalculation&&!(null===(t=this.orderLocal.deliveryCalculation)||void 0===t?void 0:t.fee)?"Недостаточно данных, для рассчета стоимости доствки":this.orderLocal.deliveryCalculation&&!(null===(o=this.orderLocal.deliveryCalculation)||void 0===o?void 0:o.deliveryDistance)?"Отправитель и получатель в одной точке":null},deliveryDistanceKm(){var e;return Math.round((null===(e=this.orderLocal.deliveryCalculation)||void 0===e?void 0:e.deliveryDistance)/100)/10||0},deliveryFeeTotal(){var e;const t=(null===(e=this.orderLocal.deliveryCalculation)||void 0===e?void 0:e.fee)??0;return Math.round(t*this.deliveryDistanceKm)},isReadyToCheckout(){return this.orderData.order_description&&this.orderData.locationStart&&this.orderData.locationFinish&&!this.checkoutError&&this.isValidAll},isValidAll(){return this.isValidContent&&this.isValidDimention&&this.isValidReadyness&&this.isValidWeight&&this.isValidSenderReciever},nextStageButtons(){let e={};for(let t in this.orderData.stage_next)this.orderData.stage_next[t][0]&&(e[t]=this.orderData.stage_next[t],e[t].icon=u.g1L,t.includes("admin")?e[t].icon=u.rp8:t.includes("delivery")?e[t].icon=u.hGQ:t.includes("supplier")&&(e[t].icon=u.te8));return e}},methods:{stageCreate(e,t,o){this.$emit("stageCreate",e,t)},async itemUpdate(e="skipRefresh"){const t=this.orderLocal;t.mode=e,this.$emit("orderUpdate",t)},async locationSelect(){try{const e=document.querySelector("ion-router-outlet"),t=await d.OZ.create({component:F,canDismiss:!0,backdropDismiss:!0,keyboardClose:!0,presentingElement:e});t.present();const{data:o,role:l}=await t.onWillDismiss();return o}catch{}},async locationStartSelect(){var e;this.orderLocal.locationStart=await this.locationSelect(),this.orderLocal.order_start_location_id=null===(e=this.orderLocal.locationStart)||void 0===e?void 0:e.location_id,this.itemUpdate("refreshTotalEstimates")},async locationFinishSelect(){var e;this.orderLocal.locationFinish=await this.locationSelect(),this.orderLocal.order_finish_location_id=null===(e=this.orderLocal.locationFinish)||void 0===e?void 0:e.location_id,this.itemUpdate("refreshTotalEstimates")},async locationPhoneEdit(e){let t=this.orderLocal[e].location_phone??"";const o=await d.TN.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:t}]});try{await o.present();const{data:l,role:i}=await o.onDidDismiss();"confirm"==i&&(t=l.values.phone.replace(/\D/g,"").replace(/^7/,""),t&&(10!=t.length&&this.$flash("Проверьте правильность телефона"),t="+7"+t)),"cancel"==i&&(t=""),this.orderLocal[e].location_phone=t;const n=this.orderLocal[e],a={location_id:n.location_id,location_phone:t};this.$emit("locationUpdate",a),this.itemUpdate()}catch(l){console.log(l)}},async locationCommentEdit(e){let t=this.orderLocal[e].location_comment??"";const o=await d.TN.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:t}]});try{await o.present();const{data:l,role:i}=await o.onDidDismiss();t=l.values.comment,"cancel"==i&&(t=""),this.orderLocal[e].location_comment=t;const n=this.orderLocal[e],a={location_id:n.location_id,location_comment:t};this.$emit("locationUpdate",a),this.itemUpdate()}catch(l){console.log(l)}},toggleValid(e){this.isValidContent=this.isValidDimention=this.isValidWeight=this.isValidReadyness=this.isValidSenderReciever=e}},async created(){this.orderLocal=this.orderData},watch:{orderData:async function(e){this.orderLocal=e}}};const L=(0,v.A)(C,[["render",c],["__scopeId","data-v-cd8cef86"]]);var W=L},6420:function(e,t,o){o.d(t,{A:function(){return y}});var l=o(641),i=o(33),n=o(3751);const a={style:{position:"absolute",bottom:"10px",width:"100%"}},s={style:{"margin-left":"12px","margin-right":"12px","background-color":"#ffffffdd","--ion-item-background":"#ffffff00","border-top-left-radius":"10px","border-top-right-radius":"10px"}},r={key:0},c={key:1},d={slot:"end",style:{color:"#666"}},u={style:{width:"100%"}},h={style:{display:"grid","grid-template-columns":"1fr 1fr","margin-bottom":"var(--ion-safe-area-bottom)"}};function _(e,t,o,_,m,p){const k=(0,l.g2)("ymap-marker"),g=(0,l.g2)("yandex-map"),b=(0,l.g2)("ion-item"),f=(0,l.g2)("ion-searchbar"),v=(0,l.g2)("ion-content"),y=(0,l.g2)("ion-img"),F=(0,l.g2)("ion-label"),C=(0,l.g2)("ion-segment-button"),L=(0,l.g2)("ion-segment"),W=(0,l.g2)("ion-input"),x=(0,l.g2)("ion-icon"),I=(0,l.g2)("ion-button"),O=(0,l.g2)("ion-toolbar");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(v,null,{default:(0,l.k6)(()=>[m.showed?((0,l.uX)(),(0,l.Wv)(g,{key:0,onClick:t[0]||(t[0]=e=>{p.onClick(e)}),style:{height:"100%"},coords:m.coords,zoom:16,settings:m.settings,controls:["zoomControl"]},{default:(0,l.k6)(()=>[(0,l.bF)(k,{coords:m.coords,"marker-id":"1",properties:p.placemarkProperties},null,8,["coords","properties"])]),_:1},8,["coords","settings"])):(0,l.Q3)("",!0),(0,l.Lk)("div",a,[(0,l.Lk)("div",s,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(m.suggestions,(e,t)=>((0,l.uX)(),(0,l.Wv)(b,{key:t,onClick:t=>p.suggestionSelect(`${e.subtitle.text}, ${e.title.text}`,e.uri),lines:"full"},{default:(0,l.k6)(()=>[0==t?((0,l.uX)(),(0,l.CE)("p",r,[(0,l.Lk)("b",null,(0,i.v_)(e.subtitle.text)+" "+(0,i.v_)(e.title.text),1)])):((0,l.uX)(),(0,l.CE)("p",c,(0,i.v_)(e.subtitle.text)+" "+(0,i.v_)(e.title.text),1)),(0,l.Lk)("span",d,(0,i.v_)(e.distance.text),1)]),_:2},1032,["onClick"]))),128))]),(0,l.bF)(f,{debounce:"500",modelValue:m.addressSearchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>m.addressSearchQuery=e),onIonInput:t[2]||(t[2]=e=>p.suggestionsGet()),onKeyup:t[3]||(t[3]=(0,n.jR)(e=>p.pickAddress(),["enter"])),placeholder:"поиск по адресу",class:"search"},null,8,["modelValue"])])]),_:1}),(0,l.bF)(O,{style:{"--background":"white"}},{default:(0,l.k6)(()=>[(0,l.Lk)("div",u,[m.locationGroups?((0,l.uX)(),(0,l.Wv)(L,{key:0,mode:"ios",modelValue:m.locationGroup,"onUpdate:modelValue":t[4]||(t[4]=e=>m.locationGroup=e)},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(m.locationGroups,t=>((0,l.uX)(),(0,l.Wv)(C,{key:t.group_id,value:t},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:`${e.$heap.state.hostname}/image/get.php/${t.image_hash}.40.40.png`,style:{height:"18px"}},null,8,["src"]),(0,l.bF)(F,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(t.group_name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):(0,l.Q3)("",!0),(0,l.bF)(W,{label:"квартира, дом, этаж, подъезд","label-placement":"floating",modelValue:m.addressComment,"onUpdate:modelValue":t[5]||(t[5]=e=>m.addressComment=e)},null,8,["modelValue"]),(0,l.Lk)("div",h,[(0,l.bF)(I,{onClick:t[6]||(t[6]=e=>_.closeModal()),color:"light",expand:"block"},{default:(0,l.k6)(()=>[(0,l.bF)(x,{src:_.closeOutline,slot:"start"},null,8,["src"]),t[8]||(t[8]=(0,l.eW)(" Закрыть "))]),_:1,__:[8]}),(0,l.bF)(I,{strong:!0,onClick:t[7]||(t[7]=e=>p.pickAddress()),color:"primary",expand:"block"},{default:(0,l.k6)(()=>[(0,l.bF)(x,{src:_.checkmark,slot:"start"},null,8,["src"]),t[9]||(t[9]=(0,l.eW)("Ок "))]),_:1,__:[9]})])])]),_:1}),t[10]||(t[10]=(0,l.Lk)("div",{style:{height:"var(--ion-safe-area-bottom)"}},null,-1))],64)}o(4114),o(8111),o(116);var m=o(5634),p=o(5221),k=o(5480),g=o(8701),b={components:{IonContent:m.W9,IonToolbar:m.ai,IonButton:m.Jm,IonSearchbar:m.S1,IonIcon:m.iq,IonItem:m.uz,IonInput:m.$w,IonSegment:m.Gp,IonSegmentButton:m.eP,IonImg:m.KW,IonLabel:m.he,yandexMap:p.IK,ymapMarker:p.cT},setup(){const e=function(){m.OZ.dismiss()};return{closeModal:e,locationOutline:k.UN$,closeOutline:k.xfX,checkmark:k.AIp}},props:["location_group_name_low","locationGroupList"],data(){var e;let t=this.$heap.state.settings.location,o=JSON.parse(t.mapCenter);return{settings:{apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationGroup:(null===(e=this.locationGroupList)||void 0===e?void 0:e[0])??null,locationGroups:this.locationGroupList??null,locSettings:t,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o,addressComment:"",showed:1}},computed:{locationType(){return this.locationGroup?this.locationGroup.group_name+" адрес":this.location_group_name_low??"адрес"},placemarkProperties(){return{iconCaption:this.locationType}}},methods:{async pickAddress(){var e;try{if(this.suggestions[0]&&(console.log(this.coords),await this.suggestionSelect(this.suggestions[0].title.text,this.suggestions[0].uri),console.log(this.coords)),!this.selectedAddress){var t;const e=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=e.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(l){console.log(l)}var o={location_group_id:(null===(e=this.locationGroup)||void 0===e?void 0:e.group_id)??null,location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};m.OZ.dismiss(o)},filterAddress(e){const t=this.locSettings.addressErase.split(", "),o=e.split(", ");let l=[];for(const i of o)t.find(e=>e==i)||l.push(i);return l.reverse().join(", ")},onClick(e){e&&e.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=e.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const e=this.$heap.state.settings.location.ymapSuggestionApiKey,t=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${e}&results=3&lang=ru_RU&ll=${t}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),l=await o.json();this.suggestions=l.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(e,t){this.selectedAddress=e,this.addressSearchQuery=e,await this.geocode(t)},async geocode(e){try{this.suggestions=[];const t=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${t}&format=json&results=1&uri=${e}`),l=await o.json(),i=l.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=i.Point.pos.split(" ").reverse()}catch(t){console.log(t)}}},async mounted(){this.showed=0,setTimeout(async()=>{await(0,p.wc)(),this.showed=1,document.querySelectorAll(".search input")[0].focus();const e=g.A.geo.lastStoredGet();null!==e&&void 0!==e&&e.location_latitude&&(this.coords=[e.location_latitude,e.location_longitude]);const t=await g.A.geo.get();if(this.markDeviceOnMap&&t){const{coords:e}=t;this.coords=[e.latitude,e.longitude],this.$flash("На карте отмечено ваше местоположение")}},100)}},f=o(6262);const v=(0,f.A)(b,[["render",_],["__scopeId","data-v-91b73b40"]]);var y=v}}]);
//# sourceMappingURL=1723.3ece5a62.js.map