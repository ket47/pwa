{"version":3,"file":"js/459.54d346b1.js","mappings":"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","sources":["webpack://tezkel/./src/views/MsgDashboard.vue","webpack://tezkel/./src/views/MsgDashboard.vue?fbaa"],"sourcesContent":["<template>\r\n  <base-layout pageTitle=\"Уведомления\">\r\n      <ion-card v-if=\"permission=='denied'\" color=\"danger\">\r\n        <ion-card-header>\r\n          <ion-card-title>Уведомления заблокированы вами</ion-card-title>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          К сожалению, мы не сможем уведомлять вас о статусах заказов \r\n          <p>\r\n            <ion-button @click=\"subscribe()\" expand=\"full\">Подписаться на уведомления</ion-button>\r\n          </p>\r\n        </ion-card-content>\r\n      </ion-card>\r\n\r\n      <ion-card v-if=\"permission=='default'\" color=\"warning\">\r\n        <ion-card-header>\r\n          <ion-card-title>Уведомления не разрешены</ion-card-title>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          Чтобы вовремя узнавать об изменениях статусов заказов, подпишитесь на уведомления\r\n          <p>\r\n            <ion-button @click=\"subscribe()\" expand=\"full\">Подписаться на уведомления</ion-button>\r\n          </p>\r\n        </ion-card-content>        \r\n      </ion-card>\r\n\r\n      <div v-if=\"registered\">\r\n\r\n        <ion-card color=\"success\">\r\n          <ion-card-header>\r\n            <ion-card-title>Вы подписаны на уведомления</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <p>Вам будут приходить некоторые уведомления</p>\r\n          </ion-card-content>\r\n        </ion-card>\r\n        <ion-list>\r\n          <ion-item-divider>Темы уведомлений</ion-item-divider>\r\n          <ion-item>Статусы заказов</ion-item>\r\n          <ion-item>Начисленные бонусы</ion-item>\r\n        </ion-list>\r\n      </div>\r\n\r\n  </base-layout>\r\n</template>\r\n<script>\r\nimport { initializeApp } from \"firebase/app\";\r\nimport { getMessaging, getToken } from \"firebase/messaging\";\r\n\r\nimport {\r\n  IonButton,\r\n  IonCard,\r\n  IonCardHeader,\r\n  IonCardTitle,\r\n  IonCardContent,\r\n  IonList,\r\n  IonItem,\r\n  IonItemDivider,\r\n}             from \"@ionic/vue\"\r\nimport jQuery from 'jquery'\r\n\r\nexport default {\r\n  components:{\r\n  IonButton,\r\n  IonCard,\r\n  IonCardHeader,\r\n  IonCardTitle,\r\n  IonCardContent,\r\n  IonList,\r\n  IonItem,\r\n  IonItemDivider,\r\n  },\r\n  data(){\r\n    return {\r\n      permission:Notification.permission,\r\n      registered:false\r\n    }\r\n  },\r\n  methods: {\r\n    async saveNotificationToken(){\r\n      if(this.permission!='granted'){\r\n        return\r\n      }\r\n      if( !(this.$heap.state.user.user_id>0) || !this.$heap.state.settings?.firebase || this.registered ){\r\n        return\r\n      }\r\n      try{\r\n        const vapidKey=this.$heap.state.settings.firebase.vapidKey\r\n        const messaging = getMessaging();\r\n        const token=await getToken(messaging, {vapidKey});\r\n        const request={\r\n          type:'webpush',\r\n          registration_id:token,\r\n          user_agent:navigator.userAgent\r\n        }\r\n        await jQuery.post(`${this.$heap.state.hostname}MessageSub/itemCreate`,request)\r\n        this.registered=true;\r\n      }catch(err){\r\n        console.log(err)\r\n      }\r\n    },\r\n    async subscribe(){\r\n      try{\r\n        this.permission=await Notification.requestPermission()\r\n        if(this.permission=='granted'){\r\n          this.saveNotificationToken()\r\n        }\r\n      }catch(err){\r\n        this.$flash(\"Вы не разрешили уведомлять вас\")\r\n      }\r\n    },\r\n    init(){\r\n      if(!this.$heap.state?.settings?.firebase){\r\n        return\r\n      }\r\n      initializeApp(this.$heap.state.settings.firebase);\r\n    }\r\n  },\r\n  mounted() {\r\n    const self=this\r\n    this.$topic.on('settingsGet',function(){\r\n      self.init()\r\n      self.saveNotificationToken()\r\n    })\r\n    this.$topic.on('userGet',function(){\r\n      self.saveNotificationToken()\r\n    })\r\n    self.init()\r\n    self.saveNotificationToken()\r\n  },\r\n}\r\n</script>","import { render } from \"./MsgDashboard.vue?vue&type=template&id=781486a2\"\nimport script from \"./MsgDashboard.vue?vue&type=script&lang=js\"\nexport * from \"./MsgDashboard.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"W:\\\\Ionic\\\\Tezkel\\\\blank\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","_createBlock","_component_base_layout","pageTitle","$data","_component_ion_card","color","_createVNode","_component_ion_card_header","_component_ion_card_title","_component_ion_card_content","_component_ion_button","onClick","$options","expand","_createElementBlock","_hoisted_7","_hoisted_9","_component_ion_list","_component_ion_item_divider","_component_ion_item","components","IonButton","IonCard","IonCardHeader","IonCardTitle","IonCardContent","IonList","IonItem","IonItemDivider","data","permission","Notification","registered","methods","async","this","$heap","state","user","user_id","settings","firebase","vapidKey","messaging","getMessaging","token","getToken","request","type","registration_id","user_agent","navigator","userAgent","jQuery","hostname","err","console","log","requestPermission","saveNotificationToken","$flash","init","initializeApp","mounted","self","$topic","on","__exports__","render"],"sourceRoot":""}