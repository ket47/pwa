"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[1565],{6178:function(t,o,e){e.d(o,{Z:function(){return _}});var i=e(6252),l=e(3577);const n={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},a={slot:"end",style:{color:"#666"}};function r(t,o,e,r,s,c){const d=(0,i.up)("ymap-marker"),u=(0,i.up)("yandex-map"),m=(0,i.up)("ion-searchbar"),h=(0,i.up)("ion-item"),p=(0,i.up)("ion-content"),_=(0,i.up)("ion-textarea"),g=(0,i.up)("ion-icon"),w=(0,i.up)("ion-button"),f=(0,i.up)("ion-toolbar");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{onClick:o[0]||(o[0]=t=>c.onClick(t)),style:{height:"100%"},coords:s.coords,zoom:16,settings:s.settings,controls:["zoomControl"]},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{coords:s.coords,"marker-id":"1",properties:s.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,i._)("div",n,[(0,i.Wm)(m,{debounce:"500",modelValue:s.addressSearchQuery,"onUpdate:modelValue":o[1]||(o[1]=t=>s.addressSearchQuery=t),onIonInput:o[2]||(o[2]=t=>c.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.suggestions,((t,o)=>((0,i.wg)(),(0,i.j4)(h,{key:o,onClick:o=>c.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.subtitle.text)+" "+(0,l.zw)(t.title.text)+" ",1),(0,i._)("span",a,(0,l.zw)(t.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{label:"комментарий к адресу","label-placement":"floating",modelValue:s.addressComment,"onUpdate:modelValue":o[3]||(o[3]=t=>s.addressComment=t)},null,8,["modelValue"]),(0,i.Wm)(w,{strong:!0,onClick:o[4]||(o[4]=t=>c.pickAddress()),color:"primary",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{src:r.checkmark,slot:"start"},null,8,["src"]),(0,i.Uk)(" Ок ")])),_:1}),(0,i.Wm)(w,{onClick:o[5]||(o[5]=t=>r.closeModal()),color:"light",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Закрыть")])),_:1})])),_:1})],64)}e(7658);var s=e(4929),c=e(5836),d=e(8903),u=e(351),m={components:{IonContent:s.W2,IonToolbar:s.sr,IonButton:s.YG,IonSearchbar:s.VI,IonIcon:s.gu,IonItem:s.Ie,IonTextarea:s.g2,yandexMap:c.xR,ymapMarker:c.Jk},setup(){const t=function(){s.Fy.dismiss()};return{closeModal:t,locationOutline:d.Iv7,closeOutline:d.fID,checkmark:d.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",o=this.$heap.state.settings.location,e=JSON.parse(o.mapCenter);return{settings:{apiKey:o.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},suggestions:[],addressSearchQuery:null,locationType:t,locSettings:o,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:e,addressComment:""}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t;const o=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=o.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(e){}var o={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};s.Fy.dismiss(o)},filterAddress(t){const o=this.locSettings.addressErase.split(", "),e=t.split(", ");let i=[];for(const l of e)o.find((t=>t==l))||i.push(l);return i.reverse().join(", ")},onClick(t){t&&t.get&&(this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,o=this.coords.slice().reverse().join(","),e=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${o}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),i=await e.json();this.suggestions=i.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(t,o){this.selectedAddress=t,this.geocode(o)},async geocode(t){try{this.suggestions=[];const o=this.$heap.state.settings.location.ymapApiKey,e=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${o}&format=json&results=1&uri=${t}`),i=await e.json(),l=i.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=l.Point.pos.split(" ").reverse()}catch(o){console.log(o)}}},async mounted(){await(0,c.xk)();const t=u.Z.geo.lastStoredGet();null!==t&&void 0!==t&&t.location_latitude&&(this.coords=[t.location_latitude,t.location_longitude]);const o=await u.Z.geo.get();if(o){const{coords:t}=o;this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}}},h=e(3744);const p=(0,h.Z)(m,[["render",r]]);var _=p},1565:function(t,o,e){e.r(o),e.d(o,{default:function(){return U}});var i=e(6252);function l(t,o,e,l,n,a){const r=(0,i.up)("shipment-draft-comp"),s=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(s,{"page-title":"Вызов курьера"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{orderData:n.order,onStageCreate:a.onStageCreate,onOrderUpdate:a.itemUpdate,onLocationUpdate:a.locationUpdate},null,8,["orderData","onStageCreate","onOrderUpdate","onLocationUpdate"])])),_:1})}e(8862),e(7658);var n=e(9755),a=e.n(n),r=(e(1817),e(3577));const s=t=>((0,i.dD)("data-v-2557d0e3"),t=t(),(0,i.Cn)(),t),c={key:0},d=s((()=>(0,i._)("h1",null,"Ваш заказ",-1))),u=s((()=>(0,i._)("p",null,[(0,i._)("b",null,"Курьер отвезет вашу посылку")],-1))),m={key:0},h={key:2},p={key:1},_=s((()=>(0,i._)("div",{slot:"end",style:{position:"relative",width:"120px","min-height":"48px","background-color":"var(--ion-color-light)"}},null,-1)));function g(t,o,e,l,n,a){const s=(0,i.up)("ion-label"),g=(0,i.up)("ion-item"),w=(0,i.up)("ion-textarea"),f=(0,i.up)("ion-item-divider"),y=(0,i.up)("ion-icon"),k=(0,i.up)("ion-img"),v=(0,i.up)("ion-thumbnail"),W=(0,i.up)("ion-text"),C=(0,i.up)("ion-chip"),S=(0,i.up)("ion-list"),L=(0,i.up)("ion-accordion"),b=(0,i.up)("ion-accordion-group"),x=(0,i.up)("ion-card-content"),D=(0,i.up)("ion-card"),I=(0,i.up)("ion-button"),O=(0,i.up)("ion-col"),$=(0,i.up)("ion-row"),U=(0,i.up)("ion-grid"),j=(0,i.up)("ion-skeleton-text");return e.orderData?((0,i.wg)(),(0,i.iD)("div",c,[(0,i.Wm)(S,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[d,u])),_:1})])),_:1}),(0,i.Wm)(g,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{ref:"description",modelValue:n.orderLocal.order_description,"onUpdate:modelValue":o[0]||(o[0]=t=>n.orderLocal.order_description=t),rows:"5",label:"",placeholder:"напишите, что будем везти",style:{"background-color":"var(--ion-color-light)","border-radius":"10px"},onIonInput:o[1]||(o[1]=t=>a.itemUpdate()),debounce:"50"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Детали перевозки")])),_:1}),n.orderLocal.locationStart?((0,i.wg)(),(0,i.iD)("div",m,[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(y,{color:"medium",src:l.locationOutline,slot:"start"},null,8,["src"]),(0,i.Uk)(" Отправитель ")])),_:1}),(0,i.Wm)(g,{button:"",detail:"",onClick:o[2]||(o[2]=t=>a.locationStartSelect())},{default:(0,i.w5)((()=>{var o;return[null!==(o=n.orderLocal.locationStart)&&void 0!==o&&o.image_hash?((0,i.wg)(),(0,i.j4)(v,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,i.w5)((()=>{var o;return[(0,i.Wm)(k,{src:`${t.$heap.state.hostname}image/get.php/${null===(o=n.orderLocal.locationStart)||void 0===o?void 0:o.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,i.wg)(),(0,i.j4)(y,{key:1,color:"primary",src:l.locationOutline,slot:"start"},null,8,["src"])),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(n.orderLocal.locationStart.location_address),1)])),_:1})]})),_:1}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i._)("div",null,[n.orderLocal.locationStart.location_comment?((0,i.wg)(),(0,i.iD)("div",{key:0,onClick:o[3]||(o[3]=t=>a.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"10px",display:"inline-block"}},(0,r.zw)(n.orderLocal.locationStart.location_comment),1)):((0,i.wg)(),(0,i.j4)(C,{key:1,color:"medium",onClick:o[4]||(o[4]=t=>a.locationCommentEdit("locationStart"))},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:l.addOutline},null,8,["src"]),(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("комментарий")])),_:1})])),_:1})),n.orderLocal.locationStart.location_phone?((0,i.wg)(),(0,i.j4)(C,{key:2,color:"medium",onClick:o[5]||(o[5]=t=>a.locationPhoneEdit("locationStart"))},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:l.callOutline},null,8,["src"]),(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(n.orderLocal.locationStart.location_phone),1)])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(C,{key:3,color:"medium",onClick:o[6]||(o[6]=t=>a.locationPhoneEdit("locationStart"))},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:l.addOutline},null,8,["src"]),(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("телефон")])),_:1})])),_:1}))])])),_:1})])):((0,i.wg)(),(0,i.j4)(g,{key:1,button:"","detail-icon":l.addOutline,onClick:o[7]||(o[7]=t=>a.locationStartSelect())},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{color:"medium",src:l.locationOutline,slot:"start"},null,8,["src"]),(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Откуда забрать?")])),_:1}),(0,i.Wm)(y,{color:"warning",src:l.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),n.orderLocal.locationFinish?((0,i.wg)(),(0,i.iD)("div",h,[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(y,{color:"medium",src:l.flagOutline,slot:"start"},null,8,["src"]),(0,i.Uk)(" Получатель ")])),_:1}),(0,i.Wm)(g,{button:"",detail:"",onClick:o[8]||(o[8]=t=>a.locationFinishSelect())},{default:(0,i.w5)((()=>{var o;return[null!==(o=e.orderData.locationFinish)&&void 0!==o&&o.image_hash?((0,i.wg)(),(0,i.j4)(v,{key:0,slot:"start",style:{"--size":"20px"}},{default:(0,i.w5)((()=>{var o;return[(0,i.Wm)(k,{src:`${t.$heap.state.hostname}image/get.php/${null===(o=e.orderData.locationFinish)||void 0===o?void 0:o.image_hash}.150.150.webp`},null,8,["src"])]})),_:1})):((0,i.wg)(),(0,i.j4)(y,{key:1,color:"primary",src:l.flagOutline,slot:"start"},null,8,["src"])),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.orderData.locationFinish.location_address),1)])),_:1})]})),_:1}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i._)("div",null,[n.orderLocal.locationFinish.location_comment?((0,i.wg)(),(0,i.iD)("div",{key:0,onClick:o[9]||(o[9]=t=>a.locationCommentEdit("locationFinish")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"10px",display:"inline-block"}},(0,r.zw)(n.orderLocal.locationFinish.location_comment),1)):((0,i.wg)(),(0,i.j4)(C,{key:1,color:"medium",onClick:o[10]||(o[10]=t=>a.locationCommentEdit("locationFinish"))},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:l.addOutline},null,8,["src"]),(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("комментарий")])),_:1})])),_:1})),n.orderLocal.locationFinish.location_phone?((0,i.wg)(),(0,i.j4)(C,{key:2,color:"medium",onClick:o[11]||(o[11]=t=>a.locationPhoneEdit("locationFinish"))},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:l.callOutline},null,8,["src"]),(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(n.orderLocal.locationFinish.location_phone),1)])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(C,{key:3,color:"medium",onClick:o[12]||(o[12]=t=>a.locationPhoneEdit("locationFinish"))},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{src:l.addOutline},null,8,["src"]),(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("телефон")])),_:1})])),_:1}))])])),_:1})])):((0,i.wg)(),(0,i.j4)(g,{key:3,button:"","detail-icon":l.addOutline,onClick:o[13]||(o[13]=t=>a.locationFinishSelect())},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{color:"medium",src:l.flagOutline,slot:"start"},null,8,["src"]),(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Куда отвезти?")])),_:1}),(0,i.Wm)(y,{color:"warning",src:l.alertCircleOutline,slot:"end"},null,8,["src"])])),_:1},8,["detail-icon"])),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Итог")])),_:1}),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{slot:"header",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{icon:l.walletOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Итого: ")])),_:1}),(0,i.Wm)(s,{slot:"end",color:"primary"},{default:(0,i.w5)((()=>{var o,e;return[(0,i.Uk)((0,r.zw)(null!==(o=null===(e=n.orderLocal.deliveryCalculation)||void 0===e?void 0:e.sum)&&void 0!==o?o:0)+(0,r.zw)(t.$heap.state.currencySign),1)]})),_:1})])),_:1}),(0,i.Wm)(S,{slot:"content"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)("Вызов курьера")])),_:1}),(0,i.Wm)(s,{slot:"end",color:"primary"},{default:(0,i.w5)((()=>{var o,e;return[(0,i.Uk)((0,r.zw)(null!==(o=null===(e=n.orderLocal.deliveryCalculation)||void 0===e?void 0:e.cost)&&void 0!==o?o:0)+(0,r.zw)(t.$heap.state.currencySign),1)]})),_:1})])),_:1}),(0,i.Wm)(g,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>{var o,e;return[(0,i.Uk)("Расстояние по карте "+(0,r.zw)(a.deliveryDistanceKm)+"км по "+(0,r.zw)(null!==(o=null===(e=n.orderLocal.deliveryCalculation)||void 0===e?void 0:e.fee)&&void 0!==o?o:0)+(0,r.zw)(t.$heap.state.currencySign),1)]})),_:1}),(0,i.Wm)(s,{slot:"end",color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(a.deliveryFeeTotal)+(0,r.zw)(t.$heap.state.currencySign),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),a.checkoutError?((0,i.wg)(),(0,i.j4)(D,{key:0,color:"warning"},{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(a.checkoutError),1)])),_:1})])),_:1})):(0,i.kq)("",!0),a.isReadyToCheckout?((0,i.wg)(),(0,i.j4)(U,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)($,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.nextStageButtons,((t,o)=>((0,i.wg)(),(0,i.j4)(O,{key:o},{default:(0,i.w5)((()=>{var l,n;return[t[0]?((0,i.wg)(),(0,i.j4)(I,{key:0,onClick:i=>a.stageCreate(e.orderData.order_id,o,t[1]),expand:"block",color:null!==(l=t[1])&&void 0!==l?l:"primary",fill:null!==(n=t[2])&&void 0!==n?n:"solid"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{slot:"start",src:t.icon},null,8,["src"]),(0,i.Uk)(" "+(0,r.zw)(t[0]),1)])),_:2},1032,["onClick","color","fill"])):(0,i.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(U,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[e.orderData.order_description?e.orderData.locationStart?e.orderData.locationFinish?n.isContentValid&&n.isDimentionValid?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(I,{key:3,onClick:o[17]||(o[17]=t=>n.isContentValid=n.isDimentionValid=1),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Согласиться с условиями ")])),_:1})):((0,i.wg)(),(0,i.j4)(I,{key:2,onClick:o[16]||(o[16]=t=>a.locationFinishSelect()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Куда отвезти ")])),_:1})):((0,i.wg)(),(0,i.j4)(I,{key:1,onClick:o[15]||(o[15]=t=>a.locationStartSelect()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Откуда забрать ")])),_:1})):((0,i.wg)(),(0,i.j4)(I,{key:0,onClick:o[14]||(o[14]=o=>t.$refs.description.$el.setFocus()),expand:"block",color:"light"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Заполнить описание ")])),_:1}))])),_:1})])),_:1})])),_:1}))])):((0,i.wg)(),(0,i.iD)("div",p,[(0,i.Wm)(g,{detail:"",button:"",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{slot:"start",icon:l.storefrontOutline},null,8,["icon"]),(0,i.Wm)(j,{animated:"",style:{width:"200px"}})])),_:1}),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3],(t=>(0,i.Wm)(g,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{style:{"background-color":"var(--ion-color-light)"}}),(0,i.Wm)(U,null,{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"100%"}})])),_:1}),(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"100px"}})])),_:1})])),_:1})])),_:1})])),_:1}),_])),_:2},1024))),64))])),_:1}),(0,i.Wm)(U,null,{default:(0,i.w5)((()=>[(0,i.Wm)($,null,{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2],(t=>(0,i.Wm)(O,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{color:"light",style:{width:"100%"}})])),_:2},1024))),64))])),_:1})])),_:1})]))}var w=e(4929),f=e(8903);function y(t,o,e,l,n,a){const s=(0,i.up)("ion-title"),c=(0,i.up)("ion-icon"),d=(0,i.up)("ion-item"),u=(0,i.up)("ion-toolbar"),m=(0,i.up)("ion-header"),h=(0,i.up)("ion-img"),p=(0,i.up)("ion-label"),_=(0,i.up)("ion-list"),g=(0,i.up)("ion-list-header"),w=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Мои адреса")])),_:1}),(0,i.Wm)(c,{slot:"end",onClick:o[0]||(o[0]=t=>{a.modalClose()}),icon:l.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[n.locationList.length?((0,i.wg)(),(0,i.j4)(_,{key:0,lines:"full"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.locationList,((o,e)=>((0,i.wg)(),(0,i.j4)(d,{key:o.location_id},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.Wm)(p,{onClick:t=>a.locationSelect(o),style:{"white-space":"normal",cursor:"pointer"},class:(0,r.C_)(1==o.is_main?"is_main":"")},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(o.location_address),1)])),_:2},1032,["onClick","class"]),(0,i.Wm)(c,{slot:"end",icon:l.trashOutline,onClick:t=>a.locationDelete(`${o.location_id}`,`${e}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить адрес")])),_:1})])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.locationGroupList,(o=>((0,i.wg)(),(0,i.j4)(d,{key:o.group_id,onClick:t=>a.modalLocationCreate(`${o.group_id}`,`${o.group_name}`),style:{cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(o.group_name),1)])),_:2},1024),(0,i.Wm)(c,{src:l.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}var k=e(2008),v=e(351),W=e(6178),C={components:{IonImg:w.Xz,IonLabel:w.Q$,IonItem:w.Ie,IonList:w.q_,IonListHeader:w.yh,IonIcon:w.gu,IonHeader:w.Gu,IonToolbar:w.sr,IonTitle:w.wd,IonContent:w.W2},setup(){return{locationOutline:f.Iv7,trashOutline:f.gtu,addOutline:f.s6O,closeOutline:f.fID}},data(){return{locationList:[],locationGroupList:[]}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{modalClose(){w.Fy.dismiss(null,"cancel")},async modalLocationCreate(t,o){if(!k.Z.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/user/sign-in"));var e=String(o).toLowerCase();const i=await w.Fy.create({component:W.Z,showBackdrop:!0,componentProps:{location_group_name_low:e}});return i.onDidDismiss().then((o=>{this.locationCreate(t,o.data)})),i.present()},async locationListGet(){try{let t=null;const o=await a().get(k.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=o.location_list,this.locationGroupList=o.location_group_list,this.locationList)for(let e of this.locationList)1==e.is_main&&(t=e);if(!t)return void v.Z.get()}catch{}},async locationCreate(t,o){if(!o)return;let e={location_holder:"user",location_holder_id:k.Z.state.user.user_id,location_group_id:t,location_address:o.location_address,location_latitude:o.location_latitude,location_longitude:o.location_longitude};try{await a().post(k.Z.state.hostname+"User/locationCreate",e),this.locationListGet()}catch(i){const t=i.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},locationSelect(t){w.Fy.dismiss(t,"confirm")},async locationDelete(t,o){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(o,1),await a().post(k.Z.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()}}}},S=e(3744);const L=(0,S.Z)(C,[["render",y],["__scopeId","data-v-7fd5fc7e"]]);var b=L,x={props:["orderData"],components:{IonIcon:w.gu,IonText:w.yW,IonLabel:w.Q$,IonItem:w.Ie,IonList:w.q_,IonImg:w.Xz,IonThumbnail:w.Bs,IonButton:w.YG,IonCol:w.wI,IonRow:w.Nd,IonGrid:w.jY,IonSkeletonText:w.CK,IonCard:w.PM,IonCardContent:w.FN,IonItemDivider:w.rH,IonTextarea:w.g2,IonAccordion:w.We,IonAccordionGroup:w.eh,IonChip:w.hM},setup(){return{add:f.IHx,remove:f.OdJ,trash:f._Ij,rocketOutline:f.G$D,storefrontOutline:f.qRG,checkmarkOutline:f.TjA,cubeOutline:f.XFf,walletOutline:f.S5P,banOutline:f.L6S,giftOutline:f._$o,cardOutline:f.pvm,ribbonOutline:f.Muk,chatboxEllipsesOutline:f._Pt,locationOutline:f.Iv7,flagOutline:f.FMn,chevronDown:f.Dd1,addOutline:f.s6O,checkmark:f.d29,cashOutline:f.zaw,businessOutline:f.c1X,alertCircleOutline:f.nLD,helpCircleOutline:f.Sm,callOutline:f.H7N}},data(){return{isDimentionValid:1,isContentValid:1,orderLocal:{}}},computed:{checkoutError(){var t,o,e,i;const l=null!==(t=null===(o=this.orderLocal.deliveryCalculation)||void 0===o?void 0:o.error)&&void 0!==t?t:null;if("no_input"==l||!this.orderData.locationStart||!this.orderData.locationFinish)return"Выберите адрес отправителя и получателя";if("start_center_toofar"==l)return"Адрес отправителя посылки слишком удален";if("finish_center_toofar"==l)return"Адрес получателя посылки слишком удален";if("start_finish_toofar"==l){var n;const t=Math.round((null===(n=this.orderLocal.deliveryCalculation)||void 0===n?void 0:n.max_distance)/100)/10;return`Расстояние по карте между адресами ${this.deliveryDistanceKm}км, больше максимального в ${t}км`}return null!==(e=null===(i=this.orderLocal.deliveryCalculation)||void 0===i?void 0:i.fee)&&void 0!==e&&e?null:"Тариф доставки не установлен"},deliveryDistanceKm(){var t;return Math.round((null===(t=this.orderLocal.deliveryCalculation)||void 0===t?void 0:t.deliveryDistance)/100)/10||0},deliveryFeeTotal(){var t,o;const e=null!==(t=null===(o=this.orderLocal.deliveryCalculation)||void 0===o?void 0:o.fee)&&void 0!==t?t:0;return Math.round(e*this.deliveryDistanceKm)},isReadyToCheckout(){return this.orderData.order_description&&this.orderData.locationStart&&this.orderData.locationFinish&&!this.checkoutError},nextStageButtons(){let t={};for(let o in this.orderData.stage_next)this.orderData.stage_next[o][0]&&(t[o]=this.orderData.stage_next[o],t[o].icon=f.TjA,o.includes("admin")?t[o].icon=f.Muk:o.includes("delivery")?t[o].icon=f.G$D:o.includes("supplier")&&(t[o].icon=f.qRG));return t}},methods:{stageCreate(t,o,e){("danger"!=e||confirm("Вы уверены?"))&&this.$emit("stageCreate",t,o)},async itemUpdate(t="skipRefresh"){const o=this.orderLocal;o.mode=t,this.$emit("orderUpdate",o)},async locationSelect(){try{const t=document.querySelector("ion-router-outlet"),o=await w.Fy.create({component:b,canDismiss:!0,backdropDismiss:!0,keyboardClose:!0,presentingElement:t});o.present();const{data:e,role:i}=await o.onWillDismiss();return e}catch{}},async locationStartSelect(){var t;this.orderLocal.locationStart=await this.locationSelect(),this.orderLocal.start_location_id=null===(t=this.orderLocal.locationStart)||void 0===t?void 0:t.location_id,this.itemUpdate("refreshTotalEstimates")},async locationFinishSelect(){var t;this.orderLocal.locationFinish=await this.locationSelect(),this.orderLocal.finish_location_id=null===(t=this.orderLocal.locationFinish)||void 0===t?void 0:t.location_id,this.itemUpdate("refreshTotalEstimates")},async locationPhoneEdit(t){var o;let e=null!==(o=this.orderLocal[t].location_phone)&&void 0!==o?o:"";const i=await w.Cl.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:e}]});try{await i.present();const{data:o,role:l}=await i.onDidDismiss();"confirm"==l&&(e=o.values.phone.replace(/\D/g,"").replace(/^7/,""),e&&(10!=e.length&&this.$flash("Проверьте правильность телефона"),e="+7"+e)),"cancel"==l&&(e=""),this.orderLocal[t].location_phone=e;const n=this.orderLocal[t],a={location_id:n.location_id,location_phone:e};this.$emit("locationUpdate",a),this.itemUpdate()}catch(l){console.log(l)}},async locationCommentEdit(t){var o;let e=null!==(o=this.orderLocal[t].location_comment)&&void 0!==o?o:"";const i=await w.Cl.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:e}]});try{await i.present();const{data:o,role:l}=await i.onDidDismiss();e=o.values.comment,"cancel"==l&&(e=""),this.orderLocal[t].location_comment=e;const n=this.orderLocal[t],a={location_id:n.location_id,location_comment:e};this.$emit("locationUpdate",a),this.itemUpdate()}catch(l){console.log(l)}}},async created(){this.orderLocal=this.orderData},watch:{orderData:async function(t){this.orderLocal=t,this.orderLocal}}};const D=(0,S.Z)(x,[["render",g],["__scopeId","data-v-2557d0e3"]]);var I=D,O={components:{ShipmentDraftComp:I},data(){return{order:null,errorCode:null}},methods:{async itemCreate(){const t=new Date,o={order_store_id:null,order_id:0,entries:[],created_at:t.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.itemSave(o)},async itemLoad(){try{const t=JSON.parse(localStorage.shipmentDraft);if(t)return t.deliveryCalculation=await this.itemTotalEstimate(t.start_location_id,t.finish_location_id),void(this.order=t)}catch{}this.itemCreate()},itemSave(t){this.order=t,localStorage.shipmentDraft=JSON.stringify(t)},async itemUpdate(t){console.log(t.mode),"refreshTotalEstimates"==t.mode&&(t.deliveryCalculation=await this.itemTotalEstimate(t.start_location_id,t.finish_location_id)),this.itemSave(Object.assign({},this.order,t))},async locationUpdate(t){try{await a().post(`${this.$heap.state.hostname}Location/itemUpdate`,JSON.stringify(t)),this.$flash("сохранено")}catch{}},async itemTotalEstimate(t,o){if(!t||!o)return;const e={start_location_id:t,finish_location_id:o};try{return await a().post(`${this.$heap.state.hostname}Shipment/itemDeliverySumEstimate`,e)}catch(i){}},async onStageCreate(t,o){if("customer_purged"==o||"customer_deleted"==o)return localStorage.removeItem("shipmentDraft"),void this.$router.replace("/order/order-list");"customer_action_confirm"==o&&(o="customer_confirmed");try{const t={is_shopping:0,order_description:this.order.order_description,order_start_location_id:this.order.start_location_id,order_finish_location_id:this.order.finish_location_id},o=await a().post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(t));o>0&&this.$router.push(`/modal/shipment-checkout-${o}`)}catch(l){var e,i;const o=null===l||void 0===l||null===(e=l.responseJSON)||void 0===e||null===(i=e.messages)||void 0===i?void 0:i.error;if(!o)return!1;switch(o){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии ☹️","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+t;break}return!1}}},mounted(){this.itemLoad()}};const $=(0,S.Z)(O,[["render",l]]);var U=$}}]);
//# sourceMappingURL=1565.6be1bb4a.js.map