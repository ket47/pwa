"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[739],{1739:function(e,o,l){l.r(o),l.d(o,{default:function(){return Z}});var n=l(6252),s=l(9963);const t={novalidate:""},a=(0,n.Uk)("Код"),i=(0,n.Uk)("+7 "),d=(0,n.Uk)("Телефон"),r={"padding-left":""},u=(0,n.Uk)("Пароль (Минимум 6 символов)"),p={"padding-left":""},h=(0,n.Uk)("Войти"),f=(0,n.Uk)("Зарегистрироваться"),c=(0,n.Uk)("Забыли пароль?");function m(e,o,l,m,w,_){const k=(0,n.up)("ion-label"),W=(0,n.up)("ion-select-option"),y=(0,n.up)("ion-select"),g=(0,n.up)("ion-col"),b=(0,n.up)("ion-input"),I=(0,n.up)("ion-row"),V=(0,n.up)("ion-text"),v=(0,n.up)("ion-button"),B=(0,n.up)("ion-grid"),U=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(U,{"page-title":"Вход в систему","page-default-back-link":"/home"},{default:(0,n.w5)((()=>[(0,n._)("form",t,[(0,n.Wm)(B,null,{default:(0,n.w5)((()=>[(0,n.Wm)(I,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,{size:"4"},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[a])),_:1}),(0,n.Wm)(y,{value:w.fields.phonePrefix,onIonChange:o[0]||(o[0]=e=>w.fields.phonePrefix=e.target.value)},{default:(0,n.w5)((()=>[(0,n.Wm)(W,{value:"+7"},{default:(0,n.w5)((()=>[i])),_:1})])),_:1},8,["value"])])),_:1}),(0,n.Wm)(g,{size:"8"},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[d])),_:1}),(0,n.Wm)(b,{modelValue:w.fields.phoneBody,"onUpdate:modelValue":o[1]||(o[1]=e=>w.fields.phoneBody=e),name:"phone",type:"numeric",inputmode:"tel",value:w.fields.phoneBody,onInput:o[2]||(o[2]=e=>{e.target.value=_.phoneValidate(e)}),placeholder:"(900)-000-00-00",spellcheck:"false",autocapitalize:"off",required:""},null,8,["modelValue","value"])])),_:1})])),_:1}),(0,n.Wm)(I,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(V,{color:"danger"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n._)("p",r,"Неверный номер телефона",512),[[s.F8,!_.phoneValid&&1==w.submitted]])])),_:1})])),_:1})])),_:1}),(0,n.Wm)(I,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(k,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[u])),_:1}),(0,n.Wm)(b,{modelValue:w.fields.password,"onUpdate:modelValue":o[3]||(o[3]=e=>w.fields.password=e),name:"password",type:"password",autocorrect:"off",placeholder:"Пароль (Минимум 6 символов)",required:""},null,8,["modelValue"])])),_:1})])),_:1}),(0,n.Wm)(I,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(V,{color:"danger"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n._)("p",p,"Пароль должен содержать не менее 6 символов.",512),[[s.F8,!_.passwordValid&&1==w.submitted]])])),_:1})])),_:1})])),_:1}),(0,n.Wm)(I,{"responsive-sm":""},{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(v,{onClick:_.onSubmit,expand:"block"},{default:(0,n.w5)((()=>[h])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,n.Wm)(I,{"responsive-sm":""},{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(v,{color:"light",expand:"block",onClick:o[4]||(o[4]=o=>e.$router.push({path:"/sign-up"}))},{default:(0,n.w5)((()=>[f])),_:1})])),_:1})])),_:1}),(0,n.Wm)(I,{"responsive-sm":""},{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(v,{onClick:_.openModal,color:"light",expand:"block"},{default:(0,n.w5)((()=>[c])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1})}var w=l(9095);const _=(0,n.Uk)("Напоминание пароля"),k={novalidate:""},W=(0,n.Uk)("Номер телефона"),y=(0,n.Uk)("Имя пользователя"),g=(0,n.Uk)("Выслать пароль");function b(e,o,l,s,t,a){const i=(0,n.up)("ion-title"),d=(0,n.up)("ion-icon"),r=(0,n.up)("ion-toolbar"),u=(0,n.up)("ion-header"),p=(0,n.up)("ion-label"),h=(0,n.up)("ion-input"),f=(0,n.up)("ion-item"),c=(0,n.up)("ion-list"),m=(0,n.up)("ion-button"),w=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Wm)(r,null,{default:(0,n.w5)((()=>[(0,n.Wm)(i,null,{default:(0,n.w5)((()=>[_])),_:1}),(0,n.Wm)(d,{icon:s.closeCircle,onClick:o[0]||(o[0]=e=>{a.closeModal()}),slot:"end",size:"large",color:"medium"},null,8,["icon"])])),_:1})])),_:1}),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[(0,n._)("form",k,[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[W])),_:1}),(0,n.Wm)(h,{modelValue:t.userphone,"onUpdate:modelValue":o[1]||(o[1]=e=>t.userphone=e),placeholder:"Ваш телефон"},null,8,["modelValue"])])),_:1}),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{position:"stacked",color:"primary"},{default:(0,n.w5)((()=>[y])),_:1}),(0,n.Wm)(h,{modelValue:t.username,"onUpdate:modelValue":o[2]||(o[2]=e=>t.username=e),placeholder:"Введите имя пользователя..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,n.Wm)(m,{onClick:o[3]||(o[3]=e=>a.passwordReset()),expand:"full"},{default:(0,n.w5)((()=>[g])),_:1})])])),_:1})],64)}var I=l(8903),V=l(9755),v=l.n(V),B={components:{IonContent:w.W2,IonHeader:w.Gu,IonTitle:w.wd,IonToolbar:w.sr,IonList:w.q_,IonItem:w.Ie,IonInput:w.pK,IonButton:w.YG,IonIcon:w.gu,IonLabel:w.Q$},props:["phone"],setup(){return{closeCircle:I.XZx}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return w.Fy.dismiss()},async passwordReset(){let e={user_phone:"+"+this.phone.replace(/\D/g,""),user_name:this.username};try{await v().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$flash(`Ваш новый пароль выслан на номер '${this.userphone}'`)}catch(o){const e=o.responseJSON.messages.error;"user_not_found"==e?this.$flash(`Пользователь с телефоном '${this.userphone}' и именем '${this.username}' ненайден`):this.$flash("Не удалось восстановить пароль")}this.closeModal()}}},U=l(3744);const $=(0,U.Z)(B,[["render",b]]);var C=$,x=l(351),D=l(1933),M=l(2008),P={components:{IonLabel:w.Q$,IonSelectOption:w.n0,IonSelect:w.t9,IonCol:w.wI,IonInput:w.pK,IonRow:w.Nd,IonText:w.yW,IonButton:w.YG,IonGrid:w.jY},data(){return{error:"",submitted:!1,config:{phoneMask:"(000)-000-00-00"},fields:{phonePrefix:"+7",phone:"",phoneBody:"",password:""},modalOpen:!1}},computed:{phoneValid(){return 10==this.fields.phoneBody.replace(/\D/g,"").length},passwordValid(){return this.fields.password.length>=6}},methods:{async onSubmit(){if(this.submitted=!0,!this.phoneValid||!this.passwordValid)return!1;let e={user_phone:this.fields.phonePrefix+this.fields.phoneBody.replace(/\D/g,""),user_pass:this.fields.password,user_pass_confirm:this.fields.password};try{await x.Z.signIn(e),await x.Z.get(),D.Z.go(-1)}catch(o){const e=o.responseJSON,l=e.messages.error;switch(l){case"user_not_found":this.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":this.$flash("Неверный пароль");break;case"user_is_disabled":this.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":this.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":this.$flash("Номер телефона не подтвержден"),this.phoneVerify();break;default:this.$flash("Не удалось войти в систему")}}},phoneVerify(){var e=this;v().post(M.Z.state.hostname+"User/phoneVerificationSend",{user_phone:"7"+this.fields.phoneBody.replace(/\D/g,"")}).done((function(){D.Z.push({name:"UserVerifyPhone",params:{phone:e.fields.phonePrefix+e.fields.phoneBody.replace(/\D/g,""),password:e.fields.password}})})).fail((function(o){e.error=o.responseJSON.messages.error}))},phoneValidate(e){this.fields.phoneBody=e.target.value,this.fields.phoneBody=this.fields.phoneBody.replace(/\D/g,""),this.fields.phoneBody.length>10&&(this.fields.phoneBody=this.fields.phoneBody.substring(0,10));let o="",l=0;for(let n in this.config.phoneMask){if(!this.fields.phoneBody[l])break;let e=this.config.phoneMask[n];"0"==e?(o+=this.fields.phoneBody[l],l++):o+=e}return this.fields.phoneBody=o,this.fields.phoneBody},async openModal(){this.modalOpen=!0;var e=this;const o=await w.Fy.create({component:C,componentProps:{phone:e.fields.phonePrefix+e.fields.phoneBody.replace(/\D/g,"")},initialBreakpoint:.3,breakpoints:[.3,.6]});return o.present()}}};const S=(0,U.Z)(P,[["render",m],["__scopeId","data-v-689056f4"]]);var Z=S}}]);
//# sourceMappingURL=739.b7dc2504.js.map