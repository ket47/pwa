"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[7462],{1608:function(t,e,o){o.d(e,{Z:function(){return g}});var s=o(6252),i=o(3577);const n={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},a={slot:"end",style:{color:"#666"}};function l(t,e,o,l,r,c){const d=(0,s.up)("ymap-marker"),u=(0,s.up)("yandex-map"),p=(0,s.up)("ion-searchbar"),m=(0,s.up)("ion-item"),h=(0,s.up)("ion-content"),g=(0,s.up)("ion-textarea"),_=(0,s.up)("ion-icon"),f=(0,s.up)("ion-button"),w=(0,s.up)("ion-toolbar");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(u,{onClick:e[0]||(e[0]=t=>c.onClick(t)),style:{height:"100%"},coords:r.coords,zoom:16,settings:r.settings,controls:["zoomControl"]},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{coords:r.coords,"marker-id":"1",properties:r.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,s._)("div",n,[(0,s.Wm)(p,{debounce:"500",modelValue:r.addressSearchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>r.addressSearchQuery=t),onIonInput:e[2]||(e[2]=t=>c.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.suggestions,((t,e)=>((0,s.wg)(),(0,s.j4)(m,{key:e,onClick:e=>c.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(t.subtitle.text)+" "+(0,i.zw)(t.title.text)+" ",1),(0,s._)("span",a,(0,i.zw)(t.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Wm)(g,{label:"комментарий к адресу","label-placement":"floating",modelValue:r.addressComment,"onUpdate:modelValue":e[3]||(e[3]=t=>r.addressComment=t)},null,8,["modelValue"]),(0,s.Wm)(f,{strong:!0,onClick:e[4]||(e[4]=t=>c.pickAddress()),color:"primary",expand:"block"},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{src:l.checkmark,slot:"start"},null,8,["src"]),(0,s.Uk)(" Ок ")])),_:1}),(0,s.Wm)(f,{onClick:e[5]||(e[5]=t=>l.closeModal()),color:"light",expand:"block"},{default:(0,s.w5)((()=>[(0,s.Uk)("Закрыть")])),_:1})])),_:1})],64)}o(3948),o(7658);var r=o(4929),c=o(5836),d=o(8903),u=o(351),p={components:{IonContent:r.W2,IonToolbar:r.sr,IonButton:r.YG,IonSearchbar:r.VI,IonIcon:r.gu,IonItem:r.Ie,IonTextarea:r.g2,yandexMap:c.xR,ymapMarker:c.Jk},setup(){const t=function(){r.Fy.dismiss()};return{closeModal:t,locationOutline:d.Iv7,closeOutline:d.fID,checkmark:d.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",e=this.$heap.state.settings.location,o=JSON.parse(e.mapCenter);return{settings:{apiKey:e.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},suggestions:[],addressSearchQuery:null,locationType:t,locSettings:e,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o,addressComment:""}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t;const e=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=e.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(o){}var e={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};r.Fy.dismiss(e)},filterAddress(t){const e=this.locSettings.addressErase.split(", "),o=t.split(", ");let s=[];for(const i of o)e.find((t=>t==i))||s.push(i);return s.reverse().join(", ")},onClick(t){t&&t.get&&(this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,e=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${e}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),s=await o.json();this.suggestions=s.results||[]}catch(t){}else this.suggestions=[]},async suggestionSelect(t,e){this.selectedAddress=t,this.geocode(e)},async geocode(t){try{this.suggestions=[];const e=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${e}&format=json&results=1&uri=${t}`),s=await o.json(),i=s.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=i.Point.pos.split(" ").reverse()}catch(e){console.log(e)}}},async mounted(){await(0,c.xk)();window.ymaps;const t=u.Z.geo.lastStoredGet();if(null!==t&&void 0!==t&&t.location_latitude)this.coords=[t.location_latitude,t.location_longitude];else{const{coords:t}=await u.Z.geo.get();this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}}},m=o(3744);const h=(0,m.Z)(p,[["render",l]]);var g=h},7462:function(t,e,o){o.r(e),o.d(e,{default:function(){return $}});var s=o(6252),i=o(3577);const n=t=>((0,s.dD)("data-v-73e28e99"),t=t(),(0,s.Cn)(),t),a={style:{color:"var(--ion-color-primary)"}},l=n((()=>(0,s._)("p",null,"Вы сможете заказать из ресторанов и магазинов в пределах радиуса доставки.",-1))),r=n((()=>(0,s._)("p",null,"Вы пока не добавили адрес доставки заказа.",-1))),c=n((()=>(0,s._)("p",null,"Для поиска ресторанов и магазинов будет использоваться адрес по умолчанию.",-1))),d={style:{color:"var(--ion-color-medium)"}};function u(t,e,o,n,u,p){const m=(0,s.up)("ion-card-subtitle"),h=(0,s.up)("ion-card-header"),g=(0,s.up)("ion-card-content"),_=(0,s.up)("ion-card"),f=(0,s.up)("ion-img"),w=(0,s.up)("ion-label"),y=(0,s.up)("ion-icon"),k=(0,s.up)("ion-item"),C=(0,s.up)("ion-list"),v=(0,s.up)("ion-list-header"),$=(0,s.up)("base-layout");return(0,s.wg)(),(0,s.j4)($,{"page-title":"Мои адреса",ref:"UserAddressPage"},{default:(0,s.w5)((()=>[p.mainAddress?((0,s.wg)(),(0,s.j4)(_,{key:0},{default:(0,s.w5)((()=>[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Uk)(" Адрес доставки заказа ")])),_:1})])),_:1}),(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[(0,s._)("p",null,[(0,s.Uk)("Вы выбрали "),(0,s._)("b",a,(0,i.zw)(p.mainAddress.location_address),1),(0,s.Uk)(", как адрес доставки заказов.")]),l])),_:1})])),_:1})):((0,s.wg)(),(0,s.j4)(_,{key:1},{default:(0,s.w5)((()=>[(0,s.Wm)(h,null,{default:(0,s.w5)((()=>[(0,s.Wm)(m,null,{default:(0,s.w5)((()=>[(0,s.Uk)(" Адрес не установлен ")])),_:1})])),_:1}),(0,s.Wm)(g,null,{default:(0,s.w5)((()=>[r,c])),_:1})])),_:1})),u.locationList.length?((0,s.wg)(),(0,s.j4)(C,{key:2,lines:"full"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(u.locationList,((e,o)=>((0,s.wg)(),(0,s.j4)(k,{key:e.location_id},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,s._)("div",null,[(0,s.Wm)(w,{onClick:t=>p.locationSetMain(`${e.location_id}`,`${o}`),style:{"white-space":"normal",cursor:"pointer"},class:(0,i.C_)(1==e.is_main?"is_main":"")},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(e.location_address),1)])),_:2},1032,["onClick","class"]),(0,s._)("div",d,(0,i.zw)(e.location_comment),1)]),(0,s.Wm)(y,{slot:"end",icon:n.trashOutline,onClick:t=>p.locationDelete(`${e.location_id}`,`${o}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,s.kq)("",!0),(0,s.Wm)(C,null,{default:(0,s.w5)((()=>[(0,s.Wm)(v,null,{default:(0,s.w5)((()=>[(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Uk)("Добавить адрес")])),_:1})])),_:1}),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(u.locationGroupList,(e=>((0,s.wg)(),(0,s.j4)(k,{key:e.group_id,onClick:t=>p.modalLocationCreate(`${e.group_id}`,`${e.group_name}`),style:{cursor:"pointer"}},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,s.Wm)(w,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(e.group_name),1)])),_:2},1024),(0,s.Wm)(y,{src:n.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)}o(3948);var p=o(4929),m=o(6668),h=o(2008),g=o(351),_=o(9755),f=o.n(_),w=o(1608),y=o(8903),k={name:"UserAddresses",components:{IonImg:p.Xz,IonLabel:p.Q$,IonItem:p.Ie,IonList:p.q_,IonListHeader:p.yh,IonIcon:p.gu,IonCard:p.PM,IonCardHeader:p.Zi,IonCardContent:p.FN,IonCardSubtitle:p.tO},setup(){return{locationOutline:y.Iv7,trashOutline:y.gtu,addOutline:y.s6O}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{async modalLocationCreate(t,e){if(!h.Z.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/user/sign-in"));var o=String(e).toLowerCase();const s=await p.Fy.create({component:w.Z,showBackdrop:!0,componentProps:{location_group_name_low:o}});return s.onDidDismiss().then((e=>{this.locationCreate(t,e.data)})),s.present()},async locationListGet(){try{var t,e;let o=null;const s=await f().get(h.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=s.location_list,this.locationGroupList=s.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(o=t);if(!o)return void g.Z.get();o&&(null===(t=o)||void 0===t?void 0:t.location_id)!=(null===(e=h.Z.state.user.location_main)||void 0===e?void 0:e.location_id)&&(h.Z.state.user.location_main=o,this.$topic.publish("userMainLocationSet",h.Z.state.user.location_main))}catch(o){}},async locationCreate(t,e){if(!e)return;let o={location_holder:"user",location_holder_id:h.Z.state.user.user_id,location_group_id:t,location_address:e.location_address,location_latitude:e.location_latitude,location_longitude:e.location_longitude,location_comment:e.location_comment};try{await f().post(h.Z.state.hostname+"User/locationCreate",o),this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(s){const t=s.responseJSON,e=t.messages.error;switch(e){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,e){var o=this,s=o.locationList[e];h.Z.state.user.location_main={location_id:s.location_id,location_latitude:s.location_latitude,location_longitude:s.location_longitude,location_address:s.location_address,image_hash:s.image_hash},m.Z.go(-1),await f().post(h.Z.state.hostname+"User/locationSetMain",{location_id:t}),this.$topic.publish("userMainLocationSet",h.Z.state.user.location_main)},async locationDelete(t,e){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(e,1),await f().post(h.Z.state.hostname+"User/locationDelete",{location_id:t})}catch(o){}this.locationListGet()}},async locationCurrentSet(){const t=await p.G0.create({message:"Определяем ваше местоположение"});t.present();try{await g.Z.geo.locationCurrentGet(),this.$flash("Ваше местоположение определено")}catch(e){this.$flash("Не удалось получить ваше местоположение")}t.dismiss(),m.Z.go(-1)}},data(){return{locationList:[],locationGroupList:[]}}},C=o(3744);const v=(0,C.Z)(k,[["render",u],["__scopeId","data-v-73e28e99"]]);var $=v}}]);
//# sourceMappingURL=7462-legacy.282fe3d5.js.map