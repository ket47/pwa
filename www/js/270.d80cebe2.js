"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[270],{9362:function(t,o,e){e.d(o,{Z:function(){return m}});var i=e(6252),s=e(3577);const n=(0,i.Uk)("Выбор нового адреса");function a(t,o,e,a,l,r){const c=(0,i.up)("ion-icon"),d=(0,i.up)("ion-title"),u=(0,i.up)("ion-item"),p=(0,i.up)("ion-toolbar"),m=(0,i.up)("ion-button"),_=(0,i.up)("ion-header"),h=(0,i.up)("ion-searchbar"),g=(0,i.up)("ymap-marker"),w=(0,i.up)("yandex-map"),f=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{icon:a.locationOutline,slot:"start"},null,8,["icon"]),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[n])),_:1}),(0,i.Wm)(c,{icon:a.closeOutline,onClick:o[0]||(o[0]=t=>{a.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(m,{onClick:o[1]||(o[1]=t=>r.pickAddress()),disabled:!l.coords,color:"primary",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Добавить "+(0,s.zw)(e.location_group_name_low)+" адрес ",1)])),_:1},8,["disabled"])])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{id:"suggest",placeholder:"название улицы, номер дома"}),(0,i.Wm)(w,{coords:l.coords,zoom:16,onClick:o[2]||(o[2]=t=>r.onClick(t)),style:{height:"100%"},settings:l.settings},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{coords:l.coords,"marker-id":"1",properties:l.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"])])),_:1})],64)}e(3948);var l=e(4852),r=e(5836),c=e(8903),d={components:{IonContent:l.W2,IonToolbar:l.sr,IonButton:l.YG,IonSearchbar:l.VI,IonHeader:l.Gu,IonIcon:l.gu,IonTitle:l.wd,IonItem:l.Ie,yandexMap:r.xR,ymapMarker:r.Jk},setup(){const t=function(){l.Fy.dismiss()};return{closeModal:t,locationOutline:c.Iv7,closeOutline:c.fID}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",o=this.$heap.state.settings.location,e=JSON.parse(o.mapCenter);return{settings:{apiKey:o.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},locationType:t,locSettings:o,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:e}},methods:{async pickAddress(){try{var t;const o=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=o.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}catch(e){console.log(e)}var o={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1]};l.Fy.dismiss(o)},filterAddress(t){const o=this.locSettings.addressErase.split(", "),e=t.split(", ");let i=[];for(const s of e)o.find((t=>t==s))||i.push(s);return i.reverse().join(", ")},onClick(t){this.coords=t.get("coords")}},async mounted(){await(0,r.xk)();let t=window.ymaps;const o=JSON.parse("["+this.locSettings.mapBoundaries[0]+"]"),e=new t.SuggestView("suggest",{boundedBy:o});e.events.add("select",(o=>{this.selectedAddress=o.get("item").displayName,t.geocode(this.selectedAddress).then((t=>{this.coords=t.geoObjects.get(0).geometry.getCoordinates()}))})),this.$flash("Получаем местоположение устройства"),t.geolocation.get().then((t=>{this.coords=t.geoObjects.position,this.$flash("На карте отмечено ваше местоположение")}))}},u=e(3744);const p=(0,u.Z)(d,[["render",a]]);var m=p},2270:function(t,o,e){e.r(o),e.d(o,{default:function(){return Z}});var i=e(6252),s=e(3577);const n=t=>((0,i.dD)("data-v-2a215d2b"),t=t(),(0,i.Cn)(),t),a=(0,i.Uk)(" Адрес доставки заказа "),l=(0,i.Uk)("Вы выбрали "),r={style:{color:"var(--ion-color-primary)"}},c=(0,i.Uk)(", как адрес доставки заказов."),d=n((()=>(0,i._)("p",null,"Вы сможете заказать из ресторанов и магазинов в пределах радиуса доставки.",-1))),u=(0,i.Uk)(" Адрес не установлен "),p=n((()=>(0,i._)("p",null,"Вы пока не добавили адрес доставки заказа.",-1))),m=n((()=>(0,i._)("p",null,"Для поиска ресторанов и магазинов будет использоваться адрес по умолчанию.",-1))),_=(0,i.Uk)("Адрес доставки заказа не добавлен"),h=(0,i.Uk)("Добавить адрес");function g(t,o,e,n,g,w){const f=(0,i.up)("ion-card-subtitle"),k=(0,i.up)("ion-card-header"),y=(0,i.up)("ion-card-content"),C=(0,i.up)("ion-card"),v=(0,i.up)("ion-img"),I=(0,i.up)("ion-label"),W=(0,i.up)("ion-icon"),L=(0,i.up)("ion-item"),$=(0,i.up)("ion-list"),b=(0,i.up)("ion-list-header"),Z=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(Z,{"page-title":"Мои адреса",pageDefaultBackLink:"/user",ref:"UserAddressPage"},{default:(0,i.w5)((()=>[w.mainAddress?((0,i.wg)(),(0,i.j4)(C,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[a])),_:1})])),_:1}),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i._)("p",null,[l,(0,i._)("b",r,(0,s.zw)(w.mainAddress.location_address),1),c]),d])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(C,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[u])),_:1})])),_:1}),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[p,m])),_:1})])),_:1})),g.locationList.length?((0,i.wg)(),(0,i.j4)($,{key:2,lines:"full"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.locationList,((o,e)=>((0,i.wg)(),(0,i.j4)(L,{key:o.location_id},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.Wm)(I,{onClick:t=>w.locationSetMain(`${o.location_id}`,`${e}`),style:{"white-space":"normal",cursor:"pointer"},class:(0,s.C_)(1==o.is_main?"is_main":"")},{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(o.location_address),1)])),_:2},1032,["onClick","class"]),(0,i.Wm)(W,{slot:"end",icon:n.trashOutline,onClick:t=>w.locationDelete(`${o.location_id}`,`${e}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):((0,i.wg)(),(0,i.j4)($,{key:3,lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{color:"dark"},{default:(0,i.w5)((()=>[_])),_:1})])),_:1})])),_:1})),(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[h])),_:1})])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.locationGroupList,(o=>((0,i.wg)(),(0,i.j4)(L,{key:o.group_id,onClick:t=>w.modalLocationCreate(`${o.group_id}`,`${o.group_name}`),style:{cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,s.zw)(o.group_name),1)])),_:2},1024),(0,i.Wm)(W,{src:n.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)}e(3948);var w=e(4852),f=e(1008),k=e(2008),y=e(351),C=e(9755),v=e.n(C),I=e(9362),W=e(8903),L={name:"UserAddresses",components:{IonImg:w.Xz,IonLabel:w.Q$,IonItem:w.Ie,IonList:w.q_,IonListHeader:w.yh,IonIcon:w.gu,IonCard:w.PM,IonCardHeader:w.Zi,IonCardContent:w.FN,IonCardSubtitle:w.tO},setup(){return{locationOutline:W.Iv7,trashOutline:W.gtu,addOutline:W.s6O}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{async modalLocationCreate(t,o){if(!k.Z.state.user.user_id)return this.$flash("Чтобы добавленные адреса сохранились, пожалуйста войдите в систему"),void f.Z.push("/user/sign-in");var e=String(o).toLowerCase();const i=await w.Fy.create({component:I.Z,showBackdrop:!0,backdropDismiss:!0,canDismiss:!0,cssClass:"update-profile-modal",presentingElement:this.$refs.UserAddressPage.$el,componentProps:{location_group_name_low:e}});return i.onDidDismiss().then((o=>{this.locationCreate(t,o.data)})),i.present()},async locationListGet(){try{var t,o;let e=null;const i=await v().get(k.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=i.location_list,this.locationGroupList=i.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(e=t);if(!e)return void y.Z.get();e&&(null===(t=e)||void 0===t?void 0:t.location_id)!=(null===(o=k.Z.state.user.location_main)||void 0===o?void 0:o.location_id)&&(k.Z.state.user.location_main=e,this.$topic.publish("userMainLocationSet",k.Z.state.user.location_main))}catch{}},async locationCreate(t,o){if(!o)return;let e={location_holder:"user",location_holder_id:k.Z.state.user.user_id,location_group_id:t,location_address:o.location_address,location_latitude:o.location_latitude,location_longitude:o.location_longitude};try{await v().post(k.Z.state.hostname+"User/locationCreate",e),this.$heap.state.next_route&&(this.$router.push(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(i){const t=i.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,o){var e=this,i=e.locationList[o];k.Z.state.user.location_main={location_id:i.location_id,location_latitude:i.location_latitude,location_altitude:i.location_altitude,location_address:i.location_address,image_hash:i.image_hash},f.Z.go(-1),await v().post(k.Z.state.hostname+"User/locationSetMain",{location_id:t}),this.$topic.publish("userMainLocationSet",k.Z.state.user.location_main)},async locationDelete(t,o){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(o,1),await v().post(k.Z.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()}},async locationCurrentSet(){const t=await w.G0.create({message:"Определяем ваше местоположение"});t.present();try{await y.Z.geo.locationCurrentGet(),this.$flash("Ваше местоположение определено")}catch(o){console.log(o),this.$flash("Не удалось получить ваше местоположение")}t.dismiss(),f.Z.go(-1)}},data(){return{locationList:[],locationGroupList:[]}}},$=e(3744);const b=(0,$.Z)(L,[["render",g],["__scopeId","data-v-2a215d2b"]]);var Z=b}}]);
//# sourceMappingURL=270.d80cebe2.js.map