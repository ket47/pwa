"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[428],{8428:function(e,t,i){i.r(t),i.d(t,{default:function(){return _}});var o=i(6252),a=i(3577);function s(e,t,i,s,n,r){const l=(0,o.up)("ion-segment-button"),d=(0,o.up)("ion-segment"),m=(0,o.up)("ion-searchbar"),u=(0,o.up)("ion-img"),c=(0,o.up)("ion-thumbnail"),p=(0,o.up)("ion-text"),_=(0,o.up)("ion-label"),h=(0,o.up)("ion-item"),g=(0,o.up)("ion-list"),f=(0,o.up)("ion-skeleton-text"),y=(0,o.up)("ion-card-content"),b=(0,o.up)("ion-card"),w=(0,o.up)("ion-infinite-scroll-content"),k=(0,o.up)("ion-infinite-scroll"),I=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(I,{pageDefaultBackLink:"/user","page-title":"Модерация"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{scrollable:!0,modelValue:n.moderationType,"onUpdate:modelValue":t[0]||(t[0]=e=>n.moderationType=e),onIonChange:t[1]||(t[1]=e=>r.listTypeChanged(e))},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{value:"images"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Картинки ")])),_:1}),(0,o.Wm)(l,{value:"products"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Товары ")])),_:1}),(0,o.Wm)(l,{value:"stores"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Магазины ")])),_:1}),(0,o.Wm)(l,{value:"couriers"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Курьеры ")])),_:1})])),_:1},8,["modelValue"]),(0,o._)("div",null,["stores"==n.moderationType||"products"==n.moderationType||"couriers"==n.moderationType?((0,o.wg)(),(0,o.j4)(m,{key:0,placeholder:"Фильтр",modelValue:n.filter,"onUpdate:modelValue":t[2]||(t[2]=e=>n.filter=e)},null,8,["modelValue"])):(0,o.kq)("",!0),r.listComputed.length>0?((0,o.wg)(),(0,o.j4)(g,{key:1},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.listComputed,(t=>((0,o.wg)(),(0,o.j4)(h,{key:t.item_id,button:"",detail:"",onClick:e=>r.itemEdit(t)},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{slot:"start",class:(0,a.C_)(t.class)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.50.50.webp`},null,8,["src"])])),_:2},1032,["class"]),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.item_name),1)])),_:2},1024),(0,o.Wm)(_,{slot:"end"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(t.date_time),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):1==n.is_loading?((0,o.wg)(),(0,o.j4)(g,{key:2},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2,3],(e=>(0,o.Wm)(h,{key:e,button:"",detail:""},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{slot:"start",style:{"background-color":"lightgray"}}),(0,o.Wm)(f,{animated:""})])),_:2},1024))),64))])),_:1})):((0,o.wg)(),(0,o.j4)(b,{key:3,color:"light"},{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Ничего не найдено ")])),_:1})])),_:1})),(0,o.Wm)(k,{onIonInfinite:t[3]||(t[3]=e=>r.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{"loading-spinner":"bubbles","loading-text":"Loading more data..."})])),_:1})])])),_:1})}var n=i(8534),r=(i(3948),i(5069),i(6964)),l=i(9755),d=i.n(l),m=i(7327),u={components:{IonInfiniteScroll:r.ju,IonInfiniteScrollContent:r.MB,IonItem:r.Ie,IonLabel:r.Q$,IonList:r.q_,IonSegmentButton:r.GO,IonSegment:r.cJ,IonImg:r.Xz,IonThumbnail:r.Bs,IonText:r.yW,IonSkeletonText:r.CK,IonCard:r.PM,IonCardContent:r.FN,IonSearchbar:r.VI},data(){return{items:[],filter:"",is_loading:0,moderationType:"images",holders:{store:"Поставщик",courier:"Курьер",product:"Товар",order:"Заказ",product_group_list:"Категория товара",location_group_list:"Категория местоп.",store_group_list:"Категория поставщ.",user_group_list:"Категория пользователя"}}},computed:{listComputed(){for(let t of this.items){var e;t.image_hash=t.image_hash||t.courier_photo_image_hash,t.item_id=t.image_id||t.store_id||t.courier_id||t.product_id,t.item_name=this.holders[t.image_holder]||(null!==(e=t.store_name)&&void 0!==e?e:t.store_name_new)||t.user_name||t.product_name,t.date_time=this.toLocDateTime(t.updated_at),t.class=t.deleted_at?"deleted":""}return this.items}},methods:{listLoadMore(e){var t=this;return(0,n.Z)((function*(){yield t.listLoad(),e.target.complete()}))()},listReload(){var e=this;return(0,n.Z)((function*(){e.items=[],e.listLoad()}))()},listLoad(){var e=this;return(0,n.Z)((function*(){let t={is_disabled:1,is_active:0,name_query:e.filter,offset:e.items.length,limit:15,order:"updated_at"};try{let i;if(e.is_loading=1,"images"==e.moderationType)i=yield d().post(`${e.$heap.state.hostname}Image/listGet`,t);else if("products"==e.moderationType){t.name_query_fields="product_name,product_description,product_barcode,product_code",t.reverse="validity";const o=yield d().post(`${e.$heap.state.hostname}Product/listGet`,t);i=o.product_list}else"stores"==e.moderationType?(t.name_query_fields="store_name,store_description",t.reverse="validity",i=yield d().post(`${e.$heap.state.hostname}Store/listGet`,t)):"couriers"==e.moderationType&&(t.name_query_fields="courier_vehicle,user_phone,user_name",t.order="courier_list.updated_at",i=yield d().post(`${e.$heap.state.hostname}Courier/listGet`,t));e.is_loading=0,e.items=e.items.concat(i)}catch(i){}}))()},listTypeChanged(e){e.target.value;this.items=[],this.listLoad()},listFilter(){clearTimeout(this.clock);const e=this;this.clock=setTimeout((()=>{e.listReload()}),300)},toLocDate(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,i)},toLocDateTime(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,i)},itemEdit(e){"images"==this.moderationType&&this.imageEdit(e),"products"==this.moderationType&&this.$go("/catalog/product-edit-"+e.product_id),"stores"==this.moderationType&&this.$go("/catalog/store-edit-"+e.store_id),"couriers"==this.moderationType&&this.$go("/user/courier-dashboard?courier_id="+e.courier_id)},imageEdit(e){var t=this;return(0,n.Z)((function*(){const i={delete:["Удалить","danger"],postpone:["Потом","primary"],enable:["Ок","success"]},o=yield r.Fy.create({component:m.Z,componentProps:{image_hash:e.image_hash,actions:i},initialBreakpoint:.75,breakpoints:[.75,1]});t.$topic.on("dismissModal",(()=>{o.dismiss()})),o.present();const a=yield o.onDidDismiss();"delete"==a.role&&(yield t.imageDelete(e)),"enable"==a.role&&(yield t.imageEnable(e)),"postpone"==a.role&&(yield t.imagePostpone(e)),t.listReload()}))()},imageEnable(e){var t=this;return(0,n.Z)((function*(){yield d().post(`${t.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0})}))()},imagePostpone(e){var t=this;return(0,n.Z)((function*(){yield d().post(`${t.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0}),yield d().post(`${t.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:1})}))()},imageDelete(e){var t=this;return(0,n.Z)((function*(){yield d().post(`${t.$heap.state.hostname}Image/itemDelete`,{image_id:e.image_id})}))()}},mounted(){this.listLoad()},watch:{filter:function(){this.listFilter()}}},c=i(3744);const p=(0,c.Z)(u,[["render",s],["__scopeId","data-v-b3535316"]]);var _=p}}]);
//# sourceMappingURL=428-legacy.8fbf22f7.js.map