"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[89],{7327:function(e,t,o){o.d(t,{Z:function(){return m}});var i=o(6252),l=o(3577);const r=(0,i.Uk)("Просмотр фотографии");function a(e,t,o,a,d,u){const n=(0,i.up)("ion-title"),s=(0,i.up)("ion-icon"),c=(0,i.up)("ion-toolbar"),m=(0,i.up)("ion-header"),p=(0,i.up)("ion-button"),_=(0,i.up)("ion-col"),h=(0,i.up)("ion-row"),g=(0,i.up)("ion-grid"),w=(0,i.up)("ion-img"),k=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[r])),_:1}),(0,i.Wm)(s,{icon:a.closeOutline,onClick:t[0]||(t[0]=e=>{a.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[o.actions?((0,i.wg)(),(0,i.j4)(g,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.actions,((e,t)=>((0,i.wg)(),(0,i.j4)(_,{key:t},{default:(0,i.w5)((()=>{var o;return[e[0]?((0,i.wg)(),(0,i.j4)(p,{key:0,onClick:o=>u.actionCreate(t,e[1]),expand:"block",color:null!==(o=e[1])&&void 0!==o?o:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e[0]),1)])),_:2},1032,["onClick","color"])):(0,i.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(w,{src:e.$heap.state.hostname+"image/get.php/"+o.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var d=o(8903),u=o(3741),n={props:["image_hash","actions"],components:{IonIcon:u.gu,IonToolbar:u.sr,IonHeader:u.Gu,IonImg:u.Xz,IonContent:u.W2,IonTitle:u.wd,IonButton:u.YG,IonCol:u.wI,IonRow:u.Nd,IonGrid:u.jY},setup(){const e=function(){u.Fy.dismiss()};return{closeModal:e,closeOutline:d.fID}},methods:{actionCreate(e,t){("danger"!=t||confirm("Вы уверены?"))&&u.Fy.dismiss(null,e)}}},s=o(3744);const c=(0,s.Z)(n,[["render",a]]);var m=c},2226:function(e,t,o){o.d(t,{Z:function(){return W}});var i=o(6252),l=o(3577);const r=(0,i.Uk)("Фотографии"),a={key:0,class:"image_grid"},d=["onClick"],u={key:0},n={key:1},s={key:0,class:"image_controls"},c=["id"];function m(e,t,o,m,p,_){var h;const g=(0,i.up)("ion-label"),w=(0,i.up)("ion-icon"),k=(0,i.up)("ion-item"),I=(0,i.up)("ion-img"),f=(0,i.up)("ion-avatar");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(k,{lines:"none",onClick:t[0]||(t[0]=e=>{p.editMode=!p.editMode,p.editMode&&_.load()})},{default:(0,i.w5)((()=>[o.title?((0,i.wg)(),(0,i.j4)(g,{key:0,color:"imageList?.length?'':medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(o.title),1)])),_:1})):((0,i.wg)(),(0,i.j4)(g,{key:1,color:"imageList?.length?'':medium"},{default:(0,i.w5)((()=>[r])),_:1})),p.editMode?((0,i.wg)(),(0,i.j4)(w,{key:2,slot:"end",icon:m.settingsSharp,color:"primary"},null,8,["icon"])):((0,i.wg)(),(0,i.j4)(w,{key:3,slot:"end",icon:m.settingsOutline},null,8,["icon"]))])),_:1}),null!==(h=_.imageList)&&void 0!==h&&h.length?((0,i.wg)(),(0,i.iD)("div",a,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.imageList,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.image_id,style:{position:"relative"}},[(0,i._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:e=>_.imagePreview(t.image_hash)},[t.deleted_at?((0,i.wg)(),(0,i.iD)("div",u,"будет удалено")):1==t.is_disabled?((0,i.wg)(),(0,i.iD)("div",n,"на модерации")):(0,i.kq)("",!0)],8,d),(0,i.Wm)(f,{onClick:e=>_.imagePreview(t.image_hash),class:(0,l.C_)(t.class)},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),p.editMode?((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(w,{icon:m.chevronBackCircleOutline,onClick:e=>_.back(t)},null,8,["icon","onClick"]),_.isAdmin&&1==t.is_disabled?((0,i.wg)(),(0,i.j4)(w,{key:0,icon:m.checkmarkCircle,color:"success",onClick:e=>_.enable(t)},null,8,["icon","onClick"])):(0,i.kq)("",!0),t.deleted_at?((0,i.wg)(),(0,i.j4)(w,{key:1,icon:m.addCircle,color:"success",onClick:e=>_.restore(t)},null,8,["icon","onClick"])):((0,i.wg)(),(0,i.j4)(w,{key:2,icon:m.trash,color:"danger",onClick:e=>_.remove(t)},null,8,["icon","onClick"])),(0,i.Wm)(w,{icon:m.chevronForwardCircleOutline,onClick:e=>_.forward(t)},null,8,["icon","onClick"])])):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0),(0,i._)("input",{type:"file",id:p.fileUploaderId,accept:".png, .jpg, .jpeg, .webp, .gif",onChange:t[1]||(t[1]=e=>_.uploadImage(e)),style:{display:"none"}},null,40,c)])}var p=o(8903),_=o(3741),h=o(7327),g=o(9755),w=o.n(g),k=o(9042),I=o(351),f={props:["images","image_holder","image_holder_id","controller","title"],components:{IonLabel:_.Q$,IonIcon:_.gu,IonItem:_.Ie,IonImg:_.Xz,IonAvatar:_.BJ},setup(){return{settingsOutline:p.C$N,settingsSharp:p.kiF,chevronBackCircleOutline:p.CK0,chevronForwardCircleOutline:p.esm,trash:p._Ij,addCircle:p.ZWo,checkmarkCircle:p.I1A}},data(){var e;return{images_loaded:null,editMode:!1,fileUploaderId:(null!==(e=this.image_holder)&&void 0!==e?e:this.controller)+this.image_holder_id}},computed:{imageList(){let e=this.images_loaded||this.images,t=[];for(let o in e)e[o].deleted_at?(e[o].class=" deleted",this.editMode&&t.push(e[o])):1==e[o].is_disabled?(e[o].class=" disabled",this.editMode&&t.push(e[o])):t.push(e[o]);return t},isAdmin(){return I.Z.isAdmin()}},methods:{async back(e){try{await w().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"}),this.load()}catch{}},async forward(e){try{await w().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"}),this.load()}catch{}},async remove(e){try{await w().post(this.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id}),this.load(),this.$flash("Фото перемещено в корзину и будет удалено")}catch{}},async restore(e){try{await w().post(this.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id}),this.load(),this.$flash("Фото перемещено извлечено из корзины")}catch{}},async enable(e){try{await w().post(this.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0}),this.load()}catch{}},async load(){var e;const t={image_holder_id:this.image_holder_id,image_holder:null!==(e=this.image_holder)&&void 0!==e?e:this.controller,is_disabled:1,is_deleted:1,is_active:1};this.images_loaded=await w().post(this.$heap.state.hostname+"Image/listGet",t)},async imagePreview(e){const t=await _.Fy.create({component:h.Z,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[.5,1]}),o=function(){t.dismiss()};return k.Z.on("dismissModal",o),t.present()},async uploadImage(e){let t=new FormData;t.append("files[]",e.target.files[0]),t.set("image_holder_id",this.image_holder_id),this.image_holder&&t.set("image_holder",this.image_holder);const o={url:this.$heap.state.hostname+this.controller+"/fileUpload",type:"POST",data:t,processData:!1,contentType:!1};try{await w().ajax(o),this.load()}catch(d){var i,l,r,a;if("limit_exeeded"==(null===d||void 0===d||null===(i=d.responseJSON)||void 0===i||null===(l=i.messages)||void 0===l?void 0:l.error))return void this.$flash("Уже загружено максимальное количество фото");if("no_valid_images"==(null===d||void 0===d||null===(r=d.responseJSON)||void 0===r||null===(a=r.messages)||void 0===a?void 0:a.error))return void this.$flash("Формат файла не поддерживается");this.$flash("Не удалось загрузить фото")}},take_photo(){w()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}},y=o(3744);const v=(0,y.Z)(f,[["render",m],["__scopeId","data-v-5ec0cc30"]]);var W=v},3089:function(e,t,o){o.r(t),o.d(t,{default:function(){return re}});var i=o(6252),l=o(3577);const r=e=>((0,i.dD)("data-v-1a3bfcb8"),e=e(),(0,i.Cn)(),e),a={key:0},d=(0,i.Uk)("Обратите внимание на то, что поля "),u=r((()=>(0,i._)("ul",null,[(0,i._)("li",null,"Название (больше 5 букв), "),(0,i._)("li",null,"Цена, "),(0,i._)("li",null,"Актуальный остаток (если ведется учет), "),(0,i._)("li",null,"Изображения товара")],-1))),n=(0,i.Uk)(" обязательные "),s=[d,u,n],c=(0,i.Uk)(" Удалено "),m=(0,i.Uk)(" На модерации "),p=(0,i.Uk)(" Вести учет остатков "),_=(0,i.Uk)(" Показать товар "),h=(0,i.Uk)(" Показать в магазине "),g=(0,i.Uk)(" Управление магазином "),w=(0,i.Uk)("Основные настройки"),k=(0,i.Uk)("Название*"),I=(0,i.Uk)("Описание*"),f=(0,i.Uk)("Артикул"),y=(0,i.Uk)("Штрихкод"),v=(0,i.Uk)("Остаток "),W={key:0},b=(0,i.Uk)("Мин. заказ*"),U={key:0},C=(0,i.Uk)("Единица*"),G=(0,i.Uk)("штука"),V=(0,i.Uk)("порция"),D=(0,i.Uk)("килограмм"),L=(0,i.Uk)("метр"),$=(0,i.Uk)("литр"),O=(0,i.Uk)("Цена"),j=(0,i.Uk)("Цена*"),q=(0,i.Uk)("Цена акционная"),P=(0,i.Uk)("Начало акции"),z=(0,i.Uk)("Конец акции"),M=(0,i.Uk)("Изображения товара*"),Z=(0,i.Uk)(" Добавить "),F=(0,i.Uk)("Категории товара*"),B=(0,i.Uk)("Без категории (в разделе 'Другое')"),x=(0,i.Uk)("Добавить в категорию");function H(e,t,o,r,d,u){var n,H;const S=(0,i.up)("ion-label"),T=(0,i.up)("ion-progress-bar"),Y=(0,i.up)("ion-card-header"),N=(0,i.up)("ion-text"),A=(0,i.up)("ion-card-content"),J=(0,i.up)("ion-card"),K=(0,i.up)("ion-icon"),X=(0,i.up)("ion-toggle"),Q=(0,i.up)("ion-item"),R=(0,i.up)("ion-item-divider"),E=(0,i.up)("ion-list"),ee=(0,i.up)("ion-input"),te=(0,i.up)("ion-textarea"),oe=(0,i.up)("ion-select-option"),ie=(0,i.up)("ion-select"),le=(0,i.up)("ion-item-group"),re=(0,i.up)("image-tile-comp"),ae=(0,i.up)("ion-button"),de=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(de,{"page-title":null!==(n=null===(H=d.productItem)||void 0===H?void 0:H.product_name)&&void 0!==n?n:"Товар",pageDefaultBackLink:"/catalog"},{default:(0,i.w5)((()=>{var o,n;return[(0,i.Wm)(J,{color:(null===(o=d.productItem)||void 0===o?void 0:o.validity)<d.validity_min?"danger":""},{default:(0,i.w5)((()=>{var e;return[(0,i.Wm)(Y,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Wm)(S,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Uk)("Анкета заполнена на "+(0,l.zw)(null===(e=d.productItem)||void 0===e?void 0:e.validity)+"%",1)]})),_:1}),(0,i.Wm)(T,{value:(null===(e=d.productItem)||void 0===e?void 0:e.validity)/100},null,8,["value"])]})),_:1}),(null===(e=d.productItem)||void 0===e?void 0:e.validity)<d.validity_min?((0,i.wg)(),(0,i.j4)(A,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(N,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Uk)(" Вам необходимо заполнить анкету не меньше чем на "+(0,l.zw)(d.validity_min)+"% для рассмотрения модератором ",1),0==(null===(e=d.productItem)||void 0===e?void 0:e.validity)?((0,i.wg)(),(0,i.iD)("p",a,s)):(0,i.kq)("",!0)]})),_:1})])),_:1})):(0,i.kq)("",!0)]})),_:1},8,["color"]),u.message&&(null===(n=d.productItem)||void 0===n?void 0:n.validity)>d.validity_min?((0,i.wg)(),(0,i.j4)(J,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(A,{class:(0,l.C_)(u.messageClass)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(u.message),1)])),_:1},8,["class"])])),_:1})):(0,i.kq)("",!0),d.productItem?((0,i.wg)(),(0,i.j4)(E,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.trashOutline,color:"primary",slot:"start"},null,8,["src"]),c,(0,i.Wm)(X,{slot:"end",modelValue:d.is_deleted,"onUpdate:modelValue":t[0]||(t[0]=e=>d.is_deleted=e),color:"danger",onIonChange:t[1]||(t[1]=e=>u.itemDelete(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.searchOutline,color:"primary",slot:"start"},null,8,["src"]),m,(0,i.Wm)(X,{slot:"end",modelValue:d.is_disabled,"onUpdate:modelValue":t[2]||(t[2]=e=>d.is_disabled=e),onIonChange:t[3]||(t[3]=e=>u.itemDisable(e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.pizzaOutline,color:"primary",slot:"start"},null,8,["src"]),p,(0,i.Wm)(X,{slot:"end",modelValue:d.is_counted,"onUpdate:modelValue":t[4]||(t[4]=e=>d.is_counted=e),onIonChange:t[5]||(t[5]=e=>u.save("is_counted",e.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(R),(0,i.Wm)(Q,{button:"",onClick:t[6]||(t[6]=t=>e.$router.push("product-"+d.productItem.product_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.chevronBack,slot:"start"},null,8,["src"]),_])),_:1}),(0,i.Wm)(Q,{button:"",onClick:t[7]||(t[7]=e=>u.showProductInStore())},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.chevronBack,slot:"start"},null,8,["src"]),h])),_:1}),(0,i.Wm)(Q,{button:"",onClick:t[8]||(t[8]=t=>e.$router.push("/catalog/store-edit-"+d.productItem.store_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.chevronBack,slot:"start"},null,8,["src"]),g])),_:1})])),_:1})):(0,i.kq)("",!0),d.productItem?((0,i.wg)(),(0,i.iD)("form",{key:2,onChange:t[21]||(t[21]=(...e)=>u.saveForm&&u.saveForm(...e))},[(0,i.Wm)(E,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(le,null,{default:(0,i.w5)((()=>[(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[w])),_:1})])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[k])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_name,"onUpdate:modelValue":t[9]||(t[9]=e=>d.productItem.product_name=e),name:"product_name",placeholder:"полное название товара",clearInput:"true"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[I])),_:1}),(0,i.Wm)(te,{modelValue:d.productItem.product_description,"onUpdate:modelValue":t[10]||(t[10]=e=>d.productItem.product_description=e),name:"product_description",rows:"6",placeholder:"характеристики, свойства, состав товара"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[f])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_code,"onUpdate:modelValue":t[11]||(t[11]=e=>d.productItem.product_code=e),name:"product_code",slot:"end",placeholder:"код товара"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[y])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_barcode,"onUpdate:modelValue":t[12]||(t[12]=e=>d.productItem.product_barcode=e),name:"product_barcode",slot:"end",placeholder:"штрихкод"},null,8,["modelValue"])])),_:1}),d.is_counted?((0,i.wg)(),(0,i.j4)(Q,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[v,d.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",W,"("+(0,l.zw)(d.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_quantity,"onUpdate:modelValue":t[13]||(t[13]=e=>d.productItem.product_quantity=e),name:"product_quantity",slot:"end",placeholder:"в наличии"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[b,d.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",U,"("+(0,l.zw)(d.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_quantity_min,"onUpdate:modelValue":t[14]||(t[14]=e=>d.productItem.product_quantity_min=e),name:"product_quantity_min",type:"number",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[C])),_:1}),(0,i.Wm)(ie,{modelValue:d.productItem.product_unit,"onUpdate:modelValue":t[15]||(t[15]=e=>d.productItem.product_unit=e),name:"product_unit",slot:"end",onIonChange:u.saveForm},{default:(0,i.w5)((()=>[(0,i.Wm)(oe,{value:"шт"},{default:(0,i.w5)((()=>[G])),_:1}),(0,i.Wm)(oe,{value:"порция"},{default:(0,i.w5)((()=>[V])),_:1}),(0,i.Wm)(oe,{value:"кг"},{default:(0,i.w5)((()=>[D])),_:1}),(0,i.Wm)(oe,{value:"м"},{default:(0,i.w5)((()=>[L])),_:1}),(0,i.Wm)(oe,{value:"л"},{default:(0,i.w5)((()=>[$])),_:1})])),_:1},8,["modelValue","onIonChange"])])),_:1}),"кг"!=d.productItem.product_unit?((0,i.wg)(),(0,i.j4)(Q,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Вес 1"+(0,l.zw)(d.productItem.product_unit)+" (кг)*",1)])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_weight,"onUpdate:modelValue":t[16]||(t[16]=e=>d.productItem.product_weight=e),name:"product_weight",type:"number",step:"0.1",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(E,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(le,null,{default:(0,i.w5)((()=>[(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[O])),_:1})])),_:1})])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"primary"},{default:(0,i.w5)((()=>[j])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_price,"onUpdate:modelValue":t[17]||(t[17]=e=>d.productItem.product_price=e),name:"product_price",type:"number",inputmode:"numeric",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(N,{color:"success"},{default:(0,i.w5)((()=>[q])),_:1}),(0,i.Wm)(ee,{modelValue:d.productItem.product_promo_price,"onUpdate:modelValue":t[18]||(t[18]=e=>d.productItem.product_promo_price=e),name:"product_promo_price",type:"number",inputmode:"numeric",slot:"end",color:"success"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"success"},{default:(0,i.w5)((()=>[P])),_:1}),(0,i.Wm)(ee,{type:"date",modelValue:d.productItem.product_promo_start,"onUpdate:modelValue":t[19]||(t[19]=e=>d.productItem.product_promo_start=e),name:"product_promo_start",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(Q,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,{color:"success"},{default:(0,i.w5)((()=>[z])),_:1}),(0,i.Wm)(ee,{type:"date",modelValue:d.productItem.product_promo_finish,"onUpdate:modelValue":t[20]||(t[20]=e=>d.productItem.product_promo_finish=e),name:"product_promo_finish",slot:"end"},null,8,["modelValue"])])),_:1})])),_:1})],32)):(0,i.kq)("",!0),d.productItem?((0,i.wg)(),(0,i.j4)(E,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[M])),_:1})])),_:1}),(0,i.Wm)(re,{images:d.productItem.images,image_holder_id:d.productItem.product_id,controller:"Product",ref:"productImgs"},null,8,["images","image_holder_id"]),(0,i.Wm)(ae,{onClick:t[22]||(t[22]=t=>e.$refs.productImgs.take_photo()),size:"small",expand:"full",color:"medium"},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.cameraOutline},null,8,["src"]),Z])),_:1})])),_:1})):(0,i.kq)("",!0),u.categoryList?((0,i.wg)(),(0,i.j4)(E,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[F])),_:1})])),_:1}),0==u.categoryList.length?((0,i.wg)(),(0,i.j4)(Q,{key:0,color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.compassOutline,slot:"start",color:"danger"},null,8,["src"]),(0,i.Wm)(S,{color:"danger"},{default:(0,i.w5)((()=>[B])),_:1})])),_:1})):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(u.categoryList,(e=>((0,i.wg)(),(0,i.j4)(Q,{key:e.group_id},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.compassOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.group_name),1)])),_:2},1024),(0,i.Wm)(K,{src:r.trashOutline,slot:"end",onClick:t=>u.categoryDelete(e.group_id,e.group_name)},null,8,["src","onClick"])])),_:2},1024)))),128)),(0,i.Wm)(Q,{button:"",onClick:t[23]||(t[23]=e=>u.categoryAdd())},{default:(0,i.w5)((()=>[(0,i.Wm)(K,{src:r.addOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[x])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)]})),_:1},8,["page-title"])}o(8862),o(6699);var S=o(3741),T=o(8903),Y=o(2226);const N=(0,i.Uk)("Категории"),A=(0,i.Uk)("Готово");function J(e,t,o,r,a,d){const u=(0,i.up)("ion-title"),n=(0,i.up)("ion-icon"),s=(0,i.up)("ion-toolbar"),c=(0,i.up)("ion-button"),m=(0,i.up)("ion-header"),p=(0,i.up)("ion-img"),_=(0,i.up)("ion-avatar"),h=(0,i.up)("ion-label"),g=(0,i.up)("ion-checkbox"),w=(0,i.up)("ion-item"),k=(0,i.up)("ion-item-divider"),I=(0,i.up)("ion-list"),f=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[N])),_:1}),(0,i.Wm)(n,{slot:"end",onClick:t[0]||(t[0]=e=>{d.closeModal()}),icon:r.closeCircle,size:"large",color:"medium"},null,8,["icon"])])),_:1}),(0,i.Wm)(c,{onClick:t[1]||(t[1]=e=>{d.closeModal()}),color:"medium",expand:"full"},{default:(0,i.w5)((()=>[A])),_:1})])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[a.groupList?((0,i.wg)(),(0,i.j4)(I,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.groupList,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.group_id},[t.group_parent_id>0?((0,i.wg)(),(0,i.j4)(w,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".50.50.webp"},null,8,["src"])])),_:2},1024),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.group_name),1)])),_:2},1024),(0,i.Wm)(g,{slot:"end",checked:t.is_marked,onClick:e=>d.mimickChage(e.target,t.group_id)},null,8,["checked","onClick"])])),_:2},1024)):((0,i.wg)(),(0,i.j4)(k,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,l.zw)(t.group_name),1)])),_:2},1024)])),_:2},1024))])))),128))])),_:1})):(0,i.kq)("",!0)])),_:1})],64)}var K=o(9755),X=o.n(K),Q={props:["controller","memberId","memberOfIds","memberLimit"],components:{IonCheckbox:S.nz,IonContent:S.W2,IonHeader:S.Gu,IonToolbar:S.sr,IonTitle:S.wd,IonIcon:S.gu,IonButton:S.YG,IonImg:S.Xz,IonAvatar:S.BJ,IonLabel:S.Q$,IonItemDivider:S.rH,IonList:S.q_,IonItem:S.Ie},setup(){return{closeCircle:T.XZx}},data(){return{groupList:null,checkedGroupList:[]}},created(){this.listGroupGet(),this.checkedGroupList=this.memberOfIds||[]},methods:{async listGroupGet(){this.groupList=await X().get(this.$heap.state.hostname+this.controller+"/listGroupGet"),this.itemMarkGroups()},itemMarkGroups(){if(this.groupList)try{for(let e of this.groupList)e.is_marked=this.checkedGroupList.includes(e.group_id)?1:0}catch{}},async itemUpdateGroup(e,t){const o={[this.controller.toLowerCase()+"_id"]:this.memberId,is_joined:e,group_id:t};try{await X().post(this.$heap.state.hostname+this.controller+"/itemUpdateGroup",o)}catch(i){this.$flash("Не удалось сохранить изменение")}},mimickChage(e,t){const o=this;setTimeout((()=>{o.groupChanged(e,t)}),0)},async groupChanged(e,t){const o=e.checked?1:0;if(o){if(this.checkedGroupList.length>=this.memberLimit)return this.$flash(`Можно выбрать не больше ${this.memberLimit} категорий`),void(e.checked=0);1==this.memberLimit&&this.closeModal(),this.checkedGroupList.push(t)}else this.checkedGroupList=this.checkedGroupList.filter((function(e,o,i){return e!=t}));this.itemUpdateGroup(o,t)},closeModal(){S.Fy.dismiss(this.checkedGroupList)}}},R=o(3744);const E=(0,R.Z)(Q,[["render",J]]);var ee=E,te=o(2008),oe=o(9042),ie={components:{IonInput:S.pK,IonTextarea:S.g2,IonCard:S.PM,IonCardContent:S.FN,IonCardHeader:S.Zi,IonToggle:S.ho,IonIcon:S.gu,IonItem:S.Ie,IonList:S.q_,IonLabel:S.Q$,IonItemDivider:S.rH,IonItemGroup:S.Ub,IonButton:S.YG,IonProgressBar:S.X7,IonText:S.yW,IonSelect:S.t9,IonSelectOption:S.n0,imageTileComp:Y.Z},setup(){return{cameraOutline:T.kuq,trashOutline:T.gtu,searchOutline:T.W6I,personOutline:T.QJ7,addOutline:T.s6O,pizzaOutline:T.fqo,compassOutline:T.gmD,chevronBack:T.Mny}},data(){return{productId:this.$route.params.id,productItem:null,productGroupList:null,is_groups_marked:0,is_deleted:0,is_disabled:0,is_counted:0,validity:0,validity_min:80}},computed:{message(){var e,t,o;return null!==(e=this.productItem)&&void 0!==e&&e.deleted_at?"Товар не активен и будет удален. Вы еще можете отменить удаление":1==(null===(t=this.productItem)||void 0===t?void 0:t.is_disabled)?"Товар не активен и находится на рассмотрении у администратора":1!=(null===(o=this.productItem)||void 0===o?void 0:o.is_counted)?"Товар активен и готов к продаже. Товар произодится вами, например еда":"Товар активен и готов к продаже."},messageClass(){var e,t,o;return null!==(e=this.productItem)&&void 0!==e&&e.deleted_at?"deleted":1==(null===(t=this.productItem)||void 0===t?void 0:t.is_disabled)?"disabled":1!=(null===(o=this.productItem)||void 0===o?void 0:o.is_counted)?"primary":"active"},categoryList(){let e=[];try{let t=this.productItem.member_of_groups.group_ids.split(","),o=this.productItem.member_of_groups.group_names.split(",");for(let i in t)e.push({group_id:t[i],group_name:o[i]})}catch{}return e}},created(){this.listGroupGet(),this.itemGet()},methods:{async itemGet(){try{let e=await X().post(te.Z.state.hostname+"Product/itemGet",{product_id:this.productId});this.productItem=this.itemPrepare(e),this.itemParseFlags(),this.itemMarkGroups()}catch{}},itemPrepare(e){return e.product_promo_start&&(e.product_promo_start=e.product_promo_start.split(" ")[0]),e.product_promo_finish&&(e.product_promo_finish=e.product_promo_finish.split(" ")[0]),e},itemParseFlags(){this.is_deleted=null==this.productItem.deleted_at?0:1,this.is_disabled=0==this.productItem.is_disabled?0:1,this.is_counted=0==this.productItem.is_counted?0:1},async itemDelete(e){const t=e?"itemDelete":"itemUnDelete";try{await X().post(te.Z.state.hostname+"Product/"+t,{product_id:this.productId}),this.productItem.deleted_at=e?1:null}catch{this.itemGet()}},async itemDisable(e){if(this.productItem.is_disabled!=e)try{await X().post(te.Z.state.hostname+"Product/itemDisable",{product_id:this.productId,is_disabled:e}),this.productItem.is_disabled=e}catch{this.itemGet()}},async itemUpdate(e){try{return await X().post(te.Z.state.hostname+"Product/itemUpdate",JSON.stringify(e)),this.$flash("сохранено"),!0}catch(t){const e=t.responseJSON.messages.error;return null!==e&&void 0!==e&&e.includes("product_description")?this.$flash("Описание слишком короткое"):null!==e&&void 0!==e&&e.includes("product_name")?this.$flash("Название слишком короткое"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},checkPromoPrice(e){if(this.productItem.product_price>0&&this.productItem.product_promo_price>0&&this.productItem.product_price<=this.productItem.product_promo_price){"product_promo_price"==e&&(this.productItem.product_price=Number(this.productItem.product_promo_price)+1),"product_price"==e&&(this.productItem.product_promo_price=Number(this.productItem.product_price)-1);const t={product_id:this.productId,product_promo_price:this.productItem.product_promo_price,product_price:this.productItem.product_price};return this.itemUpdate(t),this.$flash("Акционная цена должна быть ниже основной. Внимание цена изменена!"),!1}return!0},saveForm(e){const t=e.target.name,o=this.productItem[t]=e.target.value;this.checkPromoPrice(t)&&this.save(t,o)},async save(e,t){let o={product_id:this.productId,[e]:t};this.itemUpdate(o)&&(this.productItem[e]=t,this.itemParseFlags())},categoryDelete(e,t){if(confirm("Исключить товар из категории "+t+"?"))try{this.itemUpdateGroup(0,e)}catch{}},async categoryAdd(){var e,t,o;const i=(null===(e=this.productItem)||void 0===e||null===(t=e.member_of_groups)||void 0===t||null===(o=t.group_ids)||void 0===o?void 0:o.split(","))||[],l=await S.Fy.create({component:ee,componentProps:{controller:"Product",memberId:this.productId,memberOfIds:i,memberLimit:1},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});l.present(),oe.Z.on("dismissModal",(()=>{l.dismiss()})),await l.onDidDismiss(),this.itemGet()},async itemUpdateGroup(e,t){const o={product_id:this.productId,is_joined:e,group_id:t};try{await X().post(te.Z.state.hostname+"Product/itemUpdateGroup",o)}catch(i){this.$flash("Не удалось сохранить изменение")}this.itemGet()},async listGroupGet(){try{this.productGroupList=await X().get(te.Z.state.hostname+"Product/listGroupGet"),this.itemMarkGroups()}catch{}},showProductInStore(){let e=0;try{e=this.productItem.member_of_groups.group_ids.split(",")[0]}catch{}this.$router.push({path:"store-"+this.productItem.store_id,query:{sub_group_id:e}})}}};const le=(0,R.Z)(ie,[["render",H],["__scopeId","data-v-1a3bfcb8"]]);var re=le}}]);
//# sourceMappingURL=89.3a0b7865.js.map