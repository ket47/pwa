{"version":3,"file":"js/228.cf46a1a7.js","mappings":"yMACqC,c,0EAAnCA,EAAAA,EAAAA,IAGcC,EAAA,CAHDC,UAAU,aAAW,C,kBAAC,IAE/B,WAA+C,UAAtCC,QAAK,eAAEC,EAAAA,cAAa,gB,6BAanC,GACEC,OACE,MAAO,CACLC,UAAU,KAGdC,QAAS,CACPC,4BAA4BC,GAC1B,KAAMC,KAAKC,MAAMC,MAAMC,KAAKC,QAAQ,GAGlC,OAFAJ,KAAKK,OAAO,oCACZL,KAAKM,QAAQC,KAAK,WAGpB,IACE,MAAMC,EAAQ,CACZC,KAAK,UACLC,gBAAgBX,EAChBY,WAAWC,UAAUC,WAEjBC,QAAeC,IAAAA,KAAa,GAAEf,KAAKC,MAAMC,MAAMc,gCAAgCR,GACrFS,QAAQC,IAAI,wBAAwBJ,GACrC,MAAMK,GACLF,QAAQC,IAAIC,KAGhBrB,kBACEE,KAAKoB,WAAWC,kBAAkBrB,KAAKC,MAAMC,MAAMC,KAAKC,SACxDJ,KAAKoB,WAAWE,oBAalBxB,kBAKEE,KAAKoB,WAAWG,GAAG,sBAAsB,SAASC,GAChDP,QAAQC,IAAI,wCAAyCM,QA6B3DC,UACEzB,KAAK0B,c,UCvFT,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,KAEpE","sources":["webpack://tezkel-delivery/./src/views/MsgDashboard.vue","webpack://tezkel-delivery/./src/views/MsgDashboard.vue?fbaa"],"sourcesContent":["<template>\r\n  <base-layout pageTitle=\"Сообщения\">\r\n      mesajlar\r\n      <button @click=\"subscribe()\">SUBSCRIBE</button>\r\n  </base-layout>\r\n</template>\r\n<script>\r\n//import { initializeApp } from \"firebase/app\";\r\n//import { getMessaging, getToken } from \"firebase/messaging\";\r\n\r\n//import {IOneSignal} from 'onesignal-vue'\r\n\r\n// import 'firebase/app'\r\n// import 'firebase/messaging'\r\nimport jQuery from 'jquery'\r\n\r\nexport default {\r\n  data(){\r\n    return {\r\n      messaging:{}\r\n    }\r\n  },\r\n  methods: {\r\n    async saveNotificationToken(token) {\r\n      if( !(this.$heap.state.user.user_id>0) ){\r\n        this.$flash(\"Необходимо авторизироваться\")\r\n        this.$router.push(\"sign-in\")\r\n        return\r\n      }\r\n      try{\r\n        const request={\r\n          type:'webpush',\r\n          registration_id:token,\r\n          user_agent:navigator.userAgent\r\n        }\r\n        const response=await jQuery.post(`${this.$heap.state.hostname}MessageSub/itemCreate`,request)\r\n        console.log('saveNotificationToken',response)\r\n      }catch(err){\r\n        console.log(err)\r\n      }\r\n    },\r\n    async subscribe(){\r\n      this.$OneSignal.setExternalUserId(this.$heap.state.user.user_id);\r\n      this.$OneSignal.showNativePrompt();\r\n      // try{\r\n      //   const permission=await Notification.requestPermission()\r\n      //   console.log(permission,'Notification permission granted.')\r\n      //   const messaging = getMessaging();\r\n      //   const token=await getToken(messaging, {vapidKey: \"BLzv4oK1EGxAxwPtlAXvMNzaYvMJK1qvx92D0f1U89wlUPxUU4gAtes7c__wcTwvmEyds6e7-p0Oy4bVYZo1Igg\"});\r\n      //   this.saveNotificationToken(token)\r\n      // }catch(err){\r\n      //   this.$alert(\"Не удалось подключить уведомления\")\r\n      //   console.log('Unable to get permission to notify.', err)\r\n      // }\r\n    },\r\n\r\n    async setupPush() {\r\n\r\n\r\n\r\n\r\n      this.$OneSignal.on('subscriptionChange', function(isSubscribed) {\r\n        console.log(\"The user's subscription state is now:\", isSubscribed);\r\n      });\r\n\r\n      //this.$OneSignal.showNativePrompt();\r\n\r\n      // // I recommend to put these into your environment.ts\r\n      // this.oneSignal.startInit('YOUR ONESIGNAL APP ID', 'YOUR ANDROID ID');\r\n  \r\n      // this.oneSignal.inFocusDisplaying(this.oneSignal.OSInFocusDisplayOption.None);\r\n  \r\n      // // Notifcation was received in general\r\n      // this.oneSignal.handleNotificationReceived().subscribe(data => {\r\n      //   let msg = data.payload.body;\r\n      //   let title = data.payload.title;\r\n      //   let additionalData = data.payload.additionalData;\r\n      //   this.showAlert(title, msg, additionalData.task);\r\n      // });\r\n  \r\n      // // Notification was really clicked/opened\r\n      // this.oneSignal.handleNotificationOpened().subscribe(data => {\r\n      //   // Just a note that the data is a different place here!\r\n      //   let additionalData = data.notification.payload.additionalData;\r\n  \r\n      //   this.showAlert('Notification opened', 'You already read this before', additionalData.task);\r\n      // });\r\n  \r\n      // this.oneSignal.endInit();\r\n    },\r\n    },\r\n  mounted() {\r\n    this.setupPush()\r\n    // const firebaseConfig = {\r\n    //   apiKey: \"AIzaSyDHDeSPsSoJHE_HYKQ_vgOvSfJIN_8Y2Uc\",\r\n    //   authDomain: \"tezkel-8e371.firebaseapp.com\",\r\n    //   projectId: \"tezkel-8e371\",\r\n    //   storageBucket: \"tezkel-8e371.appspot.com\",\r\n    //   messagingSenderId: \"359468869452\",\r\n    //   appId: \"1:359468869452:web:8db6fe690d192b427891e9\",\r\n\r\n    // };\r\n    // const app = initializeApp(firebaseConfig);\r\n    // this.messaging = getMessaging(app);\r\n\r\n\r\n    // const self=this\r\n    // this.messaging.onTokenRefresh(async function (newToken) {\r\n    //   try{\r\n    //     await self.messaging.getToken({vapidKey: \"BLzv4oK1EGxAxwPtlAXvMNzaYvMJK1qvx92D0f1U89wlUPxUU4gAtes7c__wcTwvmEyds6e7-p0Oy4bVYZo1Igg\"});\r\n    //     self.saveNotificationToken(newToken)\r\n    //   } catch(err){\r\n    //     console.log('Unable to retrieve refreshed token ', err)\r\n    //   }\r\n    // });\r\n  }\r\n}\r\n</script>","import { render } from \"./MsgDashboard.vue?vue&type=template&id=003b2ae1\"\nimport script from \"./MsgDashboard.vue?vue&type=script&lang=js\"\nexport * from \"./MsgDashboard.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"W:\\\\Ionic\\\\Tezkel\\\\blank\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","pageTitle","onClick","$options","data","messaging","methods","async","token","this","$heap","state","user","user_id","$flash","$router","push","request","type","registration_id","user_agent","navigator","userAgent","response","jQuery","hostname","console","log","err","$OneSignal","setExternalUserId","showNativePrompt","on","isSubscribed","mounted","setupPush","__exports__","render"],"sourceRoot":""}