"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[762],{762:function(t,e,n){n.d(e,{Z:function(){return U}});var r=n(6252),a=n(3577),u=(0,r.Uk)("Баланс"),i=(0,r.Uk)("Период"),l=(0,r.Uk)("Начальная дата"),o={slot:"end",style:{display:"grid","grid-template-columns":"120px 100px"}},s=(0,r.Uk)("Обороты"),c={slot:"end",style:{display:"grid","grid-template-columns":"120px 100px"}},d=(0,r.Uk)("Конечная дата"),m={slot:"end",style:{display:"grid","grid-template-columns":"120px 100px"}},f=(0,r.Uk)("Фильтр по тегам"),g=(0,r.Uk)("Добавить #тег"),p=["onClick"],w=(0,r.Uk)(" Нет операций в данном периоде ");function _(t,e,n,_,h,y){var k=(0,r.up)("ion-title"),v=(0,r.up)("ion-text"),W=(0,r.up)("ion-item"),x=(0,r.up)("ion-list"),$=(0,r.up)("ion-icon"),b=(0,r.up)("ion-input"),D=(0,r.up)("ion-accordion"),C=(0,r.up)("ion-chip"),I=(0,r.up)("ion-label"),T=(0,r.up)("ion-accordion-group"),U=(0,r.up)("ion-searchbar"),j=(0,r.up)("ion-skeleton-text");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(x,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(k,null,{default:(0,r.w5)((function(){return[u]})),_:1}),h.balance>0?((0,r.wg)(),(0,r.j4)(v,{key:0,slot:"end",color:"success"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(h.balance)+(0,a.zw)(t.$heap.state.currencySign),1)]})),_:1})):((0,r.wg)(),(0,r.j4)(v,{key:1,slot:"end"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(h.balance)+(0,a.zw)(t.$heap.state.currencySign),1)]})),_:1}))]})),_:1})]})),_:1}),(0,r.Wm)(T,{value:h.settingsType},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{value:"period"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{slot:"header"},{default:(0,r.w5)((function(){return[(0,r.Wm)($,{icon:_.calendarOutline,slot:"start"},null,8,["icon"]),(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[i]})),_:1})]})),_:1}),(0,r.Wm)(x,{slot:"content"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[l]})),_:1}),(0,r._)("div",o,[(0,r.Wm)(b,{type:"date",modelValue:h.start_at,"onUpdate:modelValue":e[0]||(e[0]=function(t){return h.start_at=t}),onIonChange:e[1]||(e[1]=function(t){return y.listGet()})},null,8,["modelValue"]),h.meta.sum_start?((0,r.wg)(),(0,r.j4)(b,{key:0,type:"text",style:{"text-align":"right"},color:"medium",value:`${h.meta.sum_start}${t.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,r.kq)("",!0)])]})),_:1}),(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[s]})),_:1}),(0,r._)("div",c,[h.meta.sum_debit?((0,r.wg)(),(0,r.j4)(b,{key:0,type:"text",style:{"text-align":"right"},color:"medium",value:`+${h.meta.sum_debit}${t.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,r.kq)("",!0),h.meta.sum_credit?((0,r.wg)(),(0,r.j4)(b,{key:1,type:"text",style:{"text-align":"right"},color:"medium",value:`-${h.meta.sum_credit}${t.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,r.kq)("",!0)])]})),_:1}),(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[d]})),_:1}),(0,r._)("div",m,[(0,r.Wm)(b,{type:"date",modelValue:h.finish_at,"onUpdate:modelValue":e[2]||(e[2]=function(t){return h.finish_at=t})},null,8,["modelValue"]),h.meta.sum_finish?((0,r.wg)(),(0,r.j4)(b,{key:0,type:"text",style:{"text-align":"right"},color:"medium",value:`${h.meta.sum_finish}${t.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,r.kq)("",!0)])]})),_:1})]})),_:1})]})),_:1}),(0,r.Wm)(D,{value:"tags"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{slot:"header"},{default:(0,r.w5)((function(){return[(0,r.Wm)($,{icon:_.pricetagOutline,slot:"start"},null,8,["icon"]),(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[f]})),_:1})]})),_:1}),(0,r.Wm)(x,{slot:"content"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(h.tagDict,(function(t,e){return(0,r.wg)(),(0,r.j4)(C,{key:e,color:"primary"},{default:(0,r.w5)((function(){return[(0,r.Uk)("#"+(0,a.zw)(t)+" ",1),(0,r.Wm)($,{src:_.closeCircle,onClick:function(t){return y.itemTagRemove(e)}},null,8,["src","onClick"])]})),_:2},1024)})),128)),(0,r.Wm)(C,{onClick:e[3]||(e[3]=function(t){return y.itemTagCreate()}),color:"medium"},{default:(0,r.w5)((function(){return[(0,r.Wm)($,{src:_.addOutline},null,8,["src"]),(0,r.Wm)(I,null,{default:(0,r.w5)((function(){return[g]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1},8,["value"]),(0,r.Wm)(U,{modelValue:h.searchQuery,"onUpdate:modelValue":e[4]||(e[4]=function(t){return h.searchQuery=t}),placeholder:"Поиск по сумме или описанию",onIonChange:e[5]||(e[5]=function(t){return y.listGet()})},null,8,["modelValue"]),null==h.ledger?((0,r.wg)(),(0,r.j4)(x,{key:0},{default:(0,r.w5)((function(){return[((0,r.wg)(),(0,r.iD)(r.HY,null,(0,r.Ko)([1,2,3],(function(t){return(0,r.Wm)(W,{key:t},{default:(0,r.w5)((function(){return[(0,r.Wm)(v,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Wm)(j,{animated:"",style:{width:"50px"}})]})),_:1}),(0,r.Wm)(I,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(j,{animated:"",style:{width:"100%"}})]})),_:1}),(0,r.Wm)(I,{slot:"end",color:"success"},{default:(0,r.w5)((function(){return[(0,r.Wm)(j,{animated:"",style:{width:"50px"}})]})),_:1})]})),_:2},1024)})),64))]})),_:1})):h.ledger.length>0?((0,r.wg)(),(0,r.j4)(x,{key:1},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(y.ledgerCalc,(function(t){return(0,r.wg)(),(0,r.iD)("div",{key:t.trans_id},[(0,r.Wm)(W,{detail:y.is_admin,lines:"none",onClick:function(e){return y.itemClick(t.trans_id)}},{default:(0,r.w5)((function(){return[(0,r.Wm)(v,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(t.date),1)]})),_:2},1024),(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(t.trans_description)+" "+(0,a.zw)(t.trans_role),1)]})),_:2},1024),t.amount_sign>0?((0,r.wg)(),(0,r.j4)(I,{key:0,slot:"end",color:"success"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(t.trans_amount),1)]})),_:2},1024)):t.amount_sign<0?((0,r.wg)(),(0,r.j4)(I,{key:1,slot:"end",color:"danger"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(t.trans_amount),1)]})),_:2},1024)):((0,r.wg)(),(0,r.j4)(I,{key:2,slot:"end",color:"medium"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(t.trans_amount),1)]})),_:2},1024))]})),_:2},1032,["detail","onClick"]),(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.tag_list,(function(t,e){return(0,r.wg)(),(0,r.iD)("div",{class:"tag",key:e,onClick:function(e){return y.itemTagAdd(t)}},"#"+(0,a.zw)(t[1]),9,p)})),128))]})),_:2},1024)]})),_:2},1024)])})),128))]})),_:1})):((0,r.wg)(),(0,r.j4)(x,{key:2},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[w]})),_:1})]})),_:1}))])}var h=n(6835),y=n(8534),k=n(8439),v=(n(7042),n(4916),n(3123),n(1249),n(8292)),W=n(8903),x=n(9755),$=n.n(x),b=n(351),D=n(6321),C={components:{IonIcon:v.gu,IonTitle:v.wd,IonLabel:v.Q$,IonItem:v.Ie,IonInput:v.pK,IonList:v.q_,IonAccordion:v.We,IonAccordionGroup:v.eh,IonText:v.yW,IonSkeletonText:v.CK,IonSearchbar:v.VI,IonChip:v.hM},props:[],setup(){return{calendarOutline:W.rom,addOutline:W.s6O,closeCircle:W.XZx,pricetagOutline:W.TuG}},data(){console.log(this.query);var t=new Date,e=new Date(Date.parse(`${t.getFullYear()}-${t.getMonth()+1}-1`));return{balance:"-",start_at:e.toISOString().slice(0,10),finish_at:t.toISOString().slice(0,10),searchQuery:"",tagQuery:"",tagDict:null,ledger:null,meta:{},today:t,settingsType:null}},computed:{ledgerCalc(){if(null==this.ledger)return null;var t,e=[],n=(0,k.Z)(this.ledger);try{for(n.s();!(t=n.n()).done;){var r,a,u,i,l=t.value;l.date=this.toLocDate(l.trans_date),l.tag_list=null===(r=l.tags)||void 0===r||null===(a=r.substring(1))||void 0===a||null===(u=a.toLowerCase())||void 0===u||null===(i=u.split("|"))||void 0===i?void 0:i.map((function(t){return t.split("#")})),e.push(l)}}catch(o){n.e(o)}finally{n.f()}return e},is_admin(){return b.Z.isAdmin()}},watch:{query:function(){this.listGet()}},methods:{listGet(){var t=this;return(0,y.Z)((0,h.Z)().mark((function e(){var n,r,a,u,i,l,o;return(0,h.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a=null===(n=Object.keys(null!==(r=t.tagDict)&&void 0!==r?r:{}))||void 0===n?void 0:n.join(" "),u={start_at:t.start_at,finish_at:t.finish_at,tagQuery:a,searchQuery:t.searchQuery},e.next=5,$().post(`${t.$heap.state.hostname}Transaction/listGet`,u);case 5:i=e.sent,t.ledger=i.ledger,t.meta=i.meta,t.finish_at==t.today.toISOString().slice(0,10)&&(t.balance=i.meta.sum_finish),e.next=25;break;case 11:e.prev=11,e.t0=e["catch"](0),l=e.t0.responseJSON,o=l.messages.error,e.t1=o,e.next="large_interval"===e.t1?18:20;break;case 18:return t.$flash("Период должен быть не больше 3 месяцев"),e.abrupt("break",22);case 20:return t.$flash("Ошибка получения выписки"),e.abrupt("break",22);case 22:return t.ledger=[],t.balance=0,e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,null,[[0,11]])})))()},toLocDate(t){var e=new Date(Date.parse(t)),n={month:"short",day:"numeric"};return e.toLocaleDateString(void 0,n)},itemClick(t){b.Z.isAdmin()&&this.$router.push(`/admin/transaction-edit-${t}`)},itemTagPick(t){var e=this;return(0,y.Z)((0,h.Z)().mark((function n(){var r,a,u,i,l,o;return(0,h.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,v.Fy.create({component:D.Z,componentProps:{itemType:t},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});case 2:return l=n.sent,l.present(),e.$topic.on("dismissModal",(function(){l.dismiss()})),n.next=7,l.onDidDismiss();case 7:if(o=n.sent,o.data){n.next=10;break}return n.abrupt("return");case 10:null!==(r=o.data.order_id)&&void 0!==r&&r&&e.itemTagAdd([`order:${o.data.order_id}`,`заказ ${o.data.order_id}`]),null!==(a=o.data.store_id)&&void 0!==a&&a&&e.itemTagAdd([`store:${o.data.store_id}`,`продавец ${o.data.store_name}`]),null!==(u=o.data.courier_id)&&void 0!==u&&u&&e.itemTagAdd([`courier:${o.data.courier_id}`,`курьер ${o.data.courier_name}`]),null!==(i=o.data.type)&&void 0!==i&&i&&e.itemTagAdd([`acc::${o.data.type}`,`счет ${o.data.name}`]);case 14:case"end":return n.stop()}}),n)})))()},itemTagCreate(){var t=this;return(0,y.Z)((0,h.Z)().mark((function e(){var n,r;return(0,h.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,v.BO.create({header:"Тип тега",buttons:[{text:"Заказ",role:"destructive",data:"order"},{text:"Продавец",role:"destructive",data:"store"},{text:"Курьер",role:"destructive",data:"courier"},{text:"Счет",role:"destructive",data:"acc"}]});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onDidDismiss();case 7:r=e.sent,null!==r&&void 0!==r&&r.data&&t.itemTagPick(null===r||void 0===r?void 0:r.data);case 9:case"end":return e.stop()}}),e)})))()},itemTagAdd(t){var e,n=null!==(e=this.tagDict)&&void 0!==e?e:{};n[t[0]]=t[1],this.tagDict=n,this.listGet(),this.settingsType="tags"},itemTagRemove(t){var e,n=null!==(e=this.tagDict)&&void 0!==e?e:{};n[t]&&delete n[t];var r=Object.keys(n).length;this.tagDict=r?n:null,this.listGet(),this.settingsType="tags"}},mounted(){this.listGet()}},I=n(3744);const T=(0,I.Z)(C,[["render",_]]);var U=T}}]);
//# sourceMappingURL=762-legacy.dc10db67.js.map