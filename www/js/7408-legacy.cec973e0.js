"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[7408],{7408:function(t,o,e){e.r(o),e.d(o,{default:function(){return L}});var i=e(6252),n=e(3577);const a=(0,i.Uk)("Ваше местоположение"),l=(0,i.Uk)("Добавить адрес");function s(t,o,e,s,r,c){const u=(0,i.up)("ion-img"),d=(0,i.up)("ion-label"),_=(0,i.up)("ion-icon"),p=(0,i.up)("ion-item"),m=(0,i.up)("ion-list"),h=(0,i.up)("ion-list-header"),g=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(g,{"page-title":"Мои адреса",pageDefaultBackLink:"/user",ref:"UserAddressPage"},{default:(0,i.w5)((()=>[r.locationList.length?((0,i.wg)(),(0,i.j4)(m,{key:0,lines:"full"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.locationList,((o,e)=>((0,i.wg)(),(0,i.j4)(p,{key:o.location_id},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.32.32.png`},null,8,["src"]),(0,i.Wm)(d,{onClick:t=>c.locationSetMain(`${o.location_id}`,`${e}`),style:{"white-space":"normal",cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.location_address),1)])),_:2},1032,["onClick"]),(0,i.Wm)(_,{slot:"end",icon:s.trash,onClick:t=>c.locationDelete(`${o.location_id}`,`${e}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):((0,i.wg)(),(0,i.j4)(m,{key:1,lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{button:"",onClick:o[0]||(o[0]=t=>c.locationCurrentSet())},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{slot:"start",color:"primary",icon:s.locationOutline},null,8,["icon"]),(0,i.Wm)(d,{color:"dark"},{default:(0,i.w5)((()=>[a])),_:1})])),_:1})])),_:1})),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[l])),_:1})])),_:1}),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.locationGroupList,(o=>((0,i.wg)(),(0,i.j4)(p,{key:o.group_id,onClick:t=>c.modalLocationCreate(`${o.group_id}`,`${o.group_name}`),style:{cursor:"pointer"}},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.32.32.png`},null,8,["src"]),(0,i.Wm)(d,{style:{"margin-left":"5px","padding-left":"5px","border-left":"solid 1px black","white-space":"normal"}},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.group_name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)}var r=e(8534),c=(e(3948),e(7204)),u=e(3053),d=e(2008),_=e(351),p=e(9755),m=e.n(p),h=e(4975),g=e(8903),f={name:"UserAddresses",components:{IonImg:c.Xz,IonLabel:c.Q$,IonItem:c.Ie,IonList:c.q_,IonListHeader:c.yh,IonIcon:c.gu},setup(){return{locationOutline:g.Iv7,trash:g._Ij}},mounted(){this.locationListGet()},methods:{modalLocationCreate(t,o){var e=this;return(0,r.Z)((function*(){if(!d.Z.state.user.user_id)return e.$flash("Чтобы добавленные адреса сохранились, пожалуйста войдите в систему"),void u.Z.push("/user/sign-in");var i=String(o).toLowerCase();const n=yield c.Fy.create({component:h.Z,showBackdrop:!0,backdropDismiss:!0,swipeToClose:!0,cssClass:"update-profile-modal",presentingElement:e.$refs.UserAddressPage.$el,componentProps:{location_group_name_low:i}});return n.onDidDismiss().then((o=>{e.locationCreate(t,o.data)})),n.present()}))()},locationListGet(){var t=this;return(0,r.Z)((function*(){try{var o,e;let i=null;const n=yield m().get(d.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(t.locationList=n.location_list,t.locationGroupList=n.location_group_list,t.locationList)for(let o of t.locationList)1==o.is_main&&(i=o);if(!i)return void _.Z.get();i&&(null===(o=i)||void 0===o?void 0:o.location_id)!=(null===(e=d.Z.state.user.location_main)||void 0===e?void 0:e.location_id)&&(d.Z.state.user.location_main=i,t.$topic.publish("userMainLocationSet",d.Z.state.user.location_main))}catch(i){}}))()},locationCreate(t,o){var e=this;return(0,r.Z)((function*(){if(!o)return;let i={location_holder:"user",location_holder_id:d.Z.state.user.user_id,location_group_id:t,location_address:o.location_address,location_latitude:o.location_latitude,location_longitude:o.location_longitude};try{yield m().post(d.Z.state.hostname+"User/locationCreate",i),e.$heap.state.next_route&&(e.$router.push(e.$heap.state.next_route),e.$heap.state.next_route=null),e.locationListGet()}catch(n){const t=n.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":e.$flash("Больше адресов добавить нельзя");break}return!1}}))()},locationSetMain(t,o){var e=this;return(0,r.Z)((function*(){var i=e,n=i.locationList[o];d.Z.state.user.location_main={location_id:n.location_id,location_latitude:n.location_latitude,location_altitude:n.location_altitude,location_address:n.location_address,image_hash:n.image_hash},u.Z.go(-1),yield m().post(d.Z.state.hostname+"User/locationSetMain",{location_id:t}),e.$topic.publish("userMainLocationSet",d.Z.state.user.location_main)}))()},locationDelete(t,o){var e=this;return(0,r.Z)((function*(){try{e.locationList.splice(o,1),yield m().post(d.Z.state.hostname+"User/locationDelete",{location_id:t})}catch(i){}e.locationListGet()}))()},locationCurrentSet(){return(0,r.Z)((function*(){yield _.Z.geo.locationCurrentGet(),u.Z.go(-1)}))()}},data(){return{locationList:[],locationGroupList:[]}}},w=e(3744);const k=(0,w.Z)(f,[["render",s]]);var L=k}}]);
//# sourceMappingURL=7408-legacy.cec973e0.js.map