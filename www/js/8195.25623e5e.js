"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[8195],{8195:function(t,e,o){o.r(e),o.d(e,{default:function(){return B}});var i=o(641),l=o(33);const s=t=>((0,i.Qi)("data-v-5173520a"),t=t(),(0,i.jt)(),t),a={key:0,style:{position:"relative"}},n={class:"post-preview"},d={class:"slide-container"},r={class:"slide-content"},u={style:{display:"grid","grid-template-columns":"1fr 150px"}},p=s((()=>(0,i.Lk)("div",null,null,-1))),c={key:1,style:{position:"relative"}},m={class:"post-preview"},h={class:"slide-container"},k={class:"story-toolbar"},_=["src"],f={class:"slide-content"},b={style:{display:"grid","grid-template-columns":"1fr 150px"}},v=s((()=>(0,i.Lk)("div",null,null,-1))),g={style:{"padding-left":"10px",background:"#0000004d","border-radius":"16px"}},I={style:{"padding-left":"10px",background:"#0000004d","border-radius":"16px"}},F={class:"crop-to-fit"},y=["src"],$=s((()=>(0,i.Lk)("h6",{class:"ion-padding-horizontal"},"Ссылка",-1))),W=s((()=>(0,i.Lk)("h6",{class:"ion-padding-horizontal"},"Автор поста",-1))),C=s((()=>(0,i.Lk)("h6",{class:"ion-padding-horizontal"},"Время действия",-1))),O={class:"ion-padding"};function P(t,e,o,s,P,L){const w=(0,i.g2)("ion-skeleton-text"),X=(0,i.g2)("ion-label"),x=(0,i.g2)("ion-chip"),V=(0,i.g2)("ion-avatar"),G=(0,i.g2)("ion-icon"),D=(0,i.g2)("ion-input"),S=(0,i.g2)("ion-textarea"),U=(0,i.g2)("ion-segment-button"),A=(0,i.g2)("ion-segment"),T=(0,i.g2)("ion-button"),z=(0,i.g2)("ion-item"),E=(0,i.g2)("ion-list"),q=(0,i.g2)("ion-modal"),B=(0,i.g2)("image-tile-comp"),Z=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(Z,{hideTitle:1},{default:(0,i.k6)((()=>{var o,Z,J,K;return[null==P.postItem?((0,i.uX)(),(0,i.CE)("div",a,[(0,i.Lk)("div",n,[(0,i.Lk)("div",d,[(0,i.Lk)("div",r,[(0,i.Lk)("div",u,[p,(0,i.Lk)("div",null,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([0,1,2,3,4],(t=>(0,i.bF)(x,{key:t},{default:(0,i.k6)((()=>[(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.bF)(w,{style:{width:"50px"},animated:""})])),_:1}),(0,i.bF)(w,{style:{width:"20px",height:"20px"},animated:""})])),_:2},1024))),64))])]),((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([0,1,2,3],(t=>(0,i.bF)(w,{key:t,style:{width:"100%",height:"70px"},animated:""}))),64))])])])])):P.postItem?((0,i.uX)(),(0,i.CE)("div",c,[(0,i.Lk)("div",m,[(0,i.Lk)("div",h,[(0,i.Lk)("div",k,[(0,i.Lk)("div",null,[null!==(o=P.pickedStore)&&void 0!==o&&o.avatar_hash?((0,i.uX)(),(0,i.Wv)(V,{key:0},{default:(0,i.k6)((()=>[(0,i.Lk)("img",{src:`${t.$heap.state.hostname}image/get.php/${P.pickedStore.avatar_hash}.150.150.webp`},null,8,_)])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(X,null,{default:(0,i.k6)((()=>{var t;return[(0,i.Lk)("b",null,(0,l.v_)(null===(t=P.pickedStore)||void 0===t?void 0:t.store_name),1)]})),_:1})])]),(0,i.Lk)("div",f,[(0,i.Lk)("div",b,[v,(0,i.Lk)("div",null,[(0,i.bF)(x,{onClick:e[0]||(e[0]=t=>P.popovers.image=1)},{default:(0,i.k6)((()=>{var t,e;return[null!==(t=P.postItem)&&void 0!==t&&null!==(e=t.images)&&void 0!==e&&e.length?((0,i.uX)(),(0,i.Wv)(X,{key:0,color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)("Фото")])),_:1})):((0,i.uX)(),(0,i.Wv)(X,{key:1,color:"danger"},{default:(0,i.k6)((()=>[(0,i.eW)("Нет фото")])),_:1})),(0,i.bF)(G,{icon:s.imageOutline,color:"light"},null,8,["icon"])]})),_:1}),(0,i.bF)(x,{onClick:e[1]||(e[1]=t=>P.popovers.holder=1)},{default:(0,i.k6)((()=>{var t,e;return[null!==(t=P.postItem)&&void 0!==t&&null!==(e=t.holder)&&void 0!==e&&e.store_name?((0,i.uX)(),(0,i.Wv)(X,{key:0,color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(P.postItem.holder.store_name),1)])),_:1})):((0,i.uX)(),(0,i.Wv)(X,{key:1,color:"danger"},{default:(0,i.k6)((()=>[(0,i.eW)("Автор")])),_:1})),(0,i.bF)(G,{icon:s.personOutline,color:"light"},null,8,["icon"])]})),_:1}),(0,i.bF)(x,{onClick:e[2]||(e[2]=t=>P.popovers.link=1)},{default:(0,i.k6)((()=>{var t;return[null!==(t=P.postItem)&&void 0!==t&&t.post_route?((0,i.uX)(),(0,i.Wv)(X,{key:0,color:"primary"},{default:(0,i.k6)((()=>[(0,i.eW)("Ссылка")])),_:1})):((0,i.uX)(),(0,i.Wv)(X,{key:1,color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)("Нет ссылки")])),_:1})),(0,i.bF)(G,{icon:s.linkOutline,color:"light"},null,8,["icon"])]})),_:1}),(0,i.bF)(x,{onClick:e[3]||(e[3]=t=>P.popovers.date=1)},{default:(0,i.k6)((()=>[(0,i.bF)(X,{color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(L.dateRange),1)])),_:1}),(0,i.bF)(G,{icon:s.calendarOutline,color:"light"},null,8,["icon"])])),_:1}),(0,i.bF)(x,null,{default:(0,i.k6)((()=>[(0,i.bF)(X,{onClick:e[4]||(e[4]=t=>L.itemDelete()),color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)("Удалить")])),_:1}),(0,i.bF)(G,{icon:s.trashOutline,color:"light"},null,8,["icon"])])),_:1}),1==(null===(Z=P.postItem)||void 0===Z?void 0:Z.is_disabled)?((0,i.uX)(),(0,i.Wv)(x,{key:0,onClick:e[5]||(e[5]=t=>L.save("is_disabled",0))},{default:(0,i.k6)((()=>[(0,i.bF)(X,{color:"danger"},{default:(0,i.k6)((()=>[(0,i.eW)("На модерации")])),_:1}),(0,i.bF)(G,{icon:s.ban,color:"danger"},null,8,["icon"])])),_:1})):((0,i.uX)(),(0,i.Wv)(x,{key:1,onClick:e[6]||(e[6]=t=>L.save("is_disabled",1))},{default:(0,i.k6)((()=>[(0,i.bF)(X,{color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)("Проверен")])),_:1}),(0,i.bF)(G,{icon:s.checkmarkOutline,color:"light"},null,8,["icon"])])),_:1})),1==(null===(J=P.postItem)||void 0===J?void 0:J.is_promoted)?((0,i.uX)(),(0,i.Wv)(x,{key:2,onClick:e[7]||(e[7]=t=>L.save("is_promoted",0))},{default:(0,i.k6)((()=>[(0,i.bF)(X,{color:"primary"},{default:(0,i.k6)((()=>[(0,i.eW)("Приоритет")])),_:1}),(0,i.bF)(G,{icon:s.star,color:"primary"},null,8,["icon"])])),_:1})):((0,i.uX)(),(0,i.Wv)(x,{key:3,onClick:e[8]||(e[8]=t=>L.save("is_promoted",1))},{default:(0,i.k6)((()=>[(0,i.bF)(X,{color:"light"},{default:(0,i.k6)((()=>[(0,i.eW)("Обычный пост")])),_:1}),(0,i.bF)(G,{icon:s.starOutline,color:"light"},null,8,["icon"])])),_:1}))])]),"story"==P.postItem.post_type?((0,i.uX)(),(0,i.CE)("form",{key:0,onChange:e[11]||(e[11]=(...t)=>L.saveForm&&L.saveForm(...t))},[(0,i.Lk)("h3",g,[(0,i.bF)(D,{modelValue:P.postItem.post_title,"onUpdate:modelValue":e[9]||(e[9]=t=>P.postItem.post_title=t),labelPlacement:"stacked",name:"post_title",placeholder:"Заголовок",clearInput:"true",style:{"--placeholder-color":"#fff","--color":"#fff"}},null,8,["modelValue"])]),(0,i.Lk)("p",I,[(0,i.bF)(S,{modelValue:P.postItem.post_content,"onUpdate:modelValue":e[10]||(e[10]=t=>P.postItem.post_content=t),labelPlacement:"stacked",name:"post_content",rows:"3",placeholder:"Описание",style:{"--placeholder-color":"#fff","--color":"#fff"}},null,8,["modelValue"])])],32)):(0,i.Q3)("",!0),(0,i.bF)(A,{mode:"ios",modelValue:P.postItem.is_published,"onUpdate:modelValue":e[12]||(e[12]=t=>P.postItem.is_published=t),onIonChange:e[13]||(e[13]=t=>L.itemPublish()),style:{"--background":"#ffffff66"}},{default:(0,i.k6)((()=>[(0,i.bF)(U,{value:"0",style:{height:"50px","--indicator-color":"var(--ion-color-light)"}},{default:(0,i.k6)((()=>[(0,i.bF)(G,{icon:s.eyeOffOutline},null,8,["icon"]),(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.eW)("Скрыт")])),_:1})])),_:1}),(0,i.bF)(U,{value:"1",style:{height:"50px","--indicator-color":"var(--ion-color-success)"}},{default:(0,i.k6)((()=>[(0,i.bF)(G,{icon:s.eyeOutline},null,8,["icon"]),(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.eW)("Опубликован")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(T,{color:"light",expand:"block",onClick:e[14]||(e[14]=e=>t.$router.go(-1))},{default:(0,i.k6)((()=>[(0,i.bF)(G,{icon:s.closeOutline,slot:"start"},null,8,["icon"]),(0,i.eW)("Закрыть")])),_:1})]),(0,i.Lk)("div",F,[(0,i.Lk)("img",{src:`${t.$heap.state.hostname}image/get.php/${null===(K=P.postItem.images[0])||void 0===K?void 0:K.image_hash}.1500.1000.webp`},null,8,y)])])])])):(0,i.Q3)("",!0),(0,i.bF)(q,{"is-open":P.popovers.link,"initial-breakpoint":.5,onDidDismiss:e[20]||(e[20]=t=>{L.itemGet(),P.popovers.link=!1})},{default:(0,i.k6)((()=>[(0,i.Lk)("form",{onChange:e[19]||(e[19]=(...t)=>L.saveForm&&L.saveForm(...t))},[$,(0,i.bF)(E,null,{default:(0,i.k6)((()=>[(0,i.bF)(z,null,{default:(0,i.k6)((()=>[(0,i.bF)(D,{type:"text",modelValue:P.postItem.post_route,"onUpdate:modelValue":e[15]||(e[15]=t=>P.postItem.post_route=t),label:"Ссылка",labelPlacement:"stacked",name:"post_route",readonly:!L.isAdmin},null,8,["modelValue","readonly"]),P.postItem.post_route?((0,i.uX)(),(0,i.Wv)(G,{key:0,slot:"end",src:s.trashOutline,onClick:e[16]||(e[16]=t=>{L.save("post_route",null),P.popovers.link=!1})},null,8,["src"])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(z,{button:"",onClick:e[17]||(e[17]=t=>L.productPick())},{default:(0,i.k6)((()=>[(0,i.bF)(G,{slot:"start",src:s.addOutline},null,8,["src"]),(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.eW)("Выбрать товар")])),_:1})])),_:1})])),_:1}),(0,i.bF)(T,{color:"light",expand:"block",onClick:e[18]||(e[18]=t=>P.popovers.link=!1)},{default:(0,i.k6)((()=>[(0,i.eW)("Закрыть")])),_:1})],32)])),_:1},8,["is-open"]),(0,i.bF)(q,{"is-open":P.popovers.holder,"initial-breakpoint":.5,onDidDismiss:e[26]||(e[26]=t=>{L.itemGet(),P.popovers.holder=!1})},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[W,(0,i.bF)(E,null,{default:(0,i.k6)((()=>{var t;return[null!==(t=P.postItem)&&void 0!==t&&t.holder?((0,i.uX)(),(0,i.Wv)(z,{key:0,button:""},{default:(0,i.k6)((()=>[(0,i.bF)(G,{onClick:e[21]||(e[21]=t=>L.storePick()),slot:"start",src:s.storefrontOutline},null,8,["src"]),(0,i.bF)(X,{onClick:e[22]||(e[22]=t=>L.storePick())},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(P.postItem.holder.store_name),1)])),_:1}),(0,i.bF)(G,{slot:"end",src:s.trashOutline,onClick:e[23]||(e[23]=t=>L.storeReset())},null,8,["src"])])),_:1})):((0,i.uX)(),(0,i.Wv)(z,{key:1,button:"",onClick:e[24]||(e[24]=t=>L.storePick())},{default:(0,i.k6)((()=>[(0,i.bF)(G,{slot:"start",src:s.addOutline},null,8,["src"]),(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.eW)("Добавить автора")])),_:1})])),_:1}))]})),_:1}),(0,i.bF)(T,{color:"light",expand:"block",onClick:e[25]||(e[25]=t=>P.popovers.holder=!1)},{default:(0,i.k6)((()=>[(0,i.eW)("Закрыть")])),_:1})])])),_:1},8,["is-open"]),(0,i.bF)(q,{"is-open":P.popovers.date,"initial-breakpoint":.5,onDidDismiss:e[31]||(e[31]=t=>{L.itemGet(),P.popovers.date=!1})},{default:(0,i.k6)((()=>[(0,i.Lk)("form",{onChange:e[30]||(e[30]=(...t)=>L.saveForm&&L.saveForm(...t))},[C,(0,i.bF)(E,{addOutlinelines:"full"},{default:(0,i.k6)((()=>[(0,i.bF)(z,null,{default:(0,i.k6)((()=>[(0,i.bF)(D,{type:"date",modelValue:P.postItem.started_at,"onUpdate:modelValue":e[27]||(e[27]=t=>P.postItem.started_at=t),label:"Начало показа",labelPlacement:"stacked",name:"started_at"},null,8,["modelValue"])])),_:1}),(0,i.bF)(z,null,{default:(0,i.k6)((()=>[(0,i.bF)(D,{type:"date",modelValue:P.postItem.finished_at,"onUpdate:modelValue":e[28]||(e[28]=t=>P.postItem.finished_at=t),label:"Конец показа",labelPlacement:"stacked",name:"finished_at"},null,8,["modelValue"])])),_:1})])),_:1}),(0,i.bF)(T,{color:"light",expand:"block",onClick:e[29]||(e[29]=t=>P.popovers.date=!1)},{default:(0,i.k6)((()=>[(0,i.eW)("Закрыть")])),_:1})],32)])),_:1},8,["is-open"]),(0,i.bF)(q,{"is-open":P.popovers.image,"initial-breakpoint":.5,onDidDismiss:e[36]||(e[36]=t=>{L.itemGet(),P.popovers.image=!1})},{default:(0,i.k6)((()=>{var t,o;return[(0,i.Lk)("div",O,[(0,i.bF)(A,{mode:"ios",modelValue:P.postItem.post_type,"onUpdate:modelValue":e[32]||(e[32]=t=>P.postItem.post_type=t),style:{height:"70px"},onIonChange:e[33]||(e[33]=t=>L.itemImageDelete())},{default:(0,i.k6)((()=>[(0,i.bF)(U,{value:"story"},{default:(0,i.k6)((()=>[(0,i.bF)(G,{icon:s.phonePortraitOutline},null,8,["icon"]),(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.eW)("История 1080х1920")])),_:1})])),_:1}),(0,i.bF)(U,{value:"slide"},{default:(0,i.k6)((()=>[(0,i.bF)(G,{icon:s.phoneLandscapeOutline},null,8,["icon"]),(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.eW)("Слайд 1920х700")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(B,{ref:"postImgs",title:"Фото поста",controller:"Post",params:P.imageParams,images:null!==(t=null===(o=P.postItem)||void 0===o?void 0:o.images)&&void 0!==t?t:[],image_holder_id:P.postId,onChange:e[34]||(e[34]=t=>{L.itemGet(),P.popovers.image=!1})},null,8,["params","images","image_holder_id"]),(0,i.bF)(T,{onClick:e[35]||(e[35]=t=>L.itemImageUpload()),expand:"block"},{default:(0,i.k6)((()=>[(0,i.bF)(G,{src:s.imageOutline,slot:"start"},null,8,["src"]),(0,i.eW)(" Загрузить изображение ")])),_:1})])]})),_:1},8,["is-open"])]})),_:1})}var L=o(5654),w=o(5480),X=o(2431),x=o(2311),V=o.n(x),G=o(454);function D(t,e,o,s,a,n){const d=(0,i.g2)("ion-title"),r=(0,i.g2)("ion-icon"),u=(0,i.g2)("ion-toolbar"),p=(0,i.g2)("ion-header"),c=(0,i.g2)("ion-searchbar"),m=(0,i.g2)("ion-img"),h=(0,i.g2)("ion-chip"),k=(0,i.g2)("ion-item"),_=(0,i.g2)("ion-list"),f=(0,i.g2)("ion-content");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.eW)("Выбрать товар")])),_:1}),(0,i.bF)(r,{icon:s.closeOutline,onClick:e[0]||(e[0]=t=>{n.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.bF)(c,{modelValue:a.query,"onUpdate:modelValue":e[1]||(e[1]=t=>a.query=t),debounce:300,onIonInput:e[2]||(e[2]=t=>n.listGet())},null,8,["modelValue"]),a.productList?((0,i.uX)(),(0,i.Wv)(_,{key:0},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.productList,(e=>((0,i.uX)(),(0,i.Wv)(k,{key:e.product_id,button:"",detail:"",onClick:t=>n.itemPick(e.product_id)},{default:(0,i.k6)((()=>[(0,i.bF)(m,{slot:"start",src:`${t.$heap.state.hostname}image/get.php/${e.image_hash}.50.50.webp`},null,8,["src"]),(0,i.eW)(" "+(0,l.v_)(e.product_name)+" "+(0,l.v_)(e.product_code)+" ",1),e.product_option?((0,i.uX)(),(0,i.Wv)(h,{key:0},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.product_option),1)])),_:2},1024)):(0,i.Q3)("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,i.uX)(),(0,i.Wv)(_,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(k,null,{default:(0,i.k6)((()=>[(0,i.eW)(" Ничего не найдено ")])),_:1})])),_:1}))])),_:1})],64)}var S={props:["store_id","exclude_product_id"],components:{IonContent:L.W9,IonHeader:L.eU,IonToolbar:L.ai,IonTitle:L.BC,IonIcon:L.iq,IonImg:L.KW,IonList:L.nf,IonItem:L.uz,IonChip:L.ZB,IonSearchbar:L.S1},setup(){return{closeOutline:w.xfX}},data(){return{productList:null,query:null}},mounted(){this.listGet()},methods:{async listGet(){const t={name_query:this.query,name_query_fields:"product_name,product_code",store_id:this.store_id,limit:10};try{let e=await V().post(`${this.$heap.state.hostname}Product/listGet`,t);this.productList=e.product_list.filter((t=>t.product_id!=this.exclude_product_id))}catch{}},itemPick(t){L.OZ.dismiss(t)},closeModal(){L.OZ.dismiss()}}},U=o(6262);const A=(0,U.A)(S,[["render",D]]);var T=A,z=o(8701),E={components:{ImageTileComp:X.A,IonModal:L.Sb,IonInput:L.$w,IonTextarea:L.nc,IonIcon:L.iq,IonItem:L.uz,IonList:L.nf,IonLabel:L.he,IonButton:L.Jm,IonAvatar:L.mC,IonSegmentButton:L.eP,IonSegment:L.Gp,IonChip:L.ZB,IonSkeletonText:L.ds},setup(){return{trashOutline:w.P1A,checkmarkOutline:w.g1L,banOutline:w.Av6,ban:w._LG,personOutline:w.wAZ,addOutline:w.EKF,eyeOutline:w.ov$,eyeOffOutline:w.f_X,storefrontOutline:w.te8,imageOutline:w.ETD,calendarOutline:w.RXF,starOutline:w.zV,star:w.d49,closeOutline:w.xfX,phonePortraitOutline:w.g_S,phoneLandscapeOutline:w.abj,linkOutline:w.R4e}},data(){return{postId:this.$route.params.id,postItem:null,imageParams:null,pickedStore:null,pickedProduct:null,storeList:[],popovers:{image:0,holder:!1,date:!1,link:!1},is_deleted:0,is_disabled:0,is_promoted:0}},created(){this.itemGet()},computed:{dateRange(){const t=this.postItem.started_at.split(" ").shift().split("-").reverse().splice(0,2).join("."),e=this.postItem.finished_at.split(" ").shift().split("-").reverse().splice(0,2).join(".");return`${t}-${e}`},isAdmin(){return z.A.isAdmin()}},methods:{async itemGet(){try{if(0==this.postId)return void await this.itemCreatedGet();let t=await V().post(`${this.$heap.state.hostname}Post/itemGet`,{post_id:this.postId});this.postItem=this.itemPrepare(t),this.itemImageParamsSet(),"store"==t.post_holder?(this.pickedStore=t.holder,this.pickedProduct=t.post_route):(this.pickedStore=null,this.pickedProduct=null)}catch(t){404==t.responseJSON.status&&this.$flash("Пост не найден"),this.$router.go(-1)}},itemImageParamsSet(){this.imageParams={post_type:this.postItem.post_type}},async itemImageDelete(){try{const t=this.postItem.images.pop(),e={image_id:t.image_id};this.$flash("Удаляем предыдущее фото"),await V().post(`${this.$heap.state.hostname}Image/itemDelete`,e)}catch{}},async itemImageUpload(){1==this.postItem.is_published&&(this.postItem.is_published=0,await this.itemPublish()),await this.itemImageDelete(),this.itemImageParamsSet(),await this.$refs.postImgs.take_photo()},async itemPublish(){try{let t="itemUnpublish";1==this.postItem.is_published&&(t="itemPublish"),await V().post(`${this.$heap.state.hostname}Post/${t}`,{post_id:this.postId}),1==this.postItem.is_published?this.$flash("Пост опубликован!"):this.$flash("Пост снят с публикации")}catch(t){const e=t.responseJSON.messages.error;"noimage"==e&&this.$flash("У поста нет фото"),"noholder"==e&&this.$flash("Укажите автора"),"disabled"==e&&this.$flash("Пост на модерации"),this.itemGet()}},itemPrepare(t){return t.started_at&&(t.started_at=t.started_at.split(" ")[0]),t.finished_at&&(t.finished_at=t.finished_at.split(" ")[0]),t},async itemCreatedGet(){const t={post_title:"",post_type:"story"};try{const e=await V().post(`${this.$heap.state.hostname}Post/itemCreatedGet`,t);e&&this.$router.replace(`/wall/post-user-edit-${e}`)}catch(i){var e,o;const t=null===i||void 0===i||null===(e=i.responseJSON)||void 0===e||null===(o=e.messages)||void 0===o?void 0:o.error;"forbidden"==t&&(this.$flash("Вы не можете создавать посты"),this.$router.go(-1))}},async itemDelete(){if(confirm("Вы уверены?"))try{await V().post(`${this.$heap.state.hostname}Post/itemDelete`,{post_id:this.postId}),this.$flash("🗑️ Пост удален"),this.$router.go(-1)}catch{this.$flash("Ошибка удаления"),this.itemGet()}},async itemUpdate(t){try{return await V().post(`${this.$heap.state.hostname}Post/itemUpdate`,JSON.stringify(t)),this.$flash("💾 сохранено"),!0}catch(e){const t=e.responseJSON.messages.error;return null!==t&&void 0!==t&&t.includes("post_content")?this.$flash("Описание слишком короткое"):null!==t&&void 0!==t&&t.includes("post_title")?this.$flash("Заголовок слишком короткий"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},async save(t,e){if(!this.postItem.post_id)return;if(["is_disabled","is_promoted"].includes(t)&&!this.isAdmin)return;let o={post_id:this.postItem.post_id,[t]:e};this.itemUpdate(o)&&(this.postItem[t]=e)},saveForm(t){const e=t.target.name,o=this.postItem[e]=t.target.value;this.save(e,o)},async storePick(){let t={};var e;z.A.isAdmin()||(t.owner_id=null!==(e=this.$heap.state.user.user_id)&&void 0!==e?e:0);const o=await L.OZ.create({component:G.A,componentProps:{itemType:"store",filter:t},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});o.present(),this.$topic.on("dismissModal",(()=>{o.dismiss()}));const i=await o.onDidDismiss();if(!i.data)return;this.popovers.holder=!1;const l={post_id:this.postItem.post_id,post_holder:"store",post_holder_id:i.data.store_id};await this.itemUpdate(l),await this.itemGet()},async storeReset(){this.popovers.holder=!1;const t={post_id:this.postItem.post_id,post_holder:"store",post_holder_id:null};await this.itemUpdate(t),await this.itemGet()},async productPick(){const t=await L.OZ.create({component:T,componentProps:{store_id:this.postItem.post_holder_id},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});t.present(),this.$topic.on("dismissModal",(()=>{t.dismiss()}));const e=await t.onDidDismiss();if(!e.data)return;this.popovers.link=!1;const o={post_id:this.postItem.post_id,post_route:`/catalog/product-${e.data}`};await this.itemUpdate(o),await this.itemGet()}}};const q=(0,U.A)(E,[["render",P],["__scopeId","data-v-5173520a"]]);var B=q}}]);
//# sourceMappingURL=8195.25623e5e.js.map