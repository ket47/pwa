"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2956],{5265:function(t,e,n){n.d(e,{Z:function(){return _}});var a=n(6252);const i=(0,a.Uk)("Привязка новой карты"),o=(0,a.Uk)("Оплата картой"),r=["src"],s={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},l=["src"];function c(t,e,n,c,d,u){const m=(0,a.up)("ion-title"),p=(0,a.up)("ion-icon"),g=(0,a.up)("ion-toolbar"),h=(0,a.up)("ion-header"),y=(0,a.up)("ion-content");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(h,null,{default:(0,a.w5)((()=>[(0,a.Wm)(g,{color:"secondary"},{default:(0,a.w5)((()=>["card_registering"==this.order_data?((0,a.wg)(),(0,a.j4)(m,{key:0},{default:(0,a.w5)((()=>[i])),_:1})):((0,a.wg)(),(0,a.j4)(m,{key:1},{default:(0,a.w5)((()=>[o])),_:1})),(0,a.Wm)(p,{icon:c.closeOutline,onClick:e[0]||(e[0]=t=>{c.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(y,null,{default:(0,a.w5)((()=>[(0,a._)("iframe",{src:d.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"calc( 100% - 5px )",border:"none"},onLoad:e[1]||(e[1]=t=>u.onLoad())},null,40,r),d.loadAnimation?((0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("img",{src:c.loading},null,8,l)])):(0,a.kq)("",!0)])),_:1})],64)}var d=n(8534),u=n(2066),m=n(8903),p=n(659),g=n(9755),h=n.n(g),y={components:{IonTitle:u.wd,IonIcon:u.gu,IonToolbar:u.sr,IonHeader:u.Gu,IonContent:u.W2},props:["order_data"],setup(){const t=function(){u.Fy.dismiss()};return{closeModal:t,closeOutline:m.fID,cardOutline:m.pvm,loading:p}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{postToIframe(){var t=this;return(0,d.Z)((function*(){try{if("card_registering"==t.order_data)return void(t.paymentLink=yield h().post(t.$heap.state.hostname+"CardAcquirer/cardRegisterLinkGet"));t.paymentLink=yield h().post(t.$heap.state.hostname+"CardAcquirer/paymentLinkGet",t.order_data)}catch(a){var e,n;const i=null===a||void 0===a||null===(e=a.responseJSON)||void 0===e||null===(n=e.messages)||void 0===n?void 0:n.error;"nocardid"==i?t.$flash("Не удалось добавить карту"):t.$flash("Нет возможности принять оплату картой"),t.closeModal()}}))()},onLoad(){this.loadAnimation=0},listenFrame(){let t=this;window.addEventListener("message",(e=>{"paymentOk"!=e.data&&"paymentNo"!=e.data||t.closeModal()}))}}},k=n(3744);const f=(0,k.Z)(y,[["render",c]]);var _=f},2956:function(t,e,n){n.r(e),n.d(e,{default:function(){return f}});var a=n(6252),i=n(3577);const o=(0,a.Uk)("Привязанных карт нет"),r=(0,a.Uk)(" Добавить новую карту ");function s(t,e,n,s,l,c){const d=(0,a.up)("ion-icon"),u=(0,a.up)("ion-skeleton-text"),m=(0,a.up)("ion-item"),p=(0,a.up)("ion-list"),g=(0,a.up)("ion-img"),h=(0,a.up)("ion-label"),y=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(y,{pageTitle:"Мои банковские карты",pageDefaultBackLink:"/user"},{default:(0,a.w5)((()=>{var t;return[null==l.cardList?((0,a.wg)(),(0,a.j4)(p,{key:0},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)([1],(t=>(0,a.Wm)(m,{key:t},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{style:{"background-color":"var(--ion-color-light)"},slot:"start"}),(0,a.Wm)(u,{animated:"",style:{width:"100%"}}),(0,a.Wm)(d,{style:{"background-color":"var(--ion-color-light)"},slot:"end"})])),_:2},1024))),64))])),_:1})):(null===(t=l.cardList)||void 0===t?void 0:t.length)>0?((0,a.wg)(),(0,a.j4)(p,{key:1},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.cardList,((t,e)=>((0,a.wg)(),(0,a.j4)(m,{key:t.order_id,button:""},{default:(0,a.w5)((()=>["mir"==t.card_type?((0,a.wg)(),(0,a.j4)(g,{key:0,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==t.card_type?((0,a.wg)(),(0,a.j4)(g,{key:1,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==t.card_type?((0,a.wg)(),(0,a.j4)(g,{key:2,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):((0,a.wg)(),(0,a.j4)(d,{key:3,src:s.cardOutline,slot:"start",color:"primary"},null,8,["src"])),(0,a.Wm)(h,{onClick:n=>0!=e&&c.itemMainSet(t.card_id),class:(0,i.C_)(0==e?"is_main":"")},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(t.card_mask),1)])),_:2},1032,["onClick","class"]),(0,a.Wm)(d,{icon:s.trashOutline,slot:"end",onClick:e=>c.itemDelete(t.card_id)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):((0,a.wg)(),(0,a.j4)(p,{key:2},{default:(0,a.w5)((()=>[(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{color:"medium"},{default:(0,a.w5)((()=>[o])),_:1})])),_:1})])),_:1})),(0,a.Wm)(m,{button:"",onClick:e[0]||(e[0]=t=>c.cardRegistrationOpen())},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{icon:s.addOutline,slot:"start"},null,8,["icon"]),r])),_:1})]})),_:1})}var l=n(8534),c=n(2066),d=n(8903),u=n(5265),m=n(9042),p=n(9755),g=n.n(p),h={components:{IonList:c.q_,IonItem:c.Ie,IonSkeletonText:c.CK,IonLabel:c.Q$,IonIcon:c.gu,IonImg:c.Xz},setup(){return{cardOutline:d.pvm,addOutline:d.s6O,trashOutline:d.gtu}},data(){return{cardList:null,isOpen:!1,billLink:""}},methods:{listGet(){var t=this;return(0,l.Z)((function*(){try{t.cardList=yield g().post(t.$heap.state.hostname+"UserCards/listGet")}catch(e){}}))()},itemMainSet(t){var e=this;return(0,l.Z)((function*(){const n={card_id:t};try{yield g().post(`${e.$heap.state.hostname}UserCards/itemMainSet`,n),e.listGet()}catch(a){}}))()},itemDelete(t){var e=this;return(0,l.Z)((function*(){if(!confirm("Вы уверенны?"))return;const n={card_id:t};try{yield g().post(`${e.$heap.state.hostname}UserCards/itemDelete`,n),e.listGet()}catch(a){e.flash("Не удалось открепить карту")}}))()},cardRegistrationOpen(){var t=this;return(0,l.Z)((function*(){const e="card_registering",n=t,a=yield c.Fy.create({component:u.Z,componentProps:{order_data:e},initialBreakpoint:.85,breakpoints:[0,.85,.95]}),i=function(){a.dismiss()};return m.Z.on("dismissModal",i),a.onDidDismiss().then((()=>{n.cardRegistrationCheck()})),a.present()}))()},cardRegistrationCheck(){var t=this;return(0,l.Z)((function*(){try{const e=yield g().post(t.$heap.state.hostname+"CardAcquirer/cardRegisterActivate");"ok"==e&&(t.$flash("Карта успешно привязана"),t.listGet())}catch(e){t.$flash("Не удалось привязать карту")}}))()}},mounted(){this.listGet()}},y=n(3744);const k=(0,y.Z)(h,[["render",s],["__scopeId","data-v-2e696c9d"]]);var f=k},659:function(t,e,n){t.exports=n.p+"img/loading.30880178.svg"}}]);
//# sourceMappingURL=2956-legacy.69f0ac87.js.map