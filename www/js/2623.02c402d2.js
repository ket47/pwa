"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[2623],{2623:function(t,i,e){e.r(i),e.d(i,{default:function(){return f}});var n=e(641),l=e(33);const a=t=>((0,n.Qi)("data-v-7aeae358"),t=t(),(0,n.jt)(),t),o=a((()=>(0,n.Lk)("br",null,null,-1))),s={slot:"end"};function u(t,i,e,a,u,r){const d=(0,n.g2)("ion-icon"),c=(0,n.g2)("ion-label"),g=(0,n.g2)("ion-item"),m=(0,n.g2)("ion-list"),p=(0,n.g2)("ion-badge"),h=(0,n.g2)("ion-segment-button"),k=(0,n.g2)("ion-segment"),f=(0,n.g2)("ion-searchbar"),_=(0,n.g2)("ion-note"),b=(0,n.g2)("ion-text"),v=(0,n.g2)("ion-chip"),y=(0,n.g2)("ion-button"),F=(0,n.g2)("ion-content"),L=(0,n.g2)("ion-popover"),w=(0,n.g2)("base-layout");return(0,n.uX)(),(0,n.Wv)(w,{pageDefaultBackLink:"/user","page-title":"Рассылка"},{default:(0,n.k6)((()=>[(0,n.bF)(m,null,{default:(0,n.k6)((()=>[(0,n.bF)(g,{button:"",onClick:i[0]||(i[0]=t=>r.itemCreate())},{default:(0,n.k6)((()=>[(0,n.bF)(d,{slot:"start",src:a.addOutline},null,8,["src"]),(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.eW)("Добавить Рассылку")])),_:1})])),_:1})])),_:1}),(0,n.bF)(k,{value:"blank",scrollable:"","swipe-gesture":"true",modelValue:u.mailingType,"onUpdate:modelValue":i[1]||(i[1]=t=>u.mailingType=t)},{default:(0,n.k6)((()=>[(0,n.bF)(h,{value:"blank"},{default:(0,n.k6)((()=>[(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.eW)("Неопубликованные "),(0,n.bF)(p,null,{default:(0,n.k6)((()=>{var t;return[(0,n.eW)((0,l.v_)(null===(t=u.mailingListGrouped.blank)||void 0===t?void 0:t.length),1)]})),_:1})])),_:1})])),_:1}),(0,n.bF)(h,{value:"finished"},{default:(0,n.k6)((()=>[(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.eW)("Завершённые "),(0,n.bF)(p,null,{default:(0,n.k6)((()=>{var t;return[(0,n.eW)((0,l.v_)(null===(t=u.mailingListGrouped.finished)||void 0===t?void 0:t.length),1)]})),_:1})])),_:1})])),_:1}),(0,n.bF)(h,{value:"repeated"},{default:(0,n.k6)((()=>[(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.eW)("Регулярные "),(0,n.bF)(p,{slot:"end",color:"primary"},{default:(0,n.k6)((()=>{var t;return[(0,n.eW)((0,l.v_)(null===(t=u.mailingListGrouped.repeated)||void 0===t?void 0:t.length),1)]})),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.bF)(m,null,{default:(0,n.k6)((()=>[(0,n.bF)(f,{placeholder:"Фильтр","show-clear-button":"always",modelValue:u.filter,"onUpdate:modelValue":i[2]||(i[2]=t=>u.filter=t),onIonInput:i[3]||(i[3]=t=>r.listFilter())},null,8,["modelValue"]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(u.mailingListActive,(i=>((0,n.uX)(),(0,n.Wv)(g,{key:i.mailing_id},{default:(0,n.k6)((()=>[(0,n.bF)(c,{onClick:e=>t.$go(`/admin/mailing-edit-${i.mailing_id}`)},{default:(0,n.k6)((()=>{var t;return["finished"==i.mailing_type?((0,n.uX)(),(0,n.Wv)(_,{key:0,color:"medium",class:"ion-text-wrap",style:{"font-size":"12px"}},{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(i.start_at_humanized),1)])),_:2},1024)):(0,n.Q3)("",!0),o,(0,n.bF)(b,null,{default:(0,n.k6)((()=>[(0,n.eW)((0,l.v_)(i.subject_template),1)])),_:2},1024),(0,n.Lk)("div",null,["push"==i.transport?((0,n.uX)(),(0,n.Wv)(v,{key:0,icon:a.phonePortraitOutline,style:{"--background":"#6030ff","--color":"white","font-size":"12px"}},{default:(0,n.k6)((()=>[(0,n.eW)("push")])),_:1},8,["icon"])):"email"==i.transport?((0,n.uX)(),(0,n.Wv)(v,{key:1,icon:a.mailOutline,style:{"--background":"#ff6810","--color":"white","font-size":"12px"}},{default:(0,n.k6)((()=>[(0,n.eW)("e-mail")])),_:1},8,["icon"])):"sms"==i.transport?((0,n.uX)(),(0,n.Wv)(v,{key:2,icon:a.sendOutline,style:{"--background":"#00213f","--color":"white","font-size":"12px"}},{default:(0,n.k6)((()=>[(0,n.eW)("sms")])),_:1},8,["icon"])):"telegram"==i.transport?((0,n.uX)(),(0,n.Wv)(v,{key:3,icon:a.sendOutline,style:{"--background":"#0163aa","--color":"white","font-size":"12px"}},{default:(0,n.k6)((()=>[(0,n.eW)("telegram")])),_:1},8,["icon"])):(0,n.Q3)("",!0),(null===(t=i.recieverCount)||void 0===t?void 0:t.all)>0?((0,n.uX)(),(0,n.Wv)(v,{key:4},{default:(0,n.k6)((()=>[(0,n.eW)("Всего "+(0,l.v_)(i.recieverCount.all),1)])),_:2},1024)):(0,n.Q3)("",!0)])]})),_:2},1032,["onClick"]),(0,n.Lk)("div",s,[(0,n.bF)(y,{id:`click-trigger-${i.mailing_id}`,fill:"clear"},{default:(0,n.k6)((()=>[(0,n.bF)(d,{slot:"icon-only",icon:a.ellipsisVertical},null,8,["icon"])])),_:2},1032,["id"]),(0,n.bF)(L,{trigger:`click-trigger-${i.mailing_id}`,"trigger-action":"click","dismiss-on-select":!0,"show-backdrop":!1},{default:(0,n.k6)((()=>[(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(m,{lines:"full",class:"ion-no-padding"},{default:(0,n.k6)((()=>[(0,n.bF)(g,{button:"",onClick:e=>t.$go(`/admin/mailing-edit-${i.mailing_id}`)},{default:(0,n.k6)((()=>[(0,n.bF)(d,{slot:"end",icon:a.pencil},null,8,["icon"]),(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.eW)("Редактировать")])),_:1})])),_:2},1032,["onClick"]),(0,n.bF)(g,{button:"",onClick:t=>r.itemCopy(i.mailing_id)},{default:(0,n.k6)((()=>[(0,n.bF)(d,{slot:"end",icon:a.copyOutline},null,8,["icon"]),(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.eW)("Дублировать")])),_:1})])),_:2},1032,["onClick"]),(0,n.bF)(g,{button:"",onClick:t=>r.itemDelete(i.mailing_id)},{default:(0,n.k6)((()=>[(0,n.bF)(d,{slot:"end",icon:a.trash,color:"danger"},null,8,["icon"]),(0,n.bF)(c,{color:"danger"},{default:(0,n.k6)((()=>[(0,n.eW)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["trigger"])])])),_:2},1024)))),128))])),_:1})])),_:1})}e(4114),e(2712);var r=e(5654),d=e(5480),c=e(3201),g=e(2311),m=e.n(g),p={components:{IonList:r.nf,IonItem:r.uz,IonLabel:r.he,IonIcon:r.iq,IonNote:r.JI,IonText:r.IO,IonButton:r.Jm,IonSegment:r.Gp,IonSegmentButton:r.eP,IonSearchbar:r.S1,IonPopover:r.CF,IonContent:r.W9,IonBadge:r.In,IonChip:r.ZB},setup(){return{addOutline:d.EKF,checkmarkCircleOutline:d.gz2,ellipseOutline:d.zF,playOutline:d.zsx,locationOutline:d.UN$,phonePortraitOutline:d.g_S,copyOutline:d.cwK,mailOutline:d.SM1,repeatOutline:d.SaP,sendOutline:d.NF$,ellipsisVertical:d.Q9m,pencil:d.wzV,trash:d.dco}},data(){return{openedAccordion:"message",filter:"",mailingType:"blank",mailingList:[],mailingListGrouped:[],mailingListActive:[],isMailingOpen:!1,saveClock:null}},computed:{},methods:{async itemCreate(){const t={subject_template:"Без названия"};try{const i=await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemCreate`,t);this.$go(`/admin/mailing-edit-${i}`)}catch{}},async itemCopy(t){const i={mailing_id:t};try{await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemCopy`,i);this.listGet()}catch{}},async itemDelete(t){if(!confirm("Вы уверенны?"))return;const i={mailing_id:t};try{await m().post(`${this.$heap.state.hostname}Admin/Mailing/itemDelete`,i),this.isMailingOpen=!1,this.listGet()}catch{}},async listGet(){this.mailingType,this.filter;this.mailingList=await c.A.prePost(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{});try{for(var t in this.mailingList=await c.A.post(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{}),this.mailingList)this.mailingList[t].start_at_humanized=this.dateHumanize(this.mailingList[t].start_at),this.mailingList[t].mailing_type=0!=this.mailingList[t].regular_group?"repeated":"1"==this.mailingList[t].is_started?"finished":"blank";this.mailingList.sort((function(t,i){return new Date(i.created_at)-new Date(t.created_at)})),this.listGroup(),this.listFilter()}catch(i){}},listGroup(){this.mailingListGrouped=this.mailingList.reduce((function(t,i){return(t[i["mailing_type"]]=t[i["mailing_type"]]||[]).push(i),t}),{})},listFilter(){this.mailingListActive=this.mailingListGrouped[this.mailingType],this.filter&&(this.mailingListActive=this.mailingListActive.filter((t=>-1!==t.subject_template.toLowerCase().indexOf(this.filter.toLowerCase()))))},dateHumanize(t){var i,e=Math.round((+new Date-new Date(t))/1e3),n=60,l=60*n,a=24*l;return i=e<30?"Только что.":e<n?e+" сукунд назад.":e<2*n?"минуту назад.":e<l?Math.floor(e/n)+" минут назад.":1==Math.floor(e/l)?"Час назад.":e<a?Math.floor(e/l)+" часов назад.":e<2*a?"Вчера":new Date(t).toLocaleString("ru",{day:"numeric",month:"long"}),i}},ionViewDidEnter(){this.listGet()},watch:{mailingType(){this.listFilter()}}},h=e(6262);const k=(0,h.A)(p,[["render",u],["__scopeId","data-v-7aeae358"]]);var f=k}}]);
//# sourceMappingURL=2623.02c402d2.js.map