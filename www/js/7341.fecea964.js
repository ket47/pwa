"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[7341],{9861:function(t,e,r){r.r(e),r.d(e,{default:function(){return h}});var o=r(641);function i(t,e,r,i,a,s){const n=(0,o.g2)("shipment-draft-comp"),d=(0,o.g2)("base-layout");return(0,o.uX)(),(0,o.Wv)(d,{"page-title":"Вызов курьера"},{default:(0,o.k6)(()=>[(0,o.bF)(n,{orderData:a.order,onStageCreate:s.onStageCreate,onOrderUpdate:s.itemUpdate,onLocationUpdate:s.locationUpdate},null,8,["orderData","onStageCreate","onOrderUpdate","onLocationUpdate"])]),_:1})}r(4114);var a=r(2311),s=r.n(a),n=r(1723),d={components:{ShipmentDraftComp:n.A},data(){return{order:null,errorCode:null}},methods:{async itemCreate(){const t=new Date,e={order_store_id:null,order_id:0,entries:[],created_at:t.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.itemSave(e)},async itemLoad(){try{const t=JSON.parse(localStorage.shipmentDraft);if(t&&this.$heap.getters.userIsLogged)return t.deliveryCalculation=await this.itemTotalEstimate(t.order_start_location_id,t.order_finish_location_id),void(this.order=t)}catch{}this.itemCreate()},itemSave(t){this.order=t,localStorage.shipmentDraft=JSON.stringify(Object.assign({},t,{order_id:0}))},async itemUpdate(t){console.log(t.mode,t.order_start_location_id,t.order_finish_location_id),"refreshTotalEstimates"==t.mode&&(t.deliveryCalculation=await this.itemTotalEstimate(t.order_start_location_id,t.order_finish_location_id)),this.itemSave(Object.assign({},this.order,t))},async locationUpdate(t){try{await s().post(`${this.$heap.state.hostname}Location/itemUpdate`,JSON.stringify(t)),this.$flash("сохранено")}catch{}},async itemTotalEstimate(t,e){if(!t||!e)return;const r={start_location_id:t,finish_location_id:e};try{return await s().post(`${this.$heap.state.hostname}Shipment/itemDeliverySumEstimate`,r)}catch(o){}},async onStageCreate(t,e){if("customer_purged"!=e&&"customer_deleted"!=e){"customer_action_confirm"==e&&(e="customer_confirmed");try{const t={is_shopping:0,order_id:this.order.order_id??null,order_description:this.order.order_description,order_start_location_id:this.order.order_start_location_id,order_finish_location_id:this.order.order_finish_location_id,order_sum_delivery:this.order.deliveryCalculation.sum},e=await s().post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(t));e>0&&this.$router.push(`/modal/shipment-checkout-${e}`)}catch(i){var r,o;const e=null===i||void 0===i||null===(r=i.responseJSON)||void 0===r||null===(o=r.messages)||void 0===o?void 0:o.error;if(!e)return!1;switch(e){case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+t;break}return!1}}else{localStorage.removeItem("shipmentDraft"),this.$router.replace("/order/order-list");try{const t={order_id:this.order.order_id,new_stage:e};await s().post(`${this.$heap.state.hostname}Shipment/itemStageCreate`,t)}catch{}}}},mounted(){this.itemLoad()}},c=r(6262);const l=(0,c.A)(d,[["render",i]]);var h=l}}]);
//# sourceMappingURL=7341.fecea964.js.map