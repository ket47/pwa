"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[5009],{5432:function(t,e,o){o.d(e,{A:function(){return _}});var a=o(641),i=o(33);const n={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},s={slot:"end",style:{color:"#666"}};function l(t,e,o,l,c,r){const d=(0,a.g2)("ymap-marker"),u=(0,a.g2)("yandex-map"),h=(0,a.g2)("ion-searchbar"),p=(0,a.g2)("ion-item"),m=(0,a.g2)("ion-content"),_=(0,a.g2)("ion-textarea"),g=(0,a.g2)("ion-icon"),k=(0,a.g2)("ion-button"),f=(0,a.g2)("ion-toolbar");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(m,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,{onClick:e[0]||(e[0]=t=>r.onClick(t)),style:{height:"100%"},coords:c.coords,zoom:16,settings:c.settings,controls:["zoomControl"]},{default:(0,a.k6)((()=>[(0,a.bF)(d,{coords:c.coords,"marker-id":"1",properties:c.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,a.Lk)("div",n,[(0,a.bF)(h,{debounce:"500",modelValue:c.addressSearchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>c.addressSearchQuery=t),onIonInput:e[2]||(e[2]=t=>r.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(c.suggestions,((t,e)=>((0,a.uX)(),(0,a.Wv)(p,{key:e,onClick:e=>r.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(t.subtitle.text)+" "+(0,i.v_)(t.title.text)+" ",1),(0,a.Lk)("span",s,(0,i.v_)(t.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.bF)(_,{label:"комментарий к адресу","label-placement":"floating",modelValue:c.addressComment,"onUpdate:modelValue":e[3]||(e[3]=t=>c.addressComment=t)},null,8,["modelValue"]),(0,a.bF)(k,{strong:!0,onClick:e[4]||(e[4]=t=>r.pickAddress()),color:"primary",expand:"block"},{default:(0,a.k6)((()=>[(0,a.bF)(g,{src:l.checkmark,slot:"start"},null,8,["src"]),(0,a.eW)(" Ок ")])),_:1}),(0,a.bF)(k,{onClick:e[5]||(e[5]=t=>l.closeModal()),color:"light",expand:"block"},{default:(0,a.k6)((()=>[(0,a.eW)("Закрыть")])),_:1})])),_:1})],64)}o(4114);var c=o(5654),r=o(5221),d=o(5480),u=o(8701),h={components:{IonContent:c.W9,IonToolbar:c.ai,IonButton:c.Jm,IonSearchbar:c.S1,IonIcon:c.iq,IonItem:c.uz,IonTextarea:c.nc,yandexMap:r.IK,ymapMarker:r.cT},setup(){const t=function(){c.OZ.dismiss()};return{closeModal:t,locationOutline:d.UN$,closeOutline:d.xfX,checkmark:d.AIp}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",e=this.$heap.state.settings.location,o=JSON.parse(e.mapCenter);return{settings:{apiKey:e.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationType:t,locSettings:e,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o,addressComment:""}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t;const e=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=e.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(o){}var e={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};c.OZ.dismiss(e)},filterAddress(t){const e=this.locSettings.addressErase.split(", "),o=t.split(", ");let a=[];for(const i of o)e.find((t=>t==i))||a.push(i);return a.reverse().join(", ")},onClick(t){t&&t.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,e=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${e}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),a=await o.json();this.suggestions=a.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(t,e){this.selectedAddress=t,this.geocode(e)},async geocode(t){try{this.suggestions=[];const e=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${e}&format=json&results=1&uri=${t}`),a=await o.json(),i=a.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=i.Point.pos.split(" ").reverse()}catch(e){console.log(e)}}},async mounted(){await(0,r.wc)();const t=u.A.geo.lastStoredGet();null!==t&&void 0!==t&&t.location_latitude&&(this.coords=[t.location_latitude,t.location_longitude]);const e=await u.A.geo.get();if(this.markDeviceOnMap&&e){const{coords:t}=e;this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}}},p=o(6262);const m=(0,p.A)(h,[["render",l]]);var _=m},5009:function(t,e,o){o.r(e),o.d(e,{default:function(){return v}});var a=o(641),i=o(33);const n=t=>((0,a.Qi)("data-v-7a88f030"),t=t(),(0,a.jt)(),t),s={style:{color:"var(--ion-color-primary)"}},l=n((()=>(0,a.Lk)("p",null,"Вы пока не добавили адрес доставки заказа.",-1))),c=n((()=>(0,a.Lk)("p",null,"Для поиска ресторанов и магазинов будет использоваться адрес по умолчанию.",-1)));function r(t,e,o,n,r,d){const u=(0,a.g2)("ion-card-title"),h=(0,a.g2)("ion-card-header"),p=(0,a.g2)("ion-card-content"),m=(0,a.g2)("ion-card"),_=(0,a.g2)("ion-img"),g=(0,a.g2)("ion-label"),k=(0,a.g2)("ion-item"),f=(0,a.g2)("ion-icon"),y=(0,a.g2)("ion-chip"),b=(0,a.g2)("ion-list"),v=(0,a.g2)("ion-list-header"),C=(0,a.g2)("base-layout");return(0,a.uX)(),(0,a.Wv)(C,{"page-title":"Мои адреса",ref:"UserAddressPage"},{default:(0,a.k6)((()=>[d.mainAddress?((0,a.uX)(),(0,a.Wv)(m,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)(" Адрес доставки заказа ")])),_:1})])),_:1}),(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.Lk)("p",null,[(0,a.Lk)("b",s,(0,i.v_)(d.mainAddress.location_address),1),(0,a.eW)(", выбран как адрес доставки заказов.")])])),_:1})])),_:1})):((0,a.uX)(),(0,a.Wv)(m,{key:1},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,null,{default:(0,a.k6)((()=>[(0,a.eW)(" Адрес не установлен ")])),_:1})])),_:1}),(0,a.bF)(p,null,{default:(0,a.k6)((()=>[l,c])),_:1})])),_:1})),r.locationList.length?((0,a.uX)(),(0,a.Wv)(b,{key:2,lines:"none"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.locationList,((o,s)=>((0,a.uX)(),(0,a.CE)("div",{key:o.location_id},[(0,a.bF)(k,{button:"",detail:"",onClick:t=>d.locationSetMain(`${o.location_id}`,`${s}`)},{default:(0,a.k6)((()=>[(0,a.bF)(_,{slot:"start",alt:"location icon",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,a.bF)(g,{style:{"white-space":"normal",cursor:"pointer"},class:(0,i.C4)(1==o.is_main?"is_main":"")},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(o.location_address),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"]),1==o.is_main?((0,a.uX)(),(0,a.Wv)(k,{key:0,lines:"full"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",null,[o.location_comment?((0,a.uX)(),(0,a.CE)("div",{key:0,onClick:e[0]||(e[0]=t=>d.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"15px",display:"inline-block"}},(0,i.v_)(o.location_comment),1)):((0,a.uX)(),(0,a.Wv)(y,{key:1,color:"medium",onClick:e[1]||(e[1]=t=>d.locationCommentEdit("locationStart"))},{default:(0,a.k6)((()=>[(0,a.bF)(f,{src:n.addOutline},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("комментарий")])),_:1})])),_:1})),o.location_phone>0?((0,a.uX)(),(0,a.Wv)(y,{key:2,color:"medium",onClick:e[2]||(e[2]=t=>d.locationPhoneEdit("locationStart"))},{default:(0,a.k6)((()=>[(0,a.bF)(f,{src:n.callOutline},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(o.location_phone),1)])),_:2},1024)])),_:2},1024)):((0,a.uX)(),(0,a.Wv)(y,{key:3,color:"medium",onClick:e[3]||(e[3]=t=>d.locationPhoneEdit("locationStart"))},{default:(0,a.k6)((()=>[(0,a.bF)(f,{src:n.addOutline},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("телефон")])),_:1})])),_:1}))]),(0,a.bF)(f,{slot:"end",icon:n.trashOutline,onClick:t=>d.locationDelete(`${o.location_id}`,`${s}`),color:"medium"},null,8,["icon","onClick"])])),_:2},1024)):(0,a.Q3)("",!0)])))),128))])),_:1})):(0,a.Q3)("",!0),(0,a.bF)(b,null,{default:(0,a.k6)((()=>[(0,a.bF)(v,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Добавить адрес")])),_:1})])),_:1}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.locationGroupList,(e=>((0,a.uX)(),(0,a.Wv)(k,{key:e.group_id,onClick:t=>d.modalLocationCreate(`${e.group_id}`,`${e.group_name}`),style:{cursor:"pointer"}},{default:(0,a.k6)((()=>[(0,a.bF)(_,{src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.group_name),1)])),_:2},1024),(0,a.bF)(f,{src:n.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},512)}var d=o(5654),u=o(2327),h=o(5538),p=o(8701),m=o(2311),_=o.n(m),g=o(5432),k=o(5480),f={name:"UserAddresses",components:{IonImg:d.KW,IonLabel:d.he,IonItem:d.uz,IonList:d.nf,IonListHeader:d.AF,IonIcon:d.iq,IonCard:d.b_,IonCardHeader:d.ME,IonCardContent:d.I9,IonCardTitle:d.tN,IonChip:d.ZB},setup(){return{locationOutline:k.UN$,trashOutline:k.P1A,addOutline:k.EKF,callOutline:k.bNN}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{async modalLocationCreate(t,e){if(!h.A.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/modal/user-authorize"));var o=String(e).toLowerCase();const a=await d.OZ.create({component:g.A,showBackdrop:!0,componentProps:{location_group_name_low:o}});return a.onDidDismiss().then((e=>{this.locationCreate(t,e.data)})),a.present()},async locationListGet(){try{var t,e;let o=null;const a=await _().get(h.A.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=a.location_list,this.locationGroupList=a.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(o=t);if(!o)return void p.A.get();o&&(null===(t=o)||void 0===t?void 0:t.location_id)!=(null===(e=h.A.state.user.location_main)||void 0===e?void 0:e.location_id)&&(h.A.state.user.location_main=o,this.$topic.publish("userMainLocationSet",h.A.state.user.location_main))}catch{}},async locationCreate(t,e){if(!e)return;let o={location_holder:"user",location_holder_id:h.A.state.user.user_id,location_group_id:t,location_address:e.location_address,location_latitude:e.location_latitude,location_longitude:e.location_longitude,location_comment:e.location_comment};try{await _().post(h.A.state.hostname+"User/locationCreate",o),this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(a){const t=a.responseJSON,e=t.messages.error;switch(e){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,e){const o=this.locationList[e];h.A.state.user.location_main={location_id:o.location_id,location_latitude:o.location_latitude,location_longitude:o.location_longitude,location_address:o.location_address,image_hash:o.image_hash},await _().post(h.A.state.hostname+"User/locationSetMain",{location_id:t}),this.$topic.publish("userMainLocationSet",h.A.state.user.location_main),this.$flash("Адрес доставки изменен"),this.$heap.state.next_route?(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null):this.locationListGet()},async locationDelete(t,e){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(e,1),await _().post(h.A.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()}},async locationCurrentSet(){const t=await d.FJ.create({message:"Определяем ваше местоположение"});t.present();try{await p.A.geo.locationCurrentGet(),this.$flash("Ваше местоположение определено")}catch(e){this.$flash("Не удалось получить ваше местоположение")}t.dismiss(),u.A.go(-1)},async locationUpdate(t){await _().post(h.A.state.hostname+"Location/itemUpdate",JSON.stringify(t)),this.$flash("Сохранено"),this.locationListGet()},async locationPhoneEdit(t){var e;let o=null!==(e=h.A.state.user.location_main.location_phone)&&void 0!==e?e:"";const a=await d.TN.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:o}]});try{await a.present();const{data:t,role:e}=await a.onDidDismiss();if("confirm"==e&&(o=t.values.phone.replace(/\D/g,"").replace(/^7/,""),o)){if(10!=o.length)return void this.$flash("Проверьте правильность телефона");o="+7"+o}"cancel"==e&&(o=""),h.A.state.user.location_main.location_phone=o;const i={location_id:h.A.state.user.location_main.location_id,location_phone:o};this.locationUpdate(i)}catch(i){console.log(i)}},async locationCommentEdit(t){var e;let o=null!==(e=h.A.state.user.location_main.location_comment)&&void 0!==e?e:"";const a=await d.TN.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:o}]});try{await a.present();const{data:t,role:e}=await a.onDidDismiss();o=t.values.comment,"cancel"==e&&(o=""),h.A.state.user.location_main.location_comment=o;const i={location_id:h.A.state.user.location_main.location_id,location_comment:o};this.locationUpdate(i)}catch(i){console.log(i)}}},data(){return{locationList:[],locationGroupList:[]}}},y=o(6262);const b=(0,y.A)(f,[["render",r],["__scopeId","data-v-7a88f030"]]);var v=b}}]);
//# sourceMappingURL=5009.06a3226b.js.map