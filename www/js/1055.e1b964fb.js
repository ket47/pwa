"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[1055],{1055:function(e,t,i){i.r(t),i.d(t,{default:function(){return p}});i(8111),i(2489);var l=i(641),a=i(33);const n={slot:"end"};function o(e,t,i,o,u,r){const s=(0,l.g2)("ion-badge"),d=(0,l.g2)("ion-label"),c=(0,l.g2)("ion-segment-button"),m=(0,l.g2)("ion-segment"),_=(0,l.g2)("ion-icon"),g=(0,l.g2)("ion-item"),p=(0,l.g2)("ion-select-option"),f=(0,l.g2)("ion-select"),h=(0,l.g2)("ion-searchbar"),v=(0,l.g2)("ion-list"),k=(0,l.g2)("ion-item-divider"),b=(0,l.g2)("ion-note"),y=(0,l.g2)("ion-text"),F=(0,l.g2)("ion-chip"),W=(0,l.g2)("ion-button"),L=(0,l.g2)("ion-content"),I=(0,l.g2)("ion-popover"),C=(0,l.g2)("base-layout");return(0,l.uX)(),(0,l.Wv)(C,{pageDefaultBackLink:"/user","page-title":"Рассылка"},{default:(0,l.k6)(()=>[(0,l.bF)(m,{value:"blank",scrollable:"","swipe-gesture":"true",modelValue:u.filter.mailing_type.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.filter.mailing_type.value=e)},{default:(0,l.k6)(()=>[(0,l.bF)(c,{value:"blank"},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[t[8]||(t[8]=(0,l.eW)("Неопубликованные ")),(0,l.bF)(s,null,{default:(0,l.k6)(()=>{var e;return[(0,l.eW)((0,a.v_)(null===(e=u.mailingListGrouped.blank)||void 0===e?void 0:e.length),1)]}),_:1})]),_:1,__:[8]})]),_:1}),(0,l.bF)(c,{value:"finished"},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[t[9]||(t[9]=(0,l.eW)("Завершённые ")),(0,l.bF)(s,null,{default:(0,l.k6)(()=>{var e;return[(0,l.eW)((0,a.v_)(null===(e=u.mailingListGrouped.finished)||void 0===e?void 0:e.length),1)]}),_:1})]),_:1,__:[9]})]),_:1}),(0,l.bF)(c,{value:"repeated"},{default:(0,l.k6)(()=>[(0,l.bF)(d,null,{default:(0,l.k6)(()=>[t[10]||(t[10]=(0,l.eW)("Регулярные ")),(0,l.bF)(s,{slot:"end",color:"primary"},{default:(0,l.k6)(()=>{var e;return[(0,l.eW)((0,a.v_)(null===(e=u.mailingListGrouped.repeated)||void 0===e?void 0:e.length),1)]}),_:1})]),_:1,__:[10]})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(v,null,{default:(0,l.k6)(()=>[(0,l.bF)(g,{lines:"none",button:"",onClick:t[1]||(t[1]=e=>r.itemCreate())},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"start",src:o.addOutline},null,8,["src"]),(0,l.bF)(d,null,{default:(0,l.k6)(()=>t[11]||(t[11]=[(0,l.eW)("Добавить Рассылку")])),_:1,__:[11]})]),_:1}),(0,l.bF)(g,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"start",src:o.mailOutline},null,8,["src"]),(0,l.bF)(f,{placeholder:"Транспорт",label:"Фильтр по типу",modelValue:u.filter.transport.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.filter.transport.value=e),onIonChange:t[3]||(t[3]=e=>r.listFilter()),multiple:u.filter.transport.multiple},{default:(0,l.k6)(()=>[(0,l.bF)(p,{value:"push"},{default:(0,l.k6)(()=>t[12]||(t[12]=[(0,l.eW)("Push")])),_:1,__:[12]}),(0,l.bF)(p,{value:"email"},{default:(0,l.k6)(()=>t[13]||(t[13]=[(0,l.eW)("Email")])),_:1,__:[13]}),(0,l.bF)(p,{value:"telegram"},{default:(0,l.k6)(()=>t[14]||(t[14]=[(0,l.eW)("Telegram")])),_:1,__:[14]}),(0,l.bF)(p,{value:"sms"},{default:(0,l.k6)(()=>t[15]||(t[15]=[(0,l.eW)("Sms")])),_:1,__:[15]})]),_:1},8,["modelValue","multiple"])]),_:1}),"repeated"==u.filter.mailing_type.value?((0,l.uX)(),(0,l.Wv)(g,{key:0,lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(f,{placeholder:"Группа рассылок",label:"Группа рассылок",modelValue:u.filter.regular_group.value,"onUpdate:modelValue":t[4]||(t[4]=e=>u.filter.regular_group.value=e),onIonChange:t[5]||(t[5]=e=>r.listFilter()),multiple:u.filter.regular_group.multiple},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.regularGroupTranslation,(e,t)=>((0,l.uX)(),(0,l.Wv)(p,{value:t,key:e},{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(e),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","multiple"])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(g,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(h,{placeholder:"Поиск","show-clear-button":"always",modelValue:u.filter.subject_template.value,"onUpdate:modelValue":t[6]||(t[6]=e=>u.filter.subject_template.value=e),onIonInput:t[7]||(t[7]=e=>r.listFilter())},null,8,["modelValue"])]),_:1})]),_:1}),(0,l.bF)(k,null,{default:(0,l.k6)(()=>t[16]||(t[16]=[(0,l.eW)(" Рассылки ")])),_:1,__:[16]}),u.mailingListActive?((0,l.uX)(),(0,l.Wv)(v,{key:0},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.mailingListActive,i=>((0,l.uX)(),(0,l.Wv)(g,{key:`${i.subject_template}_${i.mailing_id}`},{default:(0,l.k6)(()=>[(0,l.bF)(d,{onClick:t=>e.$go(`/admin/mailing-edit-${i.mailing_id}`)},{default:(0,l.k6)(()=>{var e;return["finished"==i.mailing_type?((0,l.uX)(),(0,l.Wv)(b,{key:0,color:"medium",class:"ion-text-wrap",style:{"font-size":"12px"}},{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(i.start_at_humanized),1)]),_:2},1024)):(0,l.Q3)("",!0),t[21]||(t[21]=(0,l.Lk)("br",null,null,-1)),(0,l.bF)(y,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(i.subject_template),1)]),_:2},1024),(0,l.Lk)("div",null,["push"==i.transport?((0,l.uX)(),(0,l.Wv)(F,{key:0,icon:o.phonePortraitOutline,style:{"--background":"#6030ff","--color":"white","font-size":"12px"}},{default:(0,l.k6)(()=>t[17]||(t[17]=[(0,l.eW)("push")])),_:1,__:[17]},8,["icon"])):"email"==i.transport?((0,l.uX)(),(0,l.Wv)(F,{key:1,icon:o.mailOutline,style:{"--background":"#ff6810","--color":"white","font-size":"12px"}},{default:(0,l.k6)(()=>t[18]||(t[18]=[(0,l.eW)("e-mail")])),_:1,__:[18]},8,["icon"])):"sms"==i.transport?((0,l.uX)(),(0,l.Wv)(F,{key:2,icon:o.sendOutline,style:{"--background":"#00213f","--color":"white","font-size":"12px"}},{default:(0,l.k6)(()=>t[19]||(t[19]=[(0,l.eW)("sms")])),_:1,__:[19]},8,["icon"])):"telegram"==i.transport?((0,l.uX)(),(0,l.Wv)(F,{key:3,icon:o.sendOutline,style:{"--background":"#0163aa","--color":"white","font-size":"12px"}},{default:(0,l.k6)(()=>t[20]||(t[20]=[(0,l.eW)("telegram")])),_:1,__:[20]},8,["icon"])):(0,l.Q3)("",!0),(null===(e=i.recieverCount)||void 0===e?void 0:e.all)>0?((0,l.uX)(),(0,l.Wv)(F,{key:4},{default:(0,l.k6)(()=>[(0,l.eW)("Всего "+(0,a.v_)(i.recieverCount.all),1)]),_:2},1024)):(0,l.Q3)("",!0),"0"!==i.regular_group?((0,l.uX)(),(0,l.Wv)(F,{key:5,icon:o.sendOutline,style:{"--background":"var(--ion-color-primary)","--color":"white","font-size":"12px"}},{default:(0,l.k6)(()=>[(0,l.eW)((0,a.v_)(u.regularGroupTranslation[i.regular_group]),1)]),_:2},1032,["icon"])):(0,l.Q3)("",!0)])]}),_:2,__:[21]},1032,["onClick"]),(0,l.Lk)("div",n,[(0,l.bF)(W,{id:`click-trigger-${i.mailing_id}`,fill:"clear"},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"icon-only",icon:o.ellipsisVertical},null,8,["icon"])]),_:2},1032,["id"]),(0,l.bF)(I,{trigger:`click-trigger-${i.mailing_id}`,"trigger-action":"click","dismiss-on-select":!0,"show-backdrop":!1},{default:(0,l.k6)(()=>[(0,l.bF)(L,null,{default:(0,l.k6)(()=>[(0,l.bF)(v,{lines:"full",class:"ion-no-padding"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{button:"",onClick:t=>e.$go(`/admin/mailing-edit-${i.mailing_id}`)},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"end",icon:o.pencil},null,8,["icon"]),(0,l.bF)(d,null,{default:(0,l.k6)(()=>t[22]||(t[22]=[(0,l.eW)("Редактировать")])),_:1,__:[22]})]),_:2},1032,["onClick"]),(0,l.bF)(g,{button:"",onClick:e=>r.itemCopy(i.mailing_id)},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"end",icon:o.copyOutline},null,8,["icon"]),(0,l.bF)(d,null,{default:(0,l.k6)(()=>t[23]||(t[23]=[(0,l.eW)("Дублировать")])),_:1,__:[23]})]),_:2},1032,["onClick"]),(0,l.bF)(g,{button:"",onClick:e=>r.itemDelete(i.mailing_id)},{default:(0,l.k6)(()=>[(0,l.bF)(_,{slot:"end",icon:o.trash,color:"danger"},null,8,["icon"]),(0,l.bF)(d,{color:"danger"},{default:(0,l.k6)(()=>t[24]||(t[24]=[(0,l.eW)("Удалить")])),_:1,__:[24]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["trigger"])])]),_:2},1024))),128))]),_:1})):((0,l.uX)(),(0,l.Wv)(v,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(g,null,{default:(0,l.k6)(()=>t[25]||(t[25]=[(0,l.eW)("Список пуст")])),_:1,__:[25]})]),_:1}))]),_:1})}i(4114),i(8237);var u=i(5634),r=i(5480),s=i(3201),d=i(2311),c=i.n(d),m={components:{IonList:u.nf,IonItem:u.uz,IonLabel:u.he,IonIcon:u.iq,IonNote:u.JI,IonText:u.IO,IonButton:u.Jm,IonSegment:u.Gp,IonSegmentButton:u.eP,IonPopover:u.CF,IonContent:u.W9,IonBadge:u.In,IonChip:u.ZB,IonSelect:u.Nm,IonSelectOption:u.Ip,IonSearchbar:u.S1,IonItemDivider:u.Dg},setup(){return{addOutline:r.EKF,checkmarkCircleOutline:r.gz2,ellipseOutline:r.zF,playOutline:r.zsx,locationOutline:r.UN$,phonePortraitOutline:r.g_S,copyOutline:r.cwK,mailOutline:r.SM1,repeatOutline:r.SaP,sendOutline:r.NF$,ellipsisVertical:r.Q9m,pencil:r.wzV,trash:r.dco}},data(){return{openedAccordion:"message",filter:{transport:{value:"",multiple:!0},mailing_type:{value:"blank"},subject_template:{value:""},regular_group:{value:"",multiple:!0}},mailingList:[],mailingListGrouped:[],mailingListActive:[],isMailingOpen:!1,saveClock:null,regularGroupTranslation:{cart23:"Корзина брошена сутки","promo-10":"До конца скидки 10 дней","promo-3":"До конца скидки 3 дня","promo-1":"До конца скидки 1 день",forgot14:"Последний вход 2 недели назад",forgot30:"Последний вход месяц назад",forgot90:"Последний вход 3 месяца назад",every_monday:"Каждый понедельник",every_tuesday:"Каждый вторник",every_wednesday:"Каждую среду",every_thursday:"Каждый четверг",every_friday:"Каждую пятницу",every_saturday:"Каждую субботу",every_sunday:"Каждое воскресенье"}}},computed:{},methods:{async itemCreate(){const e={subject_template:""};try{const t=await c().post(`${this.$heap.state.hostname}Admin/Mailing/itemCreate`,e);this.$go(`/admin/mailing-edit-${t}`)}catch{}},async itemCopy(e){const t={mailing_id:e};try{await c().post(`${this.$heap.state.hostname}Admin/Mailing/itemCopy`,t),this.listGet()}catch{}},async itemDelete(e){if(!confirm("Вы уверены?"))return;const t={mailing_id:e};try{await c().post(`${this.$heap.state.hostname}Admin/Mailing/itemDelete`,t),this.isMailingOpen=!1,this.listGet()}catch{}},async listGet(){this.mailingList=await s.A.prePost(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{});try{for(var e in this.mailingList=await s.A.post(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{}),this.mailingList)this.mailingList[e].start_at_humanized=this.dateHumanize(this.mailingList[e].start_at),this.mailingList[e].mailing_type=0!=this.mailingList[e].regular_group?"repeated":"1"==this.mailingList[e].is_started?"finished":"blank";this.mailingList.sort(function(e,t){return new Date(t.created_at)-new Date(e.created_at)}),this.listGroup(),this.listFilter()}catch(t){}},listGroup(){this.mailingListGrouped=this.mailingList.reduce(function(e,t){return(e[t["mailing_type"]]=e[t["mailing_type"]]||[]).push(t),e},{})},listFilter(){if(this.mailingListActive=this.mailingListGrouped[this.filter.mailing_type.value],this.mailingListActive)for(var e in this.filter)if(this.filter[e]&&this.filter[e].value)if(this.filter[e].multiple){if(0==this.filter[e].value.length)continue;var t=[];for(const i in this.filter[e].value)t=t.concat(this.mailingListActive.filter(t=>t[e]==this.filter[e].value[i]));this.mailingListActive=t}else this.mailingListActive=this.mailingListActive.filter(t=>-1!==t[e].toLowerCase().indexOf(this.filter[e].value.toLowerCase()))},dateHumanize(e){var t,i=Math.round((+new Date-new Date(e))/1e3),l=60,a=60*l,n=24*a;return t=i<30?"Только что.":i<l?i+" сукунд назад.":i<2*l?"минуту назад.":i<a?Math.floor(i/l)+" минут назад.":1==Math.floor(i/a)?"Час назад.":i<n?Math.floor(i/a)+" часов назад.":i<2*n?"Вчера":new Date(e).toLocaleString("ru",{day:"numeric",month:"long"}),t}},ionViewDidEnter(){this.listGet()},watch:{"filter.mailing_type.value"(){this.filter.transport.value="",this.filter.regular_group.value="",this.filter.subject_template.value="",this.listFilter()}}},_=i(6262);const g=(0,_.A)(m,[["render",o],["__scopeId","data-v-6558d600"]]);var p=g}}]);
//# sourceMappingURL=1055.e1b964fb.js.map