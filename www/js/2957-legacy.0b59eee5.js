(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2957],{7850:function(e,t,o){var n=o(111),r=o(4326),i=o(5112),a=i("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==r(e))}},3123:function(e,t,o){"use strict";var n=o(2104),r=o(6916),i=o(1702),a=o(7007),l=o(7850),s=o(9670),d=o(4488),u=o(6707),c=o(1530),m=o(7466),p=o(1340),_=o(8173),f=o(1589),h=o(7651),g=o(2261),w=o(2999),k=o(7293),v=w.UNSUPPORTED_Y,y=4294967295,I=Math.min,W=[].push,b=i(/./.exec),D=i(W),C=i("".slice),j=!k((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var o="ab".split(e);return 2!==o.length||"a"!==o[0]||"b"!==o[1]}));a("split",(function(e,t,o){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,o){var i=p(d(this)),a=void 0===o?y:o>>>0;if(0===a)return[];if(void 0===e)return[i];if(!l(e))return r(t,i,e,a);var s,u,c,m=[],_=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,w=new RegExp(e.source,_+"g");while(s=r(g,w,i)){if(u=w.lastIndex,u>h&&(D(m,C(i,h,s.index)),s.length>1&&s.index<i.length&&n(W,m,f(s,1)),c=s[0].length,h=u,m.length>=a))break;w.lastIndex===s.index&&w.lastIndex++}return h===i.length?!c&&b(w,"")||D(m,""):D(m,C(i,h)),m.length>a?f(m,0,a):m}:"0".split(void 0,0).length?function(e,o){return void 0===e&&0===o?[]:r(t,this,e,o)}:t,[function(t,o){var n=d(this),a=void 0==t?void 0:_(t,e);return a?r(a,t,n,o):r(i,p(n),t,o)},function(e,n){var r=s(this),a=p(e),l=o(i,r,a,n,i!==t);if(l.done)return l.value;var d=u(r,RegExp),_=r.unicode,f=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(v?"g":"y"),g=new d(v?"^(?:"+r.source+")":r,f),w=void 0===n?y:n>>>0;if(0===w)return[];if(0===a.length)return null===h(g,a)?[a]:[];var k=0,W=0,b=[];while(W<a.length){g.lastIndex=v?0:W;var j,$=h(g,v?C(a,W):a);if(null===$||(j=I(m(g.lastIndex+(v?W:0)),a.length))===k)W=c(a,W,_);else{if(D(b,C(a,k,W)),b.length===w)return b;for(var O=1;O<=$.length-1;O++)if(D(b,$[O]),b.length===w)return b;W=k=j}}return D(b,C(a,k)),b}]}),!j,v)},4405:function(e,t,o){"use strict";o(4916),o(5306);var n=o(2008);const r={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const t=e.locations[0].distance,o=e.store_time_preparation||0;return r.deliveryTimeCalculate(t,o)},deliveryTimeCalculate(e,t){var o;t=parseInt(null!==(o=t)&&void 0!==o?o:n.Z.getters.settings.delivery.timePreparationDefault);const r=parseInt(n.Z.getters.settings.delivery.timeDelta),i=parseInt(n.Z.getters.settings.delivery.speed),a=5*Math.round(e/i*60/5)+t,l=a>r?a-r:a,s=l+r;return{time:a,timeMin:l,timeMax:s}},render(e,t){for(let o in t)e=e.replace(`{{${o}}}`,t[o]);return e=e.replace(/{{\.}}/,"-"),e}};t["Z"]=r},7327:function(e,t,o){"use strict";o.d(t,{Z:function(){return m}});var n=o(6252),r=o(3577);const i=(0,n.Uk)("Просмотр фотографии");function a(e,t,o,a,l,s){const d=(0,n.up)("ion-title"),u=(0,n.up)("ion-icon"),c=(0,n.up)("ion-toolbar"),m=(0,n.up)("ion-header"),p=(0,n.up)("ion-button"),_=(0,n.up)("ion-col"),f=(0,n.up)("ion-row"),h=(0,n.up)("ion-grid"),g=(0,n.up)("ion-img"),w=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,{color:"secondary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[i])),_:1}),(0,n.Wm)(u,{icon:a.closeOutline,onClick:t[0]||(t[0]=e=>{a.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[o.actions?((0,n.wg)(),(0,n.j4)(h,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.actions,((e,t)=>((0,n.wg)(),(0,n.j4)(_,{key:t},{default:(0,n.w5)((()=>{var o;return[e[0]?((0,n.wg)(),(0,n.j4)(p,{key:0,onClick:o=>s.actionCreate(t,e[1]),expand:"block",color:null!==(o=e[1])&&void 0!==o?o:"primary"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(e[0]),1)])),_:2},1032,["onClick","color"])):(0,n.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(g,{src:e.$heap.state.hostname+"image/get.php/"+o.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var l=o(8903),s=o(8292),d={props:["image_hash","actions"],components:{IonIcon:s.gu,IonToolbar:s.sr,IonHeader:s.Gu,IonImg:s.Xz,IonContent:s.W2,IonTitle:s.wd,IonButton:s.YG,IonCol:s.wI,IonRow:s.Nd,IonGrid:s.jY},setup(){const e=function(){s.Fy.dismiss()};return{closeModal:e,closeOutline:l.fID}},methods:{actionCreate(e,t){("danger"!=t||confirm("Вы уверены?"))&&s.Fy.dismiss(null,e)}}},u=o(3744);const c=(0,u.Z)(d,[["render",a]]);var m=c},2226:function(e,t,o){"use strict";o.d(t,{Z:function(){return b}});var n=o(6252),r=o(3577);const i=(0,n.Uk)("Фотографии"),a={key:0,class:"image_grid"},l=["onClick"],s={key:0},d={key:1},u={key:0,class:"image_controls"},c=["id"];function m(e,t,o,m,p,_){var f;const h=(0,n.up)("ion-label"),g=(0,n.up)("ion-icon"),w=(0,n.up)("ion-item"),k=(0,n.up)("ion-img"),v=(0,n.up)("ion-avatar");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(w,{lines:"none",onClick:t[0]||(t[0]=e=>{p.editMode=!p.editMode,p.editMode&&_.load()})},{default:(0,n.w5)((()=>[o.title?((0,n.wg)(),(0,n.j4)(h,{key:0,color:"imageList?.length?'':medium"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(o.title),1)])),_:1})):((0,n.wg)(),(0,n.j4)(h,{key:1,color:"imageList?.length?'':medium"},{default:(0,n.w5)((()=>[i])),_:1})),p.editMode?((0,n.wg)(),(0,n.j4)(g,{key:2,slot:"end",icon:m.settingsSharp,color:"primary"},null,8,["icon"])):((0,n.wg)(),(0,n.j4)(g,{key:3,slot:"end",icon:m.settingsOutline},null,8,["icon"]))])),_:1}),null!==(f=_.imageList)&&void 0!==f&&f.length?((0,n.wg)(),(0,n.iD)("div",a,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(_.imageList,(t=>((0,n.wg)(),(0,n.iD)("div",{key:t.image_id,style:{position:"relative"}},[(0,n._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:e=>_.imagePreview(t.image_hash)},[t.deleted_at?((0,n.wg)(),(0,n.iD)("div",s,"будет удалено")):1==t.is_disabled?((0,n.wg)(),(0,n.iD)("div",d,"на модерации")):(0,n.kq)("",!0)],8,l),(0,n.Wm)(v,{onClick:e=>_.imagePreview(t.image_hash),class:(0,r.C_)(t.class)},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),p.editMode?((0,n.wg)(),(0,n.iD)("div",u,[(0,n.Wm)(g,{icon:m.chevronBackCircleOutline,onClick:e=>_.back(t)},null,8,["icon","onClick"]),_.isAdmin&&1==t.is_disabled?((0,n.wg)(),(0,n.j4)(g,{key:0,icon:m.checkmarkCircle,color:"success",onClick:e=>_.enable(t)},null,8,["icon","onClick"])):(0,n.kq)("",!0),t.deleted_at?((0,n.wg)(),(0,n.j4)(g,{key:1,icon:m.addCircle,color:"success",onClick:e=>_.restore(t)},null,8,["icon","onClick"])):((0,n.wg)(),(0,n.j4)(g,{key:2,icon:m.trash,color:"danger",onClick:e=>_.remove(t)},null,8,["icon","onClick"])),(0,n.Wm)(g,{icon:m.chevronForwardCircleOutline,onClick:e=>_.forward(t)},null,8,["icon","onClick"])])):(0,n.kq)("",!0)])))),128))])):(0,n.kq)("",!0),(0,n._)("input",{type:"file",id:p.fileUploaderId,accept:".png, .jpg, .jpeg, .webp, .gif",onChange:t[1]||(t[1]=e=>_.uploadImage(e)),style:{display:"none"}},null,40,c)])}var p=o(8534),_=o(8903),f=o(8292),h=o(7327),g=o(9755),w=o.n(g),k=o(9042),v=o(351),y={props:["images","image_holder","image_holder_id","controller","title"],components:{IonLabel:f.Q$,IonIcon:f.gu,IonItem:f.Ie,IonImg:f.Xz,IonAvatar:f.BJ},setup(){return{settingsOutline:_.C$N,settingsSharp:_.kiF,chevronBackCircleOutline:_.CK0,chevronForwardCircleOutline:_.esm,trash:_._Ij,addCircle:_.ZWo,checkmarkCircle:_.I1A}},data(){var e;return{images_loaded:null,editMode:!1,fileUploaderId:(null!==(e=this.image_holder)&&void 0!==e?e:this.controller)+this.image_holder_id}},computed:{imageList(){let e=this.images_loaded||this.images,t=[];for(let o in e)e[o].deleted_at?(e[o].class=" deleted",this.editMode&&t.push(e[o])):1==e[o].is_disabled?(e[o].class=" disabled",this.editMode&&t.push(e[o])):t.push(e[o]);return t},isAdmin(){return v.Z.isAdmin()}},methods:{back(e){var t=this;return(0,p.Z)((function*(){try{yield w().post(t.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"}),t.load()}catch(o){}}))()},forward(e){var t=this;return(0,p.Z)((function*(){try{yield w().post(t.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"}),t.load()}catch(o){}}))()},remove(e){var t=this;return(0,p.Z)((function*(){try{yield w().post(t.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id}),t.load(),t.$flash("Фото перемещено в корзину и будет удалено")}catch(o){}}))()},restore(e){var t=this;return(0,p.Z)((function*(){try{yield w().post(t.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id}),t.load(),t.$flash("Фото перемещено извлечено из корзины")}catch(o){}}))()},enable(e){var t=this;return(0,p.Z)((function*(){try{yield w().post(t.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0}),t.load()}catch(o){}}))()},load(){var e=this;return(0,p.Z)((function*(){var t;const o={image_holder_id:e.image_holder_id,image_holder:null!==(t=e.image_holder)&&void 0!==t?t:e.controller,is_disabled:1,is_deleted:1,is_active:1};e.images_loaded=yield w().post(e.$heap.state.hostname+"Image/listGet",o)}))()},imagePreview(e){return(0,p.Z)((function*(){const t=yield f.Fy.create({component:h.Z,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[.5,1]}),o=function(){t.dismiss()};return k.Z.on("dismissModal",o),t.present()}))()},uploadImage(e){var t=this;return(0,p.Z)((function*(){let o=new FormData;o.append("files[]",e.target.files[0]),o.set("image_holder_id",t.image_holder_id),t.image_holder&&o.set("image_holder",t.image_holder);const n={url:t.$heap.state.hostname+t.controller+"/fileUpload",type:"POST",data:o,processData:!1,contentType:!1};try{yield w().ajax(n),t.load()}catch(s){var r,i,a,l;if("limit_exeeded"==(null===s||void 0===s||null===(r=s.responseJSON)||void 0===r||null===(i=r.messages)||void 0===i?void 0:i.error))return void t.$flash("Уже загружено максимальное количество фото");if("no_valid_images"==(null===s||void 0===s||null===(a=s.responseJSON)||void 0===a||null===(l=a.messages)||void 0===l?void 0:l.error))return void t.$flash("Формат файла не поддерживается");t.$flash("Не удалось загрузить фото")}}))()},take_photo(){w()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}},I=o(3744);const W=(0,I.Z)(y,[["render",m],["__scopeId","data-v-5ec0cc30"]]);var b=W},132:function(e,t,o){"use strict";o.d(t,{Z:function(){return f}});var n=o(6252);const r=(0,n.Uk)("Фискальный чек"),i=["src"],a={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},l=["src"];function s(e,t,o,s,d,u){const c=(0,n.up)("ion-icon"),m=(0,n.up)("ion-title"),p=(0,n.up)("ion-toolbar"),_=(0,n.up)("ion-header"),f=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{color:"secondary"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{icon:s.receiptOutline,slot:"start"},null,8,["icon"]),(0,n.Wm)(m,{slot:"start"},{default:(0,n.w5)((()=>[r])),_:1}),(0,n.Wm)(c,{icon:s.closeOutline,onClick:t[0]||(t[0]=e=>{s.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n._)("iframe",{src:o.billLink,style:{width:"100%",height:"85%",border:"none"},onLoad:t[1]||(t[1]=e=>u.onLoad())},null,40,i),d.loadAnimation?((0,n.wg)(),(0,n.iD)("div",a,[(0,n._)("img",{src:s.loading},null,8,l)])):(0,n.kq)("",!0)])),_:1})],64)}var d=o(8292),u=o(659),c=o(8903),m={components:{IonTitle:d.wd,IonIcon:d.gu,IonToolbar:d.sr,IonHeader:d.Gu,IonContent:d.W2},props:["billLink"],setup(){const e=function(){d.Fy.dismiss()};return{closeModal:e,closeOutline:c.fID,receiptOutline:c.d71,loading:u}},data(){return{loadAnimation:1}},methods:{onLoad(){this.loadAnimation=0}}},p=o(3744);const _=(0,p.Z)(m,[["render",s]]);var f=_},6930:function(e,t,o){"use strict";o.d(t,{Z:function(){return g}});var n=o(6252),r=o(3577);const i=(0,n.Uk)(" Чтобы вовремя узнавать об изменениях статусов заказов, подпишитесь на уведомления "),a=(0,n.Uk)("Подписаться"),l=(0,n.Uk)(" Уведомления не поддерживаются этим устройством. "),s=(0,n.Uk)(" Уведомления включены ");function d(e,t,o,d,u,c){const m=(0,n.up)("ion-button"),p=(0,n.up)("ion-card-content"),_=(0,n.up)("ion-card"),f=(0,n.up)("ion-icon"),h=(0,n.up)("ion-item");return(0,n.wg)(),(0,n.iD)(n.HY,null,["default"==u.permission?((0,n.wg)(),(0,n.j4)(_,{key:0,color:"light"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[i,(0,n._)("p",null,[(0,n.Wm)(m,{onClick:t[0]||(t[0]=e=>c.subscribe()),expand:"block"},{default:(0,n.w5)((()=>[a])),_:1})])])),_:1})])),_:1})):(0,n.kq)("",!0),"denied"==u.permission?((0,n.wg)(),(0,n.j4)(_,{key:1},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(h,{lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{src:d.notificationsOffOutline,color:"primary",slot:"start"},null,8,["src"]),(0,n.Uk)(" Уведомления от нашего сайта были заблокированы вами. Для полноценной работы приложения, рекомендуем влючить уведомления от сайта "+(0,r.zw)(e.$heap.state.hostname)+" в настройках вашего браузера. ",1)])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),"notsupported"==u.permission?((0,n.wg)(),(0,n.j4)(_,{key:2},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(h,{lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{src:d.notificationsOffOutline,color:"primary",slot:"start"},null,8,["src"]),l])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),"granted"==u.permission?((0,n.wg)(),(0,n.j4)(_,{key:3},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(h,{lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{src:d.notificationsOutline,color:"primary",slot:"start"},null,8,["src"]),s])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0)],64)}var u=o(8534),c=o(351),m=o(8903),p=o(8292),_={components:{IonButton:p.YG,IonCard:p.PM,IonCardContent:p.FN,IonIcon:p.gu,IonItem:p.Ie},setup(){return{notificationsOutline:m.iZ5,notificationsOffOutline:m.nZf}},data(){let e="Notification"in window?Notification.permission:"notsupported";return{permission:e,wasRejected:0}},methods:{subscribe(){var e=this;return(0,u.Z)((function*(){if("Notification"in window)try{e.permission=yield Notification.requestPermission(),"granted"==e.permission&&c.Z.firebase.saveNotificationToken()}catch(t){e.$flash("Вы не разрешили уведомлять вас")}else e.$flash("Ваше устройство не поддерживает уведомления")}))()},reject(){localStorage.pushNotificationsWasRejected=this.wasRejected=1}}},f=o(3744);const h=(0,f.Z)(_,[["render",d]]);var g=h},2957:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return ye}});var n=o(6252);const r={key:0,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},i={style:{width:"max-content","text-align":"center"}},a=(0,n.Uk)("Заказ не найден"),l=(0,n._)("br",null,null,-1),s=(0,n._)("a",{href:"/order/order-list"},"список заказов",-1),d=(0,n.Uk)("Отказ клиента"),u=(0,n.Uk)("Заказ не готов/не соответствует"),c=(0,n.Uk)("Поломка в пути"),m=(0,n.Uk)("Заказ испорчен");function p(e,t,o,p,_,f){var h;const g=(0,n.up)("ion-icon"),w=(0,n.up)("ion-label"),k=(0,n.up)("order-comp"),v=(0,n.up)("order-info-comp"),y=(0,n.up)("order-tracking-comp"),I=(0,n.up)("image-tile-comp"),W=(0,n.up)("order-history-comp"),b=(0,n.up)("msg-subscription-comp"),D=(0,n.up)("order-meta-comp"),C=(0,n.up)("ion-item"),j=(0,n.up)("ion-list"),$=(0,n.up)("ion-content"),O=(0,n.up)("ion-popover"),x=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(x,{pageTitle:`Заказ #${_.order_id} ${null!==(h=_.order)&&void 0!==h&&h.deleted_at?"(Удален)":""}`,pageDefaultBackLink:"/order/order-list"},{default:(0,n.w5)((()=>{var e,o,h;return["notfound"==_.order?((0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("div",i,[(0,n.Wm)(g,{icon:p.sparklesOutline,size:"large"},null,8,["icon"]),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[a])),_:1}),l,s])])):(0,n.kq)("",!0),(0,n.Wm)(k,{orderData:_.order,onStageCreate:f.onStageCreate,onOrderRefresh:f.itemGet},null,8,["orderData","onStageCreate","onOrderRefresh"]),(0,n.Wm)(v,{orderData:_.order},null,8,["orderData"]),(0,n.Wm)(y,{orderData:_.order},null,8,["orderData"]),_.order?((0,n.wg)(),(0,n.j4)(I,{key:1,images:null===(e=_.order)||void 0===e?void 0:e.images,image_holder_id:null===(o=_.order)||void 0===o?void 0:o.order_id,controller:"Order",ref:"orderImgs"},null,8,["images","image_holder_id"])):(0,n.kq)("",!0),(0,n.Wm)(W,{orderData:_.order},null,8,["orderData"]),(0,n.Wm)(b),"system_finish"==(null===(h=_.order)||void 0===h?void 0:h.stage_current)?((0,n.wg)(),(0,n.j4)(D,{key:2,orderId:_.order_id},null,8,["orderId"])):(0,n.kq)("",!0),(0,n.Wm)(O,{"is-open":_.isOpenDeliveryRejectionPopover,onDidDismiss:t[4]||(t[4]=e=>_.isOpenDeliveryRejectionPopover=!1)},{default:(0,n.w5)((()=>[(0,n.Wm)($,null,{default:(0,n.w5)((()=>[(0,n.Wm)(j,null,{default:(0,n.w5)((()=>[(0,n.Wm)(C,{button:!0,detail:!1,onClick:t[0]||(t[0]=e=>f.action_rejected_reason("ОТКАЗ КУРЬЕРА: Отказ клиента"))},{default:(0,n.w5)((()=>[(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[d])),_:1})])),_:1}),(0,n.Wm)(C,{button:!0,detail:!1,onClick:t[1]||(t[1]=e=>f.action_rejected_reason("ОТКАЗ КУРЬЕРА: Заказ не готов/не соответствует"))},{default:(0,n.w5)((()=>[(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[u])),_:1})])),_:1}),(0,n.Wm)(C,{button:!0,detail:!1,onClick:t[2]||(t[2]=e=>f.action_rejected_reason("ОТКАЗ КУРЬЕРА: Поломка в пути"))},{default:(0,n.w5)((()=>[(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[c])),_:1})])),_:1}),(0,n.Wm)(C,{button:!0,detail:!1,onClick:t[3]||(t[3]=e=>f.action_rejected_reason("ОТКАЗ КУРЬЕРА: Заказ испорчен"))},{default:(0,n.w5)((()=>[(0,n.Wm)(w,null,{default:(0,n.w5)((()=>[m])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open"])]})),_:1},8,["pageTitle"])}var _=o(8534),f=(o(6699),o(4916),o(3123),o(3948),o(8903)),h=o(8292),g=o(7782),w=o(7479),k=o(3577);const v=(0,n.Uk)("История заказа");function y(e,t,o,r,i,a){var l;const s=(0,n.up)("ion-label"),d=(0,n.up)("ion-item"),u=(0,n.up)("ion-icon"),c=(0,n.up)("ion-text"),m=(0,n.up)("ion-note"),p=(0,n.up)("ion-list"),_=(0,n.up)("ion-accordion"),f=(0,n.up)("ion-accordion-group");return null!==(l=o.orderData)&&void 0!==l&&l.stages?((0,n.wg)(),(0,n.j4)(f,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(d,{slot:"header"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,null,{default:(0,n.w5)((()=>[v])),_:1})])),_:1}),(0,n.Wm)(p,{slot:"content"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.orderData.stages,(e=>((0,n.wg)(),(0,n.j4)(d,{key:e.group_id},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{slot:"start",icon:r.checkmarkOutline,size:"small",color:"success"},null,8,["icon"]),(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(e.group_name),1)])),_:2},1024),(0,n.Wm)(m,{slot:"end",style:{width:"80px"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(e.created_at),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0)}var I={props:["orderData"],components:{IonIcon:h.gu,IonText:h.yW,IonLabel:h.Q$,IonItem:h.Ie,IonList:h.q_,IonNote:h.uN,IonAccordion:h.We,IonAccordionGroup:h.eh},setup(){return{checkmarkOutline:f.TjA}}},W=o(3744);const b=(0,W.Z)(I,[["render",y]]);var D=b;const C=(0,n.Uk)("Покупатель "),j=["href"],$=["href"],O=["href"],x=(0,n.Uk)("Курьер "),Z=["href"],U=["href"],q=(0,n.Uk)("Продавец "),z=["href"],L=["href"],G=["href"];function M(e,t,o,r,i,a){const l=(0,n.up)("ion-label"),s=(0,n.up)("ion-item"),d=(0,n.up)("ion-icon"),u=(0,n.up)("ion-chip"),c=(0,n.up)("ion-note"),m=(0,n.up)("ion-accordion"),p=(0,n.up)("ion-accordion-group");return(0,n.wg)(),(0,n.j4)(p,null,{default:(0,n.w5)((()=>{var e,t,i,a,p,_;return[null!==(e=o.orderData)&&void 0!==e&&null!==(t=e.info)&&void 0!==t&&t.customer_name?((0,n.wg)(),(0,n.j4)(m,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{slot:"header"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[C,(0,n._)("b",null,(0,k.zw)(o.orderData.info.customer_name),1)])),_:1})])),_:1}),(0,n.Wm)(s,{slot:"content"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"ion-text-wrap"},{default:(0,n.w5)((()=>[o.orderData.info.customer_phone?((0,n.wg)(),(0,n.j4)(u,{key:0,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.callOutline},null,8,["src"]),(0,n._)("a",{href:`tel:${o.orderData.info.customer_phone}`},(0,k.zw)(o.orderData.info.customer_phone),9,j)])),_:1})):(0,n.kq)("",!0),o.orderData.info.customer_email?((0,n.wg)(),(0,n.j4)(u,{key:1,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.mailOutline},null,8,["src"]),(0,n._)("a",{href:`mailto:${o.orderData.info.customer_email}`},(0,k.zw)(o.orderData.info.customer_email),9,$)])),_:1})):(0,n.kq)("",!0),o.orderData.info.customer_location_address?((0,n.wg)(),(0,n.j4)(u,{key:2,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.locationOutline},null,8,["src"]),(0,n._)("a",{href:`https://yandex.ru/maps/?pt=${o.orderData.info.customer_location_longitude},${o.orderData.info.customer_location_latitude}&z=19&l=map,trf`,target:"_new"},(0,k.zw)(o.orderData.info.customer_location_address),9,O)])),_:1})):(0,n.kq)("",!0),o.orderData.info.customer_location_comment?((0,n.wg)(),(0,n.j4)(c,{key:3},{default:(0,n.w5)((()=>[(0,n.Uk)(" Комментарий к адресу: "+(0,k.zw)(o.orderData.info.customer_location_comment),1)])),_:1})):(0,n.kq)("",!0)])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),null!==(i=o.orderData)&&void 0!==i&&null!==(a=i.info)&&void 0!==a&&a.courier_name?((0,n.wg)(),(0,n.j4)(m,{key:1},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{slot:"header"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[x,(0,n._)("b",null,(0,k.zw)(o.orderData.info.courier_name),1)])),_:1})])),_:1}),(0,n.Wm)(s,{slot:"content"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"ion-text-wrap"},{default:(0,n.w5)((()=>[o.orderData.info.courier_phone?((0,n.wg)(),(0,n.j4)(u,{key:0,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.callOutline},null,8,["src"]),(0,n._)("a",{href:`tel:${o.orderData.info.courier_phone}`},(0,k.zw)(o.orderData.info.courier_phone),9,Z)])),_:1})):(0,n.kq)("",!0),o.orderData.info.courier_email?((0,n.wg)(),(0,n.j4)(u,{key:1,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.mailOutline},null,8,["src"]),(0,n._)("a",{href:`mailto:${o.orderData.info.courier_email}`},(0,k.zw)(o.orderData.info.courier_email),9,U)])),_:1})):(0,n.kq)("",!0)])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0),null!==(p=o.orderData)&&void 0!==p&&null!==(_=p.info)&&void 0!==_&&_.supplier_name?((0,n.wg)(),(0,n.j4)(m,{key:2},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{slot:"header"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[q,(0,n._)("b",null,(0,k.zw)(o.orderData.info.supplier_name),1)])),_:1})])),_:1}),(0,n.Wm)(s,{slot:"content"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"ion-text-wrap"},{default:(0,n.w5)((()=>[o.orderData.info.supplier_phone?((0,n.wg)(),(0,n.j4)(u,{key:0,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.callOutline},null,8,["src"]),(0,n._)("a",{href:`tel:${o.orderData.info.supplier_phone}`},(0,k.zw)(o.orderData.info.supplier_phone),9,z)])),_:1})):(0,n.kq)("",!0),o.orderData.info.supplier_email?((0,n.wg)(),(0,n.j4)(u,{key:1,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.mailOutline},null,8,["src"]),(0,n._)("a",{href:`mailto:${o.orderData.info.supplier_email}`},(0,k.zw)(o.orderData.info.supplier_email),9,L)])),_:1})):(0,n.kq)("",!0),o.orderData.info.supplier_location_address?((0,n.wg)(),(0,n.j4)(u,{key:2,color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.locationOutline},null,8,["src"]),(0,n._)("a",{href:`https://yandex.ru/maps/?pt=${o.orderData.info.supplier_location_longitude},${o.orderData.info.supplier_location_latitude}&z=19&l=map,trf`,target:"_new"},(0,k.zw)(o.orderData.info.supplier_location_address),9,G)])),_:1})):(0,n.kq)("",!0),o.orderData.info.supplier_location_comment?((0,n.wg)(),(0,n.j4)(c,{key:3},{default:(0,n.w5)((()=>[(0,n.Uk)(" Комментарий к адресу: "+(0,k.zw)(o.orderData.info.supplier_location_comment),1)])),_:1})):(0,n.kq)("",!0)])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0)]})),_:1})}var S={props:["orderData"],components:{IonIcon:h.gu,IonChip:h.hM,IonLabel:h.Q$,IonItem:h.Ie,IonAccordion:h.We,IonAccordionGroup:h.eh,IonNote:h.uN},setup(){return{locationOutline:f.Iv7,callOutline:f.H7N,mailOutline:f.xOl}},data(){return{}},computed:{},methods:{}};const T=(0,W.Z)(S,[["render",M],["__scopeId","data-v-b14c0876"]]);var A=T;const N=(0,n.Uk)("Дополнительно"),P={slot:"content",class:"ion-padding"},R={key:0},F={key:1},H={key:2};function Y(e,t,o,r,i,a){const l=(0,n.up)("ion-label"),s=(0,n.up)("ion-item"),d=(0,n.up)("ion-icon"),u=(0,n.up)("ion-text"),c=(0,n.up)("ion-chip"),m=(0,n.up)("ion-button"),p=(0,n.up)("ion-list"),_=(0,n.up)("ion-accordion"),f=(0,n.up)("ion-accordion-group");return(0,n.wg)(),(0,n.j4)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s,{slot:"header",onClick:t[0]||(t[0]=e=>a.itemMetaGet())},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[N])),_:1})])),_:1}),(0,n._)("div",P,[i.meta.payment_card_fixate_sum>0?((0,n.wg)(),(0,n.j4)(c,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.cardOutline},null,8,["src"]),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Предоплата "+(0,k.zw)(i.meta.payment_card_fixate_sum)+(0,k.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,n.kq)("",!0),i.meta.payment_card_refund_sum>0?((0,n.wg)(),(0,n.j4)(c,{key:1},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.cardOutline},null,8,["src"]),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Сдача "+(0,k.zw)(i.meta.payment_card_refund_sum)+(0,k.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,n.kq)("",!0),i.meta.payment_card_confirm_sum>0?((0,n.wg)(),(0,n.j4)(c,{key:2},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.cardOutline},null,8,["src"]),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Оплачено "+(0,k.zw)(i.meta.payment_card_confirm_sum)+(0,k.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,n.kq)("",!0),i.meta.delivery_by_courier||i.meta.delivery_by_store||i.meta.pickup_by_customer?((0,n.wg)(),(0,n.j4)(c,{key:3},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.rocketOutline},null,8,["src"]),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[i.meta.delivery_by_courier?((0,n.wg)(),(0,n.iD)("span",R,"Курьер")):(0,n.kq)("",!0),i.meta.delivery_by_store?((0,n.wg)(),(0,n.iD)("span",F,"Продавец")):(0,n.kq)("",!0),i.meta.pickup_by_customer?((0,n.wg)(),(0,n.iD)("span",H,"Самовывоз")):(0,n.kq)("",!0)])),_:1})])),_:1})):(0,n.kq)("",!0),i.meta.invoice_link?((0,n.wg)(),(0,n.j4)(m,{key:4,color:"light",onClick:t[1]||(t[1]=e=>a.billOpen(i.meta.invoice_link)),expand:"block"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:r.receiptOutline,slot:"start"},null,8,["src"]),(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)("Открыть чек на "+(0,k.zw)(i.meta.invoice_sum)+(0,k.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,n.kq)("",!0),a.ledgerCalc.length>0?((0,n.wg)(),(0,n.j4)(p,{key:5},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.ledgerCalc,(e=>((0,n.wg)(),(0,n.j4)(s,{key:e.trans_id},{default:(0,n.w5)((()=>[(0,n.Wm)(u,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(e.trans_description),1)])),_:2},1024),(0,n.Wm)(u,{slot:"end",color:e.trans_amount>0?"normal":"danger"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(e.trans_amount),1)])),_:2},1032,["color"])])),_:2},1024)))),128))])),_:1})):(0,n.kq)("",!0)])])),_:1})])),_:1})}var B=o(132),Q=o(9755),J=o.n(Q),E={props:["orderId"],components:{IonIcon:h.gu,IonText:h.yW,IonLabel:h.Q$,IonButton:h.YG,IonItem:h.Ie,IonList:h.q_,IonAccordion:h.We,IonAccordionGroup:h.eh,IonChip:h.hM},setup(){return{cardOutline:f.pvm,rocketOutline:f.G$D,receiptOutline:f.d71}},data(){return{meta:{}}},computed:{ledgerCalc(){if(!this.meta.transactions)return[];let e=[];for(let t of this.meta.transactions)t.date=this.toLocDate(t.trans_date),e.push(t);return e}},methods:{itemMetaGet(){var e=this;return(0,_.Z)((function*(){try{e.meta=yield J().post(`${e.$heap.state.hostname}Order/itemMetaGet`,{order_id:e.orderId})}catch(n){var t,o;const r=null===n||void 0===n||null===(t=n.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;switch(r){case"forbidden":case"notfound":default:e.meta={}}return!1}}))()},toLocDate(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,o)},billOpen(e){var t=this;return(0,_.Z)((function*(){if(!e)return void t.$flash("Невозможно открыть чек");const o=yield h.Fy.create({component:B.Z,componentProps:{billLink:e},initialBreakpoint:.85,breakpoints:[0,.85,1]}),n=function(){o.dismiss()};return t.$topic.on("dismissModal",n),o.present()}))()}}};const K=(0,W.Z)(E,[["render",Y]]);var V=K;const X=(0,n.Uk)("Отслеживание заказа");function ee(e,t,o,r,i,a){const l=(0,n.up)("ion-label"),s=(0,n.up)("ion-item"),d=(0,n.up)("ion-icon"),u=(0,n.up)("ion-chip"),c=(0,n.up)("ion-progress-bar"),m=(0,n.up)("ion-list"),p=(0,n.up)("ion-accordion"),_=(0,n.up)("ion-accordion-group");return a.isDelivering()?((0,n.wg)(),(0,n.j4)(_,{key:0,value:"tracking",color:"primary"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{value:"tracking"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{slot:"header"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[X])),_:1})])),_:1}),(0,n.Wm)(m,{slot:"content"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{color:"primary",slot:"start",icon:r.locationOutline,style:{"font-size":"30px"}},null,8,["icon"]),(0,n.Wm)(l,null,{default:(0,n.w5)((()=>{var e;return[(0,n.Uk)("Курьер, "+(0,k.zw)(null===(e=i.job)||void 0===e?void 0:e.courier_name),1)]})),_:1})])),_:1}),a.courier_finish_distance_km?((0,n.wg)(),(0,n.j4)(s,{key:0,lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{slot:"start",color:"success"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(a.courier_finish_distance_km),1)])),_:1}),(0,n.Wm)(u,{slot:"end",color:"primary"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(a.courier_finish_time_min.timeMin)+"-"+(0,k.zw)(a.courier_finish_time_min.timeMax)+"мин ",1)])),_:1})])),_:1})):(0,n.kq)("",!0),a.courier_finish_distance_km?((0,n.wg)(),(0,n.j4)(s,{key:1,lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{color:"secondary",value:a.courier_progress,reversed:"true"},null,8,["value"])])),_:1})):(0,n.kq)("",!0),(0,n.Wm)(s,{lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{style:{"text-align":"right"}},{default:(0,n.w5)((()=>[(0,n.Uk)("Клиент, "+(0,k.zw)(o.orderData.customer.user_name),1)])),_:1}),(0,n.Wm)(d,{color:"primary",slot:"end",icon:r.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1})])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0)}var te=o(4405),oe={props:["orderData"],components:{IonList:h.q_,IonChip:h.hM,IonItem:h.Ie,IonLabel:h.Q$,IonIcon:h.gu,IonAccordionGroup:h.eh,IonAccordion:h.We,IonProgressBar:h.X7},setup(){return{storefrontOutline:f.qRG,locationOutline:f.Iv7,flagOutline:f.FMn}},data(){return{job:null,refreshInterval:6e4,clock:null}},computed:{courier_finish_distance_km(){var e,t;return null!==(e=this.job)&&void 0!==e&&e.courier_finish_distance?Math.round((null===(t=this.job)||void 0===t?void 0:t.courier_finish_distance)/100)/10+"км":"-"},courier_finish_time_min(){var e;return te.Z.deliveryTimeCalculate(null===(e=this.job)||void 0===e?void 0:e.courier_finish_distance,0)},courier_progress(){var e,t;return(null===(e=this.job)||void 0===e?void 0:e.courier_finish_distance)/(null===(t=this.job)||void 0===t?void 0:t.start_finish_distance)}},methods:{jobGet(){var e=this;return(0,_.Z)((function*(){if(e.isDelivering())try{if(e.job=yield g.Z.api.itemJobTrack(e.orderData.order_id),"delivery_start"==e.job.group_type){clearTimeout(e.clock);const t=e;e.clock=setTimeout((()=>{t.jobGet()}),e.refreshInterval)}}catch(n){var t,o;const r=null===(t=n.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;if("notfound"==r)return void e.$flash("Задание не найдено");if("notready"==r)return void e.$flash("Смена курьера не открыта")}}))()},isDelivering(){var e;return"delivery_start"==(null===(e=this.orderData)||void 0===e?void 0:e.stage_current)}},watch:{orderData:function(){this.jobGet()}}};const ne=(0,W.Z)(oe,[["render",ee],["__scopeId","data-v-5a49856d"]]);var re=ne;const ie=(0,n.Uk)("Возражение"),ae=(0,n.Uk)("Сохранить возражение"),le=(0,n.Uk)("Закрыть без возражения");function se(e,t,o,r,i,a){const l=(0,n.up)("ion-title"),s=(0,n.up)("ion-toolbar"),d=(0,n.up)("ion-header"),u=(0,n.up)("ion-label"),c=(0,n.up)("ion-textarea"),m=(0,n.up)("ion-item"),p=(0,n.up)("ion-list"),_=(0,n.up)("ion-button"),f=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s,{color:"secondary"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[ie])),_:1})])),_:1})])),_:1}),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,{position:"stacked"}),(0,n.Wm)(c,{rows:"6",modelValue:i.objection_text,"onUpdate:modelValue":t[0]||(t[0]=e=>i.objection_text=e),placeholder:"опишите суть возражения к исполнению заказа (минимум 10 букв)"},null,8,["modelValue"])])),_:1})])),_:1}),(0,n.Wm)(_,{onClick:t[1]||(t[1]=e=>a.save()),color:"primary",disabled:!i.objection_text||i.objection_text.length<10,expand:"full"},{default:(0,n.w5)((()=>[ae])),_:1},8,["disabled"]),(0,n.Wm)(_,{onClick:t[2]||(t[2]=e=>a.close()),color:"light",expand:"full"},{default:(0,n.w5)((()=>[le])),_:1})])),_:1})],64)}var de={components:{IonTextarea:h.g2,IonButton:h.YG,IonHeader:h.Gu,IonToolbar:h.sr,IonTitle:h.wd,IonContent:h.W2,IonList:h.q_,IonItem:h.Ie,IonLabel:h.Q$},data(){return{objection_text:null}},methods:{close(){h.Fy.dismiss()},save(){h.Fy.dismiss(this.objection_text)}}};const ue=(0,W.Z)(de,[["render",se]]);var ce=ue;const me=(0,n.Uk)("Добавить товар");function pe(e,t,o,r,i,a){const l=(0,n.up)("ion-title"),s=(0,n.up)("ion-toolbar"),d=(0,n.up)("ion-header"),u=(0,n.up)("ion-searchbar"),c=(0,n.up)("ion-img"),m=(0,n.up)("ion-label"),p=(0,n.up)("ion-item"),_=(0,n.up)("ion-list"),f=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s,{color:"secondary"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[me])),_:1})])),_:1})])),_:1}),(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,{onInput:t[0]||(t[0]=e=>a.listGet({name_query:e.target.value,name_query_fields:"product_name,product_code"})),style:{"border-radius":"10px",color:"black"},placeholder:"Поиск в этом предприятии"}),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.productList,(t=>((0,n.wg)(),(0,n.j4)(p,{key:t.product_id,onClick:e=>a.itemCreate(t.product_id)},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{slot:"start",src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".50.50.webp"},null,8,["src"]),(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(t.product_name),1)])),_:2},1024),(0,n.Wm)(m,{slot:"end",color:"primary"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,k.zw)(t.product_final_price)+(0,k.zw)(e.$heap.state.currencySign),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}var _e={components:{IonHeader:h.Gu,IonToolbar:h.sr,IonTitle:h.wd,IonContent:h.W2,IonSearchbar:h.VI,IonList:h.q_,IonItem:h.Ie,IonLabel:h.Q$,IonImg:h.Xz},props:["store_id","order_id"],data(){return{productList:[]}},mounted(){this.listGet()},methods:{listGet(e={}){var t=this;return(0,_.Z)((function*(){e.store_id=t.store_id,e.is_active=1,e.limit=5;let o={};try{o=yield J().post(`${t.$heap.state.hostname}Product/listGet`,e)}catch(n){}t.productList=o.product_list}))()},itemCreate(e){var t=this;return(0,_.Z)((function*(){let o={order_id:t.order_id,product_id:e,product_quantity:prompt("Введите количество",1)||1};try{yield J().post(`${t.$heap.state.hostname}Entry/itemCreate`,o)}catch(n){t.$flash("Не удалось добавить товар")}h.Fy.dismiss()}))()}}};const fe=(0,W.Z)(_e,[["render",pe]]);var he=fe,ge=o(2226),we=o(6930),ke={components:{OrderComp:w.Z,OrderHistoryComp:D,OrderMetaComp:V,OrderInfoComp:A,OrderTrackingComp:re,MsgSubscriptionComp:we.Z,ImageTileComp:ge.Z,IonLabel:h.Q$,IonIcon:h.gu,IonContent:h.W2,IonItem:h.Ie,IonList:h.q_,IonPopover:h.d8},setup(){return{sparklesOutline:f.Fcs}},data(){return{order_id:this.$route.params.id,order:null,orderIsLoading:!1,orderAutoloadClock:null,isOpenDeliveryRejectionPopover:!1}},methods:{itemGet(){var e=this;return(0,_.Z)((function*(){if(!e.orderIsLoading){try{e.orderIsLoading=!0,e.order=yield g.Z.api.itemGet(e.order_id),e.itemAutoReload()}catch(t){switch(t.status){case 404:e.$flash("Заказ не найден"),e.order="notfound",e.$router.push("/order/order-list");break}}e.orderIsLoading=!1}}))()},itemAutoReload(){clearTimeout(this.orderAutoloadClock);const e=this;this.orderAutoloadClock=setTimeout((()=>{e.itemGet(),console.log("autoreload")}),6e4)},onStageCreate(e,t){var o=this;return(0,_.Z)((function*(){if(t.includes("action")){t=t.split("_").splice(1).join("_");try{o[t](e)}catch(n){console.log("stage handler not found"+t)}}else try{const n=yield g.Z.api.itemStageCreate(e,t);if("ok"==n){if("customer_purged"==t)return o.$flash("Заказ удален"),o.order=null,o.$router.push("/order/order-list"),void g.Z.cart.itemDelete(e);if(yield o.itemGet(),"customer_cart"==t){let e={order_store_id:o.order.order_store_id,order_id:o.order.order_id,entries:o.order.entries,stage_current_name:o.order.stage_current_name,stage_next:o.order.stage_next,store:{store_name:o.order.store.store_name}};g.Z.cart.itemSet(e)}return!0}}catch(r){const e=r.responseJSON,t=e.messages.error;switch(t){case"wrong_courier_status":o.$flash("Смена курьера не открыта");break;case"order_is_empty":o.$alert("К сожалению, товара не осталось в наличии &#9785;","Заказ пуст");break;case"photos_must_be_made":o.$flash("Необходимо сфотографировать заказ"),o.action_take_photo();break;case"address_not_set":o.$flash("Необходимо добавить адрес доставки"),o.$router.push("/user/user-addresses");break;case"order_sum_exceeded":o.$flash("Сумма заказа должна быть меньше предоплаты");break;case"order_sum_zero":o.$flash("Нельзя завершить пустой заказ, от него можно отказаться.");break;case"forbidden_bycustomer":o.$flash("Запрещено покупателем");break;default:o.$flash("Не удалось изменить статус заказа");break}return!1}}))()},action_confirm(e){var t=this;return(0,_.Z)((function*(){const o=yield t.onStageCreate(e,"customer_confirmed");o&&t.action_checkout()}))()},action_checkout(){var e=this;return(0,_.Z)((function*(){e.$heap.commit("setCurrentOrder",e.order),e.$router.push(`/order/order-checkout-${e.order_id}`)}))()},action_add(){var e=this;return(0,_.Z)((function*(){const t=yield h.Fy.create({component:he,componentProps:{store_id:e.order.order_store_id,order_id:e.order_id},initialBreakpoint:.5,breakpoints:[.5,1],canDissmiss:!0});t.present();yield t.onDidDismiss();e.itemGet()}))()},action_objection(){var e=this;return(0,_.Z)((function*(){const t=yield h.Fy.create({component:ce,initialBreakpoint:.5,breakpoints:[.5,1],canDissmiss:!0});t.present();const o=yield t.onDidDismiss();if(o.data){const t=`ВОЗРАЖЕНИЕ ПОКУПАТЕЛЯ: ${o.data}`,n=yield g.Z.api.itemUpdate({order_id:e.order_id,order_objection:t});if("ok"==n){const t=yield e.onStageCreate(e.order_id,"customer_disputed");t&&(e.$flash("Ваше возражение принято и будет рассмотрено администратором."),alert("Необходимо сфотографировать заказ"),e.action_take_photo())}}}))()},action_rejected(){this.isOpenDeliveryRejectionPopover=!0},action_rejected_reason(e){var t=this;return(0,_.Z)((function*(){t.isOpenDeliveryRejectionPopover=!1;try{yield g.Z.api.itemUpdate({order_id:t.order_id,order_objection:e}),yield t.onStageCreate(t.order_id,"delivery_rejected"),t.$flash("Вы отказались от доставки")}catch(o){}}))()},action_take_photo(){this.$refs.orderImgs.take_photo()},action_call_customer(){location.href=`tel:+${this.order.customer.user_phone}`}},ionViewDidEnter(){null==this.order&&(this.itemGet(),console.log("viewenter"))},ionViewDidLeave(){this.order=null,clearTimeout(this.orderAutoloadClock)},created(){const e=this;e.itemGet(),this.$topic.on("orderSumChanged",(()=>{e.itemGet()})),this.$topic.on("pushStageChanged",(t=>{var o;(null===(o=e.order)||void 0===o?void 0:o.order_id)==(null===t||void 0===t?void 0:t.order_id)&&e.order.stage_current!=t.stage&&(e.itemGet(),console.log("pushStageChanged"))}))}};const ve=(0,W.Z)(ke,[["render",p]]);var ye=ve},659:function(e,t,o){"use strict";e.exports=o.p+"img/loading.30880178.svg"}}]);
//# sourceMappingURL=2957-legacy.0b59eee5.js.map