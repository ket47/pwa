"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[4217],{4217:function(e,s,l){l.r(s),l.d(s,{default:function(){return c}});var a=l(6252);const t=["src"],n=["src"],u=(0,a._)("div",null,[(0,a._)("p",null,"Ваши персональные данные будут безвозвратно удалены."),(0,a._)("p",null,"Повторная регистрация по этому номеру телефона будет невозможна!")],-1);function o(e,s,l,o,i,r){const d=(0,a.up)("ion-thumbnail"),p=(0,a.up)("ion-radio"),m=(0,a.up)("ion-item"),h=(0,a.up)("ion-radio-group"),_=(0,a.up)("ion-label"),f=(0,a.up)("ion-item-divider"),c=(0,a.up)("ion-input"),w=(0,a.up)("ion-button"),k=(0,a.up)("ion-list"),W=(0,a.up)("ion-icon"),b=(0,a.up)("ion-col"),g=(0,a.up)("ion-row"),v=(0,a.up)("ion-title"),V=(0,a.up)("ion-toolbar"),U=(0,a.up)("ion-header"),y=(0,a.up)("ion-content"),$=(0,a.up)("ion-modal"),I=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(I,{"page-title":"Мой профиль"},{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{modelValue:i.fields.user_avatar_name,"onUpdate:modelValue":s[2]||(s[2]=e=>i.fields.user_avatar_name=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{slot:"start"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,t)])),_:1}),(0,a.Wm)(p,{value:"man",onIonFocus:s[0]||(s[0]=e=>r.save("user_avatar_name",e.target.value))},{default:(0,a.w5)((()=>[(0,a.Uk)("аватар 1")])),_:1})])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,{slot:"start"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,n)])),_:1}),(0,a.Wm)(p,{value:"woman",onIonFocus:s[1]||(s[1]=e=>r.save("user_avatar_name",e.target.value))},{default:(0,a.w5)((()=>[(0,a.Uk)("аватар 2")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Данные пользователя")])),_:1})])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>i.fields.user_name=e),name:"user_name",type:"text",onChange:s[4]||(s[4]=e=>r.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",label:"Ваш псевдоним","label-placement":"stacked",required:""},null,8,["modelValue"])])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_surname,"onUpdate:modelValue":s[5]||(s[5]=e=>i.fields.user_surname=e),placeholder:"Фамилия (не обязательно)",label:"Фамилия (не обязательно)","label-placement":"stacked",name:"user_surname",type:"text",onChange:s[6]||(s[6]=e=>r.save("user_surname",e.target.value))},null,8,["modelValue"])])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{readonly:"",modelValue:i.fields.user_phone,"onUpdate:modelValue":s[7]||(s[7]=e=>i.fields.user_phone=e),label:"Телефон","label-placement":"stacked"},null,8,["modelValue"]),!i.fields.user_phone||i.fields.user_phone_verified&&"0"!==i.fields.user_phone_verified?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(w,{key:0,slot:"end",onClick:r.phoneVerify,expand:"block"},{default:(0,a.w5)((()=>[(0,a.Uk)("Подтвердить")])),_:1},8,["onClick"])),i.fields.user_phone&&i.fields.user_phone_verified&&"0"!==i.fields.user_phone_verified?((0,a.wg)(),(0,a.j4)(w,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,a.w5)((()=>[(0,a.Uk)("Подтверждено")])),_:1})):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_email,"onUpdate:modelValue":s[8]||(s[8]=e=>i.fields.user_email=e),name:"user_email",type:"email",onChange:s[9]||(s[9]=e=>r.save("user_email",e.target.value)),placeholder:"Электронная почта",label:"Электронная почта","label-placement":"stacked"},null,8,["modelValue"])])),_:1})])),_:1}),(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Пароль пользователя")])),_:1})])),_:1}),(0,a.Wm)(g,{"responsive-sm":""},{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Wm)(w,{onClick:s[10]||(s[10]=e=>r.passwordReset()),expand:"block"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,a.Uk)("Сбросить")])),_:1})])),_:1}),(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Wm)(w,{onClick:s[11]||(s[11]=e=>i.passwordPromptShow=!0),expand:"block"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,a.Uk)("Изменить")])),_:1})])),_:1})])),_:1}),(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Удаление учетной записи")])),_:1})])),_:1}),(0,a.Wm)(g,{"responsive-sm":""},{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Wm)(w,{onClick:s[12]||(s[12]=e=>i.deletePromptShow=!0),expand:"block",fill:"outline",color:"danger"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{icon:o.trashOutline,slot:"start"},null,8,["icon"]),(0,a.Uk)("Удалить аккаунт")])),_:1})])),_:1}),(0,a.Wm)(b)])),_:1}),(0,a.Wm)($,{isOpen:i.passwordPromptShow,"initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,a.w5)((()=>[(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Wm)(V,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Новый пароль")])),_:1}),(0,a.Wm)(W,{icon:o.closeOutline,onClick:s[13]||(s[13]=e=>i.passwordPromptShow=!1),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(y,{class:"ion-padding"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_pass_current,"onUpdate:modelValue":s[14]||(s[14]=e=>i.fields.user_pass_current=e),type:"password",placeholder:"пароль",label:"Действующий пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_pass,"onUpdate:modelValue":s[15]||(s[15]=e=>i.fields.user_pass=e),type:"text",placeholder:"пароль",label:"Новый пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_pass_confirm,"onUpdate:modelValue":s[16]||(s[16]=e=>i.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)",label:"Новый пароль (повтор)","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(w,{onClick:s[17]||(s[17]=e=>r.passwordSave()),expand:"block"},{default:(0,a.w5)((()=>[(0,a.Uk)("Изменить")])),_:1})])),_:1})])),_:1},8,["isOpen"]),(0,a.Wm)($,{isOpen:i.deletePromptShow,"initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,a.w5)((()=>[(0,a.Wm)(U,null,{default:(0,a.w5)((()=>[(0,a.Wm)(V,{color:"danger"},{default:(0,a.w5)((()=>[(0,a.Wm)(v,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Удаление учетной записи")])),_:1}),(0,a.Wm)(W,{icon:o.closeOutline,onClick:s[18]||(s[18]=e=>i.deletePromptShow=!1),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(y,{class:"ion-padding"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{lines:"none",style:{"margin-bottom":"15px"}},{default:(0,a.w5)((()=>[u])),_:1}),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{modelValue:i.fields.user_pass_current,"onUpdate:modelValue":s[19]||(s[19]=e=>i.fields.user_pass_current=e),type:"password",placeholder:"пароль",label:"Действующий пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.Wm)(w,{onClick:s[20]||(s[20]=e=>r.deleteAccount()),expand:"block",color:"danger"},{default:(0,a.w5)((()=>[(0,a.Uk)("Удалить аккаунт")])),_:1})])),_:1})])),_:1},8,["isOpen"])])),_:1})}l(4916),l(5306),l(8862);var i=l(4929),r=l(8903),d=l(9755),p=l.n(d),m=l(351),h={components:{IonList:i.q_,IonItem:i.Ie,IonLabel:i.Q$,IonThumbnail:i.Bs,IonRadio:i.B7,IonRadioGroup:i.se,IonInput:i.pK,IonCol:i.wI,IonRow:i.Nd,IonItemDivider:i.rH,IonButton:i.YG,IonModal:i.ki,IonHeader:i.Gu,IonTitle:i.wd,IonContent:i.W2,IonIcon:i.gu,IonToolbar:i.sr},setup(){return{closeOutline:r.fID,keyOutline:r.eyg,trashOutline:r.gtu}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1,deletePromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{async save(e,s){if("user_phone"==e){if(!this.isPhoneValid)return!1;s=s.replace(/\D/g,"")}var l={};l.user_id=this.$heap.state.user.user_id,l[e]=s,await this.itemUpdate(l),this.fields[e]=s},async itemUpdate(e){try{return await p().post(`${this.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e)),!0}catch(s){let e="unknown";try{const l=Object.keys(JSON.parse(s.responseJSON.messages.error))[0],a=Object.values(JSON.parse(s.responseJSON.messages.error))[0];e=l+"_"+a}catch(l){}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break}return!1}},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{p().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$go({name:"UserVerifyPhone",params:{phone:e}})}catch(s){}},async passwordSave(){if(this.fields.user_pass!=this.fields.user_pass_confirm)return void this.$flash("Пароль и подтверждение не совпадают");if(!this.fields.user_pass_current||!this.fields.user_pass||!this.fields.user_pass_confirm)return void this.$flash("Все поля обязательны для заполнения");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass,user_pass_current:this.fields.user_pass_current},s=await this.itemUpdate(e);s&&(this.passwordPromptShow=!1,this.$flash("Пароль изменен"))},async passwordReset(){if(!confirm("Выслать новый пароль на телефон и электронную почту?"))return;const e={user_phone:this.fields.user_phone,user_email:this.fields.user_email,user_name:this.fields.user_name};try{await p().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch(s){}},async deleteAccount(){try{if(!this.fields.user_pass_current)return void this.$flash("Действующий пароль обязателен");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass_current};await p().post(`${this.$heap.state.hostname}User/itemDelete`,e),this.deletePromptShow=!1,await m.Z.signOut(),await this.$go("/user")}catch(e){this.$flash("Не удалось удалить аккаунт. Проверьте пароль")}},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let s="",l=0;for(let a in this.config.phoneMask){if(!this.fields.user_phone[l])break;let e=this.config.phoneMask[a];"0"==e?(s+=this.fields.user_phone[l],l++):s+=e}return this.fields.user_phone=s,this.fields.user_phone}},created(){const e=this;this.$topic.on("userGet",(s=>{e.fields=s}))}},_=l(3744);const f=(0,_.Z)(h,[["render",o]]);var c=f}}]);
//# sourceMappingURL=4217-legacy.f71ece98.js.map