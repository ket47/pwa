"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[244],{7537:function(e,t,r){r.d(t,{Z:function(){return p}});var o=r(6252),i=r(3577);const s=["src"];function l(e,t,r,l,n,u){const a=(0,o.up)("swiper-slide"),d=(0,o.up)("swiper");return(0,o.wg)(),(0,o.j4)(d,{modules:l.modules,autoplay:{delay:3e3,disableOnInteraction:!1},loop:!0,effect:"fade"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.imageList,(t=>((0,o.wg)(),(0,o.j4)(a,{key:t.image_hash},{default:(0,o.w5)((()=>[(0,o._)("div",{class:"crop-to-fit",style:(0,i.j5)(`height: ${r.imgHeight||300}px;`)},[(0,o._)("img",{style:(0,i.j5)(`min-height: ${r.imgHeight||300}px;`),src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.${4*r.imgHeight||1200}.${r.imgHeight||300}.webp`},null,12,s)],4)])),_:2},1024)))),128))])),_:1},8,["modules"])}var n=r(702),u=r(3181),a={components:{Swiper:u.t,SwiperSlide:u.o},props:["imageList","imgHeight"],setup(){return{modules:[n.pt,n.xW]}}},d=r(3744);const c=(0,d.Z)(a,[["render",l],["__scopeId","data-v-f830f732"]]);var p=c},4244:function(e,t,r){r.r(t),r.d(t,{default:function(){return X}});var o=r(6252),i=r(3577),s=r(9963);const l=e=>((0,o.dD)("data-v-6efd7e68"),e=e(),(0,o.Cn)(),e),n={style:{"background-color":"var(--ion-background-shade)"}},u={class:"store-info"},a=l((()=>(0,o._)("div",{style:{"border-bottom":"1px solid var(--ion-color-primary-tint)"}},null,-1))),d={style:{display:"grid","grid-template-columns":"30px 1fr",gap:"5px"}},c={style:{"grid-row":"1 / 2","align-items":"flex-start"}},p={style:{"grid-column":"2 / span 3",display:"flex","align-items":"center"}},g=(0,o.Uk)(" Доставит "),m={style:{color:"var(--ion-color-primary)"}},_={style:{display:"flex","justify-content":"space-between"}},f={key:0,style:{"text-align":"left"}},h={key:1,style:{"text-align":"right"}},w={class:"group-fixed-block hidden-block"};function v(e,t,r,l,v,y){const k=(0,o.up)("image-slider"),b=(0,o.up)("ion-text"),S=(0,o.up)("ion-col"),I=(0,o.up)("ion-icon"),x=(0,o.up)("router-link"),G=(0,o.up)("ion-row"),P=(0,o.up)("ion-note"),W=(0,o.up)("ion-grid"),C=(0,o.up)("ion-label"),$=(0,o.up)("ion-segment-button"),z=(0,o.up)("ion-segment"),q=(0,o.up)("ion-chip"),T=(0,o.up)("ion-searchbar"),j=(0,o.up)("group-list"),D=(0,o.up)("product-list"),H=(0,o.up)("ion-slide"),L=(0,o.up)("ion-slides"),A=(0,o.up)("ion-page"),Z=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(Z,{"page-default-back-link":"/home","page-class":"store-page",contentOnScroll:y.onScroll,"page-title":v.pageTitle},{default:(0,o.w5)((()=>[(0,o.Wm)(A,{ref:"Store"},{default:(0,o.w5)((()=>[(0,o._)("div",n,[(0,o._)("div",u,[(0,o.Wm)(k,{imageList:v.storeItem.images,imgHeight:200},null,8,["imageList"]),(0,o.Wm)(W,{style:{margin:"15px 5px 5px 5px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,{color:"primary",style:{"font-size":"20px"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(v.storeItem.store_name),1)])),_:1})])),_:1}),(0,o.Wm)(S,{style:{"text-align":"right"}},{default:(0,o.w5)((()=>[1==v.storeItem.is_writable?((0,o.wg)(),(0,o.j4)(x,{key:0,to:"/store-edit-"+v.storeItem.store_id},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{icon:l.settingsOutline,style:{"font-size":"24px"}},null,8,["icon"])])),_:1},8,["to"])):(0,o.kq)("",!0)])),_:1})])),_:1}),(0,o.Wm)(G,{style:{"font-size":"12px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(v.storeItem.store_group_names),1)])),_:1}),(0,o.wy)((0,o.Wm)(S,{style:{"text-align":"right"}},{default:(0,o.w5)((()=>[(0,o.Uk)(" закроется в "+(0,i.zw)(v.storeItem.willBeClosedAt)+":00 ",1)])),_:1},512),[[s.F8,v.storeItem.willBeClosedAt]])])),_:1}),(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(P,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(v.storeItem.store_description),1)])),_:1})])),_:1})])),_:1}),(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[a])),_:1})])),_:1}),(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,{style:{"font-size":"12px"}},{default:(0,o.w5)((()=>[(0,o._)("div",d,[(0,o._)("div",c,[(0,o.Wm)(I,{src:"./assets/icon/box-delivery.svg",style:{"font-size":"26px",color:"var(--ion-color-primary)"}})]),(0,o._)("div",p,[(0,o._)("span",null,[g,(0,o._)("b",m,(0,i.zw)(e.$heap.state.app_title),1)])])]),(0,o._)("div",_,[v.storeItem.delivery?((0,o.wg)(),(0,o.iD)("div",f,(0,i.zw)(v.storeItem.delivery.timeMin)+"-"+(0,i.zw)(v.storeItem.delivery.timeMax)+" мин ",1)):(0,o.kq)("",!0),(0,o._)("div",null,"доставка "+(0,i.zw)(e.$heap.state.deliverySettings.fee)+"₽",1),v.storeItem.store_minimal_order?((0,o.wg)(),(0,o.iD)("div",h," заказ от "+(0,i.zw)(v.storeItem.store_minimal_order)+"₽ ",1)):(0,o.kq)("",!0)])])),_:1})])),_:1})])),_:1})]),(0,o._)("div",w,[(0,o.Wm)(z,{ref:"segment",scrollable:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(v.storeGroups,(e=>((0,o.wg)(),(0,o.j4)($,{key:e.group_id,value:e.group_id,onClick:t=>y.setActiveParentGroup(e.group_id),ref_for:!0,ref:"group-tab-"+e.group_id},{default:(0,o.w5)((()=>[(0,o.Wm)(C,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.group_name),1)])),_:2},1024)])),_:2},1032,["value","onClick"])))),128))])),_:1},512),v.storeGroups[v.activeParentGroupId]?((0,o.wg)(),(0,o.j4)(G,{key:0,class:"groups-container"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(v.storeGroups[v.activeParentGroupId].children,(e=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(q,{color:"primary",key:e.group_id,ref_for:!0,ref:"group-chip-"+e.group_id,onClick:t=>y.scrollTo(e.group_id)},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{color:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.group_name),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[s.F8,v.storeProducts[e.group_id]]]))),128))])),_:1})):(0,o.kq)("",!0)]),(0,o.Wm)(T,{class:"search-container",value:v.searchRequest,onInput:t[0]||(t[0]=e=>{y.getStoreProducts({name_query:e.target.value,name_query_fields:"product_name,product_code"}),v.searchRequest=e.target.value}),placeholder:"Поиск в этом предприятии"},null,8,["value"]),(0,o.Wm)(j,{groupList:v.storeGroups,onClick:e=>{y.setActiveParentGroup(e)}},null,8,["groupList","onClick"]),0!==v.storeGroups.length?((0,o.wg)(),(0,o.j4)(L,{key:0,pager:"true",ref:"slides",options:l.slideOpts,class:"product-list-slider",onIonSlideDidChange:t[1]||(t[1]=e=>y.slideChanged(e))},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(v.storeGroups,(e=>((0,o.wg)(),(0,o.j4)(H,{key:e.group_id},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{class:"product-list"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.children,(e=>(0,o.wy)(((0,o.wg)(),(0,o.j4)(G,{key:e.group_id,ref_for:!0,ref:"group-"+e.group_id,"data-group_id":e.group_id},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{class:"group-title",size:"12"},{default:(0,o.w5)((()=>[(0,o._)("label",null,[(0,o._)("b",null,(0,i.zw)(e.group_name),1)])])),_:2},1024),(0,o.Wm)(S,{size:"12"},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{productList:v.storeProducts[e.group_id]},null,8,["productList"])])),_:2},1024)])),_:2},1032,["data-group_id"])),[[s.F8,v.storeProducts[e.group_id]]]))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["options"])):(0,o.kq)("",!0)])])),_:1},512)])),_:1},8,["contentOnScroll","page-title"])}var y=r(8903),k=r(7537);const b={id:"hcat_widget_grid"},S=["onClick"];function I(e,t,r,s,l,n){const u=(0,o.up)("ion-img"),a=(0,o.up)("ion-thumbnail"),d=(0,o.up)("ion-label");return(0,o.wg)(),(0,o.iD)("div",b,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.groupList,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.group_id,onClick:()=>r.onClick(t.group_id)},[(0,o.Wm)(a,{style:{width:"70px",height:"70px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{style:{"border-radius":"10px",border:"1px solid #ddd"},src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".150.150.webp"},null,8,["src"])])),_:2},1024),(0,o.Wm)(d,{style:{height:"2em","text-align":"center"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(t.group_name),1)])),_:2},1024)],8,S)))),128))])}var x={props:["groupList","onClick"]},G=r(3744);const P=(0,G.Z)(x,[["render",I],["__scopeId","data-v-5c504139"]]);var W=P;const C={class:"product_list_widget_grid"},$=["id"],z={style:{},class:"product_list_item_img"},q={style:{position:"relative",top:"-50%"}},T={style:{height:"50px",overflow:"hidden"}},j={key:0,style:{color:"var(--ion-color-danger)"}},D=(0,o.Uk)("   "),H={style:{color:"var(--ion-color-primary)"}},L=(0,o.Uk)(" / "),A={style:{color:"var(--ion-color-medium)"}},Z={style:{color:"black"}};function O(e,t,r,s,l,n){const u=(0,o.up)("cart-add-buttons"),a=(0,o.up)("ion-img"),d=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",C,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.productList,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.product_id,class:(0,i.C_)(t.product_quantity>0?"":"absent"),id:`product_list_item${t.product_id}`},[(0,o._)("div",z,[(0,o._)("div",q,[(0,o.Wm)(u,{buttonLayout:"vertical",productItem:t},null,8,["productItem"])]),(0,o.Wm)(d,{class:"link",to:"product-"+t.product_id},{default:(0,o.w5)((()=>[t.image_hash?((0,o.wg)(),(0,o.j4)(a,{key:0,src:e.$heap.state.hostname+"/image/get.php/"+t.image_hash+".150.150.webp"},null,8,["src"])):(0,o.kq)("",!0)])),_:2},1032,["to"])]),(0,o._)("div",T,[(0,o.Wm)(d,{class:"link",to:"product-"+t.product_id},{default:(0,o.w5)((()=>[t.product_price!=t.product_final_price?((0,o.wg)(),(0,o.iD)("span",j,[(0,o._)("s",null,(0,i.zw)(t.product_price)+(0,i.zw)(e.$heap.state.currencySign),1),D])):(0,o.kq)("",!0),(0,o._)("span",H,(0,i.zw)(t.product_final_price)+(0,i.zw)(e.$heap.state.currencySign),1),L,(0,o._)("span",A,(0,i.zw)(t.product_unit),1),(0,o._)("div",Z,(0,i.zw)(t.product_name),1)])),_:2},1032,["to"])])],10,$)))),128))])}var M=r(6782),U={props:["productList","onClick"],components:{CartAddButtons:M.Z}};const R=(0,G.Z)(U,[["render",O],["__scopeId","data-v-74ade420"]]);var B=R,K=r(7873),Y=r(9755),N=r.n(Y),F=r(2008),V=r(4405);const J={slidesPerView:1,pagination:!1,centeredSlides:!1,initialSlide:0,speed:400,watchSlidesProgress:!1,grabCursor:!0,touchStartForcePreventDefault:!0};var E={components:{ImageSlider:k.Z,IonSlides:K.Hr,IonSlide:K.A$,GroupList:W,ProductList:B},setup(){return{search:y.yC4,settingsOutline:y.C$N,slideOpts:J}},data(){return{storeId:this.$route.params.id,searchRequest:"",pageTitle:"Магазин",error:"",storeItem:[],storeProducts:{},storeGroups:[],activeGroup:{children:[]},activeParentGroupId:0,offsetModificator:150}},computed:{isSignedIn(){return F.Z.state.user.user_id&&F.Z.state.user.user_id>-1}},methods:{setActiveParentGroup(e){this.activeParentGroupId=e;var t=Object.keys(this.storeGroups[this.activeParentGroupId].children)[0],r=this;setTimeout((function(){r.scrollTo(t),r.setSubgroupActive(t)}),200);var o=Object.keys(this.storeGroups).indexOf(this.activeParentGroupId);this.$refs.slides&&this.$refs.slides.$el.slideTo(o,!1,(function(){return!1}))},slideChanged(e){var t=this;e.target.getActiveIndex().then((function(e){var r=Object.keys(t.storeGroups)[e];t.setActiveParentGroup(r),t.$refs.segment.value=t.activeParentGroupId;var o=Object.keys(t.storeGroups[t.activeParentGroupId].children)[0];setTimeout((function(){t.scrollTo(o),t.setSubgroupActive(o)}),200)}))},async getStore(){try{const e=await N().post(F.Z.state.hostname+"Store/itemGet",{store_id:this.storeId,distance_include:1});this.storeItem=this.prepareStore(e),this.storeId=e.store_id,this.pageTitle=e.store_name,this.getStoreGroupTree({store_id:this.storeId}),F.Z.commit("setCurrentStore",this.storeItem)}catch(e){}},prepareStore(e){e.member_of_groups.group_names&&(e.store_group_names=e.member_of_groups.group_names);var t=new Date;return e.willBeClosedAt=e["store_time_closes_"+t.getDay()],e.delivery=V.Z.deliveryCalculate(e),e},getStoreGroupTree(e){var t=this;N().post(F.Z.state.hostname+"Product/groupTreeGet",{store_id:e.store_id}).done((function(e){t.storeGroups=e;var r=Object.keys(t.storeGroups)[0];t.$refs.segment&&(t.$refs.segment.value=r,t.activeParentGroupId=r),t.getStoreProducts()})).fail((function(e){t.error=e.responseJSON.messages.error}))},getStoreProducts(e={}){if(e.store_id=this.storeId,e.is_active=1,e.name_query&&""==e.name_query)this.getStoreGroupTree({store_id:t.storeId});else{var t=this;N().post(F.Z.state.hostname+"Product/listGet",e).done((function(e){t.prepareProductList(e.product_list);var r=Object.keys(t.storeGroups[t.activeParentGroupId].children)[0];t.setSubgroupActive(r)})).fail((function(e){t.error=e.responseJSON.messages.error}))}},prepareProductList(e){for(var t of(this.storeProducts={},e))this.storeGroups&&(this.storeProducts[t.group_id]||(this.storeProducts[t.group_id]=[])),this.storeProducts[t.group_id].push(t)},setSubgroupActive(e){var t=document.querySelectorAll(".groups-container ion-chip");for(var r of t)r.classList.remove("active-chip");this.$refs["group-chip-"+e]&&this.$refs["group-chip-"+e][0]&&this.$refs["group-chip-"+e][0].classList&&this.$refs["group-chip-"+e][0].classList.add("active-chip")},scrollTo(e){if(!this.$refs["group-"+e][0])return;const t=document.querySelector("ion-content").shadowRoot.querySelector("main").scrollTop,r=this.$refs["group-"+e][0].getBoundingClientRect().top;var o=t+r-this.offsetModificator-window.innerHeight/4,i=Object.keys(this.storeGroups[this.activeParentGroupId].children)[0];i==e&&(o=t+r-this.offsetModificator),document.querySelector("ion-content").shadowRoot.querySelector("main").scrollTo({top:o,behavior:"smooth"});var s=this;setTimeout((function(){s.setSubgroupActive(e)}),500)},onScroll(e){const t=document.querySelector(".product-list-slider")?.offsetTop,r=document.querySelector(".group-fixed-block")?.offsetHeight;t-r-100<e.detail.scrollTop?document.querySelector(".group-fixed-block").className="group-fixed-block":document.querySelector(".group-fixed-block").className="group-fixed-block hidden-block";var o=document.querySelectorAll(".swiper-slide-active .product-list ion-row");for(var i of o)if(i.getBoundingClientRect().top-this.offsetModificator<=window.innerHeight-window.innerHeight/4&&i.getBoundingClientRect().bottom+this.offsetModificator>=window.innerHeight-window.innerHeight/4&&i.dataset.group_id){this.setSubgroupActive(i.dataset.group_id);break}}},ionViewDidEnter(){this.getStore()},watch:{$route(e){this.storeId=e.params.id}}};const Q=(0,G.Z)(E,[["render",v],["__scopeId","data-v-6efd7e68"]]);var X=Q},4405:function(e,t,r){var o=r(2008);const i={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const t=e.locations[0].distance,r=e.store_time_preparation||0;return i.deliveryTimeCalculate(t,r)},deliveryTimeCalculate(e,t){t=t??o.Z.state.deliverySettings.defaultPreparationTime;const r=o.Z.state.deliverySettings.deliveryTimeDelta,i=5*Math.round(e/o.Z.state.deliverySettings.courierVelocity*60/5)+parseInt(t),s=i>r?i-r:i,l=s+r;return{time:i,timeMin:s,timeMax:l}}};t["Z"]=i}}]);
//# sourceMappingURL=244.0364f44a.js.map