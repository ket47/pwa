{"version":3,"file":"js/9515.8a24776a.js","mappings":"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","sources":["webpack://Tezkel/./src/views/UserVerifyPhone.vue","webpack://Tezkel/./src/views/UserVerifyPhone.vue?cefe"],"sourcesContent":["<template>\n  <base-layout page-title=\"Подтверждение телефона\" pageDefaultBackLink=\"/user\">\n      <ion-card color=\"light\">\n        <ion-card-header>\n          <ion-card-title color=\"primary\">\n            Подтверждение номера телефона\n          </ion-card-title>\n        </ion-card-header>\n        <ion-card-content>\n          <p>Мы выслали вам смс с кодом подтверждения на номер <b>{{user_phone}}</b>. Введите 4 цифры из смс ниже</p>\n          <hr/>\n          <p>Поступление СМС на ваш телефон может занять до 2 минут.</p>\n        </ion-card-content>\n      </ion-card>\n\n      <form novalidate>\n        <ion-list>\n          <ion-item>\n            <ion-row>\n              <ion-col>\n                <ion-label position=\"stacked\" color=\"primary\">Код подтверждения из смс</ion-label>\n                <ion-input\n                  v-model=\"verification_code\"\n                  type=\"numeric\"\n                  inputmode=\"numeric\"\n                  maxlength=\"4\"\n                  pattern=\"\\d{4}\"\n                  placeholder=\"- - - -\"\n                  @ionInput=\"verification_code=$event.target.value;onSubmit()\"\n                  enterkeyhint=\"go\"\n                  required\n                  autocomplete=\"one-time-code\"\n                ></ion-input>\n              </ion-col>\n            </ion-row>\n          </ion-item>\n        </ion-list>\n\n        <ion-row responsive-sm>\n          <ion-col>\n            <ion-button @click=\"onSubmit()\" expand=\"block\">Подтвердить</ion-button>\n          </ion-col>\n        </ion-row>\n\n        <ion-row responsive-sm>\n          <ion-col>\n            <ion-button @click=\"is_sent=false;smsSend()\" expand=\"block\" color=\"light\" :disabled=\"timeToResend>0\">Послать снова {{timeLeft}}</ion-button>\n          </ion-col>\n        </ion-row>\n      </form>\n  </base-layout>\n</template>\n\n<script>\nimport { \n  IonLabel,\n  IonCol,\n  IonInput,\n  IonRow,\n  IonButton,\n  IonCard,\n  IonCardHeader,\n  IonCardTitle,\n  IonCardContent,\n  IonItem,\n  IonList,\n}                     from '@ionic/vue';\nimport jQuery         from \"jquery\";\nimport User           from '@/scripts/User.js';\n\nexport default  {\n  name:'UserVerifyPhone',\n  components:{\n  IonLabel,\n  IonCol,\n  IonInput,\n  IonRow,\n  IonButton,\n  IonCard,\n  IonCardHeader,\n  IonCardTitle,\n  IonCardContent,\n  IonItem,\n  IonList,\n  },\n  data(){\n    return {\n      verification_code:null,\n      user_phone:this.$heap.state.user.tmp_userphone||this.$route.params.user_phone||this.$route.query.user_phone||'',//this.$heap.state.user.tmp_userphone seems is more reliable\n      is_sent:false,\n      timeToResend:120\n    }\n  },\n  created(){\n    this.smsSend();\n    if( navigator.credentials ){\n      navigator.credentials.get({\n        otp: {transport:['sms']}\n      })\n      .then(otp => this.verification_code = otp.code);\n    }\n  },\n  ionViewDidEnter(){\n    this.smsSend();\n  },\n  computed:{\n    timeLeft(){\n      const min=Math.floor(this.timeToResend/60);\n      const sec=this.timeToResend-60*min;\n      return `${min}:${sec}`\n    }\n  },\n  methods:{\n    clockStart(){\n      if(this.timeToResend<=0){\n        return\n      }\n      this.timeToResend--\n      setTimeout(()=>this.clockStart(),1000)\n    },\n    async smsSend(){\n      if(this.is_sent){\n        return\n      }\n      //this.user_phone=this.$route.params.user_phone||this.$route.query.user_phone||'';\n      if(!this.user_phone){\n        this.$router.replace('/user')\n        return;\n      }\n      let requestData = {\n        user_phone: this.user_phone\n      }\n      try{\n        this.is_sent=true\n        await jQuery.post( `${this.$heap.state.hostname}User/phoneVerificationSend`, requestData)\n        this.timeToResend=120\n        this.clockStart()\n      }catch{/** */}\n    },\n    async onSubmit() {\n      if( !this.verification_code || String(this.verification_code).length!=4 ){\n        return\n      }\n      try{\n        await jQuery.post( `${this.$heap.state.hostname}/User/phoneVerificationCheck`, {user_phone: this.user_phone, verification_code: this.verification_code})\n        this.$flash(\"Номер телефона верифицирован\")\n        this.$router.replace('/user')\n        await User.autoSignIn()\n        this.$go('/catalog')\n      } catch(err){\n        const message=err.responseJSON.messages.error\n        switch(message){\n          case 'verification_not_found':\n            this.$flash(\"Код верификации устарел\")\n            this.$router.replace('/user/sign-in')\n            break;\n        }\n        this.$flash(\"Не удалось верифицировать телефон\")\n      }\n    },\n  },\n}\n</script>","import { render } from \"./UserVerifyPhone.vue?vue&type=template&id=4d7f1444\"\nimport script from \"./UserVerifyPhone.vue?vue&type=script&lang=js\"\nexport * from \"./UserVerifyPhone.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","novalidate","_createBlock","_component_base_layout","pageDefaultBackLink","default","_withCtx","_createVNode","_component_ion_card","color","_component_ion_card_header","_component_ion_card_title","_createTextVNode","_","_component_ion_card_content","_toDisplayString","$data","user_phone","_hoisted_1","_hoisted_2","_hoisted_3","_component_ion_list","_component_ion_item","_component_ion_row","_component_ion_col","_component_ion_label","position","_component_ion_input","modelValue","verification_code","_cache","$event","type","inputmode","maxlength","pattern","placeholder","onIonInput","target","value","$options","onSubmit","enterkeyhint","required","autocomplete","_component_ion_button","onClick","expand","is_sent","smsSend","disabled","timeToResend","timeLeft","name","components","IonLabel","IonCol","IonInput","IonRow","IonButton","IonCard","IonCardHeader","IonCardTitle","IonCardContent","IonItem","IonList","data","this","$heap","state","user","tmp_userphone","$route","params","query","created","navigator","credentials","get","otp","transport","then","code","ionViewDidEnter","computed","min","Math","floor","sec","methods","clockStart","setTimeout","$router","replace","requestData","jQuery","hostname","String","length","$flash","User","autoSignIn","$go","err","message","responseJSON","messages","error","__exports__","render"],"sourceRoot":""}