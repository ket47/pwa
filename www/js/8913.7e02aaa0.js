(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[8913],{9587:function(t,e,o){var i=o(614),r=o(111),l=o(7674);t.exports=function(t,e,o){var d,n;return l&&i(d=e.constructor)&&d!==o&&r(n=d.prototype)&&n!==o.prototype&&l(t,n),t}},7850:function(t,e,o){var i=o(111),r=o(4326),l=o(5112),d=l("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[d])?!!e:"RegExp"==r(t))}},2626:function(t,e,o){var i=o(3070).f;t.exports=function(t,e,o){o in t||i(t,o,{configurable:!0,get:function(){return e[o]},set:function(t){e[o]=t}})}},4706:function(t,e,o){var i=o(6916),r=o(2597),l=o(7976),d=o(7066),n=RegExp.prototype;t.exports=function(t){var e=t.flags;return void 0!==e||"flags"in n||r(t,"flags")||!l(n,t)?e:i(d,t)}},4603:function(t,e,o){var i=o(9781),r=o(7854),l=o(1702),d=o(4705),n=o(9587),a=o(8880),u=o(8006).f,s=o(7976),c=o(7850),p=o(1340),m=o(4706),_=o(2999),h=o(2626),g=o(8052),f=o(7293),w=o(2597),k=o(9909).enforce,I=o(6340),y=o(5112),v=o(9441),W=o(7168),b=y("match"),U=r.RegExp,C=U.prototype,O=r.SyntaxError,D=l(C.exec),V=l("".charAt),G=l("".replace),$=l("".indexOf),L=l("".slice),j=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,q=/a/g,P=/a/g,x=new U(q)!==q,z=_.MISSED_STICKY,S=_.UNSUPPORTED_Y,F=i&&(!x||z||v||W||f((function(){return P[b]=!1,U(q)!=q||U(P)==P||"/a/i"!=U(q,"i")}))),M=function(t){for(var e,o=t.length,i=0,r="",l=!1;i<=o;i++)e=V(t,i),"\\"!==e?l||"."!==e?("["===e?l=!0:"]"===e&&(l=!1),r+=e):r+="[\\s\\S]":r+=e+V(t,++i);return r},Z=function(t){for(var e,o=t.length,i=0,r="",l=[],d={},n=!1,a=!1,u=0,s="";i<=o;i++){if(e=V(t,i),"\\"===e)e+=V(t,++i);else if("]"===e)n=!1;else if(!n)switch(!0){case"["===e:n=!0;break;case"("===e:D(j,L(t,i+1))&&(i+=2,a=!0),r+=e,u++;continue;case">"===e&&a:if(""===s||w(d,s))throw new O("Invalid capture group name");d[s]=!0,l[l.length]=[s,u],a=!1,s="";continue}a?s+=e:r+=e}return[r,l]};if(d("RegExp",F)){for(var T=function(t,e){var o,i,r,l,d,u,_=s(C,this),h=c(t),g=void 0===e,f=[],w=t;if(!_&&h&&g&&t.constructor===T)return t;if((h||s(C,t))&&(t=t.source,g&&(e=m(w))),t=void 0===t?"":p(t),e=void 0===e?"":p(e),w=t,v&&"dotAll"in q&&(i=!!e&&$(e,"s")>-1,i&&(e=G(e,/s/g,""))),o=e,z&&"sticky"in q&&(r=!!e&&$(e,"y")>-1,r&&S&&(e=G(e,/y/g,""))),W&&(l=Z(t),t=l[0],f=l[1]),d=n(U(t,e),_?this:C,T),(i||r||f.length)&&(u=k(d),i&&(u.dotAll=!0,u.raw=T(M(t),o)),r&&(u.sticky=!0),f.length&&(u.groups=f)),t!==w)try{a(d,"source",""===w?"(?:)":w)}catch(I){}return d},Y=u(U),B=0;Y.length>B;)h(T,U,Y[B++]);C.constructor=T,T.prototype=C,g(r,"RegExp",T,{constructor:!0})}I("RegExp")},7327:function(t,e,o){"use strict";o.d(e,{Z:function(){return p}});var i=o(6252),r=o(3577);const l=(0,i.Uk)("Просмотр фотографии");function d(t,e,o,d,n,a){const u=(0,i.up)("ion-title"),s=(0,i.up)("ion-icon"),c=(0,i.up)("ion-toolbar"),p=(0,i.up)("ion-header"),m=(0,i.up)("ion-button"),_=(0,i.up)("ion-col"),h=(0,i.up)("ion-row"),g=(0,i.up)("ion-grid"),f=(0,i.up)("ion-img"),w=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[l])),_:1}),(0,i.Wm)(s,{icon:d.closeOutline,onClick:e[0]||(e[0]=t=>{d.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[o.actions?((0,i.wg)(),(0,i.j4)(g,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.actions,((t,e)=>((0,i.wg)(),(0,i.j4)(_,{key:e},{default:(0,i.w5)((()=>{var o;return[t[0]?((0,i.wg)(),(0,i.j4)(m,{key:0,onClick:o=>a.actionCreate(e,t[1]),expand:"block",color:null!==(o=t[1])&&void 0!==o?o:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(t[0]),1)])),_:2},1032,["onClick","color"])):(0,i.kq)("",!0)]})),_:2},1024)))),128))])),_:1})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{src:t.$heap.state.hostname+"image/get.php/"+o.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var n=o(8903),a=o(8292),u={props:["image_hash","actions"],components:{IonIcon:a.gu,IonToolbar:a.sr,IonHeader:a.Gu,IonImg:a.Xz,IonContent:a.W2,IonTitle:a.wd,IonButton:a.YG,IonCol:a.wI,IonRow:a.Nd,IonGrid:a.jY},setup(){const t=function(){a.Fy.dismiss()};return{closeModal:t,closeOutline:n.fID}},methods:{actionCreate(t,e){("danger"!=e||confirm("Вы уверены?"))&&a.Fy.dismiss(null,t)}}},s=o(3744);const c=(0,s.Z)(u,[["render",d]]);var p=c},2226:function(t,e,o){"use strict";o.d(e,{Z:function(){return W}});var i=o(6252),r=o(3577);const l=(0,i.Uk)("Фотографии"),d={key:0,class:"image_grid"},n=["onClick"],a={key:0},u={key:1},s={key:0,class:"image_controls"},c=["id"];function p(t,e,o,p,m,_){var h;const g=(0,i.up)("ion-label"),f=(0,i.up)("ion-icon"),w=(0,i.up)("ion-item"),k=(0,i.up)("ion-img"),I=(0,i.up)("ion-avatar");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(w,{lines:"none",onClick:e[0]||(e[0]=t=>{m.editMode=!m.editMode,m.editMode&&_.load()})},{default:(0,i.w5)((()=>[o.title?((0,i.wg)(),(0,i.j4)(g,{key:0,color:"imageList?.length?'':medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(o.title),1)])),_:1})):((0,i.wg)(),(0,i.j4)(g,{key:1,color:"imageList?.length?'':medium"},{default:(0,i.w5)((()=>[l])),_:1})),m.editMode?((0,i.wg)(),(0,i.j4)(f,{key:2,slot:"end",icon:p.settingsSharp,color:"primary"},null,8,["icon"])):((0,i.wg)(),(0,i.j4)(f,{key:3,slot:"end",icon:p.settingsOutline},null,8,["icon"]))])),_:1}),null!==(h=_.imageList)&&void 0!==h&&h.length?((0,i.wg)(),(0,i.iD)("div",d,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.imageList,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.image_id,style:{position:"relative"}},[(0,i._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:t=>_.imagePreview(e.image_hash)},[e.deleted_at?((0,i.wg)(),(0,i.iD)("div",a,"будет удалено")):1==e.is_disabled?((0,i.wg)(),(0,i.iD)("div",u,"на модерации")):(0,i.kq)("",!0)],8,n),(0,i.Wm)(I,{onClick:t=>_.imagePreview(e.image_hash),class:(0,r.C_)(e.class)},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),m.editMode?((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(f,{icon:p.chevronBackCircleOutline,onClick:t=>_.back(e)},null,8,["icon","onClick"]),_.isAdmin&&1==e.is_disabled?((0,i.wg)(),(0,i.j4)(f,{key:0,icon:p.checkmarkCircle,color:"success",onClick:t=>_.enable(e)},null,8,["icon","onClick"])):(0,i.kq)("",!0),e.deleted_at?((0,i.wg)(),(0,i.j4)(f,{key:1,icon:p.addCircle,color:"success",onClick:t=>_.restore(e)},null,8,["icon","onClick"])):((0,i.wg)(),(0,i.j4)(f,{key:2,icon:p.trash,color:"danger",onClick:t=>_.remove(e)},null,8,["icon","onClick"])),(0,i.Wm)(f,{icon:p.chevronForwardCircleOutline,onClick:t=>_.forward(e)},null,8,["icon","onClick"])])):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0),(0,i._)("input",{type:"file",id:m.fileUploaderId,accept:".png, .jpg, .jpeg, .webp, .gif",onChange:e[1]||(e[1]=t=>_.uploadImage(t)),style:{display:"none"}},null,40,c)])}var m=o(8903),_=o(8292),h=o(7327),g=o(9755),f=o.n(g),w=o(9042),k=o(351),I={props:["images","image_holder","image_holder_id","controller","title"],components:{IonLabel:_.Q$,IonIcon:_.gu,IonItem:_.Ie,IonImg:_.Xz,IonAvatar:_.BJ},setup(){return{settingsOutline:m.C$N,settingsSharp:m.kiF,chevronBackCircleOutline:m.CK0,chevronForwardCircleOutline:m.esm,trash:m._Ij,addCircle:m.ZWo,checkmarkCircle:m.I1A}},data(){var t;return{images_loaded:null,editMode:!1,fileUploaderId:(null!==(t=this.image_holder)&&void 0!==t?t:this.controller)+this.image_holder_id}},computed:{imageList(){let t=this.images_loaded||this.images,e=[];for(let o in t)t[o].deleted_at?(t[o].class=" deleted",this.editMode&&e.push(t[o])):1==t[o].is_disabled?(t[o].class=" disabled",this.editMode&&e.push(t[o])):e.push(t[o]);return e},isAdmin(){return k.Z.isAdmin()}},methods:{async back(t){try{await f().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:t.image_id,dir:"up"}),this.load()}catch(e){}},async forward(t){try{await f().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:t.image_id,dir:"down"}),this.load()}catch(e){}},async remove(t){try{await f().post(this.$heap.state.hostname+"Image/itemDelete",{image_id:t.image_id}),this.load(),this.$flash("Фото перемещено в корзину и будет удалено")}catch(e){}},async restore(t){try{await f().post(this.$heap.state.hostname+"Image/itemUnDelete",{image_id:t.image_id}),this.load(),this.$flash("Фото перемещено извлечено из корзины")}catch(e){}},async enable(t){try{await f().post(this.$heap.state.hostname+"Image/itemDisable",{image_id:t.image_id,is_disabled:0}),this.load()}catch(e){}},async load(){var t;const e={image_holder_id:this.image_holder_id,image_holder:null!==(t=this.image_holder)&&void 0!==t?t:this.controller,is_disabled:1,is_deleted:1,is_active:1};this.images_loaded=await f().post(this.$heap.state.hostname+"Image/listGet",e)},async imagePreview(t){const e=await _.Fy.create({component:h.Z,componentProps:{image_hash:t},initialBreakpoint:.5,breakpoints:[.5,1]}),o=function(){e.dismiss()};return w.Z.on("dismissModal",o),e.present()},async uploadImage(t){let e=new FormData;e.append("files[]",t.target.files[0]),e.set("image_holder_id",this.image_holder_id),this.image_holder&&e.set("image_holder",this.image_holder);const o={url:this.$heap.state.hostname+this.controller+"/fileUpload",type:"POST",data:e,processData:!1,contentType:!1};try{await f().ajax(o),this.load()}catch(n){var i,r,l,d;if("limit_exeeded"==(null===n||void 0===n||null===(i=n.responseJSON)||void 0===i||null===(r=i.messages)||void 0===r?void 0:r.error))return void this.$flash("Уже загружено максимальное количество фото");if("no_valid_images"==(null===n||void 0===n||null===(l=n.responseJSON)||void 0===l||null===(d=l.messages)||void 0===d?void 0:d.error))return void this.$flash("Формат файла не поддерживается");this.$flash("Не удалось загрузить фото")}},take_photo(){f()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}},y=o(3744);const v=(0,y.Z)(I,[["render",p],["__scopeId","data-v-5ec0cc30"]]);var W=v},8913:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return gt}});o(3948),o(4916),o(5306);var i=o(6252),r=o(3577);const l=t=>((0,i.dD)("data-v-ff703546"),t=t(),(0,i.Cn)(),t),d={key:0},n={key:0},a=(0,i.Uk)("Обратите внимание на то, что поля "),u=l((()=>(0,i._)("ul",null,[(0,i._)("li",null,"Название (больше 5 букв), "),(0,i._)("li",null,"Цена, "),(0,i._)("li",null,"Актуальный остаток (если ведется учет), "),(0,i._)("li",null,"Изображения товара")],-1))),s=(0,i.Uk)(" обязательные "),c=[a,u,s],p=(0,i.Uk)(" Удалено "),m=(0,i.Uk)(" Вести учет остатков "),_=(0,i.Uk)(" Имеет варианты "),h=(0,i.Uk)(" На модерации "),g=(0,i.Uk)(" Родительский товар "),f=(0,i.Uk)("Вариант*"),w={style:{display:"grid","grid-template-columns":"1fr 1fr"}},k=(0,i.Uk)("Вариант*"),I=(0,i.Uk)("добавить"),y={key:2},v=(0,i.Uk)(" Показать товар "),W=(0,i.Uk)(" Показать в магазине "),b=(0,i.Uk)(" Управление магазином "),U=(0,i.Uk)("Основные настройки"),C=(0,i.Uk)("Название*"),O=(0,i.Uk)("Описание*"),D=(0,i.Uk)("Артикул"),V=(0,i.Uk)("Штрихкод"),G=(0,i.Uk)("Остаток "),$={key:0},L=(0,i.Uk)("Мин. заказ*"),j={key:0},q=(0,i.Uk)("Единица*"),P=(0,i.Uk)("штука"),x=(0,i.Uk)("порция вес"),z=(0,i.Uk)("порция объем"),S=(0,i.Uk)("килограмм"),F=(0,i.Uk)("метр"),M=(0,i.Uk)("литр"),Z=(0,i.Uk)("Объем л*"),T=(0,i.Uk)("Цена"),Y=(0,i.Uk)("Цена*"),B=(0,i.Uk)("Цена в меню/на полке"),H=(0,i.Uk)("Цена акционная"),A=(0,i.Uk)("Начало акции"),E=(0,i.Uk)("Конец акции"),K=(0,i.Uk)("Изображения товара*"),N=(0,i.Uk)(" Добавить фото на витрину "),Q=(0,i.Uk)("Категории товара*"),R=(0,i.Uk)("Без категории (в разделе 'Другое')"),J=(0,i.Uk)("Добавить в категорию");function X(t,e,o,l,a,u){var s,X;const tt=(0,i.up)("ion-progress-bar"),et=(0,i.up)("ion-card-title"),ot=(0,i.up)("ion-card-header"),it=(0,i.up)("ion-text"),rt=(0,i.up)("ion-card-content"),lt=(0,i.up)("ion-card"),dt=(0,i.up)("ion-icon"),nt=(0,i.up)("ion-toggle"),at=(0,i.up)("ion-item"),ut=(0,i.up)("ion-card-subtitle"),st=(0,i.up)("ion-img"),ct=(0,i.up)("ion-label"),pt=(0,i.up)("ion-input"),mt=(0,i.up)("ion-chip"),_t=(0,i.up)("ion-button"),ht=(0,i.up)("ion-item-divider"),gt=(0,i.up)("ion-list"),ft=(0,i.up)("ion-textarea"),wt=(0,i.up)("ion-select-option"),kt=(0,i.up)("ion-select"),It=(0,i.up)("ion-item-group"),yt=(0,i.up)("image-tile-comp"),vt=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(vt,{"page-title":null!==(s=null===(X=a.productItem)||void 0===X?void 0:X.product_name)&&void 0!==s?s:"Товар",pageDefaultBackLink:"/catalog"},{default:(0,i.w5)((()=>{var o,s;return[a.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",d,[(0,i.Wm)(lt,{color:(null===(o=a.productItem)||void 0===o?void 0:o.validity)<a.validity_min?"danger":""},{default:(0,i.w5)((()=>{var t;return[(0,i.Wm)(ot,null,{default:(0,i.w5)((()=>[(0,i.Wm)(et,null,{default:(0,i.w5)((()=>{var t,e,o;return[(0,i.Uk)(" Форма заполнена на "+(0,r.zw)(null!==(t=null===(e=a.productItem)||void 0===e?void 0:e.validity)&&void 0!==t?t:0)+"% ",1),(0,i.Wm)(tt,{value:(null===(o=a.productItem)||void 0===o?void 0:o.validity)/100},null,8,["value"])]})),_:1})])),_:1}),(null===(t=a.productItem)||void 0===t?void 0:t.validity)<a.validity_min?((0,i.wg)(),(0,i.j4)(rt,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(it,null,{default:(0,i.w5)((()=>{var t;return[(0,i.Uk)(" Вам необходимо заполнить анкету не меньше чем на "+(0,r.zw)(a.validity_min)+"% для рассмотрения модератором ",1),0==(null===(t=a.productItem)||void 0===t?void 0:t.validity)?((0,i.wg)(),(0,i.iD)("p",n,c)):(0,i.kq)("",!0)]})),_:1})])),_:1})):(0,i.kq)("",!0)]})),_:1},8,["color"]),u.message&&(null===(s=a.productItem)||void 0===s?void 0:s.validity)>a.validity_min?((0,i.wg)(),(0,i.j4)(lt,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(rt,{class:(0,r.C_)(u.messageClass)},{default:(0,i.w5)((()=>[(0,i.Wm)(it,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(u.message),1)])),_:1})])),_:1},8,["class"])])),_:1})):(0,i.kq)("",!0)])),a.productItem?((0,i.wg)(),(0,i.j4)(gt,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.trashOutline,color:"primary",slot:"start"},null,8,["src"]),p,(0,i.Wm)(nt,{slot:"end",modelValue:a.is_deleted,"onUpdate:modelValue":e[0]||(e[0]=t=>a.is_deleted=t),color:"danger",onIonChange:e[1]||(e[1]=t=>u.itemDelete(t.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.pizzaOutline,color:"primary",slot:"start"},null,8,["src"]),m,a.productItem?((0,i.wg)(),(0,i.j4)(nt,{key:0,slot:"end",modelValue:a.is_counted,"onUpdate:modelValue":e[2]||(e[2]=t=>a.is_counted=t),onIonChange:e[3]||(e[3]=t=>u.save("is_counted",t.target.checked?1:0))},null,8,["modelValue"])):(0,i.kq)("",!0)])),_:1}),a.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(at,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.layersOutline,color:"primary",slot:"start"},null,8,["src"]),_,a.productItem?((0,i.wg)(),(0,i.j4)(nt,{key:0,slot:"end",modelValue:a.is_option_parent,"onUpdate:modelValue":e[4]||(e[4]=t=>a.is_option_parent=t),onIonChange:e[5]||(e[5]=t=>{u.itemOptionSet(t.target.checked)})},null,8,["modelValue"])):(0,i.kq)("",!0)])),_:1})),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.ribbonOutline,color:"primary",slot:"start"},null,8,["src"]),h,(0,i.Wm)(nt,{slot:"end",modelValue:a.is_disabled,"onUpdate:modelValue":e[6]||(e[6]=t=>a.is_disabled=t),onIonChange:e[7]||(e[7]=t=>u.itemDisable(t.target.checked?1:0))},null,8,["modelValue"])])),_:1}),a.optionData?((0,i.wg)(),(0,i.iD)("div",{key:1,onChange:e[12]||(e[12]=(...t)=>u.saveForm&&u.saveForm(...t))},[(0,i.Wm)(lt,{onClick:e[9]||(e[9]=e=>t.$router.replace(`product-edit-${a.optionData.parent.product_id}?refreshOptions=1`)),color:a.productId==a.optionData.parent.product_id?"primary":"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(ot,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ut,null,{default:(0,i.w5)((()=>[g])),_:1})])),_:1}),(0,i.Wm)(rt,null,{default:(0,i.w5)((()=>[(0,i.Wm)(at,{color:"light",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(st,{slot:"start",style:{height:"70px"},src:`${t.$heap.state.hostname}image/get.php/${a.optionData.parent.image_hash}.70.70.webp`},null,8,["src"]),(0,i.Uk)(" "+(0,r.zw)(a.optionData.parent.product_name),1)])),_:1}),a.productId==a.optionData.parent.product_id?((0,i.wg)(),(0,i.j4)(at,{key:0,color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{position:"stacked"},{default:(0,i.w5)((()=>[f])),_:1}),(0,i.Wm)(pt,{name:"product_option",modelValue:a.productItem.product_option,"onUpdate:modelValue":e[8]||(e[8]=t=>a.productItem.product_option=t)},null,8,["modelValue"])])),_:1})):((0,i.wg)(),(0,i.j4)(at,{key:1,lines:"none",color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(mt,null,{default:(0,i.w5)((()=>[(0,i.Uk)("["+(0,r.zw)(a.optionData.parent.product_option)+"]",1)])),_:1})])),_:1}))])),_:1})])),_:1},8,["color"]),(0,i._)("div",w,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.optionData.children,(o=>((0,i.wg)(),(0,i.j4)(lt,{onClick:e=>t.$router.replace(`product-edit-${o.product_id}?refreshOptions=1`),key:o.product_id,color:a.productItem.product_id==o.product_id?"primary":""},{default:(0,i.w5)((()=>[(0,i.Wm)(rt,null,{default:(0,i.w5)((()=>[a.productItem.product_id==o.product_id?((0,i.wg)(),(0,i.j4)(at,{key:0,color:a.productItem.deleted_at?"danger":""},{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{position:"stacked"},{default:(0,i.w5)((()=>[k])),_:1}),(0,i.Wm)(pt,{name:"product_option",modelValue:a.productItem.product_option,"onUpdate:modelValue":e[10]||(e[10]=t=>a.productItem.product_option=t)},null,8,["modelValue"])])),_:1},8,["color"])):((0,i.wg)(),(0,i.j4)(at,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(mt,{color:o.deleted_at?"danger":""},{default:(0,i.w5)((()=>[(0,i.Uk)("["+(0,r.zw)(o.product_option)+"]",1)])),_:2},1032,["color"])])),_:2},1024))])),_:2},1024)])),_:2},1032,["onClick","color"])))),128)),(0,i.Wm)(lt,null,{default:(0,i.w5)((()=>[(0,i.Wm)(rt,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_t,{color:"light",expand:"block",onClick:e[11]||(e[11]=t=>u.itemOptionCreate())},{default:(0,i.w5)((()=>[I])),_:1})])),_:1})])),_:1})])],32)):(0,i.kq)("",!0),a.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",y,[(0,i.Wm)(ht),(0,i.Wm)(at,{button:"",onClick:e[13]||(e[13]=e=>t.$router.push("product-"+a.productItem.product_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.chevronBack,slot:"start"},null,8,["src"]),v])),_:1}),(0,i.Wm)(at,{button:"",onClick:e[14]||(e[14]=t=>u.showProductInStore())},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.chevronBack,slot:"start"},null,8,["src"]),W])),_:1}),(0,i.Wm)(at,{button:"",onClick:e[15]||(e[15]=e=>t.$router.push("/catalog/store-edit-"+a.productItem.store_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.chevronBack,slot:"start"},null,8,["src"]),b])),_:1})]))])),_:1})):(0,i.kq)("",!0),a.productItem?((0,i.wg)(),(0,i.iD)("form",{key:2,onChange:e[29]||(e[29]=(...t)=>u.saveForm&&u.saveForm(...t))},[(0,i.Wm)(gt,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(It,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ht,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[U])),_:1})])),_:1}),a.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(at,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[C])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_name,"onUpdate:modelValue":e[16]||(e[16]=t=>a.productItem.product_name=t),name:"product_name",placeholder:"полное название товара",clearInput:"true"},null,8,["modelValue"])])),_:1})),a.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(at,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[O])),_:1}),(0,i.Wm)(ft,{modelValue:a.productItem.product_description,"onUpdate:modelValue":e[17]||(e[17]=t=>a.productItem.product_description=t),name:"product_description",rows:"6",placeholder:"характеристики, свойства, состав товара"},null,8,["modelValue"])])),_:1})),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[D])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_code,"onUpdate:modelValue":e[18]||(e[18]=t=>a.productItem.product_code=t),name:"product_code",slot:"end",placeholder:"код товара"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[V])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_barcode,"onUpdate:modelValue":e[19]||(e[19]=t=>a.productItem.product_barcode=t),name:"product_barcode",slot:"end",placeholder:"штрихкод"},null,8,["modelValue"])])),_:1}),a.is_counted?((0,i.wg)(),(0,i.j4)(at,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[G,a.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",$,"("+(0,r.zw)(a.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_quantity,"onUpdate:modelValue":e[20]||(e[20]=t=>a.productItem.product_quantity=t),name:"product_quantity",slot:"end",placeholder:"в наличии"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[L,a.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",j,"("+(0,r.zw)(a.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_quantity_min,"onUpdate:modelValue":e[21]||(e[21]=t=>a.productItem.product_quantity_min=t),name:"product_quantity_min",type:"number",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1}),a.is_option_child?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(at,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[q])),_:1}),(0,i.Wm)(kt,{modelValue:a.productItem.product_unit,"onUpdate:modelValue":e[22]||(e[22]=t=>a.productItem.product_unit=t),name:"product_unit",slot:"end",onIonChange:u.saveForm},{default:(0,i.w5)((()=>[(0,i.Wm)(wt,{value:"шт"},{default:(0,i.w5)((()=>[P])),_:1}),(0,i.Wm)(wt,{value:"порция"},{default:(0,i.w5)((()=>[x])),_:1}),(0,i.Wm)(wt,{value:"порция мл"},{default:(0,i.w5)((()=>[z])),_:1}),(0,i.Wm)(wt,{value:"кг"},{default:(0,i.w5)((()=>[S])),_:1}),(0,i.Wm)(wt,{value:"м"},{default:(0,i.w5)((()=>[F])),_:1}),(0,i.Wm)(wt,{value:"л"},{default:(0,i.w5)((()=>[M])),_:1})])),_:1},8,["modelValue","onIonChange"])])),_:1})),"кг"!=a.productItem.product_unit?((0,i.wg)(),(0,i.j4)(at,{key:4},{default:(0,i.w5)((()=>["порция мл"==a.productItem.product_unit?((0,i.wg)(),(0,i.j4)(ct,{key:0},{default:(0,i.w5)((()=>[Z])),_:1})):((0,i.wg)(),(0,i.j4)(ct,{key:1},{default:(0,i.w5)((()=>[(0,i.Uk)("Вес 1"+(0,r.zw)(a.productItem.product_unit)+" (кг)*",1)])),_:1})),(0,i.Wm)(pt,{modelValue:a.productItem.product_weight,"onUpdate:modelValue":e[23]||(e[23]=t=>a.productItem.product_weight=t),name:"product_weight",type:"number",step:"0.1",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(gt,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(It,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ht,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[T])),_:1})])),_:1})])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[Y])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_price,"onUpdate:modelValue":e[24]||(e[24]=t=>a.productItem.product_price=t),name:"product_price",type:"number",inputmode:"numeric",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[B])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_net_price,"onUpdate:modelValue":e[25]||(e[25]=t=>a.productItem.product_net_price=t),name:"product_net_price",type:"number",inputmode:"numeric",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{color:"success"},{default:(0,i.w5)((()=>[H])),_:1}),(0,i.Wm)(pt,{modelValue:a.productItem.product_promo_price,"onUpdate:modelValue":e[26]||(e[26]=t=>a.productItem.product_promo_price=t),name:"product_promo_price",type:"number",inputmode:"numeric",slot:"end",color:"success"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{color:"success"},{default:(0,i.w5)((()=>[A])),_:1}),(0,i.Wm)(pt,{type:"date",modelValue:a.productItem.product_promo_start,"onUpdate:modelValue":e[27]||(e[27]=t=>a.productItem.product_promo_start=t),name:"product_promo_start",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(at,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,{color:"success"},{default:(0,i.w5)((()=>[E])),_:1}),(0,i.Wm)(pt,{type:"date",modelValue:a.productItem.product_promo_finish,"onUpdate:modelValue":e[28]||(e[28]=t=>a.productItem.product_promo_finish=t),name:"product_promo_finish",slot:"end"},null,8,["modelValue"])])),_:1})])),_:1})],32)):(0,i.kq)("",!0),a.productItem&&!a.is_option_child?((0,i.wg)(),(0,i.j4)(gt,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(ht,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[K])),_:1})])),_:1}),(0,i.Wm)(yt,{images:a.productItem.images,image_holder_id:a.productItem.product_id,title:"Витрина товара 5 фото",controller:"Product",ref:"productImgs"},null,8,["images","image_holder_id"]),(0,i.Wm)(_t,{onClick:e[30]||(e[30]=e=>t.$refs.productImgs.take_photo()),color:"light",expand:"block"},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.cameraOutline,slot:"start"},null,8,["src"]),N])),_:1})])),_:1})):(0,i.kq)("",!0),a.productItem&&u.categoryList&&!a.is_option_child?((0,i.wg)(),(0,i.j4)(gt,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(ht,null,{default:(0,i.w5)((()=>[(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[Q])),_:1})])),_:1}),0==u.categoryList.length?((0,i.wg)(),(0,i.j4)(at,{key:0,color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.compassOutline,slot:"start",color:"danger"},null,8,["src"]),(0,i.Wm)(ct,{color:"danger"},{default:(0,i.w5)((()=>[R])),_:1})])),_:1})):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(u.categoryList,(t=>((0,i.wg)(),(0,i.j4)(at,{key:t.group_id},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.compassOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(t.group_name),1)])),_:2},1024),(0,i.Wm)(dt,{src:l.trashOutline,slot:"end",onClick:e=>u.categoryDelete(t.group_id,t.group_name)},null,8,["src","onClick"])])),_:2},1024)))),128)),(0,i.Wm)(at,{button:"",onClick:e[31]||(e[31]=t=>u.categoryAdd())},{default:(0,i.w5)((()=>[(0,i.Wm)(dt,{src:l.addOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(ct,null,{default:(0,i.w5)((()=>[J])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)]})),_:1},8,["page-title"])}o(8862),o(6699);var tt=o(8292),et=o(8903),ot=o(2226);const it=(0,i.Uk)("Категории"),rt={class:"ion-padding",slot:"content"};function lt(t,e,o,l,d,n){const a=(0,i.up)("ion-title"),u=(0,i.up)("ion-icon"),s=(0,i.up)("ion-toolbar"),c=(0,i.up)("ion-header"),p=(0,i.up)("ion-searchbar"),m=(0,i.up)("ion-img"),_=(0,i.up)("ion-avatar"),h=(0,i.up)("ion-label"),g=(0,i.up)("ion-item"),f=(0,i.up)("ion-checkbox"),w=(0,i.up)("ion-list"),k=(0,i.up)("ion-accordion"),I=(0,i.up)("ion-accordion-group"),y=(0,i.up)("ion-skeleton-text"),v=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(a,null,{default:(0,i.w5)((()=>[it])),_:1}),(0,i.Wm)(u,{slot:"end",onClick:e[0]||(e[0]=t=>{n.closeModal()}),icon:l.closeOutline,size:"large",color:"medium"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{placeholder:"Фильтр по категориям",modelValue:d.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>d.searchQuery=t)},null,8,["modelValue"]),n.groupListFiltered.length>0?((0,i.wg)(),(0,i.j4)(I,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(n.groupListTree,(e=>((0,i.wg)(),(0,i.j4)(k,{key:e.group_id},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{slot:"header"},{default:(0,i.w5)((()=>[e.image_hash?((0,i.wg)(),(0,i.j4)(_,{key:0,slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".50.50.webp"},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.group_name),1)])),_:2},1024)])),_:2},1024),(0,i._)("div",rt,[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.children,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.group_id},[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[e.image_hash?((0,i.wg)(),(0,i.j4)(_,{key:0,slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".50.50.webp"},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(e.group_name),1)])),_:2},1024),(0,i.Wm)(f,{slot:"end",checked:e.is_marked,onClick:t=>n.mimickChage(t.target,e.group_id)},null,8,["checked","onClick"])])),_:2},1024)])))),128))])),_:2},1024)])])),_:2},1024)))),128))])),_:1})):((0,i.wg)(),(0,i.j4)(w,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3,4],(t=>(0,i.Wm)(g,{key:t},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{style:{width:"100%"}})])),_:2},1024))),64))])),_:1}))])),_:1})],64)}o(4603);var dt=o(9755),nt=o.n(dt),at={props:["controller","memberId","memberOfIds","memberLimit"],components:{IonCheckbox:tt.nz,IonContent:tt.W2,IonHeader:tt.Gu,IonToolbar:tt.sr,IonTitle:tt.wd,IonIcon:tt.gu,IonButton:tt.YG,IonImg:tt.Xz,IonAvatar:tt.BJ,IonLabel:tt.Q$,IonItemDivider:tt.rH,IonList:tt.q_,IonItem:tt.Ie,IonAccordion:tt.We,IonAccordionGroup:tt.eh,IonSearchbar:tt.VI,IonSkeletonText:tt.CK},setup(){return{closeOutline:et.fID}},data(){return{searchQuery:"",groupList:null,checkedGroupList:[]}},created(){this.listGroupGet(),this.checkedGroupList=this.memberOfIds||[]},computed:{groupListFiltered(){var t,e;if(!this.searchQuery)return null!==(e=this.groupList)&&void 0!==e?e:[];const o=new RegExp(this.searchQuery.replace(/^[\w\d\s]/,"").replace(/\s/g,".*"),"im");return null!==(t=this.groupList.filter((t=>{var e;return null===(e=t.group_path)||void 0===e?void 0:e.match(o)})))&&void 0!==t?t:[]},groupListTree(){let t=[];for(let e of this.groupListFiltered){let o=t.findIndex((t=>e.group_parent_id==t.group_id));if(o<0){let i=this.groupList.find((t=>t.group_id==e.group_parent_id));if(!i)continue;i.children=[],o=t.push(i)-1}t[o].children.push(e)}return t},parentGroupList(){var t;return null===(t=this.groupListFiltered)||void 0===t?void 0:t.filter((t=>0==t.group_parent_id))},childGroupList(){let t={};for(let e of this.parentGroupList)t[e.group_id]=this.groupListFiltered.filter((t=>t.group_parent_id==e.group_id));return t}},methods:{async listGroupGet(){this.groupList=await nt().get(this.$heap.state.hostname+this.controller+"/listGroupGet"),this.itemMarkGroups()},itemMarkGroups(){if(this.groupList)try{for(let t of this.groupList)t.is_marked=this.checkedGroupList.includes(t.group_id)?1:0}catch(t){}},async itemUpdateGroup(t,e){const o={[this.controller.toLowerCase()+"_id"]:this.memberId,is_joined:t,group_id:e};try{await nt().post(this.$heap.state.hostname+this.controller+"/itemUpdateGroup",o)}catch(i){this.$flash("Не удалось сохранить изменение")}},mimickChage(t,e){const o=this;setTimeout((()=>{o.groupChanged(t,e)}),0)},async groupChanged(t,e){const o=t.checked?1:0;if(o){if(this.checkedGroupList.length>=this.memberLimit)return this.$flash(`Можно выбрать не больше ${this.memberLimit} категорий`),void(t.checked=0);1==this.memberLimit&&this.closeModal(),this.checkedGroupList.push(e)}else this.checkedGroupList=this.checkedGroupList.filter((function(t,o,i){return t!=e}));this.itemUpdateGroup(o,e)},closeModal(){tt.Fy.dismiss(this.checkedGroupList)}}},ut=o(3744);const st=(0,ut.Z)(at,[["render",lt]]);var ct=st,pt=o(2008),mt=o(9042),_t={components:{IonInput:tt.pK,IonTextarea:tt.g2,IonCard:tt.PM,IonCardContent:tt.FN,IonCardHeader:tt.Zi,IonToggle:tt.ho,IonIcon:tt.gu,IonItem:tt.Ie,IonList:tt.q_,IonLabel:tt.Q$,IonItemDivider:tt.rH,IonItemGroup:tt.Ub,IonButton:tt.YG,IonProgressBar:tt.X7,IonText:tt.yW,IonSelect:tt.t9,IonSelectOption:tt.n0,IonImg:tt.Xz,IonChip:tt.hM,IonCardTitle:tt.Dq,IonCardSubtitle:tt.tO,imageTileComp:ot.Z},setup(){return{cameraOutline:et.kuq,trashOutline:et.gtu,banOutline:et.L6S,personOutline:et.QJ7,addOutline:et.s6O,pizzaOutline:et.fqo,compassOutline:et.gmD,chevronBack:et.Mny,layersOutline:et.Y1P,ribbonOutline:et.Muk}},data(){return{productId:this.$route.params.id,productItem:null,productGroupList:null,validity:0,validity_min:80,optionData:null,refreshOptions:this.$route.query.refreshOptions,is_option_parent:!1,is_option_child:!1,is_groups_marked:0,is_deleted:0,is_disabled:0,is_counted:0}},computed:{message(){var t,e,o;return null!==(t=this.productItem)&&void 0!==t&&t.deleted_at?"Товар не активен и будет удален. Вы еще можете отменить удаление":1==(null===(e=this.productItem)||void 0===e?void 0:e.is_disabled)?"Товар не активен и находится на рассмотрении у администратора":1!=(null===(o=this.productItem)||void 0===o?void 0:o.is_counted)?"Товар активен и готов к продаже. Учет остатков товара не ведется":"Товар активен и готов к продаже."},messageClass(){var t,e,o;return null!==(t=this.productItem)&&void 0!==t&&t.deleted_at?"deleted":1==(null===(e=this.productItem)||void 0===e?void 0:e.is_disabled)?"disabled":1!=(null===(o=this.productItem)||void 0===o?void 0:o.is_counted)?"primary":"active"},categoryList(){let t=[];try{let e=this.productItem.member_of_groups.group_ids.split(","),o=this.productItem.member_of_groups.group_names.split(",");for(let i in e)t.push({group_id:e[i],group_name:o[i]})}catch(e){}return t}},created(){this.listGroupGet(),this.itemGet()},ionViewDidEnter(){var t;this.refreshOptions&&null!==(t=this.productItem)&&void 0!==t&&t.product_parent_id&&this.itemOptionGet()},methods:{async itemGet(){try{let t=await nt().post(pt.Z.state.hostname+"Product/itemGet",{product_id:this.productId});this.productItem=this.itemPrepare(t),this.itemParseFlags(),this.is_option_child=this.productItem.product_parent_id&&this.productItem.product_parent_id!=this.productItem.product_id,this.is_option_parent=this.productItem.product_parent_id&&this.productItem.product_parent_id==this.productItem.product_id,await this.itemOptionGet()}catch(t){}},itemPrepare(t){return t.product_promo_start&&(t.product_promo_start=t.product_promo_start.split(" ")[0]),t.product_promo_finish&&(t.product_promo_finish=t.product_promo_finish.split(" ")[0]),t},itemParseFlags(){this.is_deleted=null==this.productItem.deleted_at?0:1,this.is_disabled=0==this.productItem.is_disabled?0:1,this.is_counted=0==this.productItem.is_counted?0:1},async itemDelete(t){const e=t?"itemDelete":"itemUnDelete";try{await nt().post(pt.Z.state.hostname+"Product/"+e,{product_id:this.productId}),this.productItem.deleted_at=t?1:null,(this.is_option_child||this.is_option_parent)&&this.itemOptionGet()}catch(o){this.itemGet()}},async itemDisable(t){if(this.productItem.is_disabled!=t)try{await nt().post(pt.Z.state.hostname+"Product/itemDisable",{product_id:this.productId,is_disabled:t}),this.productItem.is_disabled=t}catch(e){this.$flash("Изменение не сохранено"),this.itemGet()}},async itemUpdate(t){try{return await nt().post(pt.Z.state.hostname+"Product/itemUpdate",JSON.stringify(t)),this.$flash("💾 сохранено"),!0}catch(e){const t=e.responseJSON.messages.error;return null!==t&&void 0!==t&&t.includes("product_description")?this.$flash("Описание слишком короткое"):null!==t&&void 0!==t&&t.includes("product_name")?this.$flash("Название слишком короткое"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},async itemOptionGet(){this.productItem.product_parent_id||(this.optionData=null);const t={product_parent_id:this.productItem.product_parent_id};let e=await nt().post(`${this.$heap.state.hostname}Product/itemOptionGet`,t);this.optionData={parent:e[0],children:e.slice(1)}},async itemOptionCreate(){var t,e,o;const i=null!==(t=null===(e=this.optionData)||void 0===e||null===(o=e.children)||void 0===o?void 0:o.length)&&void 0!==t?t:0,r={is_disabled:1,store_id:this.productItem.store_id,product_parent_id:this.productItem.product_parent_id,product_name:"OPTION",product_price:0,product_option:`Вариант#${i}`};try{await nt().post(`${this.$heap.state.hostname}Product/itemCreate`,r),this.itemOptionGet()}catch(l){}},async itemOptionSet(t){t?await this.itemOptionSave(this.productId,this.productId):await this.itemOptionDelete(this.productId),this.itemGet()},async itemOptionUpdate(t){},async itemOptionSave(t,e){try{await nt().post(`${this.$heap.state.hostname}Product/itemOptionSave`,{product_id:t,product_parent_id:e})}catch(o){}},async itemOptionDelete(t){if(confirm("Удалить разновидности товара?"))try{await nt().post(`${this.$heap.state.hostname}Product/itemOptionDelete`,{product_id:t}),this.itemOptionGet()}catch(e){}},checkPromoPrice(t){if(this.productItem.product_price>0&&this.productItem.product_promo_price>0&&this.productItem.product_price<=this.productItem.product_promo_price){"product_promo_price"==t&&(this.productItem.product_price=Number(this.productItem.product_promo_price)+1),"product_price"==t&&(this.productItem.product_promo_price=Number(this.productItem.product_price)-1);const e={product_id:this.productId,product_promo_price:this.productItem.product_promo_price,product_price:this.productItem.product_price};return this.itemUpdate(e),this.$flash("Акционная цена должна быть ниже основной. Внимание цена изменена!"),!1}return!0},saveForm(t){const e=t.target.name,o=this.productItem[e]=t.target.value;this.checkPromoPrice(e)&&this.save(e,o)},async save(t,e){if(!this.productItem.product_id)return;let o={product_id:this.productItem.product_id,[t]:e};this.itemUpdate(o)&&(this.productItem[t]=e,this.itemParseFlags())},categoryDelete(t,e){if(confirm("Исключить товар из категории "+e+"?"))try{this.itemUpdateGroup(0,t)}catch(o){}},async categoryAdd(){var t,e,o;const i=(null===(t=this.productItem)||void 0===t||null===(e=t.member_of_groups)||void 0===e||null===(o=e.group_ids)||void 0===o?void 0:o.split(","))||[],r=await tt.Fy.create({component:ct,componentProps:{controller:"Product",memberId:this.productId,memberOfIds:i,memberLimit:1},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});r.present(),mt.Z.on("dismissModal",(()=>{r.dismiss()})),await r.onDidDismiss(),this.itemGet()},async itemUpdateGroup(t,e){const o={product_id:this.productId,is_joined:t,group_id:e};try{await nt().post(pt.Z.state.hostname+"Product/itemUpdateGroup",o)}catch(i){this.$flash("Не удалось сохранить изменение")}this.itemGet()},async listGroupGet(){try{this.productGroupList=await nt().get(pt.Z.state.hostname+"Product/listGroupGet"),this.itemMarkGroups()}catch(t){}},showProductInStore(){let t=0;try{t=this.productItem.member_of_groups.group_ids.split(",")[0]}catch(e){}this.$router.push({path:"store-"+this.productItem.store_id,query:{sub_group_id:t}})}}};const ht=(0,ut.Z)(_t,[["render",X],["__scopeId","data-v-ff703546"]]);var gt=ht}}]);
//# sourceMappingURL=8913.7e02aaa0.js.map