"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[9504],{7123:function(e,l,t){t.r(l),t.d(l,{default:function(){return V}});var s=t(641),a=t(33);const i={key:0},o={key:1},u=["href"],n=["href"],r={slot:"end",style:{"font-size":"10px",width:"7em"}},d={slot:"end",style:{"font-size":"10px",width:"7em"}},_={slot:"end",style:{"font-size":"10px",width:"7em"}},m={slot:"end",style:{"font-size":"10px",width:"7em"}},h={slot:"end",style:{"font-size":"10px",width:"7em"}},p={key:2};function c(e,l,t,c,b,f){const k=(0,s.g2)("ion-title"),v=(0,s.g2)("ion-toolbar"),g=(0,s.g2)("ion-header"),F=(0,s.g2)("ion-input"),y=(0,s.g2)("ion-item"),I=(0,s.g2)("ion-button"),C=(0,s.g2)("ion-content"),V=(0,s.g2)("ion-modal"),$=(0,s.g2)("ion-card-content"),O=(0,s.g2)("ion-card"),w=(0,s.g2)("ion-icon"),W=(0,s.g2)("ion-chip"),U=(0,s.g2)("ion-toggle"),A=(0,s.g2)("ion-label"),x=(0,s.g2)("ion-item-divider"),X=(0,s.g2)("ion-checkbox"),G=(0,s.g2)("ion-list"),D=(0,s.g2)("ion-accordion"),L=(0,s.g2)("ion-accordion-group"),q=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(q,{"page-title":"Пользователь",pageDefaultBackLink:"/user"},{default:(0,s.k6)(()=>{var e;return[(0,s.bF)(V,{"is-open":b.isAddPromoOpen,"initial-breakpoint":.75,breakpoints:[0,.75,1]},{default:(0,s.k6)(()=>[(0,s.bF)(g,null,{default:(0,s.k6)(()=>[(0,s.bF)(v,null,{default:(0,s.k6)(()=>[(0,s.bF)(k,null,{default:(0,s.k6)(()=>l[19]||(l[19]=[(0,s.eW)("Добавление скидки")])),_:1,__:[19]})]),_:1})]),_:1}),(0,s.bF)(C,{class:"ion-padding"},{default:(0,s.k6)(()=>[(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(F,{label:"Название скидки","label-placement":"stacked",type:"text",modelValue:b.promo_name,"onUpdate:modelValue":l[0]||(l[0]=e=>b.promo_name=e)},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(F,{label:"Сумма скидки","label-placement":"stacked",type:"text",modelValue:b.promo_value,"onUpdate:modelValue":l[1]||(l[1]=e=>b.promo_value=e)},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(F,{label:"Минимальный заказ","label-placement":"stacked",type:"text",modelValue:b.promo_minsum,"onUpdate:modelValue":l[2]||(l[2]=e=>b.promo_minsum=e)},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(F,{label:"Срок жизни дней","label-placement":"stacked",type:"num",modelValue:b.promo_lifetime,"onUpdate:modelValue":l[3]||(l[3]=e=>b.promo_lifetime=e)},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,{lines:"none"}),(0,s.bF)(I,{onClick:l[4]||(l[4]=e=>f.promoCreate()),expand:"block"},{default:(0,s.k6)(()=>l[20]||(l[20]=[(0,s.eW)("Создать")])),_:1,__:[20]}),(0,s.bF)(I,{onClick:l[5]||(l[5]=e=>b.isAddPromoOpen=0),color:"light",expand:"block"},{default:(0,s.k6)(()=>l[21]||(l[21]=[(0,s.eW)("Закрыть")])),_:1,__:[21]})]),_:1})]),_:1},8,["is-open"]),null==b.user?((0,s.uX)(),(0,s.CE)("div",i)):null!==(e=b.user)&&void 0!==e&&e.user_id?((0,s.uX)(),(0,s.CE)("div",o,[f.message?((0,s.uX)(),(0,s.Wv)(O,{key:0,lines:"none"},{default:(0,s.k6)(()=>[(0,s.bF)($,{class:(0,a.C4)(f.messageClass)},{default:(0,s.k6)(()=>[(0,s.eW)((0,a.v_)(f.message),1)]),_:1},8,["class"])]),_:1})):((0,s.uX)(),(0,s.Wv)(O,{key:1,lines:"none"},{default:(0,s.k6)(()=>[(0,s.bF)($,{style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,s.k6)(()=>[l[22]||(l[22]=(0,s.Lk)("p",null,"Анкета пользователя активна.",-1)),b.user.user_phone?((0,s.uX)(),(0,s.Wv)(W,{key:0,color:"primary"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.callOutline},null,8,["src"]),(0,s.Lk)("a",{href:`tel:+${b.user.user_phone}`},"+"+(0,a.v_)(b.user.user_phone),9,u)]),_:1})):(0,s.Q3)("",!0),b.user.user_email?((0,s.uX)(),(0,s.Wv)(W,{key:1,color:"primary"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.mailOutline},null,8,["src"]),(0,s.Lk)("a",{href:`mailto:${b.user.user_email}`},(0,a.v_)(b.user.user_email),9,n)]),_:1})):(0,s.Q3)("",!0)]),_:1,__:[22]})]),_:1})),(0,s.Lk)("form",{onChange:l[17]||(l[17]=(...e)=>f.updateUser&&f.updateUser(...e))},[(0,s.bF)(G,null,{default:(0,s.k6)(()=>[(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.trashOutline,color:"primary",slot:"start"},null,8,["src"]),l[23]||(l[23]=(0,s.eW)(" Удалено ")),(0,s.bF)(U,{slot:"end",modelValue:b.is_deleted,"onUpdate:modelValue":l[6]||(l[6]=e=>b.is_deleted=e),color:"danger",onIonChange:l[7]||(l[7]=e=>f.itemDelete(e.target.checked?1:0))},null,8,["modelValue"])]),_:1,__:[23]}),(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.closeOutline,color:"primary",slot:"start"},null,8,["src"]),l[24]||(l[24]=(0,s.eW)(" Заблокировано ")),(0,s.bF)(U,{slot:"end",modelValue:b.is_disabled,"onUpdate:modelValue":l[8]||(l[8]=e=>b.is_disabled=e),onIonChange:l[9]||(l[9]=e=>f.itemDisable(e.target.checked?1:0))},null,8,["modelValue"])]),_:1,__:[24]}),(0,s.bF)(x,null,{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>l[25]||(l[25]=[(0,s.eW)("Основные настройки")])),_:1,__:[25]})]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(F,{modelValue:b.user.user_phone,"onUpdate:modelValue":l[10]||(l[10]=e=>b.user.user_phone=e),name:"user_phone",placeholder:"Телефон",label:"Телефон","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(X,{modelValue:b.user.user_phone_verified,"onUpdate:modelValue":l[11]||(l[11]=e=>b.user.user_phone_verified=e),name:"user_phone_verified",onClick:l[12]||(l[12]=e=>f.updateUserDelayed({target:{name:"user_phone_verified"}}))},{default:(0,s.k6)(()=>l[26]||(l[26]=[(0,s.eW)("Телефон подтвержден")])),_:1,__:[26]},8,["modelValue"])]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(F,{modelValue:b.user.user_email,"onUpdate:modelValue":l[13]||(l[13]=e=>b.user.user_email=e),name:"user_email",placeholder:"Емаил",label:"почта","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(F,{modelValue:b.user.user_name,"onUpdate:modelValue":l[14]||(l[14]=e=>b.user.user_name=e),name:"user_name",placeholder:"Имя",label:"Имя","label-placement":"stacked"},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(F,{modelValue:b.user.user_birthday,"onUpdate:modelValue":l[15]||(l[15]=e=>b.user.user_birthday=e),name:"user_birthday",placeholder:"День рождения",label:"День рождения","label-placement":"stacked",type:"datetime-local"},null,8,["modelValue"])]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>l[27]||(l[27]=[(0,s.eW)("Регистрация")])),_:1,__:[27]}),(0,s.Lk)("p",r,(0,a.v_)(b.user.created_at),1)]),_:1}),(0,s.bF)(y,{lines:"full"},{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>l[28]||(l[28]=[(0,s.eW)("Последний вход")])),_:1,__:[28]}),(0,s.Lk)("p",d,(0,a.v_)(b.user.signed_in_at),1)]),_:1}),(0,s.bF)(y,{lines:"full",onClick:l[16]||(l[16]=e=>{f.itemSignInById(b.user.user_id)}),button:"",color:"warning"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{icon:c.enterOutline,slot:"start"},null,8,["icon"]),(0,s.eW)(" Войти как "+(0,a.v_)(b.user.user_name),1)]),_:1})]),_:1})],32),(0,s.bF)(x,null,{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>l[29]||(l[29]=[(0,s.eW)("Дополнително")])),_:1,__:[29]})]),_:1}),(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.bF)(D,null,{default:(0,s.k6)(()=>[(0,s.bF)(y,{slot:"header"},{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>{var e;return[(0,s.eW)("Пуш подписки "+(0,a.v_)((null===(e=b.user_push_subs)||void 0===e?void 0:e.length)||0),1)]}),_:1})]),_:1}),(0,s.bF)(G,{slot:"content"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.user_push_subs,e=>((0,s.uX)(),(0,s.Wv)(y,{key:e.sub_id},{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,a.v_)(e.platform)+" / "+(0,a.v_)(e.mobile||e.browser),1)]),_:2},1024),(0,s.Lk)("p",_,(0,a.v_)(e.created_at),1)]),_:2},1024))),128))]),_:1})]),_:1}),(0,s.bF)(D,null,{default:(0,s.k6)(()=>[(0,s.bF)(y,{slot:"header"},{default:(0,s.k6)(()=>[(0,s.bF)(A,null,{default:(0,s.k6)(()=>{var e;return[(0,s.eW)("Скидки "+(0,a.v_)((null===(e=b.promo_list)||void 0===e?void 0:e.length)||0),1)]}),_:1})]),_:1}),(0,s.bF)(G,{slot:"content"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.promo_list,e=>((0,s.uX)(),(0,s.Wv)(y,{key:e.promo_id},{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.checkmarkOutline,color:"success",slot:"start"},null,8,["src"]),(0,s.bF)(A,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,a.v_)(e.promo_name)+" / "+(0,a.v_)(e.promo_value)+" / "+(0,a.v_)(e.promo_share)+"%",1)]),_:2},1024),(0,s.Lk)("p",m,(0,a.v_)(e.expired_at),1)]),_:2},1024))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.promo_list_expired,e=>((0,s.uX)(),(0,s.Wv)(y,{key:e.promo_id},{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.closeOutline,color:"danger",slot:"start"},null,8,["src"]),(0,s.bF)(A,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,a.v_)(e.promo_name)+" / "+(0,a.v_)(e.promo_value)+" / "+(0,a.v_)(e.promo_share)+"%",1)]),_:2},1024),(0,s.Lk)("p",h,(0,a.v_)(e.expired_at),1)]),_:2},1024))),128)),(0,s.bF)(y,{button:"",onClick:l[18]||(l[18]=e=>b.isAddPromoOpen=1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,{src:c.addOutline,slot:"start"},null,8,["src"]),(0,s.bF)(A,null,{default:(0,s.k6)(()=>l[30]||(l[30]=[(0,s.eW)("Добавить скидку")])),_:1,__:[30]})]),_:1})]),_:1})]),_:1})]),_:1})])):((0,s.uX)(),(0,s.CE)("div",p))]}),_:1})}var b=t(5634),f=t(5480),k=t(2311),v=t.n(k),g=t(5538),F=t(8701),y={components:{IonInput:b.$w,IonCard:b.b_,IonCardContent:b.I9,IonLabel:b.he,IonItem:b.uz,IonButton:b.Jm,IonList:b.nf,IonCheckbox:b.eY,IonItemDivider:b.Dg,IonToggle:b.BY,IonIcon:b.iq,IonAccordion:b.xk,IonAccordionGroup:b.YH,IonModal:b.Sb,IonHeader:b.eU,IonContent:b.W9,IonToolbar:b.ai,IonTitle:b.BC,IonChip:b.ZB},setup(){return{enterOutline:f.b9o,addOutline:f.EKF,trashOutline:f.P1A,searchOutline:f.jBE,documentTextOutline:f.pXZ,checkmarkOutline:f.g1L,closeOutline:f.xfX,callOutline:f.bNN,mailOutline:f.SM1}},data(){var e,l;return{managed_user_id:null===(e=this.$route)||void 0===e||null===(l=e.query)||void 0===l?void 0:l.user_id,user:null,user_push_subs:null,promo_list:null,promo_list_expired:null,promo_name:null,promo_value:null,promo_minsum:null,promo_lifetime:null,isAdmin:F.A.isAdmin(),isAddPromoOpen:0,is_deleted:0,is_disabled:0}},ionViewDidEnter(){var e,l,t,s;this.managed_user_id!=(null===(e=this.$route)||void 0===e||null===(l=e.query)||void 0===l?void 0:l.user_id)&&(this.managed_user_id=null===(t=this.$route)||void 0===t||null===(s=t.query)||void 0===s?void 0:s.user_id,this.itemGet())},mounted(){this.itemGet()},computed:{message(){var e,l;return null!==(e=this.user)&&void 0!==e&&e.deleted_at?"Пользователь удален":1==(null===(l=this.user)||void 0===l?void 0:l.is_disabled)?"Пользователь заблокирован":null},messageClass(){var e,l;return null!==(e=this.user)&&void 0!==e&&e.deleted_at?"deleted":1==(null===(l=this.user)||void 0===l?void 0:l.is_disabled)?"disabled":null}},methods:{async itemGet(){if(0==this.managed_user_id){const e=await this.itemGetCreate();if(!e)return;this.managed_user_id=e}if(this.managed_user_id>0)try{this.user=await v().post(`${g.A.state.hostname}User/itemGet`,{user_id:this.managed_user_id}),this.user_push_subs=await v().post(`${g.A.state.hostname}MessageSub/listGet`,{user_id:this.managed_user_id}),this.promo_list=await v().post(`${g.A.state.hostname}Promo/listGet`,{user_id:this.managed_user_id,type:"active"}),this.promo_list_expired=await v().post(`${g.A.state.hostname}Promo/listGet`,{user_id:this.managed_user_id,type:"expired"})}catch(e){this.$flash("Не удалось загрузить пользователя")}else this.user={};this.itemParseFlags()},itemParseFlags(){this.user&&(this.is_deleted=null==this.user.deleted_at?0:1,this.is_disabled=0==this.user.is_disabled?0:1)},async itemGetCreate(){const e=prompt("Телефон нового пользователя");if(!e)return void setTimeout(()=>this.$go("/admin/list-moderation"),200);const l={name_query_fields:"user_phone",name_query:e,limit:1},t=await v().post(`${g.A.state.hostname}User/listGet`,l);if(t&&t[0])return t[0].user_id;const s={user_phone:e,user_name:"новый пользователь"};return this.itemCreate(s)},async itemCreate(e){try{return await v().post(`${g.A.state.hostname}User/itemCreate`,e)}catch(l){let e="unknown";try{const t=Object.keys(JSON.parse(l.responseJSON.messages.error))[0],s=Object.values(JSON.parse(l.responseJSON.messages.error))[0];e=t+"_"+s}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_required":this.$flash("Пароль обязателен для заполнения");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break;default:this.$flash("Не удалось зарегистрироваться")}return 0}},async itemDelete(e){if(!confirm("Вы уверены?"))return;const l=e?"itemDelete":"itemUnDelete";try{await v().post(g.A.state.hostname+"user/"+l,{user_id:this.user.user_id}),this.user.deleted_at=e?1:null}catch{}this.itemGet()},async itemDisable(e){if(this.user.is_disabled!=e)try{await v().post(g.A.state.hostname+"User/itemDisable",{user_id:this.user.user_id,is_disabled:e}),this.user.is_disabled=e}catch{this.itemGet()}},async itemSignInById(e){if(!confirm(`Войти в профиль пользователя ${this.user.user_name}?`))return;this.$flash("Выходим из админ профиля");const l={user_id:e};await v().post(`${g.A.state.hostname}User/signInById`,l),await this.$go("/")},async updateUser(e){const l=e.target.name,t=this.user[l],s={user_id:this.user.user_id,[l]:t};try{await v().post(g.A.state.hostname+"User/itemUpdate",JSON.stringify(s)),this.$flash("Сохранено")}catch(a){this.$flash("Ошибка сохранения"),this.itemGet()}},async updateUserDelayed(e){setTimeout(()=>this.updateUser(e),200)},async promoCreate(){const e=100*this.promo_value/this.promo_minsum,l={owner_id:this.managed_user_id,promo_name:this.promo_name,promo_value:this.promo_value,promo_share:e,promo_lifetime:this.promo_lifetime};this.promo_lifetime&&this.promo_name&&this.promo_value&&!(this.promo_value>this.promo_minsum)?(await v().post(g.A.state.hostname+"Promo/itemCreate",l),this.isAddPromoOpen=0,this.$flash("Скидка создана"),this.itemGet()):this.$flash("Проверьте форму!")}}},I=t(6262);const C=(0,I.A)(y,[["render",c],["__scopeId","data-v-7ab95bba"]]);var V=C}}]);
//# sourceMappingURL=9504.fb614653.js.map