"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[463],{5942:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var i=n(6252),o=n(3577);const s=(0,i._)("hr",null,null,-1),a=(0,i._)("p",null,"Поступление СМС на ваш телефон может занять до 2 минут.",-1),r={novalidate:""};function u(e,t,n,u,l,d){const c=(0,i.up)("ion-card-title"),h=(0,i.up)("ion-card-header"),p=(0,i.up)("ion-card-content"),m=(0,i.up)("ion-card"),f=(0,i.up)("ion-label"),_=(0,i.up)("ion-input"),w=(0,i.up)("ion-col"),k=(0,i.up)("ion-row"),I=(0,i.up)("ion-item"),v=(0,i.up)("ion-list"),$=(0,i.up)("ion-button"),W=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(W,{"page-title":"Подтверждение телефона",pageDefaultBackLink:"/user"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Подтверждение номера телефона ")])),_:1})])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i._)("p",null,[(0,i.Uk)("Мы выслали вам смс с кодом подтверждения на номер "),(0,i._)("b",null,(0,o.zw)(l.user_phone),1),(0,i.Uk)(". Введите 4 цифры из смс ниже")]),s,a])),_:1})])),_:1}),(0,i._)("form",r,[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Код подтверждения из смс")])),_:1}),(0,i.Wm)(_,{modelValue:l.verification_code,"onUpdate:modelValue":t[0]||(t[0]=e=>l.verification_code=e),type:"numeric",inputmode:"numeric",placeholder:"- - - -",onIonInput:t[1]||(t[1]=e=>{l.verification_code=e.target.value,d.onSubmit()}),enterkeyhint:"go",required:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.Wm)(k,{"responsive-sm":""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)($,{onClick:t[2]||(t[2]=e=>d.onSubmit()),expand:"block"},{default:(0,i.w5)((()=>[(0,i.Uk)("Подтвердить")])),_:1})])),_:1})])),_:1}),(0,i.Wm)(k,{"responsive-sm":""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)($,{onClick:t[3]||(t[3]=e=>{l.is_sent=!1,d.smsSend()}),expand:"block",color:"light",disabled:l.timeToResend>0},{default:(0,i.w5)((()=>[(0,i.Uk)("Послать снова "+(0,o.zw)(d.timeLeft),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])])),_:1})}n(4916),n(5306);var l=n(6964),d=n(9755),c=n.n(d),h=n(351),p={name:"UserVerifyPhone",components:{IonLabel:l.Q$,IonCol:l.wI,IonInput:l.pK,IonRow:l.Nd,IonButton:l.YG,IonCard:l.PM,IonCardHeader:l.Zi,IonCardTitle:l.Dq,IonCardContent:l.FN,IonItem:l.Ie,IonList:l.q_},data(){return{verification_code:null,user_phone:this.$heap.state.user.tmp_userphone||this.$route.params.user_phone||this.$route.query.user_phone||"",is_sent:!1,timeToResend:120}},created(){this.smsSend()},ionViewDidEnter(){this.smsSend()},computed:{timeLeft(){const e=Math.floor(this.timeToResend/60),t=this.timeToResend-60*e;return`${e}:${t}`}},methods:{clockStart(){this.timeToResend<=0||(this.timeToResend--,setTimeout((()=>this.clockStart()),1e3))},async smsSend(){if(this.is_sent)return;if(!this.user_phone)return void this.$router.replace("/user");let e={user_phone:this.user_phone};try{this.is_sent=!0,await c().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,e),this.timeToResend=120,this.clockStart()}catch(t){}},async onSubmit(){if(this.verification_code&&4==String(this.verification_code).length)try{await c().post(`${this.$heap.state.hostname}/User/phoneVerificationCheck`,{user_phone:this.user_phone,verification_code:this.verification_code}),this.$flash("Номер телефона верифицирован"),this.$router.replace("/user"),await h.Z.autoSignIn(),this.$go("/catalog")}catch(e){const t=e.responseJSON.messages.error;switch(t){case"verification_not_found":this.$flash("Код верификации устарел"),this.$router.replace("/user/sign-in");break}this.$flash("Не удалось верифицировать телефон")}}}},m=n(3744);const f=(0,m.Z)(p,[["render",u]]);var _=f}}]);
//# sourceMappingURL=463.00e173ac.js.map