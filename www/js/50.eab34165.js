"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[50],{8377:function(e,i,t){t.d(i,{Z:function(){return W}});var a=t(6252),o=t(3577);const n=(0,a.Uk)("Фотографии"),s={key:0,class:"image_grid"},l=["onClick"],r={key:0},d={key:1},c={key:0,class:"image_controls"},h=["id"];function u(e,i,t,u,m,g){const p=(0,a.up)("ion-label"),_=(0,a.up)("ion-icon"),k=(0,a.up)("ion-item"),f=(0,a.up)("ion-img"),w=(0,a.up)("ion-avatar");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",null,[(0,a.Wm)(k,{lines:"none"},{default:(0,a.w5)((()=>[(0,a.Wm)(p,null,{default:(0,a.w5)((()=>[n])),_:1}),m.editMode?((0,a.wg)(),(0,a.j4)(_,{key:0,slot:"end",icon:u.settingsSharp,color:"primary",onClick:i[0]||(i[0]=e=>m.editMode=0)},null,8,["icon"])):((0,a.wg)(),(0,a.j4)(_,{key:1,slot:"end",icon:u.settingsOutline,onClick:i[1]||(i[1]=e=>{m.editMode=1,g.load()})},null,8,["icon"]))])),_:1}),g.imageList?.length?((0,a.wg)(),(0,a.iD)("div",s,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(g.imageList,(i=>((0,a.wg)(),(0,a.iD)("div",{key:i.image_id,style:{position:"relative"}},[(0,a._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:e=>g.imagePreview(i.image_hash)},[i.deleted_at?((0,a.wg)(),(0,a.iD)("div",r,"будет удалено")):1==i.is_disabled?((0,a.wg)(),(0,a.iD)("div",d,"на модерации")):(0,a.kq)("",!0)],8,l),(0,a.Wm)(w,{onClick:e=>g.imagePreview(i.image_hash),class:(0,o.C_)(i.class)},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{src:e.$heap.state.hostname+"image/get.php/"+i.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),m.editMode?((0,a.wg)(),(0,a.iD)("div",c,[(0,a.Wm)(_,{icon:u.chevronBackCircleOutline,onClick:e=>g.back(i)},null,8,["icon","onClick"]),g.isAdmin&&1==i.is_disabled?((0,a.wg)(),(0,a.j4)(_,{key:0,icon:u.checkmarkCircle,color:"success",onClick:e=>g.enable(i)},null,8,["icon","onClick"])):(0,a.kq)("",!0),i.deleted_at?((0,a.wg)(),(0,a.j4)(_,{key:1,icon:u.addCircle,color:"success",onClick:e=>g.restore(i)},null,8,["icon","onClick"])):((0,a.wg)(),(0,a.j4)(_,{key:2,icon:u.trash,color:"danger",onClick:e=>g.remove(i)},null,8,["icon","onClick"])),(0,a.Wm)(_,{icon:u.chevronForwardCircleOutline,onClick:e=>g.forward(i)},null,8,["icon","onClick"])])):(0,a.kq)("",!0)])))),128))])):(0,a.kq)("",!0)]),(0,a._)("input",{type:"file",id:m.fileUploaderId,accept:"image/*",onChange:i[2]||(i[2]=e=>g.uploadImage(e)),style:{display:"none"}},null,40,h)],64)}var m=t(8903),g=t(4508);const p=(0,a.Uk)("Просмотр фотографии");function _(e,i,t,o,n,s){const l=(0,a.up)("ion-title"),r=(0,a.up)("ion-icon"),d=(0,a.up)("ion-toolbar"),c=(0,a.up)("ion-header"),h=(0,a.up)("ion-img"),u=(0,a.up)("ion-content");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[p])),_:1}),(0,a.Wm)(r,{icon:o.closeOutline,onClick:i[0]||(i[0]=e=>{o.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{src:e.$heap.state.hostname+"image/get.php/"+t.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var k={props:["image_hash"],components:{IonIcon:g.gu,IonToolbar:g.sr,IonHeader:g.Gu,IonImg:g.Xz,IonContent:g.W2,IonTitle:g.wd},setup(){const e=function(){g.Fy.dismiss()};return{closeModal:e,closeOutline:m.fID}}},f=t(3744);const w=(0,f.Z)(k,[["render",_]]);var y=w,C=t(9755),I=t.n(C),v=t(9042),b=t(351),$={props:["images","image_holder_id","controller"],components:{IonLabel:g.Q$,IonIcon:g.gu,IonItem:g.Ie,IonImg:g.Xz,IonAvatar:g.BJ},setup(){return{settingsOutline:m.C$N,settingsSharp:m.kiF,chevronBackCircleOutline:m.CK0,chevronForwardCircleOutline:m.esm,trash:m._Ij,addCircle:m.ZWo,checkmarkCircle:m.I1A}},data(){return{images_loaded:null,editMode:!1,fileUploaderId:this.controller+this.image_holder_id}},computed:{imageList(){let e=this.images_loaded||this.images,i=[];for(let t in e)e[t].deleted_at?(e[t].class=" deleted",this.editMode&&i.push(e[t])):1==e[t].is_disabled?(e[t].class=" disabled",this.editMode&&i.push(e[t])):i.push(e[t]);return i},isAdmin(){return b.Z.isAdmin()}},methods:{async back(e){try{await I().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"up"}),this.load()}catch{}},async forward(e){try{await I().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:e.image_id,dir:"down"}),this.load()}catch{}},async remove(e){try{await I().post(this.$heap.state.hostname+"Image/itemDelete",{image_id:e.image_id}),this.load(),this.$flash("Фото перемещено в корзину и будет удалено")}catch{}},async restore(e){try{await I().post(this.$heap.state.hostname+"Image/itemUnDelete",{image_id:e.image_id}),this.load(),this.$flash("Фото перемещено извлечено из корзины")}catch{}},async enable(e){try{await I().post(this.$heap.state.hostname+"Image/itemDisable",{image_id:e.image_id,is_disabled:0}),this.load()}catch{}},async load(){const e={image_holder_id:this.image_holder_id,image_holder:this.controller,is_disabled:1,is_deleted:1,is_active:1};this.images_loaded=await I().post(this.$heap.state.hostname+"Image/listGet",e)},async imagePreview(e){const i=await g.Fy.create({component:y,componentProps:{image_hash:e},initialBreakpoint:.5,breakpoints:[.5,1]}),t=function(){i.dismiss()};return v.Z.on("dismissModal",t),i.present()},async uploadImage(e){let i=new FormData;i.append("files[]",e.target.files[0]),i.set("image_holder_id",this.image_holder_id);const t={url:this.$heap.state.hostname+this.controller+"/fileUpload",type:"POST",data:i,processData:!1,contentType:!1};try{await I().ajax(t),this.load()}catch(a){if("limit_exeeded"==a?.responseJSON?.messages?.error)return void this.$flash("Уже загружено максимальное количество фото");this.$flash("Не удалось загрузить фото")}},take_photo(){I()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}};const D=(0,f.Z)($,[["render",u],["__scopeId","data-v-3717a58c"]]);var W=D},5050:function(e,i,t){t.r(i),t.d(i,{default:function(){return w}});var a=t(6252);const o={key:0,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},n={style:{width:"max-content","text-align":"center"}},s=(0,a.Uk)("Заказ не найден"),l=(0,a._)("br",null,null,-1),r=(0,a._)("a",{href:"/order-list"},"список заказов",-1);function d(e,i,t,d,c,h){const u=(0,a.up)("ion-icon"),m=(0,a.up)("ion-label"),g=(0,a.up)("order-comp"),p=(0,a.up)("image-tile-comp"),_=(0,a.up)("ion-content"),k=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(k,{pageTitle:"Заказ",pageDefaultBackLink:"order-list"},{default:(0,a.w5)((()=>[(0,a.Wm)(_,null,{default:(0,a.w5)((()=>["notfound"==c.order?((0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",n,[(0,a.Wm)(u,{icon:d.sparklesOutline,size:"large"},null,8,["icon"]),(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[s])),_:1}),l,r])])):(0,a.kq)("",!0),(0,a.Wm)(g,{orderData:c.order,onStageCreate:h.onStageCreate},null,8,["orderData","onStageCreate"]),c.order?.images.length?((0,a.wg)(),(0,a.j4)(p,{key:1,images:c.order?.images,image_holder_id:c.order?.order_id,controller:"Order",ref:"orderImgs"},null,8,["images","image_holder_id"])):(0,a.kq)("",!0)])),_:1})])),_:1})}var c=t(8903),h=t(7782),u=t(7597),m=t(8377),g=t(1933),p=t(4508),_={components:{OrderComp:u.Z,ImageTileComp:m.Z,IonLabel:p.Q$,IonIcon:p.gu,IonContent:p.W2},setup(){return{sparklesOutline:c.Fcs}},data(){return{order_id:0,order:null}},methods:{async orderGet(){try{this.order=await h.Z.api.itemGet(this.order_id)}catch(e){switch(e.status){case 404:this.$flash("Заказ не найден"),this.order="notfound",g.Z.push("order-list");break}}},async onStageCreate(e,i){if(i.includes("action")){i=i.split("_").splice(1).join("_");try{this[i](e)}catch{}}else try{const t=await h.Z.api.itemStageCreate(e,i);if("ok"==t){if("customer_purged"==i)return this.$flash("Заказ удален"),this.order=null,void g.Z.push("order-list");this.orderGet()}}catch{}},async action_checkout(e){await this.onStageCreate(e,"customer_confirmed"),this.$heap.state.currentOrder=this.order,g.Z.push("order-checkout-"+e)},action_take_photo(){this.$refs.orderImgs.take_photo()},ionViewDidEnter(){this.order_id=this.$route.params.id,this.orderGet()}}},k=t(3744);const f=(0,k.Z)(_,[["render",d]]);var w=f}}]);
//# sourceMappingURL=50.eab34165.js.map