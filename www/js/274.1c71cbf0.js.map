{"version":3,"file":"js/274.1c71cbf0.js","mappings":"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","sources":["webpack://tezkel-delivery/./src/views/UserAddresses.vue","webpack://tezkel-delivery/./src/views/UserAddresses.vue?cfef"],"sourcesContent":["<template>\r\n  <base-layout page-title=\"Мои адреса\" page-default-back-link=\"/user-dashboard\"  ref=\"UserAddressPage\">\r\n        <ion-list v-if=\"locationList.length\" lines=\"full\">\r\n          <ion-item v-for=\"(location,i) in locationList\" :key=\"location.location_id\">\r\n              <ion-img slot=\"start\" :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\r\n              <ion-label @click=\"locationSetMain(`${location.location_id}`,`${i}`)\" style=\"white-space:normal;cursor:pointer;\">{{ location.location_address }}</ion-label>\r\n              <ion-icon slot=\"end\" :icon=\"trash\" @click=\"locationDelete(`${location.location_id}`,`${i}`)\"></ion-icon>\r\n          </ion-item>\r\n        </ion-list>\r\n        <ion-card v-else color=\"warning\">\r\n          <ion-card-content>\r\n          Пока адреса не добавлены\r\n          </ion-card-content>\r\n        </ion-card>\r\n\r\n        <ion-list>\r\n          <ion-list-header>\r\n            <ion-label>Добавить адрес</ion-label>\r\n          </ion-list-header>\r\n          <ion-item  v-for=\"location in locationGroupList\" :key=\"location.group_id\" @click=\"modalLocationCreate(`${location.group_id}`,`${location.group_name}`)\" style=\"cursor:pointer\">\r\n              <ion-img :src=\"`${$heap.state.hostname}/image/get.php/${location.image_hash}.32.32.png`\" />\r\n              <ion-label style=\"margin-left:5px;padding-left:5px;border-left:solid 1px black;white-space:normal\">{{ location.group_name }}</ion-label>\r\n          </ion-item>\r\n        </ion-list>\r\n  </base-layout>\r\n</template>\r\n\r\n\r\n<script>\r\nimport {\r\n  IonImg,\r\n  IonLabel,\r\n  IonItem,\r\n  IonList,\r\n  IonNote,\r\n  IonListHeader,\r\n  IonIcon,\r\n  modalController,\r\n  IonCard,\r\n  IonCardContent,\r\n}                         from \"@ionic/vue\";\r\nimport router             from '@/router';\r\nimport heap               from '@/heap';\r\nimport User              from '@/scripts/User.js'\r\nimport jQuery             from 'jquery';\r\nimport UserAddressPicker  from '@/components/UserAddressPicker.vue';\r\n\r\nimport { trash }          from 'ionicons/icons';\r\n\r\nexport default{\r\n  name: 'UserAddresses',\r\n  components: {\r\n  IonImg,\r\n  IonLabel,\r\n  IonItem,\r\n  IonList,\r\n  IonNote,\r\n  IonListHeader,\r\n  IonIcon,\r\n  IonCard,\r\n  IonCardContent,\r\n  },\r\n  setup(){\r\n    return { trash };\r\n  },\r\n  mounted(){\r\n    this.locationListGet();\r\n  },\r\n  methods:{\r\n    async modalLocationCreate( location_group_id, location_group_name ) {\r\n      if(!heap.state.user.user_id){\r\n        this.$flash('Чтобы добавленные адреса сохранились, пожалуйста войдите в систему');\r\n        router.push({name: 'UserSignIn'});\r\n        return;\r\n      }\r\n      var location_group_name_low=String(location_group_name).toLowerCase();\r\n      const modal = await modalController.create({\r\n        component: UserAddressPicker,\r\n        showBackdrop:true,\r\n        backdropDismiss:true,\r\n        swipeToClose: true,\r\n        cssClass: 'update-profile-modal',\r\n        presentingElement: this.$refs.UserAddressPage.$el,\r\n        componentProps:{\r\n          location_group_name_low\r\n        },\r\n      });\r\n      modal.onDidDismiss().then(location => {\r\n        this.locationCreate(location_group_id,location.data);\r\n      });\r\n      return modal.present();\r\n    },\r\n    async locationListGet(){\r\n      try{\r\n        let new_location_main=null\r\n        const response=await jQuery.get(heap.state.hostname + \"User/locationListGet\",{includeGroupList:1})\r\n        this.locationList=response.location_list;\r\n        this.locationGroupList=response.location_group_list;\r\n        if(this.locationList){\r\n          for(let loc of this.locationList){\r\n            if(loc.is_main!=1)continue;\r\n              new_location_main=loc;\r\n          }\r\n        }\r\n        if( !new_location_main ){\r\n          /**\r\n           * for some reason main location is not present so reload user data\r\n           */\r\n          User.get()\r\n          return\r\n        }\r\n        if(new_location_main && new_location_main?.location_id!=heap.state.user.location_main?.location_id){\r\n          heap.state.user.location_main=new_location_main\r\n          this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\r\n        }\r\n      }catch{/** */}\r\n    },\r\n    async locationCreate(group_id,location){\r\n      if( !location ){\r\n        return;\r\n      }\r\n      let request={\r\n        location_holder:'user',\r\n        location_holder_id:heap.state.user.user_id,\r\n        location_group_id:group_id,\r\n        location_address:location.location_address,\r\n        location_latitude:location.location_latitude,\r\n        location_longitude:location.location_longitude\r\n      };\r\n      try{\r\n        await jQuery.post(heap.state.hostname + \"User/locationCreate\",request)\r\n        this.locationListGet();\r\n      } catch(err){\r\n        const exception=err.responseJSON;\r\n        const exception_code=exception.messages.error;\r\n        switch(exception_code){\r\n            case 'limit_exeeded':\r\n                this.$flash(\"Больше адресов добавить нельзя\");\r\n                break;\r\n        }\r\n        return false\r\n      }\r\n    },\r\n    async locationSetMain( location_id, index ){\r\n      var self=this;\r\n      var loc=self.locationList[index];\r\n      heap.state.user.location_main={\r\n        location_id:loc.location_id,\r\n        location_latitude:loc.location_latitude,\r\n        location_altitude:loc.location_altitude,\r\n        location_address:loc.location_address,\r\n        image_hash:loc.image_hash\r\n      };\r\n      router.go(-1);\r\n      await jQuery.post(heap.state.hostname + \"User/locationSetMain\",{location_id});\r\n      this.$topic.publish('userMainLocationSet',heap.state.user.location_main)\r\n    },\r\n    async locationDelete( location_id, index ){\r\n      try{\r\n        this.locationList.splice(index,1);\r\n        await jQuery.post(heap.state.hostname + \"User/locationDelete\",{location_id})\r\n      }catch{/** */}\r\n      this.locationListGet();\r\n    }\r\n  },\r\n  data(){\r\n    return{\r\n      locationList:[],\r\n      locationGroupList:[]\r\n    }\r\n  }\r\n}\r\n</script>","import { render } from \"./UserAddresses.vue?vue&type=template&id=22b0cd9b\"\nimport script from \"./UserAddresses.vue?vue&type=script&lang=js\"\nexport * from \"./UserAddresses.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"W:\\\\Ionic\\\\Tezkel\\\\blank\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","ref","$data","length","_component_ion_list","lines","_createElementBlock","_Fragment","_renderList","location","i","_component_ion_item","key","location_id","_createVNode","_component_ion_img","slot","src","_ctx","state","hostname","image_hash","_component_ion_label","onClick","$options","style","location_address","_component_ion_icon","icon","$setup","_component_ion_card","color","_component_ion_card_content","_component_ion_list_header","group_id","group_name","name","components","IonImg","IonLabel","IonItem","IonList","IonNote","IonListHeader","IonIcon","IonCard","IonCardContent","setup","trash","mounted","this","locationListGet","methods","async","location_group_id","location_group_name","heap","$flash","router","location_group_name_low","String","toLowerCase","modal","modalController","component","UserAddressPicker","showBackdrop","backdropDismiss","swipeToClose","cssClass","presentingElement","$refs","UserAddressPage","$el","componentProps","onDidDismiss","then","locationCreate","data","present","new_location_main","response","jQuery","includeGroupList","locationList","location_list","locationGroupList","location_group_list","loc","is_main","User","$topic","publish","request","location_holder","location_holder_id","location_latitude","location_longitude","err","exception","responseJSON","exception_code","messages","error","index","self","location_altitude","splice","__exports__","render"],"sourceRoot":""}