"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[1134],{5784:function(t,e,l){l.r(e),l.d(e,{default:function(){return m}});var a=l(641),n=l(33);const o={key:0},i={key:1},r={key:2};function d(t,e,l,d,s,u){const c=(0,a.g2)("ion-segment-button"),v=(0,a.g2)("ion-segment"),p=(0,a.g2)("ion-icon"),_=(0,a.g2)("ion-label"),k=(0,a.g2)("ion-item"),f=(0,a.g2)("ion-list"),h=(0,a.g2)("ledger-comp"),b=(0,a.g2)("statistics-seller-report"),m=(0,a.g2)("base-layout");return(0,a.uX)(),(0,a.Wv)(m,{pageDefaultBackLink:"/user","page-title":"Бухгалтерия"},{default:(0,a.k6)(()=>[(0,a.bF)(v,{"swipe-gesture":"true",modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=t=>s.activeTab=t),onIonInput:e[1]||(e[1]=e=>t.listTypeChanged(e))},{default:(0,a.k6)(()=>[(0,a.bF)(c,{value:"reports"},{default:(0,a.k6)(()=>e[6]||(e[6]=[(0,a.eW)(" Баланс ")])),_:1,__:[6]}),(0,a.bF)(c,{value:"ledger"},{default:(0,a.k6)(()=>e[7]||(e[7]=[(0,a.eW)(" Проводки ")])),_:1,__:[7]}),(0,a.bF)(c,{value:"sellerReport"},{default:(0,a.k6)(()=>e[8]||(e[8]=[(0,a.eW)(" Отчет ")])),_:1,__:[8]})]),_:1},8,["modelValue"]),"reports"==s.activeTab?((0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(f,null,{default:(0,a.k6)(()=>[(0,a.bF)(k,{button:"",onClick:e[2]||(e[2]=t=>u.reportSupplierBalanceExport())},{default:(0,a.k6)(()=>[(0,a.bF)(p,{slot:"start",src:d.downloadOutline},null,8,["src"]),(0,a.bF)(_,null,{default:(0,a.k6)(()=>e[9]||(e[9]=[(0,a.eW)("Скачать баланс продавцов")])),_:1,__:[9]})]),_:1})]),_:1})])):(0,a.Q3)("",!0),"ledger"==s.activeTab?((0,a.uX)(),(0,a.CE)("div",i,[(0,a.bF)(f,null,{default:(0,a.k6)(()=>[(0,a.bF)(k,{button:"",onClick:e[3]||(e[3]=t=>u.itemCreate())},{default:(0,a.k6)(()=>[(0,a.bF)(p,{slot:"start",src:d.addOutline},null,8,["src"]),(0,a.bF)(_,null,{default:(0,a.k6)(()=>e[10]||(e[10]=[(0,a.eW)("Добавить проводку")])),_:1,__:[10]})]),_:1})]),_:1}),(0,a.bF)(h,{account:s.ledgerAccount,ref:"ledger"},null,8,["account"])])):(0,a.Q3)("",!0),"sellerReport"==s.activeTab?((0,a.uX)(),(0,a.CE)("div",r,[(0,a.bF)(f,null,{default:(0,a.k6)(()=>[s.pickedStore?((0,a.uX)(),(0,a.Wv)(k,{key:0,button:"",onClick:e[4]||(e[4]=t=>u.storePick()),color:"primary"},{default:(0,a.k6)(()=>[(0,a.bF)(p,{slot:"start",src:d.storefrontOutline},null,8,["src"]),(0,a.bF)(_,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(s.pickedStore.store_name),1)]),_:1})]),_:1})):((0,a.uX)(),(0,a.Wv)(k,{key:1,button:"",onClick:e[5]||(e[5]=t=>u.storePick()),color:"warning"},{default:(0,a.k6)(()=>[(0,a.bF)(p,{slot:"start",src:d.storefrontOutline},null,8,["src"]),(0,a.bF)(_,null,{default:(0,a.k6)(()=>e[11]||(e[11]=[(0,a.eW)("Выбрать продавца")])),_:1,__:[11]})]),_:1}))]),_:1}),"sellerReport"==s.activeTab?((0,a.uX)(),(0,a.Wv)(b,{key:0,store:s.pickedStore},null,8,["store"])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)]),_:1})}var s=l(5634),u=l(5480),c=l(8062),v=l(5908),p=l(6383),_=l(2311),k=l.n(_),f={components:{LedgerComp:c.A,IonSegmentButton:s.eP,IonSegment:s.Gp,IonList:s.nf,IonItem:s.uz,IonLabel:s.he,IonIcon:s.iq,StatisticsSellerReport:v.A},setup(){return{addOutline:u.EKF,refreshOutline:u.mVv,storefrontOutline:u.te8,downloadOutline:u.fPB}},data(){return{activeTab:"ledger",ledgerAccount:"supplier",pickedStore:null}},computed:{},methods:{itemCreate(){this.$go("/admin/transaction-edit-0")},async storePick(){const t=await s.OZ.create({component:p.A,componentProps:{itemType:"store"},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});t.present(),this.$topic.on("dismissModal",()=>{t.dismiss()});const e=await t.onDidDismiss();e.data&&(this.pickedStore=e.data)},async reportSupplierBalanceExport(){try{const t={output:"xlsx"},e=await k().post(`${this.$heap.state.hostname}Statistics/statSupplierBalanceReport`,t),l=`${this.$heap.state.hostname}Statistics/download/${e}/supplierBalance.xlsx`,a=document.createElement("a");a.href=l,a.download="download",a.click()}catch(t){return!1}}},ionViewDidEnter(){this.$refs.ledger.listGet()}},h=l(6262);const b=(0,h.A)(f,[["render",d],["__scopeId","data-v-4fa7f3d0"]]);var m=b},5908:function(t,e,l){l.d(e,{A:function(){return g}});var a=l(641),n=l(33);const o={slot:"end",style:{display:"grid","grid-template-columns":"120px"}},i={slot:"end",style:{display:"grid","grid-template-columns":"120px"}},r={class:"horizontalScroller"},d={key:1,class:"printDiv"},s={class:"table_head"},u={class:"table",style:{"overflow-x":"scroll"}},c=["href"];function v(t,e,l,v,p,_){const k=(0,a.g2)("ion-icon"),f=(0,a.g2)("ion-text"),h=(0,a.g2)("ion-item"),b=(0,a.g2)("ion-input"),m=(0,a.g2)("ion-list"),g=(0,a.g2)("ion-accordion"),y=(0,a.g2)("ion-accordion-group"),F=(0,a.g2)("ion-label"),I=(0,a.g2)("ion-chip"),w=(0,a.g2)("ion-searchbar"),L=(0,a.g2)("ion-skeleton-text");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(y,null,{default:(0,a.k6)(()=>[(0,a.bF)(g,{value:"period"},{default:(0,a.k6)(()=>[(0,a.bF)(h,{slot:"header"},{default:(0,a.k6)(()=>[(0,a.bF)(k,{icon:v.calendarOutline,slot:"start"},null,8,["icon"]),(0,a.bF)(f,null,{default:(0,a.k6)(()=>[e[8]||(e[8]=(0,a.eW)("Период ")),(0,a.Lk)("small",null,(0,n.v_)(p.start_at)+" до "+(0,n.v_)(p.finish_at),1)]),_:1,__:[8]})]),_:1}),(0,a.bF)(m,{slot:"content"},{default:(0,a.k6)(()=>[(0,a.bF)(h,null,{default:(0,a.k6)(()=>[(0,a.bF)(f,null,{default:(0,a.k6)(()=>e[9]||(e[9]=[(0,a.eW)("Начальная дата")])),_:1,__:[9]}),(0,a.Lk)("div",o,[(0,a.bF)(b,{type:"date",modelValue:p.start_at,"onUpdate:modelValue":e[0]||(e[0]=t=>p.start_at=t),onIonInput:e[1]||(e[1]=t=>_.reportGet())},null,8,["modelValue"])])]),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)(()=>[(0,a.bF)(f,null,{default:(0,a.k6)(()=>e[10]||(e[10]=[(0,a.eW)("Конечная дата")])),_:1,__:[10]}),(0,a.Lk)("div",i,[(0,a.bF)(b,{type:"date",modelValue:p.finish_at,"onUpdate:modelValue":e[2]||(e[2]=t=>p.finish_at=t),onIonInput:e[3]||(e[3]=t=>_.reportGet())},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),(0,a.Lk)("div",r,[(0,a.bF)(I,{onClick:e[4]||(e[4]=t=>_.reportExport()),color:"medium"},{default:(0,a.k6)(()=>[(0,a.bF)(k,{src:v.downloadOutline},null,8,["src"]),(0,a.bF)(F,null,{default:(0,a.k6)(()=>e[11]||(e[11]=[(0,a.eW)("Скачать")])),_:1,__:[11]})]),_:1}),(0,a.bF)(I,{onClick:e[5]||(e[5]=t=>_.reportGet()),color:"medium"},{default:(0,a.k6)(()=>[(0,a.bF)(k,{src:v.reloadOutline},null,8,["src"]),(0,a.bF)(F,null,{default:(0,a.k6)(()=>e[12]||(e[12]=[(0,a.eW)("Обновить")])),_:1,__:[12]})]),_:1})]),(0,a.bF)(w,{modelValue:p.searchQuery,"onUpdate:modelValue":e[6]||(e[6]=t=>p.searchQuery=t),placeholder:"Поиск по товару",onIonInput:e[7]||(e[7]=t=>_.reportGet()),debounce:"500"},null,8,["modelValue"]),null==p.report?((0,a.uX)(),(0,a.Wv)(m,{key:0},{default:(0,a.k6)(()=>[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)([1,2,3],t=>(0,a.bF)(h,{key:t},{default:(0,a.k6)(()=>[(0,a.bF)(f,{slot:"start"},{default:(0,a.k6)(()=>[(0,a.bF)(L,{animated:"",style:{width:"50px"}})]),_:1}),(0,a.bF)(F,null,{default:(0,a.k6)(()=>[(0,a.bF)(L,{animated:"",style:{width:"100%"}})]),_:1}),(0,a.bF)(F,{slot:"end",color:"success"},{default:(0,a.k6)(()=>[(0,a.bF)(L,{animated:"",style:{width:"50px"}})]),_:1})]),_:2},1024)),64))]),_:1})):p.report.body.length>0?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("div",s,[e[13]||(e[13]=(0,a.Lk)("div",null,"Количество",-1)),(0,a.Lk)("div",null,(0,n.v_)(p.report.head.total_quantity),1),e[14]||(e[14]=(0,a.Lk)("div",null,"Скидка",-1)),(0,a.Lk)("div",null,(0,n.v_)(p.report.head.total_discount),1),e[15]||(e[15]=(0,a.Lk)("div",null,"Сумма",-1)),(0,a.Lk)("div",null,(0,n.v_)(p.report.head.total_sum),1),e[16]||(e[16]=(0,a.Lk)("div",null,"Вознаграждение",-1)),(0,a.Lk)("div",null,(0,n.v_)(p.report.head.total_commission),1),e[17]||(e[17]=(0,a.Lk)("div",null,"К выплате",-1)),(0,a.Lk)("div",null,(0,n.v_)(p.report.head.total_topay),1)]),(0,a.Lk)("div",u,[e[18]||(e[18]=(0,a.Fv)('<div class="table_h" data-v-ccaff9d8><div data-v-ccaff9d8>Время</div><div data-v-ccaff9d8>Заказ №</div><div data-v-ccaff9d8>Товар</div><div data-v-ccaff9d8>Цена</div><div data-v-ccaff9d8>Количество</div><div data-v-ccaff9d8>Скидка</div><div data-v-ccaff9d8>Сумма</div><div data-v-ccaff9d8>Вознаграждение %</div><div data-v-ccaff9d8>Доставка</div><div data-v-ccaff9d8>Оплата</div><div data-v-ccaff9d8>Чек</div></div>',1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.report.body,(t,e)=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:"table_r"},[(0,a.Lk)("div",null,(0,n.v_)(t.created_at),1),(0,a.Lk)("div",null,(0,n.v_)(t.order_id),1),(0,a.Lk)("div",null,(0,n.v_)(t.entry_text),1),(0,a.Lk)("div",null,(0,n.v_)(t.entry_price),1),(0,a.Lk)("div",null,(0,n.v_)(t.entry_quantity),1),(0,a.Lk)("div",null,(0,n.v_)(t.entry_discount),1),(0,a.Lk)("div",null,(0,n.v_)(t.entry_sum),1),(0,a.Lk)("div",null,(0,n.v_)(t.fee),1),(0,a.Lk)("div",null,(0,n.v_)(t.delivery),1),(0,a.Lk)("div",null,(0,n.v_)(t.payment_type),1),(0,a.Lk)("div",null,[t.invoice_link?((0,a.uX)(),(0,a.CE)("a",{key:0,href:t.invoice_link,target:"_new"},"онлайн чек",8,c)):(0,a.Q3)("",!0)])]))),128))])])):((0,a.uX)(),(0,a.Wv)(m,{key:2},{default:(0,a.k6)(()=>[(0,a.bF)(h,null,{default:(0,a.k6)(()=>e[19]||(e[19]=[(0,a.eW)(" Нет заказов в данном периоде ")])),_:1,__:[19]})]),_:1}))])}var p=l(5634),_=l(5480),k=l(2311),f=l.n(k),h={components:{IonIcon:p.iq,IonLabel:p.he,IonItem:p.uz,IonInput:p.$w,IonList:p.nf,IonAccordion:p.xk,IonAccordionGroup:p.YH,IonText:p.IO,IonSkeletonText:p.ds,IonSearchbar:p.S1,IonChip:p.ZB},props:["store"],setup(){return{calendarOutline:_.RXF,addOutline:_.EKF,closeCircle:_.P0k,pricetagOutline:_.eOv,downloadOutline:_.fPB,reloadOutline:_.QMU,printOutline:_.SfY}},data(){const t=new Date,e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),1));return{start_at:e.toISOString().slice(0,10),finish_at:t.toISOString().slice(0,10),searchQuery:"",report:null,today:t}},watch:{store:function(){this.reportGet()}},methods:{async reportGet(){var t;if(null===(t=this.store)||void 0===t||!t.store_id)return this.report=null,void(this.head=null);try{var e;const t={store_id:null===(e=this.store)||void 0===e?void 0:e.store_id,start_at:this.start_at,finish_at:this.finish_at,searchQuery:this.searchQuery},l=await f().post(`${this.$heap.state.hostname}Statistics/sellReportProductGet`,t);this.report=l}catch(n){var l,a;const t=null===n||void 0===n||null===(l=n.responseJSON)||void 0===l||null===(a=l.messages)||void 0===a?void 0:a.error;switch(t){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},reportPrint(){window.print()},async reportExport(){var t;if(null===(t=this.store)||void 0===t||!t.store_id)return this.report=null,void(this.head=null);try{var e;const t={store_id:null===(e=this.store)||void 0===e?void 0:e.store_id,start_at:this.start_at,finish_at:this.finish_at,searchQuery:this.searchQuery,output:"xlsx"},l=await f().post(`${this.$heap.state.hostname}Statistics/sellReportProductGet`,t),a=this.store.store_name.replace(/[^\wа-яА-Яa-zA-Z]/gi,""),n=`${this.$heap.state.hostname}Statistics/download/${l}/sellReport_${a}_${this.start_at}.xlsx`,o=document.createElement("a");o.href=n,o.download="download",o.click()}catch(n){var l,a;const t=null===n||void 0===n||null===(l=n.responseJSON)||void 0===l||null===(a=l.messages)||void 0===a?void 0:a.error;switch(t){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки"),console.log(n);break}return this.ledger=[],this.balance=0,!1}},toLocDate(t){const e=new Date(Date.parse(t)),l={month:"short",day:"numeric"};return e.toLocaleDateString(void 0,l)}},mounted(){this.reportGet()}},b=l(6262);const m=(0,b.A)(h,[["render",v],["__scopeId","data-v-ccaff9d8"]]);var g=m}}]);
//# sourceMappingURL=1134.08906a6d.js.map