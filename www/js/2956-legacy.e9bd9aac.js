"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2956],{5265:function(t,e,n){n.d(e,{Z:function(){return _}});var r=n(6252),a=(0,r.Uk)("Привязка новой карты"),i=(0,r.Uk)("Оплата картой"),o=["src"],s={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},c=["src"];function u(t,e,n,u,l,d){var p=this,m=(0,r.up)("ion-title"),f=(0,r.up)("ion-icon"),h=(0,r.up)("ion-toolbar"),k=(0,r.up)("ion-header"),v=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(k,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(h,{color:"secondary"},{default:(0,r.w5)((function(){return["card_registering"==p.order_data?((0,r.wg)(),(0,r.j4)(m,{key:0},{default:(0,r.w5)((function(){return[a]})),_:1})):((0,r.wg)(),(0,r.j4)(m,{key:1},{default:(0,r.w5)((function(){return[i]})),_:1})),(0,r.Wm)(f,{icon:u.closeOutline,onClick:e[0]||(e[0]=function(t){u.closeModal()}),slot:"end",size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[(0,r._)("iframe",{src:l.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"calc( 100% - 5px )",border:"none"},onLoad:e[1]||(e[1]=function(t){return d.onLoad()})},null,40,o),l.loadAnimation?((0,r.wg)(),(0,r.iD)("div",s,[(0,r._)("img",{src:u.loading},null,8,c)])):(0,r.kq)("",!0)]})),_:1})],64)}var l=n(6835),d=n(8534),p=n(8292),m=n(8903),f=n(659),h=n(9755),k=n.n(h),v={components:{IonTitle:p.wd,IonIcon:p.gu,IonToolbar:p.sr,IonHeader:p.Gu,IonContent:p.W2},props:["order_data"],setup(){var t=function(){p.Fy.dismiss()};return{closeModal:t,closeOutline:m.fID,cardOutline:m.pvm,loading:f}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{postToIframe(){var t=this;return(0,d.Z)((0,l.Z)().mark((function e(){var n,r,a;return(0,l.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,"card_registering"!=t.order_data){e.next=6;break}return e.next=4,k().post(t.$heap.state.hostname+"CardAcquirer/cardRegisterLinkGet");case 4:return t.paymentLink=e.sent,e.abrupt("return");case 6:return e.next=8,k().post(t.$heap.state.hostname+"CardAcquirer/paymentLinkGet",t.order_data);case 8:t.paymentLink=e.sent,e.next=16;break;case 11:e.prev=11,e.t0=e["catch"](0),a=null===e.t0||void 0===e.t0||null===(n=e.t0.responseJSON)||void 0===n||null===(r=n.messages)||void 0===r?void 0:r.error,"nocardid"==a?t.$flash("Не удалось добавить карту"):t.$flash("Нет возможности принять оплату картой"),t.closeModal();case 16:case"end":return e.stop()}}),e,null,[[0,11]])})))()},onLoad(){this.loadAnimation=0},listenFrame(){var t=this;window.addEventListener("message",(function(e){"paymentOk"!=e.data&&"paymentNo"!=e.data||t.closeModal()}))}}},w=n(3744);const g=(0,w.Z)(v,[["render",u]]);var _=g},2956:function(t,e,n){n.r(e),n.d(e,{default:function(){return g}});var r=n(6252),a=n(3577),i=(0,r.Uk)("Привязанных карт нет"),o=(0,r.Uk)(" Добавить новую карту ");function s(t,e,n,s,c,u){var l=(0,r.up)("ion-icon"),d=(0,r.up)("ion-skeleton-text"),p=(0,r.up)("ion-item"),m=(0,r.up)("ion-list"),f=(0,r.up)("ion-img"),h=(0,r.up)("ion-label"),k=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(k,{pageTitle:"Мои банковские карты",pageDefaultBackLink:"/user"},{default:(0,r.w5)((function(){var t;return[null==c.cardList?((0,r.wg)(),(0,r.j4)(m,{key:0},{default:(0,r.w5)((function(){return[((0,r.wg)(),(0,r.iD)(r.HY,null,(0,r.Ko)([1],(function(t){return(0,r.Wm)(p,{key:t},{default:(0,r.w5)((function(){return[(0,r.Wm)(l,{style:{"background-color":"var(--ion-color-light)"},slot:"start"}),(0,r.Wm)(d,{animated:"",style:{width:"100%"}}),(0,r.Wm)(l,{style:{"background-color":"var(--ion-color-light)"},slot:"end"})]})),_:2},1024)})),64))]})),_:1})):(null===(t=c.cardList)||void 0===t?void 0:t.length)>0?((0,r.wg)(),(0,r.j4)(m,{key:1},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(c.cardList,(function(t,e){return(0,r.wg)(),(0,r.j4)(p,{key:t.order_id,button:""},{default:(0,r.w5)((function(){return["mir"==t.card_type?((0,r.wg)(),(0,r.j4)(f,{key:0,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==t.card_type?((0,r.wg)(),(0,r.j4)(f,{key:1,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==t.card_type?((0,r.wg)(),(0,r.j4)(f,{key:2,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):((0,r.wg)(),(0,r.j4)(l,{key:3,src:s.cardOutline,slot:"start",color:"primary"},null,8,["src"])),(0,r.Wm)(h,{onClick:function(n){return 0!=e&&u.itemMainSet(t.card_id)},class:(0,a.C_)(0==e?"is_main":"")},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(t.card_mask),1)]})),_:2},1032,["onClick","class"]),(0,r.Wm)(l,{icon:s.trashOutline,slot:"end",onClick:function(e){return u.itemDelete(t.card_id)}},null,8,["icon","onClick"])]})),_:2},1024)})),128))]})),_:1})):((0,r.wg)(),(0,r.j4)(m,{key:2},{default:(0,r.w5)((function(){return[(0,r.Wm)(p,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(h,{color:"medium"},{default:(0,r.w5)((function(){return[i]})),_:1})]})),_:1})]})),_:1})),(0,r.Wm)(p,{button:"",onClick:e[0]||(e[0]=function(t){return u.cardRegistrationOpen()})},{default:(0,r.w5)((function(){return[(0,r.Wm)(l,{icon:s.addOutline,slot:"start"},null,8,["icon"]),o]})),_:1})]})),_:1})}var c=n(6835),u=n(8534),l=n(8292),d=n(8903),p=n(5265),m=n(9042),f=n(9755),h=n.n(f),k={components:{IonList:l.q_,IonItem:l.Ie,IonSkeletonText:l.CK,IonLabel:l.Q$,IonIcon:l.gu,IonImg:l.Xz},setup(){return{cardOutline:d.pvm,addOutline:d.s6O,trashOutline:d.gtu}},data(){return{cardList:null,isOpen:!1,billLink:""}},methods:{listGet(){var t=this;return(0,u.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h().post(t.$heap.state.hostname+"UserCards/listGet");case 3:t.cardList=e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e["catch"](0);case 8:case"end":return e.stop()}}),e,null,[[0,6]])})))()},itemMainSet(t){var e=this;return(0,u.Z)((0,c.Z)().mark((function n(){var r;return(0,c.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r={card_id:t},n.prev=1,n.next=4,h().post(`${e.$heap.state.hostname}UserCards/itemMainSet`,r);case 4:e.listGet(),n.next=9;break;case 7:n.prev=7,n.t0=n["catch"](1);case 9:case"end":return n.stop()}}),n,null,[[1,7]])})))()},itemDelete(t){var e=this;return(0,u.Z)((0,c.Z)().mark((function n(){var r;return(0,c.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(confirm("Вы уверенны?")){n.next=2;break}return n.abrupt("return");case 2:return r={card_id:t},n.prev=3,n.next=6,h().post(`${e.$heap.state.hostname}UserCards/itemDelete`,r);case 6:e.listGet(),n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](3),e.flash("Не удалось открепить карту");case 12:case"end":return n.stop()}}),n,null,[[3,9]])})))()},cardRegistrationOpen(){var t=this;return(0,u.Z)((0,c.Z)().mark((function e(){var n,r,a,i;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="card_registering",r=t,e.next=4,l.Fy.create({component:p.Z,componentProps:{order_data:n},initialBreakpoint:.85,breakpoints:[0,.85,.95]});case 4:return a=e.sent,i=function(){a.dismiss()},m.Z.on("dismissModal",i),a.onDidDismiss().then((function(){r.cardRegistrationCheck()})),e.abrupt("return",a.present());case 9:case"end":return e.stop()}}),e)})))()},cardRegistrationCheck(){var t=this;return(0,u.Z)((0,c.Z)().mark((function e(){var n;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h().post(t.$heap.state.hostname+"CardAcquirer/cardRegisterActivate");case 3:n=e.sent,"ok"==n&&(t.$flash("Карта успешно привязана"),t.listGet()),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t.$flash("Не удалось привязать карту");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}},mounted(){this.listGet()}},v=n(3744);const w=(0,v.Z)(k,[["render",s],["__scopeId","data-v-2e696c9d"]]);var g=w},659:function(t,e,n){t.exports=n.p+"img/loading.30880178.svg"}}]);
//# sourceMappingURL=2956-legacy.e9bd9aac.js.map