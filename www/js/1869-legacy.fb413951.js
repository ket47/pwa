"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[1869],{6970:function(e,t,r){r.r(t),r.d(t,{default:function(){return h}});var s=r(6252);function a(e,t,r,a,o,i){const n=(0,s.up)("ship-comp"),d=(0,s.up)("base-layout");return(0,s.wg)(),(0,s.j4)(d,{"page-title":"Вызов курьера"},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{orderData:o.order,onStageCreate:i.onStageCreate,onOrderUpdate:i.itemUpdate},null,8,["orderData","onStageCreate","onOrderUpdate"])])),_:1})}r(4916),r(5306),r(8862),r(7658);var o=r(4929),i=r(9755),n=r.n(i),d=r(2118),c={components:{ShipComp:d.Z,IonButton:o.YG},data(){return{order:null}},methods:{async itemCreate(){const e=new Date,t={order_store_id:null,order_id:0,entries:[],created_at:e.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.order=t,this.itemSave()},async itemLoad(){try{const e=JSON.parse(localStorage.shipmentDraft);if(e)return void(this.order=e)}catch(e){}this.itemCreate()},async itemSave(){localStorage.shipmentDraft=JSON.stringify(this.order)},async itemUpdate(e){this.order=Object.assign(this.order,e),this.itemSave()},async onStageCreate(e,t){if("customer_purged"==t||"customer_deleted"==t)return localStorage.removeItem("shipmentDraft"),void this.$router.replace("/order/order-list");"customer_action_confirm"==t&&(t="customer_confirmed");try{const e=this.order,t=await n().post(`${this.$heap.state.hostname}Shipment/itemSync`,e);t>0&&this.$router.push(`modal/shipment-checkout-${t}`)}catch(r){const t=null===r||void 0===r?void 0:r.responseJSON;if(!t)return!1;const s=t.messages.error;switch(s){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии ☹️","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+e;break}return!1}}},mounted(){this.itemLoad()}},u=r(3744);const m=(0,u.Z)(c,[["render",a]]);var h=m}}]);
//# sourceMappingURL=1869-legacy.fb413951.js.map