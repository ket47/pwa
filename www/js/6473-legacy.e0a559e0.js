"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[6473],{6473:function(e,t,n){n.r(t),n.d(t,{default:function(){return W}});var o=n(6252),i=n(3577);const r=(0,o.Uk)(" Подтверждение номера телефона "),u=(0,o.Uk)("Мы выслали вам смс с кодом подтверждения на номер "),a=(0,o.Uk)(". Введите 4 цифры из смс ниже"),l=(0,o._)("hr",null,null,-1),s=(0,o._)("p",null,"Поступление СМС на ваш телефон может занять до 2 минут.",-1),d={novalidate:""},c=(0,o.Uk)("Код подтверждения из смс"),p=(0,o.Uk)("Подтвердить");function m(e,t,n,m,h,f){const _=(0,o.up)("ion-card-title"),w=(0,o.up)("ion-card-header"),k=(0,o.up)("ion-card-content"),v=(0,o.up)("ion-card"),I=(0,o.up)("ion-label"),$=(0,o.up)("ion-input"),W=(0,o.up)("ion-col"),b=(0,o.up)("ion-row"),S=(0,o.up)("ion-item"),g=(0,o.up)("ion-list"),y=(0,o.up)("ion-button"),C=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(C,{"page-title":"Подтверждение телефона",pageDefaultBackLink:"/user"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{color:"light"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{color:"primary"},{default:(0,o.w5)((()=>[r])),_:1})])),_:1}),(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o._)("p",null,[u,(0,o._)("b",null,(0,i.zw)(h.user_phone),1),a]),l,s])),_:1})])),_:1}),(0,o._)("form",d,[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(I,{position:"stacked",color:"primary"},{default:(0,o.w5)((()=>[c])),_:1}),(0,o.Wm)($,{modelValue:h.verification_code,"onUpdate:modelValue":t[0]||(t[0]=e=>h.verification_code=e),type:"numeric",inputmode:"numeric",placeholder:"- - - -",onIonInput:t[1]||(t[1]=e=>{h.verification_code=e.target.value,f.onSubmit()}),enterkeyhint:"go",required:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(b,{"responsive-sm":""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{onClick:t[2]||(t[2]=e=>f.onSubmit()),expand:"block"},{default:(0,o.w5)((()=>[p])),_:1})])),_:1})])),_:1}),(0,o.Wm)(b,{"responsive-sm":""},{default:(0,o.w5)((()=>[(0,o.Wm)(W,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{onClick:t[3]||(t[3]=e=>{h.is_sent=!1,f.smsSend()}),expand:"block",color:"light",disabled:h.timeToResend>0},{default:(0,o.w5)((()=>[(0,o.Uk)("Послать снова "+(0,i.zw)(f.timeLeft),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])])),_:1})}var h=n(8534),f=(n(4916),n(5306),n(8292)),_=n(9755),w=n.n(_),k=n(351),v={name:"UserVerifyPhone",components:{IonLabel:f.Q$,IonCol:f.wI,IonInput:f.pK,IonRow:f.Nd,IonButton:f.YG,IonCard:f.PM,IonCardHeader:f.Zi,IonCardTitle:f.Dq,IonCardContent:f.FN,IonItem:f.Ie,IonList:f.q_},data(){return{verification_code:null,user_phone:this.$route.params.user_phone||this.$route.query.user_phone||"",is_sent:!1,timeToResend:120}},created(){this.smsSend()},ionViewDidEnter(){this.smsSend()},computed:{timeLeft(){const e=Math.floor(this.timeToResend/60),t=this.timeToResend-60*e;return`${e}:${t}`}},methods:{clockStart(){this.timeToResend<=0||(this.timeToResend--,setTimeout((()=>this.clockStart()),1e3))},smsSend(){var e=this;return(0,h.Z)((function*(){if(e.is_sent)return;if(e.user_phone=e.$route.params.user_phone||e.$route.query.user_phone||"",!e.user_phone)return void e.$router.replace("/user");let t={user_phone:e.user_phone};try{e.is_sent=!0,yield w().post(`${e.$heap.state.hostname}User/phoneVerificationSend`,t),e.timeToResend=120,e.clockStart()}catch(n){}}))()},onSubmit(){var e=this;return(0,h.Z)((function*(){if(e.verification_code&&4==String(e.verification_code).length)try{yield w().post(`${e.$heap.state.hostname}/User/phoneVerificationCheck`,{user_phone:e.user_phone,verification_code:e.verification_code}),e.$flash("Номер телефона верифицирован"),e.$router.replace("/user"),yield k.Z.autoSignIn(),e.$router.push("/catalog")}catch(t){const n=t.responseJSON.messages.error;switch(n){case"verification_not_found":e.$flash("Код верификации устарел"),e.$router.replace("/user/sign-in");break}e.$flash("Не удалось верифицировать телефон")}}))()}}},I=n(3744);const $=(0,I.Z)(v,[["render",m]]);var W=$}}]);
//# sourceMappingURL=6473-legacy.e0a559e0.js.map