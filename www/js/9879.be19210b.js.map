{"version":3,"file":"js/9879.be19210b.js","mappings":"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","sources":["webpack://Tezkel/./src/views/ShipmentDraftView.vue","webpack://Tezkel/./src/views/ShipmentDraftView.vue?ac34"],"sourcesContent":["<template>\r\n    <base-layout page-title=\"Вызов курьера\">\r\n        <shipment-draft-comp :orderData=\"order\" @stageCreate=\"onStageCreate\" @orderUpdate=\"itemUpdate\" @locationUpdate=\"locationUpdate\"/>\r\n    </base-layout>\r\n</template>\r\n<script>\r\n\r\nimport jQuery           from \"jquery\";\r\nimport ShipmentDraftComp          from '@/components/ShipmentDraftComp.vue';\r\n\r\nexport default {\r\n    components:{\r\n        ShipmentDraftComp,\r\n    },\r\n    data(){\r\n        return{\r\n            order:null,\r\n            errorCode:null\r\n        }\r\n    },\r\n    methods:{\r\n        async itemCreate(){\r\n            const date=new Date()\r\n            const draft={\r\n                order_store_id:null,\r\n                order_id:0,\r\n                entries:[],\r\n                created_at:date.toISOString().replace(/[T]/g,' ').replace(/.\\d\\d\\dZ/,''),\r\n                stage_next:{\r\n                    \"customer_confirmed\": [\"Перейти к оформлению\"],\r\n                    \"customer_deleted\": [\"Удалить\",\"danger\",\"clear\"],\r\n                },\r\n                stage_current:'customer_cart',\r\n                user_role:'customer',\r\n            }\r\n            this.itemSave(draft)\r\n        },\r\n        async itemLoad(){\r\n            try{\r\n                const storedOrder=JSON.parse(localStorage.shipmentDraft)\r\n                if(storedOrder){\r\n                    storedOrder.deliveryCalculation=await this.itemTotalEstimate(storedOrder.order_start_location_id,storedOrder.order_finish_location_id)\r\n                    this.order=storedOrder\r\n                    return\r\n                }\r\n            }catch{/** */}\r\n            this.itemCreate()\r\n        },\r\n        itemSave( order ){\r\n            this.order=order\r\n            localStorage.shipmentDraft=JSON.stringify(order)\r\n        },\r\n        async itemUpdate( orderUpdate ){\r\n            console.log(orderUpdate.mode,orderUpdate.order_start_location_id,orderUpdate.order_finish_location_id)\r\n            if( orderUpdate.mode=='refreshTotalEstimates' ){\r\n                orderUpdate.deliveryCalculation=await this.itemTotalEstimate( orderUpdate.order_start_location_id, orderUpdate.order_finish_location_id )\r\n            }\r\n            this.itemSave(Object.assign({},this.order,orderUpdate))\r\n        },\r\n        async locationUpdate(locationUpdate){\r\n            try{\r\n                await jQuery.post(`${this.$heap.state.hostname}Location/itemUpdate`,JSON.stringify(locationUpdate))\r\n                this.$flash(\"сохранено\")\r\n            }catch{/** */}\r\n        },\r\n        async itemTotalEstimate(start_location_id,finish_location_id){\r\n            if(!start_location_id || !finish_location_id){\r\n                return\r\n            }\r\n            const request={\r\n                start_location_id,finish_location_id\r\n            }\r\n            try{\r\n                return await jQuery.post(`${this.$heap.state.hostname}Shipment/itemDeliverySumEstimate`,request)\r\n            } catch(err){/** */}\r\n        },\r\n        async onStageCreate(order_id, order_stage_code){\r\n            if(order_stage_code=='customer_purged' || order_stage_code=='customer_deleted' ){\r\n                localStorage.removeItem('shipmentDraft');\r\n                this.$router.replace(`/order/order-list`)\r\n                try{\r\n                    const request={\r\n                        order_id:this.order.order_id,\r\n                        new_stage:order_stage_code\r\n                    }\r\n                    await jQuery.post(`${this.$heap.state.hostname}Shipment/itemStageCreate`,request);\r\n                }catch{/** */}\r\n                return\r\n            }\r\n            if(order_stage_code=='customer_action_confirm'){\r\n                order_stage_code='customer_confirmed'\r\n            }\r\n            try{\r\n                const request={\r\n                    is_shopping:0,\r\n                    order_id:this.order.order_id??null,\r\n                    order_description:this.order.order_description,\r\n                    order_start_location_id:this.order.order_start_location_id,\r\n                    order_finish_location_id:this.order.order_finish_location_id,\r\n                    order_sum_delivery:this.order.deliveryCalculation.sum\r\n                }\r\n                const order_id = await jQuery.post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(request))\r\n                if( order_id>0 ){\r\n                    this.$router.push(`/modal/shipment-checkout-${order_id}`)\r\n                }\r\n            } catch(err){\r\n                const exception_code=err?.responseJSON?.messages?.error;\r\n                if(!exception_code){\r\n                    return false;\r\n                }\r\n                switch(exception_code){\r\n                    case 'address_not_set':\r\n                        this.$flash(\"Необходимо добавить адрес доставки\")\r\n                        this.$topic.publish('dismissModal')\r\n                        this.$go('/modal/user-addresses')\r\n                        this.$heap.state.next_route='/order/order-'+order_id;\r\n                        break;\r\n                }\r\n                return false\r\n            }\r\n        },\r\n    },\r\n    mounted(){\r\n        this.itemLoad()\r\n    }\r\n}\r\n</script>","import { render } from \"./ShipmentDraftView.vue?vue&type=template&id=a33496dc\"\nimport script from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\nexport * from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","default","_withCtx","_createVNode","_component_shipment_draft_comp","orderData","$data","order","onStageCreate","$options","onOrderUpdate","itemUpdate","onLocationUpdate","locationUpdate","_","components","ShipmentDraftComp","data","errorCode","methods","itemCreate","date","Date","draft","order_store_id","order_id","entries","created_at","toISOString","replace","stage_next","stage_current","user_role","this","itemSave","itemLoad","storedOrder","JSON","parse","localStorage","shipmentDraft","deliveryCalculation","itemTotalEstimate","order_start_location_id","order_finish_location_id","stringify","orderUpdate","console","log","mode","Object","assign","jQuery","$heap","state","hostname","$flash","start_location_id","finish_location_id","request","err","order_stage_code","_this$order$order_id","is_shopping","order_description","order_sum_delivery","sum","$router","push","_err$responseJSON","_err$responseJSON$mes","exception_code","responseJSON","messages","error","$topic","publish","$go","next_route","removeItem","new_stage","mounted","__exports__","render"],"sourceRoot":""}