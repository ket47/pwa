"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[5337],{5337:function(t,e,o){o.r(e),o.d(e,{default:function(){return L}});var l=o(641),i=o(33);const r={key:0},d={key:0,class:"ion-padding"},u=["src"],a={style:{display:"grid","grid-template-columns":"1fr 1fr"}},n={key:0},c={key:2},s={key:0},p=["href"];function _(t,e,o,_,m,h){var k;const b=(0,l.g2)("ion-progress-bar"),g=(0,l.g2)("ion-card-title"),I=(0,l.g2)("ion-card-header"),f=(0,l.g2)("ion-text"),v=(0,l.g2)("ion-card-content"),F=(0,l.g2)("ion-card"),y=(0,l.g2)("ion-icon"),W=(0,l.g2)("ion-toggle"),V=(0,l.g2)("ion-item"),C=(0,l.g2)("ion-card-subtitle"),O=(0,l.g2)("ion-label"),G=(0,l.g2)("ion-input"),L=(0,l.g2)("ion-button"),X=(0,l.g2)("ion-item-divider"),w=(0,l.g2)("ion-list"),$=(0,l.g2)("ion-textarea"),P=(0,l.g2)("ion-select-option"),U=(0,l.g2)("ion-select"),D=(0,l.g2)("ion-item-group"),Q=(0,l.g2)("image-tile-comp"),A=(0,l.g2)("base-layout");return(0,l.uX)(),(0,l.Wv)(A,{"page-title":(null===(k=m.productItem)||void 0===k?void 0:k.product_name)??"Товар",pageDefaultBackLink:`/catalog/product-${m.productId}`},{default:(0,l.k6)(()=>{var o;return[m.productItem&&!m.is_option_child?((0,l.uX)(),(0,l.CE)("div",r,[(null===(o=m.productItem)||void 0===o?void 0:o.validity)<m.validity_min?((0,l.uX)(),(0,l.Wv)(F,{key:0,color:h.messageCardSeverity},{default:(0,l.k6)(()=>{var t;return[(0,l.bF)(I,null,{default:(0,l.k6)(()=>[(0,l.bF)(g,null,{default:(0,l.k6)(()=>{var t,e;return[(0,l.eW)(" Форма заполнена на "+(0,i.v_)((null===(t=m.productItem)||void 0===t?void 0:t.validity)??0)+"% ",1),(0,l.bF)(b,{value:(null===(e=m.productItem)||void 0===e?void 0:e.validity)/100},null,8,["value"])]}),_:1})]),_:1}),(null===(t=m.productItem)||void 0===t?void 0:t.validity)<m.validity_min?((0,l.uX)(),(0,l.Wv)(v,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(f,null,{default:(0,l.k6)(()=>{var t;return[(0,l.eW)(" Вам необходимо заполнить анкету не меньше чем на "+(0,i.v_)(m.validity_min)+"% для рассмотрения модератором ",1),0==(null===(t=m.productItem)||void 0===t?void 0:t.validity)?((0,l.uX)(),(0,l.CE)("div",d,e[34]||(e[34]=[(0,l.eW)(" Обратите внимание на то, что поля "),(0,l.Lk)("ul",null,[(0,l.Lk)("li",null,"Название (больше 5 букв), "),(0,l.Lk)("li",null,"Цена, "),(0,l.Lk)("li",null,"Актуальный остаток (если ведется учет), "),(0,l.Lk)("li",null,"Изображения товара")],-1),(0,l.eW)(" обязательные ")]))):(0,l.Q3)("",!0)]}),_:1})]),_:1})):(0,l.Q3)("",!0)]}),_:1},8,["color"])):(0,l.Q3)("",!0),(0,l.bF)(F,null,{default:(0,l.k6)(()=>[(0,l.bF)(v,{class:(0,i.C4)(h.messageClass)},{default:(0,l.k6)(()=>[(0,l.bF)(f,{color:"dark"},{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(h.message),1)]),_:1})]),_:1},8,["class"])]),_:1})])):(0,l.Q3)("",!0),m.productItem?((0,l.uX)(),(0,l.Wv)(w,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.eyeOffOutline,color:"primary",slot:"start"},null,8,["src"]),(0,l.bF)(W,{modelValue:m.is_hidden,"onUpdate:modelValue":e[0]||(e[0]=t=>m.is_hidden=t),color:"warning",onIonChange:e[1]||(e[1]=t=>h.save("is_hidden",t.target.checked?1:0))},{default:(0,l.k6)(()=>e[35]||(e[35]=[(0,l.eW)("Скрыт")])),_:1,__:[35]},8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.calculatorOutline,color:"primary",slot:"start"},null,8,["src"]),m.productItem?((0,l.uX)(),(0,l.Wv)(W,{key:0,modelValue:m.is_counted,"onUpdate:modelValue":e[2]||(e[2]=t=>m.is_counted=t),onIonChange:e[3]||(e[3]=t=>h.save("is_counted",t.target.checked?1:0))},{default:(0,l.k6)(()=>e[36]||(e[36]=[(0,l.eW)("Остаток учитывается")])),_:1,__:[36]},8,["modelValue"])):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.trashOutline,color:"primary",slot:"start"},null,8,["src"]),(0,l.bF)(W,{modelValue:m.is_deleted,"onUpdate:modelValue":e[4]||(e[4]=t=>m.is_deleted=t),color:"danger",onIonChange:e[5]||(e[5]=t=>h.itemDelete(t.target.checked?1:0))},{default:(0,l.k6)(()=>e[37]||(e[37]=[(0,l.eW)("Удален")])),_:1,__:[37]},8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.ribbonOutline,color:"primary",slot:"start"},null,8,["src"]),(0,l.bF)(W,{modelValue:m.is_disabled,"onUpdate:modelValue":e[6]||(e[6]=t=>m.is_disabled=t),onIonChange:e[7]||(e[7]=t=>h.itemDisable(t.target.checked?1:0))},{default:(0,l.k6)(()=>e[38]||(e[38]=[(0,l.eW)("На модерации")])),_:1,__:[38]},8,["modelValue"])]),_:1}),m.is_option_child?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(V,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.layersOutline,color:"primary",slot:"start"},null,8,["src"]),m.productItem?((0,l.uX)(),(0,l.Wv)(W,{key:0,modelValue:m.is_option_parent,"onUpdate:modelValue":e[8]||(e[8]=t=>m.is_option_parent=t),onIonChange:e[9]||(e[9]=t=>{h.itemOptionSet(t.target.checked)})},{default:(0,l.k6)(()=>e[39]||(e[39]=[(0,l.eW)("Имеет варианты")])),_:1,__:[39]},8,["modelValue"])):(0,l.Q3)("",!0)]),_:1})),m.optionData?((0,l.uX)(),(0,l.CE)("div",{key:1,onChange:e[14]||(e[14]=(...t)=>h.saveForm&&h.saveForm(...t))},[(0,l.bF)(F,{onClick:e[11]||(e[11]=e=>t.$router.replace(`product-edit-${m.optionData.parent.product_id}?refreshOptions=1`)),color:m.is_option_parent?"primary":"light"},{default:(0,l.k6)(()=>[(0,l.bF)(I,null,{default:(0,l.k6)(()=>[(0,l.bF)(C,null,{default:(0,l.k6)(()=>e[40]||(e[40]=[(0,l.eW)(" Родительский товар ")])),_:1,__:[40]})]),_:1}),(0,l.bF)(v,null,{default:(0,l.k6)(()=>[(0,l.bF)(V,{color:"light",lines:"none"},{default:(0,l.k6)(()=>[(0,l.Lk)("img",{slot:"start",style:{height:"70px","border-radius":"10px",margin:"3px"},src:`${t.$heap.state.hostname}image/get.php/${m.optionData.parent.image_hash}.70.70.webp`},null,8,u),(0,l.bF)(O,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(m.optionData.parent.product_name),1)]),_:1})]),_:1}),m.productId==m.optionData.parent.product_id?((0,l.uX)(),(0,l.Wv)(V,{key:0,color:"light"},{default:(0,l.k6)(()=>[(0,l.bF)(G,{label:"Вариант*","label-placement":"stacked",placeholder:"напишите вариант",name:"product_option",modelValue:m.productItem.product_option,"onUpdate:modelValue":e[10]||(e[10]=t=>m.productItem.product_option=t)},null,8,["modelValue"])]),_:1})):((0,l.uX)(),(0,l.Wv)(V,{key:1,lines:"none",color:"light"},{default:(0,l.k6)(()=>[(0,l.bF)(f,null,{default:(0,l.k6)(()=>[(0,l.eW)("["+(0,i.v_)(m.optionData.parent.product_option)+"]",1)]),_:1})]),_:1}))]),_:1})]),_:1},8,["color"]),(0,l.Lk)("div",a,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(m.optionData.children,o=>((0,l.uX)(),(0,l.Wv)(F,{onClick:e=>t.$router.replace(`product-edit-${o.product_id}?refreshOptions=1`),key:o.product_id,color:m.productItem.product_id==o.product_id?"primary":""},{default:(0,l.k6)(()=>[(0,l.bF)(v,null,{default:(0,l.k6)(()=>[m.productItem.product_id==o.product_id?((0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(V,{color:m.productItem.deleted_at?"danger":"light"},{default:(0,l.k6)(()=>[(0,l.bF)(G,{label:"Вариант*","label-placement":"stacked",placeholder:"напишите вариант",name:"product_option",modelValue:m.productItem.product_option,"onUpdate:modelValue":e[12]||(e[12]=t=>m.productItem.product_option=t)},null,8,["modelValue"])]),_:1},8,["color"]),m.productItem.image_hash?((0,l.uX)(),(0,l.Wv)(V,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.cameraOutline},null,8,["src"])]),_:1})):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.Wv)(V,{key:1,lines:"none"},{default:(0,l.k6)(()=>[(0,l.bF)(f,{color:o.deleted_at?"danger":"medium"},{default:(0,l.k6)(()=>[(0,l.eW)("["+(0,i.v_)(o.product_option)+"]",1)]),_:2},1032,["color"])]),_:2},1024))]),_:2},1024)]),_:2},1032,["onClick","color"]))),128)),(0,l.bF)(F,null,{default:(0,l.k6)(()=>[(0,l.bF)(v,null,{default:(0,l.k6)(()=>[(0,l.bF)(L,{color:"light",expand:"block",onClick:e[13]||(e[13]=t=>h.itemOptionCreate())},{default:(0,l.k6)(()=>e[41]||(e[41]=[(0,l.eW)("+ вариант")])),_:1,__:[41]})]),_:1})]),_:1})])],32)):(0,l.Q3)("",!0),m.is_option_child?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(X),(0,l.bF)(V,{button:"",onClick:e[15]||(e[15]=e=>t.$go("/catalog/product-"+m.productItem.product_id)),detail:"false"},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.chevronBack,slot:"start"},null,8,["src"]),e[42]||(e[42]=(0,l.eW)(" Показать товар "))]),_:1,__:[42]}),(0,l.bF)(V,{button:"",onClick:e[16]||(e[16]=t=>h.showProductInStore()),detail:"false"},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.chevronBack,slot:"start"},null,8,["src"]),e[43]||(e[43]=(0,l.eW)(" Показать в магазине "))]),_:1,__:[43]}),(0,l.bF)(V,{button:"",onClick:e[17]||(e[17]=e=>t.$go("/catalog/store-edit-"+m.productItem.store_id)),detail:"false"},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.chevronBack,slot:"start"},null,8,["src"]),e[44]||(e[44]=(0,l.eW)(" Управление магазином "))]),_:1,__:[44]})]))]),_:1})):(0,l.Q3)("",!0),m.productItem?((0,l.uX)(),(0,l.CE)("form",{key:2,onChange:e[31]||(e[31]=(...t)=>h.saveForm&&h.saveForm(...t))},[(0,l.bF)(w,{lines:"full"},{default:(0,l.k6)(()=>[(0,l.bF)(D,null,{default:(0,l.k6)(()=>[(0,l.bF)(X,null,{default:(0,l.k6)(()=>[(0,l.bF)(O,null,{default:(0,l.k6)(()=>e[45]||(e[45]=[(0,l.eW)("Основные настройки")])),_:1,__:[45]})]),_:1}),m.is_option_child?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(V,{key:0},{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_name,"onUpdate:modelValue":e[18]||(e[18]=t=>m.productItem.product_name=t),label:"Название*",labelPlacement:"stacked",name:"product_name",placeholder:"полное название товара",clearInput:"true"},null,8,["modelValue"])]),_:1})),m.is_option_child?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(V,{key:1},{default:(0,l.k6)(()=>[(0,l.bF)($,{modelValue:m.productItem.product_description,"onUpdate:modelValue":e[19]||(e[19]=t=>m.productItem.product_description=t),label:"Описание*",labelPlacement:"stacked",name:"product_description",rows:"6",placeholder:"характеристики, свойства, состав товара"},null,8,["modelValue"])]),_:1})),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_code,"onUpdate:modelValue":e[20]||(e[20]=t=>m.productItem.product_code=t),label:"Артикул",labelPlacement:"stacked",name:"product_code",placeholder:"код товара"},null,8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_barcode,"onUpdate:modelValue":e[21]||(e[21]=t=>m.productItem.product_barcode=t),label:"Штрихкод",labelPlacement:"stacked",name:"product_barcode",placeholder:"штрихкод"},null,8,["modelValue"])]),_:1}),m.is_counted?((0,l.uX)(),(0,l.Wv)(V,{key:2},{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_quantity,"onUpdate:modelValue":e[22]||(e[22]=t=>m.productItem.product_quantity=t),label:`Остаток ${m.productItem.product_unit}`,labelPlacement:"stacked",name:"product_quantity",placeholder:"в наличии"},null,8,["modelValue","label"])]),_:1})):(0,l.Q3)("",!0),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_quantity_min,"onUpdate:modelValue":e[23]||(e[23]=t=>m.productItem.product_quantity_min=t),label:`Мин. заказ* ${m.productItem.product_unit}`,labelPlacement:"stacked",name:"product_quantity_min",type:"number",inputmode:"numeric",pattern:"\\d\\."},null,8,["modelValue","label"])]),_:1}),m.is_option_child?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(V,{key:3},{default:(0,l.k6)(()=>[(0,l.bF)(U,{modelValue:m.productItem.product_unit,"onUpdate:modelValue":e[24]||(e[24]=t=>m.productItem.product_unit=t),label:"Единица*",labelPlacement:"stacked",name:"product_unit",onIonChange:h.saveForm},{default:(0,l.k6)(()=>[(0,l.bF)(P,{value:"шт"},{default:(0,l.k6)(()=>e[46]||(e[46]=[(0,l.eW)("штука")])),_:1,__:[46]}),(0,l.bF)(P,{value:"порция"},{default:(0,l.k6)(()=>e[47]||(e[47]=[(0,l.eW)("порция вес")])),_:1,__:[47]}),(0,l.bF)(P,{value:"порция мл"},{default:(0,l.k6)(()=>e[48]||(e[48]=[(0,l.eW)("порция объем")])),_:1,__:[48]}),(0,l.bF)(P,{value:"кг"},{default:(0,l.k6)(()=>e[49]||(e[49]=[(0,l.eW)("килограмм")])),_:1,__:[49]}),(0,l.bF)(P,{value:"м"},{default:(0,l.k6)(()=>e[50]||(e[50]=[(0,l.eW)("метр")])),_:1,__:[50]}),(0,l.bF)(P,{value:"л"},{default:(0,l.k6)(()=>e[51]||(e[51]=[(0,l.eW)("литр")])),_:1,__:[51]})]),_:1},8,["modelValue","onIonChange"])]),_:1})),"кг"!=m.productItem.product_unit?((0,l.uX)(),(0,l.Wv)(V,{key:4},{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_weight,"onUpdate:modelValue":e[25]||(e[25]=t=>m.productItem.product_weight=t),label:"порция мл"==m.productItem.product_unit?"Объем мл*":`Вес 1${m.productItem.product_unit} в г*`,labelPlacement:"stacked",name:"product_weight",type:"number",step:"1",inputmode:"numeric",pattern:"\\d"},null,8,["modelValue","label"])]),_:1})):(0,l.Q3)("",!0)]),_:1})]),_:1}),(0,l.bF)(w,{lines:"full"},{default:(0,l.k6)(()=>[(0,l.bF)(D,null,{default:(0,l.k6)(()=>[(0,l.bF)(X,null,{default:(0,l.k6)(()=>[(0,l.bF)(O,null,{default:(0,l.k6)(()=>e[52]||(e[52]=[(0,l.eW)("Цена")])),_:1,__:[52]})]),_:1})]),_:1}),m.is_option_same_price?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",s,[(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_price,"onUpdate:modelValue":e[26]||(e[26]=t=>m.productItem.product_price=t),label:"Цена*",labelPlacement:"stacked",name:"product_price",type:"number",inputmode:"numeric"},null,8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_net_price,"onUpdate:modelValue":e[27]||(e[27]=t=>m.productItem.product_net_price=t),label:"Цена в меню/на полке",labelPlacement:"stacked",name:"product_net_price",type:"number",inputmode:"numeric"},null,8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{modelValue:m.productItem.product_promo_price,"onUpdate:modelValue":e[28]||(e[28]=t=>m.productItem.product_promo_price=t),label:"Цена акционная",labelPlacement:"stacked",name:"product_promo_price",type:"number",inputmode:"numeric",color:"success"},null,8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{type:"date",modelValue:m.productItem.product_promo_start,"onUpdate:modelValue":e[29]||(e[29]=t=>m.productItem.product_promo_start=t),label:"Начало акции",labelPlacement:"stacked",name:"product_promo_start"},null,8,["modelValue"])]),_:1}),(0,l.bF)(V,null,{default:(0,l.k6)(()=>[(0,l.bF)(G,{type:"date",modelValue:m.productItem.product_promo_finish,"onUpdate:modelValue":e[30]||(e[30]=t=>m.productItem.product_promo_finish=t),label:"Конец акции",labelPlacement:"stacked",name:"product_promo_finish"},null,8,["modelValue"])]),_:1})]))]),_:1})],32)):(0,l.Q3)("",!0),m.productItem&&!m.is_option_child?((0,l.uX)(),(0,l.Wv)(w,{key:3},{default:(0,l.k6)(()=>[(0,l.bF)(X,null,{default:(0,l.k6)(()=>[(0,l.bF)(O,null,{default:(0,l.k6)(()=>e[53]||(e[53]=[(0,l.eW)("Изображения товара*")])),_:1,__:[53]})]),_:1}),(0,l.bF)(Q,{images:m.productItem.images,image_holder_id:m.productItem.product_id,title:"Витрина товара 5 фото",controller:"Product",ref:"productImgs"},null,8,["images","image_holder_id"]),(0,l.bF)(L,{onClick:e[32]||(e[32]=e=>t.$refs.productImgs.take_photo()),color:"light",expand:"block"},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.cameraOutline,slot:"start"},null,8,["src"]),e[54]||(e[54]=(0,l.eW)(" Добавить фото на витрину "))]),_:1,__:[54]})]),_:1})):(0,l.Q3)("",!0),m.productItem&&h.categoryList&&!m.is_option_child?((0,l.uX)(),(0,l.Wv)(w,{key:4},{default:(0,l.k6)(()=>[(0,l.bF)(X,null,{default:(0,l.k6)(()=>[(0,l.bF)(O,null,{default:(0,l.k6)(()=>e[55]||(e[55]=[(0,l.eW)("Категории товара*")])),_:1,__:[55]})]),_:1}),0==h.categoryList.length?((0,l.uX)(),(0,l.Wv)(V,{key:0,color:"light"},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.compassOutline,slot:"start",color:"danger"},null,8,["src"]),(0,l.bF)(O,{color:"danger"},{default:(0,l.k6)(()=>e[56]||(e[56]=[(0,l.eW)("Без категории (в разделе 'Другое')")])),_:1,__:[56]})]),_:1})):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(h.categoryList,t=>((0,l.uX)(),(0,l.Wv)(V,{key:t.group_id},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.compassOutline,slot:"start",color:"primary"},null,8,["src"]),(0,l.bF)(O,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(t.group_name),1)]),_:2},1024),(0,l.bF)(y,{src:_.trashOutline,slot:"end",onClick:e=>h.categoryDelete(t.group_id,t.group_name)},null,8,["src","onClick"])]),_:2},1024))),128)),(0,l.bF)(V,{button:"",onClick:e[33]||(e[33]=t=>h.categoryAdd())},{default:(0,l.k6)(()=>[(0,l.bF)(y,{src:_.addOutline,slot:"start",color:"primary"},null,8,["src"]),(0,l.bF)(O,null,{default:(0,l.k6)(()=>e[57]||(e[57]=[(0,l.eW)("Добавить в категорию")])),_:1,__:[57]})]),_:1})]),_:1})):(0,l.Q3)("",!0),m.productItem&&m.productItem.updated_user?((0,l.uX)(),(0,l.Wv)(w,{key:5},{default:(0,l.k6)(()=>[(0,l.bF)(X,null,{default:(0,l.k6)(()=>[(0,l.bF)(O)]),_:1}),(0,l.bF)(V,{lines:"none"},{default:(0,l.k6)(()=>[(0,l.eW)(" Изменен "+(0,i.v_)(m.productItem.updated_at)+" ",1),(0,l.Lk)("a",{slot:"end",href:`tel:+${m.productItem.updated_user.user_phone}`},(0,i.v_)(m.productItem.updated_user.user_name),9,p)]),_:1})]),_:1})):(0,l.Q3)("",!0)]}),_:1},8,["page-title","pageDefaultBackLink"])}o(4114);var m=o(5634),h=o(5480),k=o(4933);const b={class:"ion-padding",slot:"content"};function g(t,e,o,r,d,u){const a=(0,l.g2)("ion-title"),n=(0,l.g2)("ion-icon"),c=(0,l.g2)("ion-toolbar"),s=(0,l.g2)("ion-header"),p=(0,l.g2)("ion-searchbar"),_=(0,l.g2)("ion-img"),m=(0,l.g2)("ion-avatar"),h=(0,l.g2)("ion-label"),k=(0,l.g2)("ion-item"),g=(0,l.g2)("ion-checkbox"),I=(0,l.g2)("ion-list"),f=(0,l.g2)("ion-accordion"),v=(0,l.g2)("ion-accordion-group"),F=(0,l.g2)("ion-skeleton-text"),y=(0,l.g2)("ion-content");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(s,null,{default:(0,l.k6)(()=>[(0,l.bF)(c,{color:"secondary"},{default:(0,l.k6)(()=>[(0,l.bF)(a,null,{default:(0,l.k6)(()=>e[2]||(e[2]=[(0,l.eW)("Категории")])),_:1,__:[2]}),(0,l.bF)(n,{slot:"end",onClick:e[0]||(e[0]=t=>{u.closeModal()}),icon:r.closeOutline,size:"large",color:"medium"},null,8,["icon"])]),_:1})]),_:1}),(0,l.bF)(y,null,{default:(0,l.k6)(()=>[(0,l.bF)(p,{placeholder:"Фильтр по категориям",modelValue:d.searchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>d.searchQuery=t)},null,8,["modelValue"]),u.groupListFiltered.length>0?((0,l.uX)(),(0,l.Wv)(v,{key:0},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.groupListTree,e=>((0,l.uX)(),(0,l.Wv)(f,{key:e.group_id},{default:(0,l.k6)(()=>[(0,l.bF)(k,{slot:"header"},{default:(0,l.k6)(()=>[e.image_hash?((0,l.uX)(),(0,l.Wv)(m,{key:0,slot:"start"},{default:(0,l.k6)(()=>[(0,l.bF)(_,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".50.50.webp"},null,8,["src"])]),_:2},1024)):(0,l.Q3)("",!0),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.group_name),1)]),_:2},1024)]),_:2},1024),(0,l.Lk)("div",b,[(0,l.bF)(I,null,{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.children,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.group_id},[(0,l.bF)(k,null,{default:(0,l.k6)(()=>[e.image_hash?((0,l.uX)(),(0,l.Wv)(m,{key:0,slot:"start"},{default:(0,l.k6)(()=>[(0,l.bF)(_,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".50.50.webp"},null,8,["src"])]),_:2},1024)):(0,l.Q3)("",!0),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.eW)((0,i.v_)(e.group_name),1)]),_:2},1024),(0,l.bF)(g,{slot:"end",checked:e.is_marked,onClick:t=>u.mimickChage(t.target,e.group_id)},null,8,["checked","onClick"])]),_:2},1024)]))),128))]),_:2},1024)])]),_:2},1024))),128))]),_:1})):((0,l.uX)(),(0,l.Wv)(I,{key:1},{default:(0,l.k6)(()=>[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)([1,2,3,4],t=>(0,l.bF)(k,{key:t},{default:(0,l.k6)(()=>[(0,l.bF)(F,{style:{width:"100%"}})]),_:2},1024)),64))]),_:1}))]),_:1})],64)}o(8111),o(2489),o(116);var I=o(2311),f=o.n(I),v={props:["controller","memberId","memberOfIds","memberLimit"],components:{IonCheckbox:m.eY,IonContent:m.W9,IonHeader:m.eU,IonToolbar:m.ai,IonTitle:m.BC,IonIcon:m.iq,IonImg:m.KW,IonAvatar:m.mC,IonLabel:m.he,IonList:m.nf,IonItem:m.uz,IonAccordion:m.xk,IonAccordionGroup:m.YH,IonSearchbar:m.S1,IonSkeletonText:m.ds},setup(){return{closeOutline:h.xfX}},data(){return{searchQuery:"",groupList:null,checkedGroupList:[]}},created(){this.listGroupGet(),this.checkedGroupList=this.memberOfIds||[]},computed:{groupListFiltered(){if(!this.searchQuery)return this.groupList??[];const t=new RegExp(this.searchQuery.replace(/^[\w\d\s]/,"").replace(/\s/g,".*"),"im");return this.groupList.filter(e=>{var o;return null===(o=e.group_path)||void 0===o?void 0:o.match(t)})??[]},groupListTree(){let t=[];for(let e of this.groupListFiltered){let o=t.findIndex(t=>e.group_parent_id==t.group_id);if(o<0){let l=this.groupList.find(t=>t.group_id==e.group_parent_id);if(!l)continue;l.children=[],o=t.push(l)-1}t[o].children.push(e)}return t},parentGroupList(){var t;return null===(t=this.groupListFiltered)||void 0===t?void 0:t.filter(t=>0==t.group_parent_id)},childGroupList(){let t={};for(let e of this.parentGroupList)t[e.group_id]=this.groupListFiltered.filter(t=>t.group_parent_id==e.group_id);return t}},methods:{async listGroupGet(){this.groupList=await f().get(this.$heap.state.hostname+this.controller+"/listGroupGet"),this.itemMarkGroups()},itemMarkGroups(){if(this.groupList)try{for(let t of this.groupList)t.is_marked=this.checkedGroupList.includes(t.group_id)?1:0}catch{}},async itemUpdateGroup(t,e){const o={[this.controller.toLowerCase()+"_id"]:this.memberId,is_joined:t,group_id:e};try{await f().post(this.$heap.state.hostname+this.controller+"/itemUpdateGroup",o)}catch(l){this.$flash("Не удалось сохранить изменение")}},mimickChage(t,e){const o=this;setTimeout(()=>{o.groupChanged(t,e)},0)},async groupChanged(t,e){const o=t.checked?1:0;if(o){if(this.checkedGroupList.length>=this.memberLimit)return this.$flash(`Можно выбрать не больше ${this.memberLimit} категорий`),void(t.checked=0);1==this.memberLimit&&this.closeModal(),this.checkedGroupList.push(e)}else this.checkedGroupList=this.checkedGroupList.filter(function(t,o,l){return t!=e});this.itemUpdateGroup(o,e)},closeModal(){m.OZ.dismiss(this.checkedGroupList)}}},F=o(6262);const y=(0,F.A)(v,[["render",g]]);var W=y,V=o(5538),C=o(6859),O={components:{IonInput:m.$w,IonTextarea:m.nc,IonCard:m.b_,IonCardContent:m.I9,IonCardHeader:m.ME,IonToggle:m.BY,IonIcon:m.iq,IonItem:m.uz,IonList:m.nf,IonLabel:m.he,IonItemDivider:m.Dg,IonItemGroup:m.jh,IonButton:m.Jm,IonProgressBar:m.FH,IonText:m.IO,IonSelect:m.Nm,IonSelectOption:m.Ip,IonCardTitle:m.tN,IonCardSubtitle:m.HW,imageTileComp:k.A},setup(){return{cameraOutline:h.GOB,trashOutline:h.P1A,banOutline:h.Av6,personOutline:h.wAZ,addOutline:h.EKF,calculatorOutline:h.N0h,compassOutline:h.Hy9,chevronBack:h.fcl,layersOutline:h.z8i,ribbonOutline:h.rp8,eyeOffOutline:h.f_X}},data(){return{productId:this.$route.params.id,productItem:null,productGroupList:null,validity:0,validity_min:70,optionData:null,refreshOptions:this.$route.query.refreshOptions,is_option_parent:!1,is_option_child:!1,is_option_menu_open:!1,is_option_same_price:!1,is_groups_marked:0,is_deleted:0,is_disabled:0,is_counted:0,is_hidden:0}},computed:{messageCardSeverity(){var t,e;return(null===(t=this.productItem)||void 0===t?void 0:t.validity)<60?"danger":(null===(e=this.productItem)||void 0===e?void 0:e.validity)<this.validity_min?"warning":"primary"},message(){return this.productItem?this.productItem.deleted_at?"Товар не активен и будет удален. Вы еще можете отменить удаление":1==this.productItem.is_disabled?"Товар не активен и находится на рассмотрении у администратора":1==this.productItem.is_hidden?"Товар скрыт из магазина. Не продается":1!=this.productItem.is_counted?"Товар активен и готов к продаже. Остаток товара неограничен":"Товар активен и готов к продаже. Остаток "+(this.productItem.product_quantity||0)+this.productItem.product_unit:""},messageClass(){var t,e,o;return this.productItem?null!==(t=this.productItem)&&void 0!==t&&t.deleted_at?"pdeleted":1==(null===(e=this.productItem)||void 0===e?void 0:e.is_disabled)?"pdisabled":1==(null===(o=this.productItem)||void 0===o?void 0:o.is_hidden)?"phidden":"pactive":""},categoryList(){let t=[];try{let e=this.productItem.member_of_groups.group_ids.split(","),o=this.productItem.member_of_groups.group_names.split(",");for(let l in e)t.push({group_id:e[l],group_name:o[l]})}catch{}return t}},created(){this.listGroupGet(),this.itemGet()},ionViewDidEnter(){var t;this.refreshOptions&&null!==(t=this.productItem)&&void 0!==t&&t.product_parent_id&&this.itemOptionGet()},methods:{async itemGet(){try{let t=await f().post(V.A.state.hostname+"Product/itemGet",{product_id:this.productId});this.productItem=this.itemPrepare(t),this.itemParseFlags(),this.is_option_child=this.productItem.product_parent_id&&this.productItem.product_parent_id!=this.productItem.product_id,this.is_option_parent=this.productItem.product_parent_id&&this.productItem.product_parent_id==this.productItem.product_id,this.productItem.product_weight>0&&(this.productItem.product_weight=1e3*this.productItem.product_weight),await this.itemOptionGet()}catch(t){}},itemPrepare(t){return t.product_promo_start&&(t.product_promo_start=t.product_promo_start.split(" ")[0]),t.product_promo_finish&&(t.product_promo_finish=t.product_promo_finish.split(" ")[0]),t},itemParseFlags(){this.is_deleted=null==this.productItem.deleted_at?0:1,this.is_disabled=0==this.productItem.is_disabled?0:1,this.is_counted=0==this.productItem.is_counted?0:1,this.is_hidden=0==this.productItem.is_hidden?0:1},async itemDelete(t){const e=t?"itemDelete":"itemUnDelete";try{await f().post(V.A.state.hostname+"Product/"+e,{product_id:this.productId}),this.productItem.deleted_at=t?1:null,(this.is_option_child||this.is_option_parent)&&this.itemOptionGet()}catch{this.itemGet()}},async itemDisable(t){if(this.productItem.is_disabled!=t)try{await f().post(V.A.state.hostname+"Product/itemDisable",{product_id:this.productId,is_disabled:t}),this.productItem.is_disabled=t}catch{this.$flash("Изменение не сохранено"),this.itemGet()}},async itemUpdate(t){try{return await f().post(V.A.state.hostname+"Product/itemUpdate",JSON.stringify(t)),this.$flash("💾 сохранено"),!0}catch(e){const t=e.responseJSON.messages.error;return null!==t&&void 0!==t&&t.includes("product_description")?this.$flash("Описание слишком короткое"):null!==t&&void 0!==t&&t.includes("product_name")?this.$flash("Название слишком короткое"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},async itemOptionGet(){this.productItem.product_parent_id||(this.optionData=null);const t={product_parent_id:this.productItem.product_parent_id};let e=await f().post(`${this.$heap.state.hostname}Product/itemOptionGet`,t);this.optionData={parent:e[0],children:e.slice(1)}},async itemOptionCreate(){var t,e;const o=(null===(t=this.optionData)||void 0===t||null===(e=t.children)||void 0===e?void 0:e.length)??0,l={is_disabled:1,store_id:this.productItem.store_id,product_parent_id:this.productItem.product_parent_id,product_name:"OPTION",product_price:0,product_option:`Вариант#${o}`};try{await f().post(`${this.$heap.state.hostname}Product/itemCreate`,l),this.itemOptionGet()}catch(i){}},async itemOptionSet(t){t?await this.itemOptionSave(this.productId,this.productId):await this.itemOptionDelete(this.productId),this.itemGet()},async itemOptionUpdate(t){},async itemOptionSave(t,e){try{await f().post(`${this.$heap.state.hostname}Product/itemOptionSave`,{product_id:t,product_parent_id:e})}catch{}},async itemOptionDelete(t){if(confirm("Удалить разновидности товара?"))try{await f().post(`${this.$heap.state.hostname}Product/itemOptionDelete`,{product_id:t}),this.itemOptionGet()}catch{}},checkPromoPrice(t){const e=parseFloat(this.productItem.product_promo_price),o=parseFloat(this.productItem.product_price);if(o>0&&e>0&&o<=e){"product_promo_price"==t&&(this.productItem.product_price=e+1),"product_price"==t&&(this.productItem.product_promo_price=o-1);const l={product_id:this.productId,product_promo_price:this.productItem.product_promo_price,product_price:this.productItem.product_price};return this.itemUpdate(l),this.$flash("Акционная цена должна быть ниже основной. Внимание цена изменена!"),!1}return!0},saveForm(t){const e=t.target.name,o=this.productItem[e]=t.target.value;this.checkPromoPrice(e)&&this.save(e,o)},async save(t,e){if(!this.productItem.product_id)return;let o={product_id:this.productItem.product_id,[t]:e};"product_weight"==t&&e>0&&(o.product_weight=e/1e3),this.itemUpdate(o)&&(this.productItem[t]=e,this.itemParseFlags())},categoryDelete(t,e){if(confirm("Исключить товар из категории "+e+"?"))try{this.itemUpdateGroup(0,t)}catch{}},async categoryAdd(){var t,e,o;const l=(null===(t=this.productItem)||void 0===t||null===(e=t.member_of_groups)||void 0===e||null===(o=e.group_ids)||void 0===o?void 0:o.split(","))||[],i=await m.OZ.create({component:W,componentProps:{controller:"Product",memberId:this.productId,memberOfIds:l,memberLimit:1},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});i.present(),C.A.on("dismissModal",()=>{i.dismiss()}),await i.onDidDismiss(),this.itemGet()},async itemUpdateGroup(t,e){const o={product_id:this.productId,is_joined:t,group_id:e};try{await f().post(V.A.state.hostname+"Product/itemUpdateGroup",o)}catch(l){this.$flash("Не удалось сохранить изменение")}this.itemGet()},async listGroupGet(){try{this.productGroupList=await f().get(V.A.state.hostname+"Product/listGroupGet"),this.itemMarkGroups()}catch{}},showProductInStore(){let t=0;try{t=this.productItem.member_of_groups.group_ids.split(",")[0]}catch{}this.$go({path:"store-"+this.productItem.store_id,query:{sub_group_id:t}})}}};const G=(0,F.A)(O,[["render",_],["__scopeId","data-v-3484be86"]]);var L=G}}]);
//# sourceMappingURL=5337.71160b05.js.map