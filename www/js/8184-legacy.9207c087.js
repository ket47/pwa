"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[8184],{1249:function(e,t,n){var r=n(2109),a=n(2092).map,o=n(1194),i=o("map");r({target:"Array",proto:!0,forced:!i},{map:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},4405:function(e,t,n){n(4916),n(5306);var r=n(2008),a={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;var t=e.locations[0].distance,n=e.store_time_preparation||0;return a.deliveryTimeCalculate(t,n)},deliveryTimeCalculate(e,t){var n;t=parseInt(null!==(n=t)&&void 0!==n?n:r.Z.getters.settings.delivery.timePreparationDefault);var a=parseInt(r.Z.getters.settings.delivery.timeDelta),o=parseInt(r.Z.getters.settings.delivery.speed),i=5*Math.round(e/o*60/5)+t,s=i>a?i-a:i,u=s+a;return{time:i,timeMin:s,timeMax:u}},render(e,t){for(var n in t)e=e.replace(`{{${n}}}`,t[n]);return e}};t["Z"]=a},8184:function(e,t,n){n.r(t),n.d(t,{default:function(){return D}});var r=n(6252),a=n(3577),o=(0,r.Uk)("Дата"),i=(0,r.Uk)("Тип проводки"),s=(0,r.Uk)("Заказ #"),u=(0,r.Uk)("Продавец #"),l=(0,r.Uk)("Курьер #"),c=(0,r.Uk)("Сумма"),d=(0,r.Uk)("Комментарий"),p=(0,r.Uk)("Отключена"),m=(0,r.Uk)("Удалить"),_=(0,r.Uk)("Сохранить");function f(e,t,n,f,h,w){var k=(0,r.up)("ion-label"),v=(0,r.up)("ion-input"),y=(0,r.up)("ion-item"),b=(0,r.up)("ion-select-option"),g=(0,r.up)("ion-select"),$=(0,r.up)("ion-icon"),I=(0,r.up)("ion-button"),x=(0,r.up)("ion-textarea"),W=(0,r.up)("ion-toggle"),Z=(0,r.up)("ion-note"),U=(0,r.up)("ion-list"),q=(0,r.up)("ion-col"),G=(0,r.up)("ion-row"),T=(0,r.up)("ion-grid"),V=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(V,{pageDefaultBackLink:"/user","page-title":"Редактирование проводки"},{default:(0,r.w5)((function(){return[h.transaction?((0,r.wg)(),(0,r.j4)(U,{key:0},{default:(0,r.w5)((function(){return[(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(k,{position:"floating"},{default:(0,r.w5)((function(){return[o]})),_:1}),(0,r.Wm)(v,{modelValue:h.transaction.trans_date,"onUpdate:modelValue":t[0]||(t[0]=function(e){return h.transaction.trans_date=e}),placeholder:"дата",type:"date"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(y,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r.Wm)(k,{position:"floating"},{default:(0,r.w5)((function(){return[i]})),_:1}),(0,r.Wm)(g,{interface:"popover",placeholder:"Выберите тип проводки",modelValue:h.transaction.trans_role,"onUpdate:modelValue":t[1]||(t[1]=function(e){return h.transaction.trans_role=e}),required:"",onIonChange:t[2]||(t[2]=function(e){return w.itemUpdateRole()})},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(h.transTypes,(function(e){return(0,r.wg)(),(0,r.j4)(b,{key:e.trans_role,value:e.trans_role},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(e.trans_name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(g,{slot:"start",modelValue:h.transaction.trans_holder,"onUpdate:modelValue":t[3]||(t[3]=function(e){return h.transaction.trans_holder=e}),disabled:"",placeholder:"Тип объекта"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{value:"order"},{default:(0,r.w5)((function(){return[s]})),_:1}),(0,r.Wm)(b,{value:"store"},{default:(0,r.w5)((function(){return[u]})),_:1}),(0,r.Wm)(b,{value:"courier"},{default:(0,r.w5)((function(){return[l]})),_:1})]})),_:1},8,["modelValue"]),(0,r.Wm)(k,{onClick:t[4]||(t[4]=function(e){return w.holderIdPick()})},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(h.transaction.trans_holder_label),1)]})),_:1}),(0,r.Wm)(I,{slot:"end",onClick:t[5]||(t[5]=function(e){return w.holderIdPick()})},{default:(0,r.w5)((function(){return[(0,r.Wm)($,{icon:f.searchOutline},null,8,["icon"])]})),_:1})]})),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(k,{position:"floating"},{default:(0,r.w5)((function(){return[c]})),_:1}),(0,r.Wm)(v,{modelValue:h.transaction.trans_amount,"onUpdate:modelValue":t[6]||(t[6]=function(e){return h.transaction.trans_amount=e}),placeholder:"сумма",inputmode:"decimal",autocomplete:"transaction-amount",min:"1"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(k,{position:"floating"},{default:(0,r.w5)((function(){return[d]})),_:1}),(0,r.Wm)(x,{modelValue:h.transaction.trans_description,"onUpdate:modelValue":t[7]||(t[7]=function(e){return h.transaction.trans_description=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(y,{lines:"full"},{default:(0,r.w5)((function(){return[(0,r.Wm)(k,null,{default:(0,r.w5)((function(){return[p]})),_:1}),(0,r.Wm)(W,{modelValue:h.transaction.is_disabled,"onUpdate:modelValue":t[8]||(t[8]=function(e){return h.transaction.is_disabled=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(y,{lines:"none"},{default:(0,r.w5)((function(){return[h.transaction.created_at?((0,r.wg)(),(0,r.j4)(Z,{key:0},{default:(0,r.w5)((function(){return[(0,r.Uk)(" Создано "+(0,a.zw)(h.transaction.created_user_name)+" "+(0,a.zw)(h.transaction.created_at),1)]})),_:1})):(0,r.kq)("",!0),h.transaction.created_at?((0,r.wg)(),(0,r.j4)(Z,{key:1},{default:(0,r.w5)((function(){return[(0,r.Uk)(" Изменено "+(0,a.zw)(h.transaction.updated_user_name)+" "+(0,a.zw)(h.transaction.updated_at),1)]})),_:1})):(0,r.kq)("",!0)]})),_:1})]})),_:1})):(0,r.kq)("",!0),h.transaction?((0,r.wg)(),(0,r.j4)(T,{key:1},{default:(0,r.w5)((function(){return[(0,r.Wm)(G,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{color:"medium",onClick:t[9]||(t[9]=function(e){return w.itemDelete()}),expand:"block"},{default:(0,r.w5)((function(){return[m]})),_:1})]})),_:1}),(0,r.Wm)(q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{color:"primary",onClick:t[10]||(t[10]=function(e){return w.itemSave()}),expand:"block"},{default:(0,r.w5)((function(){return[_]})),_:1})]})),_:1})]})),_:1})]})),_:1})):(0,r.kq)("",!0)]})),_:1})}var h=n(6835),w=n(8534),k=(n(4916),n(5306),n(8862),n(1539),n(2066)),v=n(8903),y=n(9755),b=n.n(y),g=n(351),$=n(4405),I={class:"ion-page"},x=(0,r.Uk)(" Ничего не найдено ");function W(e,t,n,o,i,s){var u=(0,r.up)("ion-title"),l=(0,r.up)("ion-icon"),c=(0,r.up)("ion-toolbar"),d=(0,r.up)("ion-header"),p=(0,r.up)("ion-searchbar"),m=(0,r.up)("ion-skeleton-text"),_=(0,r.up)("ion-item"),f=(0,r.up)("ion-list"),h=(0,r.up)("ion-img"),w=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)("div",I,[(0,r.Wm)(d,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(c,{color:"secondary"},{default:(0,r.w5)((function(){return[(0,r.Wm)(u,null,{default:(0,r.w5)((function(){return[(0,r.Uk)("Выбрать "+(0,a.zw)(i.itemTypeName),1)]})),_:1}),(0,r.Wm)(l,{icon:o.closeOutline,onClick:t[0]||(t[0]=function(e){s.closeModal()}),slot:"end",size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,r.Wm)(w,null,{default:(0,r.w5)((function(){var n;return[(0,r.Wm)(p,{modelValue:i.query,"onUpdate:modelValue":t[1]||(t[1]=function(e){return i.query=e}),debounce:100,onIonChange:t[2]||(t[2]=function(e){return s.listGet()})},null,8,["modelValue"]),i.itemList?null!==(n=i.itemList)&&void 0!==n&&n.length?((0,r.wg)(),(0,r.j4)(f,{key:1},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(i.itemList,(function(t){return(0,r.wg)(),(0,r.j4)(_,{key:t.id,button:"",detail:"",onClick:function(e){return s.itemPick(t)}},{default:(0,r.w5)((function(){return[t.image_hash?((0,r.wg)(),(0,r.j4)(h,{key:0,slot:"start",src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.50.50.webp`},null,8,["src"])):(0,r.kq)("",!0),(0,r.Uk)(" "+(0,a.zw)(t.name),1)]})),_:2},1032,["onClick"])})),128))]})),_:1})):((0,r.wg)(),(0,r.j4)(f,{key:2},{default:(0,r.w5)((function(){return[(0,r.Wm)(_,null,{default:(0,r.w5)((function(){return[x]})),_:1})]})),_:1})):((0,r.wg)(),(0,r.j4)(f,{key:0},{default:(0,r.w5)((function(){return[((0,r.wg)(),(0,r.iD)(r.HY,null,(0,r.Ko)([0,1,2,3,4,5,6,7,8,9],(function(e){return(0,r.Wm)(_,{key:e,button:"",detail:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(m,{style:{height:"35px",width:"40px"},animated:""}),(0,r.Wm)(m,{style:{width:"100%"},animated:""})]})),_:2},1024)})),64))]})),_:1}))]})),_:1})])}n(1249);var Z={props:["itemType"],components:{IonContent:k.W2,IonHeader:k.Gu,IonToolbar:k.sr,IonTitle:k.wd,IonIcon:k.gu,IonImg:k.Xz,IonList:k.q_,IonItem:k.Ie,IonSearchbar:k.VI,IonSkeletonText:k.CK},setup(){return{closeOutline:v.fID}},data(){return{query:null,itemList:null,itemTypeName:""}},mounted(){this.listGet()},methods:{listGet(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:"order"==e.itemType?(e.itemTypeName="Заказ",e.ordersGet()):"store"==e.itemType?(e.itemTypeName="Продавец",e.storesGet()):"courier"==e.itemType?(e.itemTypeName="Курьер",e.couriersGet()):e.$flash("unknown item type "+e.itemType);case 1:case"end":return t.stop()}}),t)})))()},storesGet(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={name_query:e.query,name_query_fields:"store_name",limit:10},t.prev=1,t.next=4,b().post(`${e.$heap.state.hostname}Store/listGet`,n);case 4:r=t.sent,e.itemList=r.map((function(e){return e.name=`продавец ${e.store_name}`,e.id=e.store_id,e})),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](1);case 10:case"end":return t.stop()}}),t,null,[[1,8]])})))()},couriersGet(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={name_query:e.query,name_query_fields:"user_name,user_phone",limit:10},t.prev=1,t.next=4,b().post(`${e.$heap.state.hostname}Courier/listGet`,n);case 4:r=t.sent,e.itemList=r.map((function(e){return e.name=`курьер ${e.user_name} ${e.user_phone}`,e.id=e.courier_id,e.image_hash=e.courier_photo_image_hash,e})),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](1);case 10:case"end":return t.stop()}}),t,null,[[1,8]])})))()},ordersGet(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={name_query:e.query,name_query_fields:"store_name,order_id,user_name",limit:10},t.prev=1,t.next=4,b().post(`${e.$heap.state.hostname}Order/listGet`,n);case 4:r=t.sent,e.itemList=r.map((function(e){return e.name=`заказ#${e.order_id} ${e.store_name} > ${e.user_name}`,e.id=e.order_id,e})),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](1);case 10:case"end":return t.stop()}}),t,null,[[1,8]])})))()},itemPick(e){k.Fy.dismiss(e)},closeModal(){k.Fy.dismiss()}}},U=n(3744);const q=(0,U.Z)(Z,[["render",W]]);var G=q,T=[{trans_role:"transit->supplier",trans_holder:"order",trans_name:"Продавец Возврат товара",trans_description:"Средства взимаемые с Продавца для воврата оплаты Покупателю. Заказ №{{trans_holder_id}}"},{trans_role:"supplier->transit",trans_holder:"order",trans_name:"Продавец Отгрузка заказа",trans_description:"Стоимость товара, отгруженного Покупателю. Заказ №{{trans_holder_id}}"},{trans_role:"capital.profit->supplier",trans_holder:"order",trans_name:"Продавец Комиссия сайта",trans_description:"Комиссия сайта за предоставленные услуги. Заказ №{{trans_holder_id}}"},{trans_role:"money.account->supplier",trans_holder:"store",trans_name:"Продавец Выплата",trans_description:"Оплата по договору за выполненые заказы"},{trans_role:"supplier->money.account",trans_holder:"store",trans_name:"Продавец Авансирование услуг",trans_description:"Аванс за услуги сайта"},{trans_role:"supplier->capital.profit",trans_holder:"store",trans_name:"Продавец Бонус на услуги при регистрации",trans_description:"Бонус на услуги при регистрации на сайте"},{trans_role:"money.account->courier",trans_holder:"courier",trans_name:"Курьер Выплата",trans_description:"Оплата по договору за оказанные услуги"},{trans_role:"courier->capital.profit",trans_holder:"order",trans_name:"Курьер Начисление бонуса",trans_description:"Начисление бонуса за Заказ №{{trans_holder_id}}"},{trans_role:"capital.profit->courier",trans_holder:"order",trans_name:"Курьер Штраф",trans_description:"Штраф за не выполнение Заказа №{{trans_holder_id}}"}],V={components:{IonInput:k.pK,IonIcon:k.gu,IonList:k.q_,IonItem:k.Ie,IonToggle:k.ho,IonLabel:k.Q$,IonSelect:k.t9,IonSelectOption:k.n0,IonTextarea:k.g2,IonButton:k.YG,IonGrid:k.jY,IonRow:k.Nd,IonCol:k.wI,IonNote:k.uN},setup(){return{trashOutline:v.gtu,searchOutline:v.W6I}},data(){return{transactionId:this.$route.params.id,transaction:null,transTypes:T}},computed:{},created(){var e=this;this.$topic.on("userGet",(function(){e.init()})),g.Z.isAdmin()&&this.init()},methods:{init(){g.Z.isAdmin()||this.$router.replace("/"),this.itemGet()},itemGet(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r,a,o;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=e.transactionId){t.next=3;break}return e.transaction={},t.abrupt("return");case 3:return n={trans_id:e.transactionId},t.prev=4,t.next=7,b().post(`${e.$heap.state.hostname}Transaction/itemGet`,n);case 7:e.transaction=t.sent,e.holderLabelGet(),t.next=22;break;case 11:t.prev=11,t.t0=t["catch"](4),o=null===t.t0||void 0===t.t0||null===(r=t.t0.responseJSON)||void 0===r||null===(a=r.messages)||void 0===a?void 0:a.error,t.t1=o,t.next="forbidden"===t.t1?17:"notfound"===t.t1?19:21;break;case 17:return e.$flash("Не достаточно прав"),t.abrupt("break",21);case 19:return e.$flash("Проводка не найдена"),t.abrupt("break",21);case 21:return t.abrupt("return",!1);case 22:case"end":return t.stop()}}),t,null,[[4,11]])})))()},holderLabelGet(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r,a,o,i,s,u,l,c;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.transaction.trans_holder_label="","order"!=e.transaction.trans_holder){t.next=9;break}return n={name_query:e.transaction.trans_holder_id,name_query_fields:"order_id"},t.next=6,b().post(`${e.$heap.state.hostname}Order/listGet`,n);case 6:r=t.sent,a=r[0],e.transaction.trans_holder_label=`заказ#${a.order_id} ${a.store_name} > ${a.user_name}`;case 9:if("store"!=e.transaction.trans_holder){t.next=16;break}return o={name_query:e.transaction.trans_holder_id,name_query_fields:"store_id"},t.next=13,b().post(`${e.$heap.state.hostname}Store/listGet`,o);case 13:i=t.sent,s=i[0],e.transaction.trans_holder_label=`продавец ${s.store_name}`;case 16:if("courier"!=e.transaction.trans_holder){t.next=23;break}return u={name_query:e.transaction.trans_holder_id,name_query_fields:"courier_id"},t.next=20,b().post(`${e.$heap.state.hostname}Courier/listGet`,u);case 20:l=t.sent,c=l[0],e.transaction.trans_holder_label=`курьер ${c.user_name} ${c.user_phone}`;case 23:t.next=27;break;case 25:t.prev=25,t.t0=t["catch"](0);case 27:case"end":return t.stop()}}),t,null,[[0,25]])})))()},holderIdPick(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r,a;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.transaction.trans_holder){t.next=2;break}return t.abrupt("return");case 2:return n=e.transaction.trans_holder,t.next=5,k.Fy.create({component:G,componentProps:{itemType:n},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});case 5:return r=t.sent,r.present(),e.$topic.on("dismissModal",(function(){r.dismiss()})),t.next=10,r.onDidDismiss();case 10:if(a=t.sent,a.data){t.next=13;break}return t.abrupt("return");case 13:e.transaction.trans_holder_id=a.data.id,e.transaction.trans_holder_label=a.data.name,e.itemRender();case 16:case"end":return t.stop()}}),t)})))()},validate(){return this.transaction.trans_date?this.transaction.trans_role?this.transaction.trans_holder_id>0?0!=this.transaction.trans_amount||(this.$flash("Сумма должна не равняться нулю"),!1):(this.$flash("Контрагент не выбран"),!1):(this.$flash("Тип проводки не выбран"),!1):(this.$flash("Дата не выбрана"),!1)},itemSave(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){var n,r,a,o,i;return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.validate()){t.next=2;break}return t.abrupt("return");case 2:return n={trans_id:e.transaction.trans_id,trans_date:e.transaction.trans_date,trans_holder:e.transaction.trans_holder,trans_holder_id:e.transaction.trans_holder_id,trans_amount:e.transaction.trans_amount,trans_role:e.transaction.trans_role,trans_description:e.transaction.trans_description,is_disabled:e.transaction.is_disabled},t.prev=3,r=n.trans_id?"itemUpdate":"itemCreate",t.next=7,b().post(`${e.$heap.state.hostname}Transaction/${r}`,JSON.stringify(n));case 7:e.$flash("💾 сохранено"),e.$router.go(-1),t.next=21;break;case 11:t.prev=11,t.t0=t["catch"](3),i=null===t.t0||void 0===t.t0||null===(a=t.t0.responseJSON)||void 0===a||null===(o=a.messages)||void 0===o?void 0:o.error,t.t1=i,t.next="forbidden"===t.t1?17:19;break;case 17:return e.$flash("Не достаточно прав"),t.abrupt("break",19);case 19:return e.$flash("Не удалось сохранить проводку"),t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t,null,[[3,11]])})))()},itemUpdateRole(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.transaction.trans_holder_id="",e.transaction.trans_holder_label="Выберите агента",e.itemRender();case 3:case"end":return t.stop()}}),t)})))()},itemRender(){var e=this,t=this.transTypes.find((function(t){return t.trans_role==e.transaction.trans_role}));t?(this.transaction.trans_tags="",this.transaction.trans_holder=t.trans_holder,this.transaction.trans_description=$.Z.render(t.trans_description,this.transaction)):this.$flash("Неверный тип проводки")},itemDelete(){var e=this;return(0,w.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(confirm("Вы уверенны?")){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,b().post(`${e.$heap.state.hostname}Transaction/itemDelete`,{trans_id:e.transactionId});case 5:e.$router.go(-1),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](2);case 10:case"end":return t.stop()}}),t,null,[[2,8]])})))()}}};const C=(0,U.Z)(V,[["render",f]]);var D=C}}]);
//# sourceMappingURL=8184-legacy.9207c087.js.map