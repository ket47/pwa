"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[5304],{5561:function(e,r,t){t.r(r),t.d(r,{default:function(){return h}});var o=t(6252),s=t(3577);function a(e,r,t,a,i,n){const d=(0,o.up)("ship-comp"),c=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(c,{"page-title":"Вызов курьера"},{default:(0,o.w5)((()=>{var e;return[(0,o.Wm)(d,{orderData:i.order,onStageCreate:n.onStageCreate,onOrderUpdate:n.itemUpdate},null,8,["orderData","onStageCreate","onOrderUpdate"]),(0,o.Uk)(" "+(0,s.zw)(null===(e=i.order)||void 0===e?void 0:e.order_sum_delivery)+" "+(0,s.zw)(i.err),1)]})),_:1})}t(4916),t(5306),t(8862),t(7658);var i=t(9755),n=t.n(i),d=t(283),c={components:{ShipComp:d.Z},data(){return{order:null,err:""}},methods:{async itemCreate(){const e=new Date,r={order_store_id:null,order_id:0,entries:[],created_at:e.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.itemSave(r)},async itemLoad(){try{const e=JSON.parse(localStorage.shipmentDraft);if(e)return void(this.order=e)}catch(e){}this.itemCreate()},itemSave(e){this.order=e,localStorage.shipmentDraft=JSON.stringify(e)},async itemUpdate(e){this.itemSave(Object.assign({},this.order,e))},async onStageCreate(e,r){if("customer_purged"==r||"customer_deleted"==r)return localStorage.removeItem("shipmentDraft"),void this.$router.replace("/order/order-list");"customer_action_confirm"==r&&(r="customer_confirmed");try{const e={is_shopping:0,order_description:this.order.order_description,order_start_location_id:this.order.start_location_id,order_finish_location_id:this.order.finish_location_id},r=await n().post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(e));r>0&&this.$router.push(`/modal/shipment-checkout-${r}`)}catch(s){var t,o;const r=null===s||void 0===s||null===(t=s.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;if(!r)return!1;switch(r){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии ☹️","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+e;break}return!1}}},mounted(){this.itemLoad()}},l=t(3744);const u=(0,l.Z)(c,[["render",a]]);var h=u}}]);
//# sourceMappingURL=5304.a1964d1f.js.map