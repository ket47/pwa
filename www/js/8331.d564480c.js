"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[8331],{4075:function(t,e,o){o.d(e,{Z:function(){return u}});var a=o(6252);function n(t,e,o,n,i,s){const l=(0,a.up)("ion-icon"),r=(0,a.up)("ion-button"),c=(0,a.up)("ion-buttons"),d=(0,a.up)("ion-label"),u=(0,a.up)("ion-toolbar"),p=(0,a.up)("ion-searchbar"),m=(0,a.up)("ion-header"),h=(0,a.up)("ymap-marker"),_=(0,a.up)("yandex-map"),y=(0,a.up)("ion-content");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(m,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,{slot:"start"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{onClick:e[0]||(e[0]=t=>n.closeModal()),color:"primary"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{icon:n.closeOutline,slot:"start"},null,8,["icon"]),(0,a.Uk)(" Закрыть ")])),_:1})])),_:1}),(0,a.Wm)(d,{size:"large"},{default:(0,a.w5)((()=>[(0,a.Uk)("Добавление адреса")])),_:1}),(0,a.Wm)(c,{slot:"end"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{strong:!0,onClick:e[1]||(e[1]=t=>s.pickAddress()),color:"primary"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{src:n.checkmark,slot:"start"},null,8,["src"]),(0,a.Uk)(" Ок ")])),_:1})])),_:1})])),_:1}),(0,a.Wm)(p,{id:"suggest",placeholder:"название улицы, номер дома"})])),_:1}),(0,a.Wm)(y,null,{default:(0,a.w5)((()=>[(0,a.Wm)(_,{coords:i.coords,zoom:16,onClick:e[2]||(e[2]=t=>s.onClick(t)),style:{height:"100%"},settings:i.settings},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{coords:i.coords,"marker-id":"1",properties:i.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"])])),_:1})],64)}o(3948),o(7658);var i=o(2824),s=o(5836),l=o(8903),r={components:{IonContent:i.W2,IonToolbar:i.sr,IonButton:i.YG,IonButtons:i.Sm,IonSearchbar:i.VI,IonHeader:i.Gu,IonIcon:i.gu,yandexMap:s.xR,ymapMarker:s.Jk},setup(){const t=function(){i.Fy.dismiss()};return{closeModal:t,locationOutline:l.Iv7,closeOutline:l.fID,checkmark:l.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let t=this.location_group_name_low+" адрес",e=this.$heap.state.settings.location,o=JSON.parse(e.mapCenter);return{settings:{apiKey:e.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:t},locationType:t,locSettings:e,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o}},methods:{async pickAddress(){try{var t;const e=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=e.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}catch(o){}var e={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1]};i.Fy.dismiss(e)},filterAddress(t){const e=this.locSettings.addressErase.split(", "),o=t.split(", ");let a=[];for(const n of o)e.find((t=>t==n))||a.push(n);return a.reverse().join(", ")},onClick(t){t&&t.get&&(this.coords=t.get("coords"))}},async mounted(){await(0,s.xk)();let t=window.ymaps;const e=JSON.parse("["+this.locSettings.mapBoundaries[0]+"]"),o=new t.SuggestView("suggest",{boundedBy:e});o.events.add("select",(e=>{this.selectedAddress=e.get("item").displayName,t.geocode(this.selectedAddress).then((t=>{this.coords=t.geoObjects.get(0).geometry.getCoordinates()}))})),this.$flash("Получаем местоположение устройства"),t.geolocation.get().then((t=>{this.coords=t.geoObjects.position,this.$flash("На карте отмечено ваше местоположение")}))}},c=o(3744);const d=(0,c.Z)(r,[["render",n]]);var u=d},8331:function(t,e,o){o.r(e),o.d(e,{default:function(){return z}});var a=o(6252),n=o(3577);const i=t=>((0,a.dD)("data-v-356a5117"),t=t(),(0,a.Cn)(),t),s=i((()=>(0,a._)("b",null,"Курьер",-1))),l=i((()=>(0,a._)("br",null,null,-1))),r={style:{"border-radius":"10px",margin:"10px",overflow:"hidden"}},c={style:{padding:"10px"}},d=i((()=>(0,a._)("b",null,"Ко времени",-1))),u=i((()=>(0,a._)("label",{for:"payment_cash"},"Оплата наличными",-1))),p={slot:"end"},m=["checked"],h=i((()=>(0,a._)("label",{for:"payment_cash_store"},"Оплата наличными продавцу",-1))),_={slot:"end"},y=["checked"],k={key:6},g=i((()=>(0,a._)("label",{for:"payment_card"},"Оплата картой без привязки",-1))),f={slot:"end"},w=["checked"],v={for:"use_card_recurrent"},C={slot:"end"},b=["checked"];function W(t,e,o,i,W,S){const I=(0,a.up)("ion-title"),O=(0,a.up)("ion-label"),j=(0,a.up)("ion-icon"),T=(0,a.up)("ion-text"),U=(0,a.up)("ion-item"),$=(0,a.up)("ymap-marker"),x=(0,a.up)("yandex-map"),A=(0,a.up)("ion-segment-button"),D=(0,a.up)("ion-segment"),F=(0,a.up)("ion-img"),z=(0,a.up)("ion-card-content"),L=(0,a.up)("ion-card"),R=(0,a.up)("base-layout");return(0,a.wg)(),(0,a.j4)(R,{pageTitle:"Оформление",pageDefaultBackLink:"/order/order-list"},{default:(0,a.w5)((()=>{var o;return[(0,a.Wm)(I,{class:"ion-padding"},{default:(0,a.w5)((()=>[(0,a.Uk)("Ваш заказ")])),_:1}),(0,a.Wm)(O,{class:"ion-padding"},{default:(0,a.w5)((()=>[s])),_:1}),(0,a.Wm)(U,{detail:"",lines:"none"},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{src:i.cubeOutline,slot:"start",size:"large",color:"medium",style:{"font-size":"2em"}},null,8,["src"]),(0,a.Wm)(T,{color:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("Скажите нам, что нужно перевезти?")])),_:1})])),_:1}),l,(0,a.Wm)(I,{class:"ion-padding"},{default:(0,a.w5)((()=>[(0,a.Uk)("Детали перевозки")])),_:1}),(0,a._)("div",r,[W.placemarkCoords?((0,a.wg)(),(0,a.j4)(x,{key:0,coords:W.placemarkCoords,zoom:16,settings:W.mapsettings,controls:["fullscreenControl"],behaviors:[],style:{height:"200px"}},{default:(0,a.w5)((()=>[(0,a.Wm)($,{coords:W.placemarkCoords,icon:W.placemarkIcon,"marker-id":"1",properties:W.placemarkProperties},null,8,["coords","icon","properties"])])),_:1},8,["coords","settings"])):(0,a.kq)("",!0)]),W.locationStart?((0,a.wg)(),(0,a.j4)(U,{key:0,lines:"none",button:"",onClick:e[0]||(e[0]=t=>S.locationStartSelect())},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{color:"primary",src:i.locationOutline,slot:"start"},null,8,["src"]),(0,a.Wm)(T,{color:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(W.locationStart.location_address),1)])),_:1})])),_:1})):((0,a.wg)(),(0,a.j4)(U,{key:1,lines:"none",button:"",onClick:e[1]||(e[1]=t=>S.locationStartSelect())},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{color:"medium",src:i.locationOutline,slot:"start"},null,8,["src"]),(0,a.Wm)(T,{color:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("Откуда забрать?")])),_:1}),(0,a.Wm)(j,{color:"medium",src:i.addOutline,slot:"end"},null,8,["src"])])),_:1})),W.locationFinish?((0,a.wg)(),(0,a.j4)(U,{key:2,lines:"none",button:"",onClick:e[2]||(e[2]=t=>S.locationFinishSelect())},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{color:"primary",src:i.flagOutline,slot:"start"},null,8,["src"]),(0,a.Wm)(T,{color:"primary"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(W.locationFinish.location_address),1)])),_:1})])),_:1})):((0,a.wg)(),(0,a.j4)(U,{key:3,lines:"none",button:"",onClick:e[3]||(e[3]=t=>S.locationFinishSelect())},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{color:"medium",src:i.flagOutline,slot:"start"},null,8,["src"]),(0,a.Wm)(T,{color:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("Куда отвезти?")])),_:1}),(0,a.Wm)(j,{color:"medium",src:i.addOutline,slot:"end"},null,8,["src"])])),_:1})),(0,a._)("div",c,[(0,a.Wm)(D,{mode:"ios",value:"atonce"},{default:(0,a.w5)((()=>[(0,a.Wm)(A,{value:"atonce"},{default:(0,a.w5)((()=>[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a.Uk)("Как можно скорее")])),_:1}),(0,a.Uk)(" отвезти сразу ")])),_:1}),(0,a.Wm)(A,{value:"schedule",disabled:""},{default:(0,a.w5)((()=>[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[d])),_:1}),(0,a.Uk)(" выберите день и время ")])),_:1})])),_:1})]),(0,a.Wm)(I,{class:"ion-padding"},{default:(0,a.w5)((()=>[(0,a.Uk)("Способы оплаты")])),_:1}),1==W.tariffRule.paymentByCash?((0,a.wg)(),(0,a.j4)(U,{key:4,button:"",detail:"false",onClick:e[4]||(e[4]=t=>W.paymentType="use_cash")},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{icon:t.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),u,(0,a._)("div",p,[(0,a._)("input",{type:"radio",name:"paymentType",id:"payment_cash",value:"cash",checked:"use_cash"==W.paymentType},null,8,m)])])),_:1})):(0,a.kq)("",!0),1==W.tariffRule.paymentByCashStore?((0,a.wg)(),(0,a.j4)(U,{key:5,button:"",detail:"false",onClick:e[5]||(e[5]=t=>W.paymentType="use_cash_store")},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{icon:t.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),h,(0,a._)("div",_,[(0,a._)("input",{type:"radio",name:"paymentType",id:"payment_cash_store",value:"cash",checked:"use_cash_store"==W.paymentType},null,8,y)])])),_:1})):(0,a.kq)("",!0),1==W.tariffRule.paymentByCard?((0,a.wg)(),(0,a.iD)("div",k,[(0,a.Wm)(U,{detail:"false",button:"",onClick:e[6]||(e[6]=t=>W.paymentType="use_card")},{default:(0,a.w5)((()=>[(0,a.Wm)(j,{icon:t.cardOutline,slot:"start",color:"primary"},null,8,["icon"]),g,(0,a._)("div",f,[(0,a._)("input",{type:"radio",name:"paymentType",id:"payment_card",value:"card",checked:"use_card"==W.paymentType},null,8,w)])])),_:1}),null!==(o=W.bankCard)&&void 0!==o&&o.card_type?((0,a.wg)(),(0,a.j4)(U,{key:0,button:"",detail:"false",onClick:e[7]||(e[7]=t=>W.paymentType="use_card_recurrent")},{default:(0,a.w5)((()=>{var e;return["mir"==W.bankCard.card_type?((0,a.wg)(),(0,a.j4)(F,{key:0,class:"card_type",src:`/img/icons/card-${W.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==W.bankCard.card_type?((0,a.wg)(),(0,a.j4)(F,{key:1,class:"card_type",src:`/img/icons/card-${W.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==W.bankCard.card_type?((0,a.wg)(),(0,a.j4)(F,{key:2,class:"card_type",src:`/img/icons/card-${W.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):((0,a.wg)(),(0,a.j4)(j,{key:3,src:t.cardOutline,slot:"start",color:"primary"},null,8,["src"])),(0,a._)("label",v,"Оплата картой "+(0,n.zw)(null===(e=W.bankCard)||void 0===e?void 0:e.card_mask),1),(0,a._)("div",C,[(0,a._)("input",{type:"radio",name:"paymentType",id:"use_card_recurrent",value:"registered_card",checked:"use_card_recurrent"==W.paymentType},null,8,b)])]})),_:1})):(0,a.kq)("",!0),W.recurrentPaymentAllow?((0,a.wg)(),(0,a.j4)(U,{key:1,button:"",detail:"",onClick:e[8]||(e[8]=e=>t.$go("/user/user-cards"))},{default:(0,a.w5)((()=>{var t;return[null!==(t=W.bankCard)&&void 0!==t&&t.card_type?((0,a.wg)(),(0,a.j4)(O,{key:0,color:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("Выбрать другую карту")])),_:1})):((0,a.wg)(),(0,a.j4)(O,{key:1,color:"medium"},{default:(0,a.w5)((()=>[(0,a.Uk)("Привязать карту")])),_:1}))]})),_:1})):(0,a.kq)("",!0)])):(0,a.kq)("",!0),(0,a.Uk)(" "+(0,n.zw)(W.locationStart)+" ",1),S.checkoutError?((0,a.wg)(),(0,a.j4)(L,{key:7,color:"warning"},{default:(0,a.w5)((()=>[(0,a.Wm)(z,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(S.checkoutError),1)])),_:1})])),_:1})):(0,a.kq)("",!0)]})),_:1})}o(8862);var S=o(2824),I=o(8903),O=o(5836),j=o(6234),T=o(7536),U=o(4405),$=o(9755),x=o.n($),A=(o(4075),{components:{yandexMap:O.xR,ymapMarker:O.Jk,IonText:S.yW,IonItem:S.Ie,IonIcon:S.gu,IonLabel:S.Q$,IonTitle:S.wd,IonSegment:S.cJ,IonSegmentButton:S.GO,IonImg:S.Xz,IonCard:S.PM,IonCardContent:S.FN},setup(){return{magic_wand:j,boxDelivery:T,cubeOutline:I.XFf,locationOutline:I.Iv7,flagOutline:I.FMn,chevronDown:I.Dd1,addOutline:I.s6O}},computed:{checkoutError(){return"no_input"==this.errorCode?"Выберите адрес забора и доставки посылки":null}},data(){var t,e;return{ship_id:this.$route.params.id,ship:null,shipAutoloadClock:null,paymentType:"use_card",bankCard:null,recurrentPaymentAllow:1==(null===(t=this.$heap.state.settings)||void 0===t||null===(e=t.other)||void 0===e?void 0:e.recurrentPaymentAllow)?1:0,tariffRule:{},tariffRuleList:[],errorCode:null,locationStart:null,locationFinish:null,mapsettings:null,placemarkCoords:null,placemarkProperties:{},placemarkIcon:{layout:"default#imageWithContent",content:"some content here",contentLayout:'<div class="placemarkBaloon">$[properties.iconContent]</div>',contentOffset:[45,10],imageHref:"/img/tezkel-placemark.png",imageSize:[50,50],imageOffset:[-25,-50]}}},methods:{async itemLoad(){this.itemCheckoutDataGet()},async itemCheckoutDataGet(){try{const t=await x().post(`${this.$heap.state.hostname}Shipment/itemCheckoutDataGet`,{ship_id:this.ship_id});this.deliveryTime=U.Z.deliveryTimeCalculate(t.Location_distanceGet,0),this.bankCard=null===t||void 0===t?void 0:t.bankCard,this.tariffRuleList=t.Store_deliveryOptions,this.tariffRuleSet(this.tariffRuleList[0]||{}),this.is_checkout_data_loaded=1,this.customerIpLocationGet()}catch(o){var t,e;return this.is_checkout_data_loaded=1,this.errorCode=null===o||void 0===o||null===(t=o.responseJSON)||void 0===t||null===(e=t.messages)||void 0===e?void 0:e.error,console.log(this.errorCode),!1}},async itemCheckoutDataSet(){var t,e;const o={ship_id:this.ship_id,ship_start_location_id:null===(t=this.locationStart)||void 0===t?void 0:t.location_id,ship_finish_location_id:null===(e=this.locationFinish)||void 0===e?void 0:e.location_id};try{await x().post(`${this.$heap.state.hostname}Shipment/itemCheckoutDataSet`,JSON.stringify(o))}catch(a){console.log(a)}},locationStartSelect(){this.locationStart="waiting_for_selection",this.$go("/modal/user-addresses")},locationFinishSelect(){this.locationFinish="waiting_for_selection",this.$go("/modal/user-addresses")},async customerIpLocationGet(){try{const t=await fetch("https://geolocation-db.com/json/");this.iplocation=await t.json()}catch(t){}},async ymapInit(t){this.mapsettings={apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},this.placemarkCoords=JSON.parse(t.mapCenter),await(0,O.xk)()}},mounted(){this.itemLoad();let t=this.$heap.state.settings;null!==t&&void 0!==t&&t.location&&this.ymapInit(t.location),this.$topic.on("settingsGet",(async t=>{this.ymapInit(t.location)})),this.$topic.on("userMainLocationSet",(t=>{"waiting_for_selection"==this.locationStart?this.locationStart=t:"waiting_for_selection"==this.locationFinish&&(this.locationFinish=t),(this.locationStart||this.locationFinish)&&this.itemCheckoutDataSet()}))},ionViewDidEnter(){this.itemLoad()}}),D=o(3744);const F=(0,D.Z)(A,[["render",W],["__scopeId","data-v-356a5117"]]);var z=F},7536:function(t,e,o){t.exports=o.p+"img/boxDelivery.31519b49.svg"},6234:function(t,e,o){t.exports=o.p+"img/magic_wand.35042221.svg"}}]);
//# sourceMappingURL=8331.d564480c.js.map