"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[1586],{5432:function(e,t,l){l.d(t,{A:function(){return h}});var a=l(641),i=l(33);const n={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},s={slot:"end",style:{color:"#666"}};function o(e,t,l,o,r,d){const u=(0,a.g2)("ymap-marker"),c=(0,a.g2)("yandex-map"),m=(0,a.g2)("ion-searchbar"),g=(0,a.g2)("ion-item"),p=(0,a.g2)("ion-content"),h=(0,a.g2)("ion-textarea"),_=(0,a.g2)("ion-icon"),k=(0,a.g2)("ion-button"),f=(0,a.g2)("ion-toolbar");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.bF)(c,{onClick:t[0]||(t[0]=e=>d.onClick(e)),style:{height:"100%"},coords:r.coords,zoom:16,settings:r.settings,controls:["zoomControl"]},{default:(0,a.k6)((()=>[(0,a.bF)(u,{coords:r.coords,"marker-id":"1",properties:r.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,a.Lk)("div",n,[(0,a.bF)(m,{debounce:"500",modelValue:r.addressSearchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>r.addressSearchQuery=e),onIonInput:t[2]||(t[2]=e=>d.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.suggestions,((e,t)=>((0,a.uX)(),(0,a.Wv)(g,{key:t,onClick:t=>d.suggestionSelect(`${e.subtitle.text}, ${e.title.text}`,e.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(e.subtitle.text)+" "+(0,i.v_)(e.title.text)+" ",1),(0,a.Lk)("span",s,(0,i.v_)(e.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.bF)(h,{label:"комментарий к адресу","label-placement":"floating",modelValue:r.addressComment,"onUpdate:modelValue":t[3]||(t[3]=e=>r.addressComment=e)},null,8,["modelValue"]),(0,a.bF)(k,{strong:!0,onClick:t[4]||(t[4]=e=>d.pickAddress()),color:"primary",expand:"block"},{default:(0,a.k6)((()=>[(0,a.bF)(_,{src:o.checkmark,slot:"start"},null,8,["src"]),(0,a.eW)(" Ок ")])),_:1}),(0,a.bF)(k,{onClick:t[5]||(t[5]=e=>o.closeModal()),color:"light",expand:"block"},{default:(0,a.k6)((()=>[(0,a.eW)("Закрыть")])),_:1})])),_:1})],64)}l(4114);var r=l(5654),d=l(5221),u=l(5480),c=l(8701),m={components:{IonContent:r.W9,IonToolbar:r.ai,IonButton:r.Jm,IonSearchbar:r.S1,IonIcon:r.iq,IonItem:r.uz,IonTextarea:r.nc,yandexMap:d.IK,ymapMarker:d.cT},setup(){const e=function(){r.OZ.dismiss()};return{closeModal:e,locationOutline:u.UN$,closeOutline:u.xfX,checkmark:u.AIp}},props:{location_group_name_low:String,location_group_id:Number},data(){let e=this.location_group_name_low+" адрес",t=this.$heap.state.settings.location,l=JSON.parse(t.mapCenter);return{settings:{apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:e},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationType:e,locSettings:t,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:l,addressComment:""}},methods:{async pickAddress(){try{if(!this.selectedAddress){var e;const t=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(e=t.geoObjects.get(0))||void 0===e?void 0:e.getAddressLine()}}catch(l){}var t={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};r.OZ.dismiss(t)},filterAddress(e){const t=this.locSettings.addressErase.split(", "),l=e.split(", ");let a=[];for(const i of l)t.find((e=>e==i))||a.push(i);return a.reverse().join(", ")},onClick(e){e&&e.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=e.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const e=this.$heap.state.settings.location.ymapSuggestionApiKey,t=this.coords.slice().reverse().join(","),l=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${e}&lang=ru_RU&ll=${t}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),a=await l.json();this.suggestions=a.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(e,t){this.selectedAddress=e,this.geocode(t)},async geocode(e){try{this.suggestions=[];const t=this.$heap.state.settings.location.ymapApiKey,l=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${t}&format=json&results=1&uri=${e}`),a=await l.json(),i=a.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=i.Point.pos.split(" ").reverse()}catch(t){console.log(t)}}},async mounted(){await(0,d.wc)();const e=c.A.geo.lastStoredGet();null!==e&&void 0!==e&&e.location_latitude&&(this.coords=[e.location_latitude,e.location_longitude]);const t=await c.A.geo.get();if(this.markDeviceOnMap&&t){const{coords:e}=t;this.coords=[e.latitude,e.longitude],this.$flash("На карте отмечено ваше местоположение")}}},g=l(6262);const p=(0,g.A)(m,[["render",o]]);var h=p},1586:function(e,t,l){l.r(t),l.d(t,{default:function(){return X}});var a=l(641),i=l(33);const n=e=>((0,a.Qi)("data-v-2344ef84"),e=e(),(0,a.jt)(),e),s={key:0},o={key:1},r={key:2},d={key:0,class:"ion-text-center ion-margin-vertical"},u={key:0},c={key:1},m={key:1,class:"ion-text-center ion-margin-vertical"},g=n((()=>(0,a.Lk)("img",{src:"/img/logo-full.png"},null,-1))),p={class:"max-two-lines"},h={style:{"max-height":"200px",overflow:"hidden","border-radius":"5px","margin-top":"5px"}},_=["src"],k=n((()=>(0,a.Lk)("img",{src:"/img/logo-full.png"},null,-1))),f=["src"],b={class:"ion-margin-vertical ion-text-center"},v={style:{"max-height":"200px",overflow:"hidden","margin-bottom":"10px"}},y=["src"],F={style:{"margin-top":"10px"},class:"max-two-lines"},C=n((()=>(0,a.Lk)("b",null,"Tezkel",-1)));function x(e,t,l,n,x,I){const w=(0,a.g2)("ion-loading"),W=(0,a.g2)("ion-select-option"),$=(0,a.g2)("ion-select"),S=(0,a.g2)("ion-item"),V=(0,a.g2)("ion-toggle"),L=(0,a.g2)("ion-input"),O=(0,a.g2)("ion-icon"),A=(0,a.g2)("ion-button"),X=(0,a.g2)("ion-label"),D=(0,a.g2)("ion-avatar"),j=(0,a.g2)("ion-note"),U=(0,a.g2)("ion-card-header"),Q=(0,a.g2)("ion-card-title"),T=(0,a.g2)("ion-card-content"),z=(0,a.g2)("ion-card"),E=(0,a.g2)("ion-row"),M=(0,a.g2)("ion-skeleton-text"),G=(0,a.g2)("ion-col"),K=(0,a.g2)("image-tile-comp"),N=(0,a.g2)("ion-textarea"),P=(0,a.g2)("ion-list"),B=(0,a.g2)("ion-grid"),J=(0,a.g2)("ion-chip"),R=(0,a.g2)("base-layout");return(0,a.uX)(),(0,a.Wv)(R,{pageDefaultBackLink:"/admin/mailing-list","page-title":"Рассылка"},{default:(0,a.k6)((()=>[(0,a.bF)(w,{message:"Dismissing after 3 seconds..."}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)($,{label:"Транспорт","label-placement":"stacked",modelValue:x.mailing.transport,"onUpdate:modelValue":t[0]||(t[0]=e=>x.mailing.transport=e),onIonChange:t[1]||(t[1]=e=>I.itemSave())},{default:(0,a.k6)((()=>[(0,a.bF)(W,{value:"push"},{default:(0,a.k6)((()=>[(0,a.eW)("Push")])),_:1}),(0,a.bF)(W,{value:"email"},{default:(0,a.k6)((()=>[(0,a.eW)("Email")])),_:1}),(0,a.bF)(W,{value:"sms"},{default:(0,a.k6)((()=>[(0,a.eW)("Sms")])),_:1}),(0,a.bF)(W,{value:"telegram"},{default:(0,a.k6)((()=>[(0,a.eW)("Telegram")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(V,{onIonChange:t[2]||(t[2]=e=>{e.target.checked?x.mailing.regular_group="signin":x.mailing.regular_group="0",x.mailing.is_delayed=!1,I.itemSave()}),checked:"0"!=x.mailing.regular_group},{default:(0,a.k6)((()=>[(0,a.eW)(" Регулярная рассылка ")])),_:1},8,["checked"])])),_:1}),"0"==x.mailing.regular_group?((0,a.uX)(),(0,a.CE)("div",s,[(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(V,{onIonChange:t[3]||(t[3]=e=>x.mailing.is_delayed=e.target.checked),checked:x.mailing.is_delayed},{default:(0,a.k6)((()=>[(0,a.eW)("Отправить потом")])),_:1},8,["checked"])])),_:1}),x.mailing.is_delayed?((0,a.uX)(),(0,a.Wv)(S,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.start_at,"onUpdate:modelValue":t[4]||(t[4]=e=>x.mailing.start_at=e),type:"datetime-local",min:(new Date).toISOString().slice(0,-8),label:"Когда отправить?","label-placement":"stacked",onIonChange:t[5]||(t[5]=e=>I.itemSave())},null,8,["modelValue","min"])])),_:1})):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.regular_group,"onUpdate:modelValue":t[6]||(t[6]=e=>x.mailing.regular_group=e),label:"Группа рассылок",placeholder:"Выберите группу",onIonChange:t[7]||(t[7]=e=>I.itemSave())},null,8,["modelValue"])])),_:1}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.start_at,"onUpdate:modelValue":t[8]||(t[8]=e=>x.mailing.start_at=e),type:"time",label:"Во сколько отправлять?","label-placement":"stacked",onIonChange:t[9]||(t[9]=e=>I.itemSave())},null,8,["modelValue"])])),_:1})])),x.mailing.transport?((0,a.uX)(),(0,a.CE)("div",r,["0"==x.mailing.regular_group?((0,a.uX)(),(0,a.CE)("div",d,["0"==x.mailing.is_started?((0,a.uX)(),(0,a.Wv)(A,{key:0,onClick:t[10]||(t[10]=e=>I.itemStart())},{default:(0,a.k6)((()=>[(0,a.bF)(O,{slot:"start",src:n.playOutline},null,8,["src"]),x.mailing.is_delayed?((0,a.uX)(),(0,a.CE)("span",u,"Запланировать")):((0,a.uX)(),(0,a.CE)("span",c,"Отправить"))])),_:1})):((0,a.uX)(),(0,a.Wv)(A,{key:1,onClick:t[11]||(t[11]=e=>I.itemStart()),color:"warning"},{default:(0,a.k6)((()=>[(0,a.bF)(O,{slot:"start",src:n.refreshOutline},null,8,["src"]),(0,a.eW)(" Перезапустить ")])),_:1}))])):((0,a.uX)(),(0,a.CE)("div",m,[(0,a.bF)(A,{onClick:t[12]||(t[12]=e=>I.itemStart())},{default:(0,a.k6)((()=>[(0,a.bF)(O,{slot:"start",src:n.playOutline},null,8,["src"]),(0,a.eW)(" Сохранить ")])),_:1})]))])):(0,a.Q3)("",!0),(0,a.bF)(B,null,{default:(0,a.k6)((()=>[(0,a.bF)(E,null,{default:(0,a.k6)((()=>[(0,a.bF)(G,{col:"3"},{default:(0,a.k6)((()=>[(0,a.bF)(S,{lines:"none"},{default:(0,a.k6)((()=>[(0,a.bF)(X,null,{default:(0,a.k6)((()=>[(0,a.eW)("Предварительный показ:")])),_:1})])),_:1}),"push"==x.mailing.transport||"telegram"==x.mailing.transport?((0,a.uX)(),(0,a.Wv)(z,{key:0,class:"preview-card"},{default:(0,a.k6)((()=>[(0,a.bF)(U,null,{default:(0,a.k6)((()=>[(0,a.bF)(S,{class:"ion-no-padding",lines:"none"},{default:(0,a.k6)((()=>[(0,a.bF)(D,{slot:"start",style:{"--border-radius":"5px",width:"25px",height:"25px"}},{default:(0,a.k6)((()=>[g])),_:1}),(0,a.bF)(X,null,{default:(0,a.k6)((()=>[(0,a.bF)(j,{style:{"font-size":"12px"}},{default:(0,a.k6)((()=>[(0,a.eW)("Tezkel")])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.bF)(T,{style:{"padding-left":"55px"}},{default:(0,a.k6)((()=>[(0,a.Lk)("div",null,[(0,a.bF)(Q,{style:{"font-size":"14px"}},{default:(0,a.k6)((()=>[(0,a.Lk)("b",null,(0,i.v_)(x.mailing.subject_template),1)])),_:1}),(0,a.Lk)("span",p,(0,i.v_)(x.mailing.text_template),1)]),(0,a.Lk)("div",h,[x.mailing.image?((0,a.uX)(),(0,a.CE)("img",{key:0,src:x.mailing.image},null,8,_)):(0,a.Q3)("",!0)])])),_:1})])),_:1})):(0,a.Q3)("",!0),"email"==x.mailing.transport?((0,a.uX)(),(0,a.Wv)(z,{key:1,class:"preview-card"},{default:(0,a.k6)((()=>[(0,a.bF)(U,null,{default:(0,a.k6)((()=>[(0,a.bF)(S,{class:"ion-no-padding",lines:"none"},{default:(0,a.k6)((()=>[(0,a.bF)(D,{slot:"start",style:{"--border-radius":"5px",width:"25px",height:"25px"}},{default:(0,a.k6)((()=>[k])),_:1}),(0,a.bF)(X,null,{default:(0,a.k6)((()=>[(0,a.bF)(j,{style:{"font-size":"12px"}},{default:(0,a.k6)((()=>[(0,a.eW)("Tezkel ○ "+(0,i.v_)(x.mailing.start_at),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.bF)(T,{style:{"padding-left":"55px"}},{default:(0,a.k6)((()=>[(0,a.bF)(E,{class:"ion-justify-content-center"},{default:(0,a.k6)((()=>[(0,a.Lk)("img",{src:`${e.$heap.state.hostname}img/tezbanner.jpg`,width:"450px"},null,8,f)])),_:1}),(0,a.bF)(E,{class:"ion-justify-content-center ion-margin-vertical"},{default:(0,a.k6)((()=>[(0,a.bF)(Q,{style:{"font-size":"14px"}},{default:(0,a.k6)((()=>[(0,a.Lk)("b",null,(0,i.v_)(x.mailing.subject_template),1)])),_:1})])),_:1}),(0,a.Lk)("div",b,[(0,a.Lk)("div",v,[x.mailing.image?((0,a.uX)(),(0,a.CE)("img",{key:0,style:{height:"200px","border-radius":"5px"},src:x.mailing.image},null,8,y)):(0,a.Q3)("",!0)]),(0,a.Lk)("span",F,(0,i.v_)(x.mailing.text_template),1)]),(0,a.bF)(E,{class:"ion-justify-content-center"},{default:(0,a.k6)((()=>[(0,a.bF)(M,{animated:!0,style:{width:"80%"}})])),_:1}),(0,a.bF)(E,{class:"ion-justify-content-center"},{default:(0,a.k6)((()=>[(0,a.bF)(M,{animated:!0,style:{width:"50%"}})])),_:1})])),_:1})])),_:1})):(0,a.Q3)("",!0),"sms"==x.mailing.transport?((0,a.uX)(),(0,a.Wv)(z,{key:2,class:"preview-card"},{default:(0,a.k6)((()=>[(0,a.bF)(U,null,{default:(0,a.k6)((()=>[(0,a.bF)(S,{class:"ion-no-padding",lines:"none"},{default:(0,a.k6)((()=>[(0,a.bF)(X,{slot:"start"},{default:(0,a.k6)((()=>[C])),_:1}),(0,a.bF)(X,{slot:"end"},{default:(0,a.k6)((()=>[(0,a.bF)(j,{style:{"font-size":"12px"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(x.mailing.start_at),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.bF)(T,{style:{"padding-top":"0"}},{default:(0,a.k6)((()=>[(0,a.bF)(Q,{style:{"font-size":"14px"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(x.mailing.text_template),1)])),_:1})])),_:1})])),_:1})):(0,a.Q3)("",!0)])),_:1}),(0,a.bF)(G,{col:"9"},{default:(0,a.k6)((()=>[(0,a.bF)(S,{lines:"none"},{default:(0,a.k6)((()=>[(0,a.bF)(X,null,{default:(0,a.k6)((()=>[(0,a.eW)("Содержимое:")])),_:1})])),_:1}),(0,a.bF)(z,null,{default:(0,a.k6)((()=>[(0,a.Lk)("form",{onChange:t[19]||(t[19]=(...e)=>I.itemSave&&I.itemSave(...e))},[(0,a.bF)(P,{lines:"full"},{default:(0,a.k6)((()=>{var e,l;return[(0,a.Lk)("div",null,[(0,a.bF)(K,{images:null===(e=x.mailing)||void 0===e?void 0:e.images,image_holder:"mailing",image_holder_id:null===(l=x.mailing)||void 0===l?void 0:l.mailing_id,hide_if_empty:"true",controller:"Admin/Mailing",ref:"mailingImgs",onOnChange:I.imageChange},null,8,["images","image_holder_id","onOnChange"]),(0,a.bF)(S,{lines:"none",onClick:t[13]||(t[13]=e=>this.$refs.mailingImgs.take_photo())},{default:(0,a.k6)((()=>[(0,a.bF)(O,{src:n.addOutline,slot:"start"},null,8,["src"]),(0,a.eW)(" Изменить фото ")])),_:1})]),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.subject_template,"onUpdate:modelValue":t[14]||(t[14]=e=>x.mailing.subject_template=e),ref:"subject_template",label:"Заголовок","label-placement":"stacked",disabled:I.isSubjectDisabled},null,8,["modelValue","disabled"])])),_:1}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(N,{modelValue:x.mailing.text_template,"onUpdate:modelValue":t[15]||(t[15]=e=>x.mailing.text_template=e),ref:"text_template",label:"Описание","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.link,"onUpdate:modelValue":t[16]||(t[16]=e=>x.mailing.link=e),label:"Ссылка",ref:"link","label-placement":"stacked",disabled:I.isLinkDisabled},null,8,["modelValue","disabled"])])),_:1}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)($,{onIonChange:t[17]||(t[17]=e=>I.itemSave()),label:"Рингтон","label-placement":"stacked",modelValue:x.mailing.sound,"onUpdate:modelValue":t[18]||(t[18]=e=>x.mailing.sound=e),value:"default",disabled:I.isRingtoneDisabled},{default:(0,a.k6)((()=>[(0,a.bF)(W,{value:""},{default:(0,a.k6)((()=>[(0,a.eW)("-")])),_:1}),(0,a.bF)(W,{value:"default"},{default:(0,a.k6)((()=>[(0,a.eW)("стандарт")])),_:1}),(0,a.bF)(W,{value:"short.wav"},{default:(0,a.k6)((()=>[(0,a.eW)("Короткий")])),_:1}),(0,a.bF)(W,{value:"medium.wav"},{default:(0,a.k6)((()=>[(0,a.eW)("Средний")])),_:1}),(0,a.bF)(W,{value:"long.wav"},{default:(0,a.k6)((()=>[(0,a.eW)("Длинный")])),_:1})])),_:1},8,["modelValue","disabled"])])),_:1})]})),_:1})],32)])),_:1})])),_:1})])),_:1})])),_:1}),0==x.mailing.regular_group?((0,a.uX)(),(0,a.Wv)(B,{key:3},{default:(0,a.k6)((()=>[(0,a.bF)(E,null,{default:(0,a.k6)((()=>[(0,a.bF)(G,null,{default:(0,a.k6)((()=>[(0,a.bF)(z,null,{default:(0,a.k6)((()=>[(0,a.Lk)("form",{onChange:t[24]||(t[24]=(...e)=>I.itemSave&&I.itemSave(...e))},[x.mailing.user_filter?((0,a.uX)(),(0,a.Wv)(P,{key:0,lines:"full"},{default:(0,a.k6)((()=>[(0,a.bF)(P,null,{default:(0,a.k6)((()=>[(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.user_filter.phones,"onUpdate:modelValue":t[20]||(t[20]=e=>x.mailing.user_filter.phones=e),name:"user_filter.phones",label:"Телефоны получателей","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[(0,a.bF)(X,null,{default:(0,a.k6)((()=>[(0,a.eW)("Локация клиентов")])),_:1})])),_:1}),x.mailing.user_filter.location?((0,a.uX)(),(0,a.Wv)(S,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(O,{slot:"start",src:n.locationOutline},null,8,["src"]),(0,a.bF)(X,{style:{"white-space":"normal",cursor:"pointer"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,i.v_)(x.mailing.user_filter.location.location_address),1)])),_:1}),(0,a.bF)(O,{slot:"end",icon:n.trash,onClick:t[21]||(t[21]=e=>I.locationDelete(`${x.mailing.user_filter.location.location_id}`))},null,8,["icon"])])),_:1})):((0,a.uX)(),(0,a.Wv)(A,{key:1,onClick:t[22]||(t[22]=e=>I.modalLocationCreate()),color:"light",expand:"block"},{default:(0,a.k6)((()=>[(0,a.bF)(O,{src:n.locationOutline},null,8,["src"]),(0,a.eW)(" Добавить адрес ")])),_:1})),x.mailing.user_filter.location?((0,a.uX)(),(0,a.Wv)(S,{key:2},{default:(0,a.k6)((()=>[(0,a.bF)(L,{modelValue:x.mailing.user_filter.radius,"onUpdate:modelValue":t[23]||(t[23]=e=>x.mailing.user_filter.radius=e),name:"user_filter.radius",label:"Радиус вокруг локации км","label-placement":"stacked"},null,8,["modelValue"])])),_:1})):(0,a.Q3)("",!0),(0,a.bF)(S,null,{default:(0,a.k6)((()=>[x.mailing.recieverCount.all>0?((0,a.uX)(),(0,a.Wv)(J,{key:0},{default:(0,a.k6)((()=>[(0,a.eW)("Всего "+(0,i.v_)(x.mailing.recieverCount.all),1)])),_:1})):(0,a.Q3)("",!0),x.mailing.recieverCount.sent>0?((0,a.uX)(),(0,a.Wv)(J,{key:1,color:"success"},{default:(0,a.k6)((()=>[(0,a.eW)("Послано "+(0,i.v_)(x.mailing.recieverCount.sent),1)])),_:1})):(0,a.Q3)("",!0),x.mailing.recieverCount.failed>0?((0,a.uX)(),(0,a.Wv)(J,{key:2,color:"danger"},{default:(0,a.k6)((()=>[(0,a.eW)("Ошибка "+(0,i.v_)(x.mailing.recieverCount.failed),1)])),_:1})):(0,a.Q3)("",!0)])),_:1})])),_:1})])),_:1})):(0,a.Q3)("",!0)],32)])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.Q3)("",!0),(0,a.bF)(z,null,{default:(0,a.k6)((()=>[(0,a.bF)(A,{onClick:t[25]||(t[25]=e=>I.itemDelete()),color:"danger",fill:"clear",expand:"block"},{default:(0,a.k6)((()=>[(0,a.eW)("Удалить")])),_:1})])),_:1})])),_:1})}var I=l(5654),w=l(5480),W=l(2311),$=l.n(W),S=l(9144),V=l(5432),L={components:{ImageTileComp:S.A,IonList:I.nf,IonItem:I.uz,IonLabel:I.he,IonIcon:I.iq,IonButton:I.Jm,IonInput:I.$w,IonTextarea:I.nc,IonCard:I.b_,IonCardTitle:I.tN,IonCardHeader:I.ME,IonCardContent:I.I9,IonSelect:I.Nm,IonSelectOption:I.Ip,IonGrid:I.lO,IonRow:I.ln,IonCol:I.hU,IonChip:I.ZB,IonToggle:I.BY,IonAvatar:I.mC,IonNote:I.JI,IonSkeletonText:I.ds,IonLoading:I.rQ},setup(){return{addOutline:w.EKF,refreshOutline:w.mVv,imageOutline:w.ETD,closeOutline:w.xfX,playOutline:w.zsx,locationOutline:w.UN$,trash:w.dco}},data(){return{openedAccordion:"message",mailingId:this.$route.params.id,mailing:{},saveClock:null}},computed:{isPhotoDisabled(){return"sms"==this.mailing.transport},isSubjectDisabled(){return"sms"==this.mailing.transport},isRingtoneDisabled(){return"sms"==this.mailing.transport||"email"==this.mailing.transport},isLinkDisabled(){return"sms"==this.mailing.transport}},methods:{async itemGet(){let e={mailing_id:this.mailingId};try{var t;const l=await $().post(`${this.$heap.state.hostname}Admin/Mailing/itemGet`,e);null!==(t=l.user_filter)&&void 0!==t||(l.user_filter={}),"0"!==l.regular_group?l.start_at=new Date(l.start_at).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit"}):l.is_delayed=new Date(l.start_at)>new Date,this.mailing=l}catch{}},async itemSave(e){clearTimeout(this.saveClock),this.saveClock=setTimeout((async()=>{var t,l;await this.itemUpdate(),e&&(null===(t=e.target)||void 0===t||null===(l=t.name)||void 0===l?void 0:l.indexOf("user_filter"))>-1&&this.recieverListCreate()}),500)},async imageChange(e){if(e){this.mailing.image="";var t=e.find((e=>null==e.deleted_at));t&&t.length>0&&(this.mailing.image=`${this.$heap.state.hostname}image/get.php/${t[0].image_hash}.500.500.webp`)}},async itemUpdate(){let e=this.mailing;"0"!==e.regular_group&&e.start_at.length<10&&(e.start_at="1999-07-01 "+e.start_at+":00");try{await $().post(`${this.$heap.state.hostname}Admin/Mailing/itemUpdate`,JSON.stringify(e)),this.$flash("💾 сохранено"),this.itemGet()}catch{this.$flash("Ошибка сохранения")}},async itemDelete(){if(!confirm("Вы уверенны?"))return;const e={mailing_id:this.mailing.mailing_id};try{await $().post(`${this.$heap.state.hostname}Admin/Mailing/itemDelete`,e),this.$go({name:"MailingList"})}catch{}},itemValidate(){if(this.mailing.start_at)if(0!=this.mailing.regular_group||this.mailing.user_filter.phones)if(this.mailing.subject_template){if(!this.mailing.text_template)return this.$refs.text_template.$el.classList.add("ion-invalid"),void alert("Содержание не заполнено");if(this.mailing.transport)return!0;alert("Транспорт не заполнен")}else alert("Заголовок не заполнен");else alert("Получатели не заполнены");else alert("Начало рассылки не заполнено")},async itemStart(){if(!this.itemValidate()||!confirm(`Запустить рассылку в ${this.mailing.start_at}?`))return;const e={mailing_id:this.mailing.mailing_id};try{await $().post(`${this.$heap.state.hostname}Admin/Mailing/itemStart`,e),this.itemGet()}catch{}},async modalLocationCreate(){if(!this.$heap.state.user.user_id)return this.$flash("Чтобы добавленные адреса сохранились, пожалуйста войдите в систему"),void this.$go({name:"UserSignIn"});var e="рабочий";const t=await I.OZ.create({component:V.A,showBackdrop:!0,backdropDismiss:!0,componentProps:{location_group_name_low:e}});await t.present();const l=await t.onDidDismiss();l&&(this.mailing.user_filter.location=l.data,this.recieverListCreate())},async locationDelete(e){try{this.mailing.user_filter.location=null,this.recieverListCreate()}catch{this.$flash("Удалить адрес не удалось")}},async recieverListCreate(){try{const e={mailing_id:this.mailing.mailing_id};await this.itemUpdate();const t=await $().post(this.$heap.state.hostname+"Admin/Mailing/recieverListCreate",e);this.$flash(`В список получателей добавлено ${t} запись`),this.itemGet(this.mailing.mailing_id)}catch{this.$flash("Создать список получателей не удалось")}}},ionViewDidEnter(){this.itemGet()}},O=l(6262);const A=(0,O.A)(L,[["render",x],["__scopeId","data-v-2344ef84"]]);var X=A}}]);
//# sourceMappingURL=1586.e4838478.js.map