"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[7843],{7843:function(e,o,n){n.r(o),n.d(o,{default:function(){return L}});var l=n(6252),s=n(3577),t=n(9963);const u=(0,l.Uk)(" Вы уже вошли в систему с номером телефона "),a={novalidate:""},r={style:{display:"grid","grid-template-columns":"100px auto"}},p=(0,l.Uk)("Код"),i=(0,l.Uk)("+7 "),d=(0,l.Uk)("Мобильный телефон*"),_={"padding-left":""},h={"padding-left":""},c=(0,l.Uk)("Пароль (Минимум 4 символа)*"),m={"padding-left":""},f=(0,l.Uk)("Войти"),w=(0,l.Uk)("Зарегистрироваться"),k=(0,l.Uk)("Забыли пароль?");function W(e,o,n,W,g,I){const v=(0,l.up)("ion-card-title"),b=(0,l.up)("ion-card-header"),y=(0,l.up)("ion-card-content"),x=(0,l.up)("ion-card"),$=(0,l.up)("ion-label"),V=(0,l.up)("ion-select-option"),U=(0,l.up)("ion-select"),C=(0,l.up)("ion-input"),S=(0,l.up)("ion-text"),D=(0,l.up)("ion-item"),F=(0,l.up)("ion-list"),O=(0,l.up)("ion-button"),Z=(0,l.up)("ion-col"),q=(0,l.up)("ion-row"),z=(0,l.up)("ion-grid"),M=(0,l.up)("base-layout");return(0,l.wg)(),(0,l.j4)(M,{"page-title":"Вход в систему",pageDefaultBackLink:"/user"},{default:(0,l.w5)((()=>[e.$heap.state.user.user_id>0?((0,l.wg)(),(0,l.j4)(x,{key:0,style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(e.$heap.state.user.user_name)+" "+(0,s.zw)(e.$heap.state.user.user_surname)+" "+(0,s.zw)(e.$heap.state.user.user_middlename),1)])),_:1})])),_:1}),(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[u,(0,l._)("b",null,(0,s.zw)(e.$heap.state.user.user_phone),1)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l._)("form",a,[(0,l.Wm)(F,null,{default:(0,l.w5)((()=>[(0,l.Wm)(D,{lines:"full"},{default:(0,l.w5)((()=>[(0,l._)("div",r,[(0,l._)("div",null,[(0,l.Wm)($,{position:"stacked"},{default:(0,l.w5)((()=>[p])),_:1}),(0,l.Wm)(U,{value:g.user_phone_prefix},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{value:"7",selected:""},{default:(0,l.w5)((()=>[i])),_:1})])),_:1},8,["value"])]),(0,l._)("div",null,[(0,l.Wm)($,{position:"stacked"},{default:(0,l.w5)((()=>[d])),_:1}),(0,l.Wm)(C,{modelValue:g.user_phone,"onUpdate:modelValue":o[0]||(o[0]=e=>g.user_phone=e),onIonChange:o[1]||(o[1]=e=>I.phoneFormat()),name:"phone",type:"tel",inputmode:"tel",placeholder:"(xxx)xxxxxxxxx",required:""},null,8,["modelValue"]),(0,l.Wm)(S,{color:"danger",slot:"helper"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("p",_,"Неверный номер телефона",512),[[t.F8,!I.phoneValid&&1==g.submitted]])])),_:1})])]),(0,l.Wm)(S,{color:"danger",slot:"helper"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("p",h,"Неверный номер телефона",512),[[t.F8,!I.phoneValid&&1==g.submitted]])])),_:1})])),_:1}),(0,l.Wm)(D,{lines:"full"},{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked"},{default:(0,l.w5)((()=>[c])),_:1}),(0,l.Wm)(C,{modelValue:g.user_pass,"onUpdate:modelValue":o[2]||(o[2]=e=>g.user_pass=e),name:"password",type:"password",autocorrect:"off",placeholder:"Пароль (Минимум 4 символа)",required:""},null,8,["modelValue"]),(0,l.Wm)(S,{color:"danger",slot:"helper"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("p",m,"Пароль должен содержать не менее 4 символов.",512),[[t.F8,!I.passwordValid&&1==g.submitted]])])),_:1})])),_:1})])),_:1}),(0,l.Wm)(z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(q,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(O,{onClick:I.onSubmit,expand:"block"},{default:(0,l.w5)((()=>[f])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,l.Wm)(q,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(O,{color:"light",expand:"block",onClick:o[3]||(o[3]=o=>e.$router.push({path:"/user/sign-up"}))},{default:(0,l.w5)((()=>[w])),_:1})])),_:1})])),_:1}),(0,l.Wm)(q,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(O,{onClick:I.openModal,color:"light",expand:"block"},{default:(0,l.w5)((()=>[k])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1})}var g=n(8534),I=(n(4916),n(5306),n(8862),n(8292));const v=(0,l.Uk)("Напоминание пароля"),b={novalidate:""},y=(0,l.Uk)("Номер телефона"),x=(0,l.Uk)("Имя пользователя"),$=(0,l.Uk)("Выслать пароль");function V(e,o,n,s,t,u){const a=(0,l.up)("ion-title"),r=(0,l.up)("ion-icon"),p=(0,l.up)("ion-toolbar"),i=(0,l.up)("ion-header"),d=(0,l.up)("ion-label"),_=(0,l.up)("ion-input"),h=(0,l.up)("ion-item"),c=(0,l.up)("ion-list"),m=(0,l.up)("ion-button"),f=(0,l.up)("ion-content");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(i,null,{default:(0,l.w5)((()=>[(0,l.Wm)(p,{color:"secondary"},{default:(0,l.w5)((()=>[(0,l.Wm)(a,null,{default:(0,l.w5)((()=>[v])),_:1}),(0,l.Wm)(r,{slot:"end",onClick:o[0]||(o[0]=e=>{u.closeModal()}),icon:s.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l._)("form",b,[(0,l.Wm)(c,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[y])),_:1}),(0,l.Wm)(_,{modelValue:t.userphone,"onUpdate:modelValue":o[1]||(o[1]=e=>t.userphone=e),placeholder:"Ваш телефон"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[x])),_:1}),(0,l.Wm)(_,{modelValue:t.username,"onUpdate:modelValue":o[2]||(o[2]=e=>t.username=e),placeholder:"Введите имя пользователя..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(m,{onClick:o[3]||(o[3]=e=>u.passwordReset()),expand:"full"},{default:(0,l.w5)((()=>[$])),_:1})])])),_:1})],64)}var U=n(8903),C=n(9755),S=n.n(C),D={components:{IonContent:I.W2,IonHeader:I.Gu,IonTitle:I.wd,IonToolbar:I.sr,IonList:I.q_,IonItem:I.Ie,IonInput:I.pK,IonButton:I.YG,IonIcon:I.gu,IonLabel:I.Q$},props:["phone"],setup(){return{closeOutline:U.fID}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return I.Fy.dismiss()},passwordReset(){var e=this;return(0,g.Z)((function*(){let o={user_phone:"+"+e.userphone.replace(/\D/g,""),user_name:e.username};try{yield S().post(`${e.$heap.state.hostname}User/passwordReset`,o),e.$flash(`Ваш новый пароль выслан на номер '${e.userphone}'`)}catch(s){var n,l;const o=null===s||void 0===s||null===(n=s.responseJSON)||void 0===n||null===(l=n.messages)||void 0===l?void 0:l.error;"user_notfound"==o?e.$flash(`Пользователь с телефоном '${e.userphone}' и именем '${e.username}' не найден`):e.$flash("Не удалось восстановить пароль")}e.closeModal()}))()}}},F=n(3744);const O=(0,F.Z)(D,[["render",V]]);var Z=O,q=n(351),z=n(422),M={components:{IonLabel:I.Q$,IonSelectOption:I.n0,IonSelect:I.t9,IonCol:I.wI,IonInput:I.pK,IonRow:I.Nd,IonText:I.yW,IonButton:I.YG,IonGrid:I.jY,IonCard:I.PM,IonCardHeader:I.Zi,IonCardTitle:I.Dq,IonCardContent:I.FN,IonList:I.q_,IonItem:I.Ie},data(){return{submitted:!1,user_pass:null,user_phone:null,user_phone_prefix:"7",modalOpen:!1}},computed:{phoneValid(){var e;return 10==(null===(e=this.user_phone)||void 0===e?void 0:e.replace(/\D/g,"").length)},passwordValid(){var e;return(null===(e=this.user_pass)||void 0===e?void 0:e.length)>=4}},created(){var e;const o=JSON.parse(null!==(e=localStorage.signInData)&&void 0!==e?e:"{}");o&&o.user_phone&&(this.user_phone=o.user_phone,this.phoneFormat()),o&&o.user_pass&&(this.user_pass=o.user_pass)},methods:{onSubmit(){var e=this;return(0,g.Z)((function*(){if(e.submitted=!0,!e.phoneValid||!e.passwordValid)return!1;let o={user_phone:e.user_phone_prefix+e.user_phone,user_pass:e.user_pass,user_pass_confirm:e.user_pass};try{yield q.Z.signIn(o),yield q.Z.get(),z.Z.go(-1)}catch(n){const o=n.responseJSON,l=o.messages.error;switch(l){case"user_not_found":e.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":e.$flash("Неверный пароль");break;case"user_is_disabled":e.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":e.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":e.$flash("Номер телефона не подтвержден"),localStorage.signInData=JSON.stringify({user_phone:e.user_phone_prefix+e.user_phone,user_pass:e.user_pass}),e.phoneVerify();break;default:e.$flash("Не удалось войти в систему")}}}))()},phoneFormat(){this.user_phone||(this.user_phone="");try{let e=this.user_phone.replace(/\D/g,"");e.length>10&&(e=e.substring(e.length-10)),this.user_phone=e}catch(e){}},openModal(){var e=this;return(0,g.Z)((function*(){var o,n;e.modalOpen=!0;const l=null!==(o=null!==(n=e.user_phone_prefix)&&void 0!==n?n:""+e.user_phone)&&void 0!==o?o:"",s=yield I.Fy.create({component:Z,componentProps:{phone:l},initialBreakpoint:.5,breakpoints:[.5,.75]});return s.present()}))()},phoneVerify(){let e={user_phone:this.user_phone_prefix+this.user_phone};try{this.$router.push({name:"UserVerifyPhone",query:e})}catch(o){this.$flash("Не удалось выслать смс с подтверждением")}}}};const N=(0,F.Z)(M,[["render",W],["__scopeId","data-v-738a0954"]]);var L=N}}]);
//# sourceMappingURL=7843-legacy.a9d0b31d.js.map