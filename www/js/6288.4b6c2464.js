"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[6288],{6288:function(e,t,s){s.r(t),s.d(t,{default:function(){return I}});var a=s(641),l=s(33);const o={key:0},i=["href"],n={key:1};function d(e,t,s,d,r,u){var m,p;const _=(0,a.g2)("ion-text"),h=(0,a.g2)("ion-card-content"),c=(0,a.g2)("ion-card"),b=(0,a.g2)("ion-icon"),k=(0,a.g2)("ion-toggle"),I=(0,a.g2)("ion-item"),f=(0,a.g2)("ion-list"),g=(0,a.g2)("ion-label"),F=(0,a.g2)("ion-item-divider"),y=(0,a.g2)("ion-radio"),v=(0,a.g2)("ion-radio-group"),P=(0,a.g2)("image-tile-comp"),V=(0,a.g2)("ion-button"),C=(0,a.g2)("ion-input"),O=(0,a.g2)("ion-textarea"),W=(0,a.g2)("ion-item-group"),$=(0,a.g2)("base-layout");return(0,a.uX)(),(0,a.Wv)($,{"page-title":null!==(m=null===(p=r.postItem)||void 0===p?void 0:p.post_title)&&void 0!==m?m:"Пост"},{default:(0,a.k6)((()=>[r.postItem?((0,a.uX)(),(0,a.CE)("div",o,[(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(h,{class:(0,l.C4)(u.messageClass)},{default:(0,a.k6)((()=>[(0,a.bF)(_,{color:"dark"},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(u.message),1)])),_:1})])),_:1},8,["class"])])),_:1}),(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{src:e.checkmark,color:"primary",slot:"start"},null,8,["src"]),(0,a.bF)(k,{modelValue:e.is_published,"onUpdate:modelValue":t[0]||(t[0]=t=>e.is_published=t),onIonChange:t[1]||(t[1]=t=>e.itemPublish(t.target.checked?1:0))},{default:(0,a.k6)((()=>[(0,a.eW)("Опубликован")])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{src:d.trashOutline,color:"primary",slot:"start"},null,8,["src"]),(0,a.bF)(k,{modelValue:r.is_deleted,"onUpdate:modelValue":t[2]||(t[2]=e=>r.is_deleted=e),color:"danger",onIonChange:t[3]||(t[3]=e=>u.itemDelete(e.target.checked?1:0))},{default:(0,a.k6)((()=>[(0,a.eW)("Удален")])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{src:d.ribbonOutline,color:"primary",slot:"start"},null,8,["src"]),(0,a.bF)(k,{modelValue:r.is_promoted,"onUpdate:modelValue":t[4]||(t[4]=e=>r.is_promoted=e),onIonChange:t[5]||(t[5]=e=>u.save("is_promoted",r.is_promoted))},{default:(0,a.k6)((()=>[(0,a.eW)("Приоритет")])),_:1},8,["modelValue"])])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{src:d.ribbonOutline,color:"primary",slot:"start"},null,8,["src"]),(0,a.bF)(k,{modelValue:r.is_disabled,"onUpdate:modelValue":t[6]||(t[6]=e=>r.is_disabled=e),onIonChange:t[7]||(t[7]=e=>u.itemDisable(e.target.checked?1:0))},{default:(0,a.k6)((()=>[(0,a.eW)("На модерации")])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,a.Lk)("form",{onChange:t[20]||(t[20]=(...e)=>u.saveForm&&u.saveForm(...e))},[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Тип поста")])),_:1})])),_:1}),(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.bF)(v,{modelValue:r.postItem.post_type,"onUpdate:modelValue":t[9]||(t[9]=e=>r.postItem.post_type=e),onIonChange:u.saveForm,name:"post_type"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.postTypes,(e=>((0,a.uX)(),(0,a.Wv)(I,{key:e.post_type,onClick:t[8]||(t[8]=e=>u.itemImageParamsSet())},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(e.post_type_name)+" ",1),(0,a.bF)(y,{color:"primary",slot:"end",value:e.post_type,disabled:!!r.postItem.post_type},null,8,["value","disabled"])])),_:2},1024)))),128))])),_:1},8,["modelValue","onIonChange"])])),_:1}),r.imageParams?((0,a.uX)(),(0,a.Wv)(f,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Изображения")])),_:1})])),_:1}),(0,a.bF)(P,{images:r.postItem.images,image_holder_id:r.postItem.post_id,params:r.imageParams,title:"Фото поста",controller:"Post",ref:"postImgs"},null,8,["images","image_holder_id","params"]),(0,a.bF)(V,{onClick:t[10]||(t[10]=t=>e.$refs.postImgs.take_photo()),color:"light",expand:"block"},{default:(0,a.k6)((()=>[(0,a.bF)(b,{src:d.cameraOutline,slot:"start"},null,8,["src"]),(0,a.eW)(" Добавить фото в пост ")])),_:1})])),_:1})):(0,a.Q3)("",!0),r.imageParams?((0,a.uX)(),(0,a.Wv)(f,{key:1},{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Автор")])),_:1})])),_:1}),r.pickedStore?((0,a.uX)(),(0,a.Wv)(I,{key:0,button:""},{default:(0,a.k6)((()=>[(0,a.bF)(b,{onClick:t[11]||(t[11]=e=>u.storePick()),slot:"start",src:d.storefrontOutline},null,8,["src"]),(0,a.bF)(g,{onClick:t[12]||(t[12]=e=>u.storePick())},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(r.pickedStore.store_name),1)])),_:1}),(0,a.bF)(b,{slot:"end",src:d.trashOutline,onClick:t[13]||(t[13]=e=>u.storeReset())},null,8,["src"])])),_:1})):((0,a.uX)(),(0,a.Wv)(I,{key:1,button:"",onClick:t[14]||(t[14]=e=>u.storePick())},{default:(0,a.k6)((()=>[(0,a.bF)(b,{slot:"start",src:d.addOutline},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Добавить автора")])),_:1})])),_:1}))])),_:1})):(0,a.Q3)("",!0),r.imageParams?((0,a.uX)(),(0,a.Wv)(f,{key:2,lines:"full"},{default:(0,a.k6)((()=>[(0,a.bF)(W,null,{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Основные настройки")])),_:1})])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(C,{modelValue:r.postItem.post_title,"onUpdate:modelValue":t[15]||(t[15]=e=>r.postItem.post_title=e),label:"Заголовок*",labelPlacement:"stacked",name:"post_title",placeholder:"заголовок",clearInput:"true"},null,8,["modelValue"])])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(O,{modelValue:r.postItem.post_content,"onUpdate:modelValue":t[16]||(t[16]=e=>r.postItem.post_content=e),label:"Содержание*",labelPlacement:"stacked",name:"post_content",rows:"6",placeholder:"текст"},null,8,["modelValue"])])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(C,{modelValue:r.postItem.post_route,"onUpdate:modelValue":t[17]||(t[17]=e=>r.postItem.post_route=e),label:"Ссылка*",labelPlacement:"stacked",name:"post_route",placeholder:"ссылка",clearInput:"true"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})):(0,a.Q3)("",!0),r.imageParams?((0,a.uX)(),(0,a.Wv)(f,{key:3,lines:"full"},{default:(0,a.k6)((()=>[(0,a.bF)(W,null,{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,null,{default:(0,a.k6)((()=>[(0,a.eW)("Время действия")])),_:1})])),_:1})])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(C,{type:"date",modelValue:r.postItem.started_at,"onUpdate:modelValue":t[18]||(t[18]=e=>r.postItem.started_at=e),label:"Начало показа",labelPlacement:"stacked",name:"started_at"},null,8,["modelValue"])])),_:1}),(0,a.bF)(I,null,{default:(0,a.k6)((()=>[(0,a.bF)(C,{type:"date",modelValue:r.postItem.finished_at,"onUpdate:modelValue":t[19]||(t[19]=e=>r.postItem.finished_at=e),label:"Конец показа",labelPlacement:"stacked",name:"finished_at"},null,8,["modelValue"])])),_:1})])),_:1})):(0,a.Q3)("",!0)],32),r.postItem&&r.postItem.updated_user?((0,a.uX)(),(0,a.Wv)(f,{key:0},{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(g)])),_:1}),(0,a.bF)(I,{lines:"none"},{default:(0,a.k6)((()=>[(0,a.eW)(" Изменен "+(0,l.v_)(r.postItem.updated_at)+" ",1),(0,a.Lk)("a",{slot:"end",href:`tel:+${r.postItem.updated_user.user_phone}`},(0,l.v_)(r.postItem.updated_user.user_name),9,i)])),_:1})])),_:1})):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.CE)("div",n," loading "))])),_:1},8,["page-title"])}var r=s(5654),u=s(5480),m=s(2431),p=s(2311),_=s.n(p),h=s(454),c={components:{IonInput:r.$w,IonTextarea:r.nc,IonCard:r.b_,IonCardContent:r.I9,IonToggle:r.BY,IonIcon:r.iq,IonItem:r.uz,IonList:r.nf,IonLabel:r.he,IonItemDivider:r.Dg,IonItemGroup:r.jh,IonButton:r.Jm,IonText:r.IO,imageTileComp:m.A,IonRadio:r.KO,IonRadioGroup:r.f0},setup(){return{cameraOutline:u.GOB,trashOutline:u.P1A,banOutline:u.Av6,personOutline:u.wAZ,addOutline:u.EKF,calculatorOutline:u.N0h,compassOutline:u.Hy9,chevronBack:u.fcl,layersOutline:u.z8i,ribbonOutline:u.rp8,eyeOffOutline:u.f_X,storefrontOutline:u.te8}},data(){return{postId:this.$route.params.id,postItem:null,imageParams:null,pickedStore:null,postTypes:[{post_type:"slide",post_type_name:"Слайд 1920x700",image_height:700,image_width:1920},{post_type:"story",post_type_name:"История 1500x3200",image_height:3200,image_width:1500}],is_deleted:0,is_disabled:0,is_promoted:0}},computed:{messageCardSeverity(){var e,t;return(null===(e=this.postItem)||void 0===e?void 0:e.validity)<50?"danger":(null===(t=this.postItem)||void 0===t?void 0:t.validity)<this.validity_min?"warning":"primary"},message(){return this.postItem?this.postItem.deleted_at?"Пост не активен и будет удален. Вы еще можете отменить удаление":1==this.postItem.is_disabled?"Пост не активен и находится на рассмотрении у администратора":1==this.postItem.is_hidden?"Пост скрыт со стены.":"Пост активен":""},messageClass(){var e,t;return this.postItem?null!==(e=this.postItem)&&void 0!==e&&e.deleted_at?"pdeleted":1==(null===(t=this.postItem)||void 0===t?void 0:t.is_disabled)?"pdisabled":"pactive":""}},created(){this.itemGet()},methods:{async itemGet(){try{if(0==this.postId)return void await this.itemCreate();let e=await _().post(`${this.$heap.state.hostname}Post/itemGet`,{post_id:this.postId});this.postItem=this.itemPrepare(e),this.itemParseFlags(),this.itemImageParamsSet(),"store"==e.post_holder?this.pickedStore=e.holder:this.pickedStore=null}catch(e){}},itemImageParamsSet(){this.imageParams={post_type:this.postType}},itemPrepare(e){return e.started_at&&(e.started_at=e.started_at.split(" ")[0]),e.finished_at&&(e.finished_at=e.finished_at.split(" ")[0]),e},itemParseFlags(){this.is_deleted=null==this.postItem.deleted_at?0:1,this.is_disabled=0==this.postItem.is_disabled?0:1,this.is_promoted=0==this.postItem.is_promoted?0:1},async itemCreate(){const e={post_title:""};try{const t=await _().post(`${this.$heap.state.hostname}Post/itemCreate`,e);t&&this.$router.replace(`/wall/post-edit-${t}`)}catch{}},async itemDelete(e){const t=e?"itemDelete":"itemUnDelete";try{await _().post(`${this.$heap.state.hostname}Post/${t}`,{post_id:this.postId}),this.postItem.deleted_at=e?1:null}catch{this.itemGet()}},async itemDisable(e){if(this.postItem.is_disabled!=e)try{await _().post(`${this.$heap.state.hostname}Post/itemDisable`,{post_id:this.postId,is_disabled:e}),this.postItem.is_disabled=e}catch{this.$flash("Изменение не сохранено"),this.itemGet()}},async itemUpdate(e){try{return await _().post(`${this.$heap.state.hostname}Post/itemUpdate`,JSON.stringify(e)),this.$flash("💾 сохранено"),!0}catch(t){const e=t.responseJSON.messages.error;return null!==e&&void 0!==e&&e.includes("post_content")?this.$flash("Описание слишком короткое"):null!==e&&void 0!==e&&e.includes("post_title")?this.$flash("Заголовок слишком короткий"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},saveForm(e){const t=e.target.name,s=this.postItem[t]=e.target.value;this.save(t,s)},async save(e,t){if(!this.postItem.post_id)return;let s={post_id:this.postItem.post_id,[e]:t};this.itemUpdate(s)&&(this.postItem[e]=t,this.itemParseFlags())},async storePick(){const e=await r.OZ.create({component:h.A,componentProps:{itemType:"store"},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});e.present(),this.$topic.on("dismissModal",(()=>{e.dismiss()}));const t=await e.onDidDismiss();if(!t.data)return;const s={post_id:this.postItem.post_id,post_holder:"store",post_holder_id:t.data.store_id};await this.itemUpdate(s),await this.itemGet()},async storeReset(){const e={post_id:this.postItem.post_id,post_holder:"",post_holder_id:0};await this.itemUpdate(e),await this.itemGet()}}},b=s(6262);const k=(0,b.A)(c,[["render",d],["__scopeId","data-v-7004cdb5"]]);var I=k}}]);
//# sourceMappingURL=6288.4b6c2464.js.map