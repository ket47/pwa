"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[4918],{5730:function(t,e,o){o.d(e,{A:function(){return _}});var i=o(641),n=o(33);const a={style:{position:"absolute",bottom:"20px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},s={slot:"end",style:{color:"#666"}},l={style:{width:"100%"}};function c(t,e,o,c,r,d){const u=(0,i.g2)("ymap-marker"),h=(0,i.g2)("yandex-map"),p=(0,i.g2)("ion-item"),m=(0,i.g2)("ion-searchbar"),g=(0,i.g2)("ion-content"),_=(0,i.g2)("ion-img"),k=(0,i.g2)("ion-label"),f=(0,i.g2)("ion-segment-button"),b=(0,i.g2)("ion-segment"),y=(0,i.g2)("ion-textarea"),v=(0,i.g2)("ion-icon"),x=(0,i.g2)("ion-button"),F=(0,i.g2)("ion-toolbar");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(g,null,{default:(0,i.k6)((()=>[r.showed?((0,i.uX)(),(0,i.Wv)(h,{key:0,onClick:e[0]||(e[0]=t=>{d.onClick(t)}),style:{height:"100%"},coords:r.coords,zoom:16,settings:r.settings,controls:["zoomControl"]},{default:(0,i.k6)((()=>[(0,i.bF)(u,{coords:r.coords,"marker-id":"1",properties:d.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"])):(0,i.Q3)("",!0),(0,i.Lk)("div",a,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.suggestions,((t,e)=>((0,i.uX)(),(0,i.Wv)(p,{key:e,onClick:e=>d.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,i.k6)((()=>[(0,i.eW)((0,n.v_)(t.subtitle.text)+" "+(0,n.v_)(t.title.text)+" ",1),(0,i.Lk)("span",s,(0,n.v_)(t.distance.text),1)])),_:2},1032,["onClick"])))),128)),(0,i.bF)(m,{debounce:"500",modelValue:r.addressSearchQuery,"onUpdate:modelValue":e[1]||(e[1]=t=>r.addressSearchQuery=t),onIonInput:e[2]||(e[2]=t=>d.suggestionsGet()),placeholder:"поиск по адресу",class:"search"},null,8,["modelValue"])])])),_:1}),(0,i.bF)(F,{style:{"--background":"white"}},{default:(0,i.k6)((()=>[(0,i.Lk)("div",l,[(0,i.bF)(b,{mode:"ios",modelValue:r.locationGroup,"onUpdate:modelValue":e[3]||(e[3]=t=>r.locationGroup=t)},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.locationGroupList,(e=>((0,i.uX)(),(0,i.Wv)(f,{key:e.group_id,value:e},{default:(0,i.k6)((()=>[(0,i.bF)(_,{src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,n.v_)(e.group_name),1)])),_:2},1024)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"]),(0,i.bF)(y,{label:"комментарий к адресу","label-placement":"floating",modelValue:r.addressComment,"onUpdate:modelValue":e[4]||(e[4]=t=>r.addressComment=t)},null,8,["modelValue"]),(0,i.bF)(x,{strong:!0,onClick:e[5]||(e[5]=t=>d.pickAddress()),color:"primary",expand:"block"},{default:(0,i.k6)((()=>[(0,i.bF)(v,{src:c.checkmark,slot:"start"},null,8,["src"]),(0,i.eW)(" Ок ")])),_:1}),(0,i.bF)(x,{onClick:e[6]||(e[6]=t=>c.closeModal()),color:"light",expand:"block"},{default:(0,i.k6)((()=>[(0,i.eW)("Закрыть")])),_:1})])])),_:1})],64)}o(4114);var r=o(5654),d=o(5221),u=o(5480),h=o(8701),p={components:{IonContent:r.W9,IonToolbar:r.ai,IonButton:r.Jm,IonSearchbar:r.S1,IonIcon:r.iq,IonItem:r.uz,IonTextarea:r.nc,IonSegment:r.Gp,IonSegmentButton:r.eP,IonImg:r.KW,IonLabel:r.he,yandexMap:d.IK,ymapMarker:d.cT},setup(){const t=function(){r.OZ.dismiss()};return{closeModal:t,locationOutline:u.UN$,closeOutline:u.xfX,checkmark:u.AIp}},props:{location_group_name_low:String,locationGroupList:Array},data(){let t=this.$heap.state.settings.location,e=JSON.parse(t.mapCenter);return{settings:{apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationGroup:this.locationGroupList[0],locSettings:t,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:e,addressComment:"",showed:1}},computed:{locationType(){return this.locationGroup.group_name+" адрес"},placemarkProperties(){return{iconCaption:this.locationType}}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t,e;null!==(t=this.suggestions[0])&&void 0!==t&&t&&this.suggestionSelect(this.suggestions[0].title.text,this.suggestions[0].uri);const o=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(e=o.geoObjects.get(0))||void 0===e?void 0:e.getAddressLine()}}catch(i){console.log(i)}var o={location_group_id:this.locationGroup.group_id,location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};r.OZ.dismiss(o)},filterAddress(t){const e=this.locSettings.addressErase.split(", "),o=t.split(", ");let i=[];for(const n of o)e.find((t=>t==n))||i.push(n);return i.reverse().join(", ")},onClick(t){t&&t.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,e=this.coords.slice().reverse().join(","),o=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${e}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),i=await o.json();this.suggestions=i.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(t,e){this.selectedAddress=t,this.addressSearchQuery=t,this.geocode(e)},async geocode(t){try{this.suggestions=[];const e=this.$heap.state.settings.location.ymapApiKey,o=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${e}&format=json&results=1&uri=${t}`),i=await o.json(),n=i.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=n.Point.pos.split(" ").reverse()}catch(e){console.log(e)}}},async mounted(){this.showed=0,setTimeout((async()=>{await(0,d.wc)(),this.showed=1,document.querySelectorAll(".search input")[0].focus();const t=h.A.geo.lastStoredGet();null!==t&&void 0!==t&&t.location_latitude&&(this.coords=[t.location_latitude,t.location_longitude]);const e=await h.A.geo.get();if(this.markDeviceOnMap&&e){const{coords:t}=e;this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}}),100)}},m=o(6262);const g=(0,m.A)(p,[["render",c],["__scopeId","data-v-496ef34c"]]);var _=g},4918:function(t,e,o){o.r(e),o.d(e,{default:function(){return v}});var i=o(641),n=o(33);const a=t=>((0,i.Qi)("data-v-3f2b1c88"),t=t(),(0,i.jt)(),t),s={style:{color:"var(--ion-color-primary)"}},l=a((()=>(0,i.Lk)("p",null,"Нам нужно знать куда привезти ваш заказ",-1))),c={class:"ion-padding"};function r(t,e,o,a,r,d){const u=(0,i.g2)("ion-skeleton-text"),h=(0,i.g2)("ion-card-title"),p=(0,i.g2)("ion-card-header"),m=(0,i.g2)("ion-card-content"),g=(0,i.g2)("ion-card"),_=(0,i.g2)("ion-item"),k=(0,i.g2)("ion-icon"),f=(0,i.g2)("ion-label"),b=(0,i.g2)("ion-chip"),y=(0,i.g2)("ion-list"),v=(0,i.g2)("ion-img"),x=(0,i.g2)("ion-button"),F=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(F,{"page-title":"Мои адреса",ref:"UserAddressPage"},{default:(0,i.k6)((()=>[null==r.locationList?((0,i.uX)(),(0,i.Wv)(g,{key:0},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.bF)(h,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,{animated:"",style:{width:"190px",height:"30px"}})])),_:1})])),_:1}),(0,i.bF)(m,null,{default:(0,i.k6)((()=>[(0,i.Lk)("p",null,[(0,i.bF)(u,{animated:"",style:{width:"250px"}}),(0,i.eW)(),(0,i.bF)(u,{animated:""})])])),_:1})])),_:1})):d.mainAddress?((0,i.uX)(),(0,i.Wv)(g,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.bF)(h,null,{default:(0,i.k6)((()=>[(0,i.eW)(" Адрес доставки ")])),_:1})])),_:1}),(0,i.bF)(m,null,{default:(0,i.k6)((()=>[(0,i.Lk)("p",null,[(0,i.Lk)("b",s,(0,n.v_)(d.mainAddress.location_address),1),(0,i.eW)(", выбран как адрес доставки заказов.")])])),_:1})])),_:1})):((0,i.uX)(),(0,i.Wv)(g,{key:2},{default:(0,i.k6)((()=>[(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.bF)(h,null,{default:(0,i.k6)((()=>[(0,i.eW)(" Добавьте адрес ")])),_:1})])),_:1}),(0,i.bF)(m,null,{default:(0,i.k6)((()=>[l])),_:1})])),_:1})),null==r.locationList?((0,i.uX)(),(0,i.Wv)(y,{key:3,lines:"none"},{default:(0,i.k6)((()=>[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([1,2,3],(t=>(0,i.Lk)("div",{key:t,style:{padding:"5px"}},[(0,i.bF)(_,{button:"",detail:""},{default:(0,i.k6)((()=>[(0,i.bF)(u,{slot:"start",style:{height:"30px",width:"30px"},animated:""}),(0,i.bF)(u,{animated:""})])),_:1}),1==t?((0,i.uX)(),(0,i.Wv)(_,{key:0,lines:"full"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[(0,i.bF)(b,{color:"medium"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{src:a.addOutline},null,8,["src"]),(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,{style:{width:"70px"},animated:""})])),_:1})])),_:1}),(0,i.bF)(b,{color:"medium"},{default:(0,i.k6)((()=>[(0,i.bF)(k,{src:a.addOutline},null,8,["src"]),(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,{style:{width:"70px"},animated:""})])),_:1})])),_:1})]),(0,i.bF)(u,{slot:"end",style:{height:"30px",width:"30px","border-radius":"40px"},animated:""})])),_:1})):(0,i.Q3)("",!0)]))),64))])),_:1})):r.locationList.length?((0,i.uX)(),(0,i.Wv)(y,{key:4,lines:"none"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.locationList,((o,s)=>((0,i.uX)(),(0,i.CE)("div",{key:o.location_id},[(0,i.bF)(_,{button:"",detail:"",onClick:t=>d.locationSetMain(`${o.location_id}`,`${s}`)},{default:(0,i.k6)((()=>[(0,i.bF)(v,{slot:"start",alt:"",src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.bF)(f,{style:{"white-space":"normal",cursor:"pointer"},class:(0,n.C4)(1==o.is_main?"is_main":"")},{default:(0,i.k6)((()=>[(0,i.eW)((0,n.v_)(o.location_address),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"]),1==o.is_main?((0,i.uX)(),(0,i.Wv)(_,{key:0,lines:"full"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[o.location_comment?((0,i.uX)(),(0,i.CE)("div",{key:0,onClick:e[0]||(e[0]=t=>d.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"15px",display:"inline-block"}},(0,n.v_)(o.location_comment),1)):((0,i.uX)(),(0,i.Wv)(b,{key:1,color:"medium",onClick:e[1]||(e[1]=t=>d.locationCommentEdit("locationStart"))},{default:(0,i.k6)((()=>[(0,i.bF)(k,{src:a.addOutline},null,8,["src"]),(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.eW)("комментарий")])),_:1})])),_:1})),o.location_phone>0?((0,i.uX)(),(0,i.Wv)(b,{key:2,color:"medium",onClick:e[2]||(e[2]=t=>d.locationPhoneEdit("locationStart"))},{default:(0,i.k6)((()=>[(0,i.bF)(k,{src:a.callOutline},null,8,["src"]),(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.eW)("+"+(0,n.v_)(o.location_phone),1)])),_:2},1024)])),_:2},1024)):((0,i.uX)(),(0,i.Wv)(b,{key:3,color:"medium",onClick:e[3]||(e[3]=t=>d.locationPhoneEdit("locationStart"))},{default:(0,i.k6)((()=>[(0,i.bF)(k,{src:a.addOutline},null,8,["src"]),(0,i.bF)(f,null,{default:(0,i.k6)((()=>[(0,i.eW)("телефон")])),_:1})])),_:1}))]),(0,i.bF)(k,{slot:"end",icon:a.trashOutline,onClick:t=>d.locationDelete(`${o.location_id}`,`${s}`),color:"medium"},null,8,["icon","onClick"])])),_:2},1024)):(0,i.Q3)("",!0)])))),128))])),_:1})):(0,i.Q3)("",!0),(0,i.Lk)("div",c,[(0,i.bF)(x,{expand:"block",onClick:e[4]||(e[4]=t=>d.modalLocationCreate())},{default:(0,i.k6)((()=>[(0,i.bF)(k,{src:a.locationOutline,slot:"start"},null,8,["src"]),(0,i.eW)(" Добавить адрес")])),_:1}),(0,i.bF)(x,{onClick:e[5]||(e[5]=e=>t.$router.go(-1)),color:"light",expand:"block"},{default:(0,i.k6)((()=>[(0,i.eW)("Назад")])),_:1})])])),_:1},512)}var d=o(5654),u=o(2355),h=o(5538),p=o(8701),m=o(2311),g=o.n(m),_=o(5730),k=o(5480),f={name:"UserAddresses",components:{IonImg:d.KW,IonLabel:d.he,IonItem:d.uz,IonList:d.nf,IonIcon:d.iq,IonCard:d.b_,IonCardHeader:d.ME,IonCardContent:d.I9,IonCardTitle:d.tN,IonChip:d.ZB,IonButton:d.Jm,IonSkeletonText:d.ds},setup(){return{locationOutline:k.UN$,trashOutline:k.P1A,addOutline:k.EKF,callOutline:k.bNN}},data(){return{locationList:null,locationGroupList:[],is_loading:0}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{async modalLocationCreate(){if(!h.A.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/modal/user-authorize"));const t=await d.OZ.create({component:_.A,showBackdrop:!0,componentProps:{locationGroupList:this.locationGroupList}});return t.onDidDismiss().then((t=>{const e=t.data;e&&this.locationCreate(e)})),t.present()},async locationListGet(){try{var t,e;let o=null;const i=await g().get(h.A.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=i.location_list||[],this.locationGroupList=i.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(o=t);if(o||this.modalLocationCreate(),!o)return void p.A.get();o&&(null===(t=o)||void 0===t?void 0:t.location_id)!=(null===(e=h.A.state.user.location_main)||void 0===e?void 0:e.location_id)&&(h.A.state.user.location_main=o,this.$topic.publish("userMainLocationSet",h.A.state.user.location_main))}catch{}},async locationCreate(t){let e={location_holder:"user",location_holder_id:h.A.state.user.user_id,location_group_id:t.location_group_id,location_address:t.location_address,location_latitude:t.location_latitude,location_longitude:t.location_longitude,location_comment:t.location_comment};try{await g().post(h.A.state.hostname+"User/locationCreate",e),this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(o){const t=o.responseJSON,e=t.messages.error;switch(e){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,e){this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null);const o=this.locationList[e];h.A.state.user.location_main={location_id:o.location_id,location_latitude:o.location_latitude,location_longitude:o.location_longitude,location_address:o.location_address,location_phone:o.location_phone,location_comment:o.location_comment,image_hash:o.image_hash},this.$topic.publish("userMainLocationSet",h.A.state.user.location_main),await g().post(h.A.state.hostname+"User/locationSetMain",{location_id:t}),this.$flash("Адрес доставки изменен"),this.locationListGet()},async locationDelete(t,e){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(e,1),await g().post(h.A.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()}},async locationCurrentSet(){const t=await d.FJ.create({message:"Определяем ваше местоположение"});t.present();try{await p.A.geo.locationCurrentGet(),this.$flash("Ваше местоположение определено")}catch(e){this.$flash("Не удалось получить ваше местоположение")}t.dismiss(),u.A.go(-1)},async locationUpdate(t){await g().post(h.A.state.hostname+"Location/itemUpdate",JSON.stringify(t)),this.$flash("Сохранено"),this.locationListGet()},async locationPhoneEdit(t){var e;let o=null!==(e=h.A.state.user.location_main.location_phone)&&void 0!==e?e:"";const i=await d.TN.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:o}]});try{await i.present();const{data:t,role:e}=await i.onDidDismiss();if("confirm"==e&&(o=t.values.phone.replace(/\D/g,"").replace(/^7/,""),o)){if(10!=o.length)return void this.$flash("Проверьте правильность телефона");o="+7"+o}"cancel"==e&&(o=""),h.A.state.user.location_main.location_phone=o;const n={location_id:h.A.state.user.location_main.location_id,location_phone:o};this.locationUpdate(n)}catch(n){console.log(n)}},async locationCommentEdit(t){var e;let o=null!==(e=h.A.state.user.location_main.location_comment)&&void 0!==e?e:"";const i=await d.TN.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:o}]});try{await i.present();const{data:t,role:e}=await i.onDidDismiss();o=t.values.comment,"cancel"==e&&(o=""),h.A.state.user.location_main.location_comment=o;const n={location_id:h.A.state.user.location_main.location_id,location_comment:o};this.locationUpdate(n)}catch(n){console.log(n)}}}},b=o(6262);const y=(0,b.A)(f,[["render",r],["__scopeId","data-v-3f2b1c88"]]);var v=y}}]);
//# sourceMappingURL=4918.e69188bc.js.map