"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[8180],{1942:function(e,t,r){r.r(t),r.d(t,{default:function(){return m}});var o=r(6252),s=r(3577);function a(e,t,r,a,i,n){const d=(0,o.up)("ship-comp"),c=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(c,{"page-title":"Вызов курьера"},{default:(0,o.w5)((()=>{var e;return[(0,o.Wm)(d,{orderData:i.order,onStageCreate:n.onStageCreate,onOrderUpdate:n.itemUpdate},null,8,["orderData","onStageCreate","onOrderUpdate"]),(0,o.Uk)(" "+(0,s.zw)(null===(e=i.order)||void 0===e?void 0:e.order_sum_delivery)+" "+(0,s.zw)(i.err),1)]})),_:1})}r(4916),r(5306),r(8862),r(7658);var i=r(4929),n=r(9755),d=r.n(n),c=r(1039),u={components:{ShipComp:c.Z,IonButton:i.YG},data(){return{order:null,err:""}},methods:{async itemCreate(){const e=new Date,t={order_store_id:null,order_id:0,entries:[],created_at:e.toISOString().replace(/[T]/g," ").replace(/.\d\d\dZ/,""),stage_next:{customer_confirmed:["Перейти к оформлению"],customer_deleted:["Удалить","danger","clear"]},stage_current:"customer_cart",user_role:"customer"};this.itemSave(t)},async itemLoad(){try{const e=JSON.parse(localStorage.shipmentDraft);if(e)return void(this.order=e)}catch(e){}this.itemCreate()},itemSave(e){this.order=e,localStorage.shipmentDraft=JSON.stringify(e)},async itemUpdate(e){this.itemSave(Object.assign({},this.order,e))},async onStageCreate(e,t){if("customer_purged"==t||"customer_deleted"==t)return localStorage.removeItem("shipmentDraft"),void this.$router.replace("/order/order-list");"customer_action_confirm"==t&&(t="customer_confirmed");try{const e={is_shopping:0,order_description:this.order.order_description,order_start_location_id:this.order.start_location_id,order_finish_location_id:this.order.finish_location_id},t=await d().post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(e));t>0&&this.$router.push(`/modal/shipment-checkout-${t}`)}catch(s){var r,o;const t=null===s||void 0===s||null===(r=s.responseJSON)||void 0===r||null===(o=r.messages)||void 0===o?void 0:o.error;if(!t)return!1;switch(t){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии ☹️","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses"),this.$heap.state.next_route="/order/order-"+e;break}return!1}}},mounted(){this.itemLoad()}},l=r(3744);const h=(0,l.Z)(u,[["render",a]]);var m=h}}]);
//# sourceMappingURL=8180-legacy.1f656736.js.map