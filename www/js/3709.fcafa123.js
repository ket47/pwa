"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[3709],{3709:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var l=i(641),a=i(33);const n=e=>((0,l.Qi)("data-v-11ba3492"),e=e(),(0,l.jt)(),e),o=n((()=>(0,l.Lk)("br",null,null,-1))),u={slot:"end"};function r(e,t,i,n,r,s){const d=(0,l.g2)("ion-icon"),c=(0,l.g2)("ion-label"),m=(0,l.g2)("ion-item"),g=(0,l.g2)("ion-list"),p=(0,l.g2)("ion-badge"),f=(0,l.g2)("ion-segment-button"),_=(0,l.g2)("ion-segment"),h=(0,l.g2)("ion-input"),v=(0,l.g2)("ion-select-option"),k=(0,l.g2)("ion-select"),b=(0,l.g2)("ion-note"),y=(0,l.g2)("ion-text"),F=(0,l.g2)("ion-chip"),W=(0,l.g2)("ion-button"),L=(0,l.g2)("ion-content"),w=(0,l.g2)("ion-popover"),C=(0,l.g2)("base-layout");return(0,l.uX)(),(0,l.Wv)(C,{pageDefaultBackLink:"/user","page-title":"Рассылка"},{default:(0,l.k6)((()=>[(0,l.bF)(g,null,{default:(0,l.k6)((()=>[(0,l.bF)(m,{button:"",onClick:t[0]||(t[0]=e=>s.itemCreate())},{default:(0,l.k6)((()=>[(0,l.bF)(d,{slot:"start",src:n.addOutline},null,8,["src"]),(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)("Добавить Рассылку")])),_:1})])),_:1})])),_:1}),(0,l.bF)(_,{value:"blank",scrollable:"","swipe-gesture":"true",modelValue:r.filter.mailing_type.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.filter.mailing_type.value=e)},{default:(0,l.k6)((()=>[(0,l.bF)(f,{value:"blank"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)("Неопубликованные "),(0,l.bF)(p,null,{default:(0,l.k6)((()=>{var e;return[(0,l.eW)((0,a.v_)(null===(e=r.mailingListGrouped.blank)||void 0===e?void 0:e.length),1)]})),_:1})])),_:1})])),_:1}),(0,l.bF)(f,{value:"finished"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)("Завершённые "),(0,l.bF)(p,null,{default:(0,l.k6)((()=>{var e;return[(0,l.eW)((0,a.v_)(null===(e=r.mailingListGrouped.finished)||void 0===e?void 0:e.length),1)]})),_:1})])),_:1})])),_:1}),(0,l.bF)(f,{value:"repeated"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)("Регулярные "),(0,l.bF)(p,{slot:"end",color:"primary"},{default:(0,l.k6)((()=>{var e;return[(0,l.eW)((0,a.v_)(null===(e=r.mailingListGrouped.repeated)||void 0===e?void 0:e.length),1)]})),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(g,null,{default:(0,l.k6)((()=>[(0,l.bF)(g,{slot:"content"},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(h,{placeholder:"Название","show-clear-button":"always",modelValue:r.filter.subject_template.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r.filter.subject_template.value=e),onIonInput:t[3]||(t[3]=e=>s.listFilter())},null,8,["modelValue"])])),_:1}),(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(k,{placeholder:"Транспорт",label:"Транспорт",modelValue:r.filter.transport.value,"onUpdate:modelValue":t[4]||(t[4]=e=>r.filter.transport.value=e),onIonChange:t[5]||(t[5]=e=>s.listFilter()),multiple:r.filter.transport.multiple},{default:(0,l.k6)((()=>[(0,l.bF)(v,{value:"push"},{default:(0,l.k6)((()=>[(0,l.eW)("Push")])),_:1}),(0,l.bF)(v,{value:"email"},{default:(0,l.k6)((()=>[(0,l.eW)("Email")])),_:1}),(0,l.bF)(v,{value:"telegram"},{default:(0,l.k6)((()=>[(0,l.eW)("Telegram")])),_:1}),(0,l.bF)(v,{value:"sms"},{default:(0,l.k6)((()=>[(0,l.eW)("Sms")])),_:1})])),_:1},8,["modelValue","multiple"])])),_:1}),"repeated"==r.filter.mailing_type.value?((0,l.uX)(),(0,l.Wv)(m,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(k,{placeholder:"Группа рассылок",label:"Группа рассылок",modelValue:r.filter.regular_group.value,"onUpdate:modelValue":t[6]||(t[6]=e=>r.filter.regular_group.value=e),onIonChange:t[7]||(t[7]=e=>s.listFilter()),multiple:r.filter.regular_group.multiple},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.regularGroupTranslation,((e,t)=>((0,l.uX)(),(0,l.Wv)(v,{value:t,key:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","multiple"])])),_:1})):(0,l.Q3)("",!0)])),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.mailingListActive,(t=>((0,l.uX)(),(0,l.Wv)(m,{key:`${t.subject_template}_${t.mailing_id}`},{default:(0,l.k6)((()=>[(0,l.bF)(c,{onClick:i=>e.$go(`/admin/mailing-edit-${t.mailing_id}`)},{default:(0,l.k6)((()=>{var e;return["finished"==t.mailing_type?((0,l.uX)(),(0,l.Wv)(b,{key:0,color:"medium",class:"ion-text-wrap",style:{"font-size":"12px"}},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(t.start_at_humanized),1)])),_:2},1024)):(0,l.Q3)("",!0),o,(0,l.bF)(y,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(t.subject_template),1)])),_:2},1024),(0,l.Lk)("div",null,["push"==t.transport?((0,l.uX)(),(0,l.Wv)(F,{key:0,icon:n.phonePortraitOutline,style:{"--background":"#6030ff","--color":"white","font-size":"12px"}},{default:(0,l.k6)((()=>[(0,l.eW)("push")])),_:1},8,["icon"])):"email"==t.transport?((0,l.uX)(),(0,l.Wv)(F,{key:1,icon:n.mailOutline,style:{"--background":"#ff6810","--color":"white","font-size":"12px"}},{default:(0,l.k6)((()=>[(0,l.eW)("e-mail")])),_:1},8,["icon"])):"sms"==t.transport?((0,l.uX)(),(0,l.Wv)(F,{key:2,icon:n.sendOutline,style:{"--background":"#00213f","--color":"white","font-size":"12px"}},{default:(0,l.k6)((()=>[(0,l.eW)("sms")])),_:1},8,["icon"])):"telegram"==t.transport?((0,l.uX)(),(0,l.Wv)(F,{key:3,icon:n.sendOutline,style:{"--background":"#0163aa","--color":"white","font-size":"12px"}},{default:(0,l.k6)((()=>[(0,l.eW)("telegram")])),_:1},8,["icon"])):(0,l.Q3)("",!0),(null===(e=t.recieverCount)||void 0===e?void 0:e.all)>0?((0,l.uX)(),(0,l.Wv)(F,{key:4},{default:(0,l.k6)((()=>[(0,l.eW)("Всего "+(0,a.v_)(t.recieverCount.all),1)])),_:2},1024)):(0,l.Q3)("",!0),"0"!==t.regular_group?((0,l.uX)(),(0,l.Wv)(F,{key:5,icon:n.sendOutline,style:{"--background":"var(--ion-color-primary)","--color":"white","font-size":"12px"}},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(r.regularGroupTranslation[t.regular_group]),1)])),_:2},1032,["icon"])):(0,l.Q3)("",!0)])]})),_:2},1032,["onClick"]),(0,l.Lk)("div",u,[(0,l.bF)(W,{id:`click-trigger-${t.mailing_id}`,fill:"clear"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{slot:"icon-only",icon:n.ellipsisVertical},null,8,["icon"])])),_:2},1032,["id"]),(0,l.bF)(w,{trigger:`click-trigger-${t.mailing_id}`,"trigger-action":"click","dismiss-on-select":!0,"show-backdrop":!1},{default:(0,l.k6)((()=>[(0,l.bF)(L,null,{default:(0,l.k6)((()=>[(0,l.bF)(g,{lines:"full",class:"ion-no-padding"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{button:"",onClick:i=>e.$go(`/admin/mailing-edit-${t.mailing_id}`)},{default:(0,l.k6)((()=>[(0,l.bF)(d,{slot:"end",icon:n.pencil},null,8,["icon"]),(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)("Редактировать")])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(m,{button:"",onClick:e=>s.itemCopy(t.mailing_id)},{default:(0,l.k6)((()=>[(0,l.bF)(d,{slot:"end",icon:n.copyOutline},null,8,["icon"]),(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)("Дублировать")])),_:1})])),_:2},1032,["onClick"]),(0,l.bF)(m,{button:"",onClick:e=>s.itemDelete(t.mailing_id)},{default:(0,l.k6)((()=>[(0,l.bF)(d,{slot:"end",icon:n.trash,color:"danger"},null,8,["icon"]),(0,l.bF)(c,{color:"danger"},{default:(0,l.k6)((()=>[(0,l.eW)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["trigger"])])])),_:2},1024)))),128))])),_:1})])),_:1})}i(4114),i(2712);var s=i(5654),d=i(5480),c=i(3201),m=i(2311),g=i.n(m),p={components:{IonList:s.nf,IonItem:s.uz,IonLabel:s.he,IonIcon:s.iq,IonNote:s.JI,IonText:s.IO,IonButton:s.Jm,IonSegment:s.Gp,IonSegmentButton:s.eP,IonPopover:s.CF,IonContent:s.W9,IonBadge:s.In,IonChip:s.ZB,IonSelect:s.Nm,IonSelectOption:s.Ip,IonInput:s.$w},setup(){return{addOutline:d.EKF,checkmarkCircleOutline:d.gz2,ellipseOutline:d.zF,playOutline:d.zsx,locationOutline:d.UN$,phonePortraitOutline:d.g_S,copyOutline:d.cwK,mailOutline:d.SM1,repeatOutline:d.SaP,sendOutline:d.NF$,ellipsisVertical:d.Q9m,pencil:d.wzV,trash:d.dco}},data(){return{openedAccordion:"message",filter:{transport:{value:"",multiple:!0},mailing_type:{value:"blank"},subject_template:{value:""},regular_group:{value:"",multiple:!0}},mailingList:[],mailingListGrouped:[],mailingListActive:[],isMailingOpen:!1,saveClock:null,regularGroupTranslation:{cart23:"Корзина брошена сутки","promo-10":"До конца скидки 10 дней","promo-3":"До конца скидки 3 дня","promo-1":"До конца скидки 1 день",forgot14:"Последний вход 2 недели назад",forgot30:"Последний вход месяц назад",forgot90:"Последний вход 3 месяца назад",every_monday:"Каждый понедельник",every_tuesday:"Каждый вторник",every_wednesday:"Каждую среду",every_thursday:"Каждый четверг",every_friday:"Каждую пятницу",every_saturday:"Каждую субботу",every_sunday:"Каждое воскресенье"}}},computed:{},methods:{async itemCreate(){const e={subject_template:"Без названия"};try{const t=await g().post(`${this.$heap.state.hostname}Admin/Mailing/itemCreate`,e);this.$go(`/admin/mailing-edit-${t}`)}catch{}},async itemCopy(e){const t={mailing_id:e};try{await g().post(`${this.$heap.state.hostname}Admin/Mailing/itemCopy`,t);this.listGet()}catch{}},async itemDelete(e){if(!confirm("Вы уверены?"))return;const t={mailing_id:e};try{await g().post(`${this.$heap.state.hostname}Admin/Mailing/itemDelete`,t),this.isMailingOpen=!1,this.listGet()}catch{}},async listGet(){this.mailingList=await c.A.prePost(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{});try{for(var e in this.mailingList=await c.A.post(`${this.$heap.state.hostname}Admin/Mailing/listGet`,{}),this.mailingList)this.mailingList[e].start_at_humanized=this.dateHumanize(this.mailingList[e].start_at),this.mailingList[e].mailing_type=0!=this.mailingList[e].regular_group?"repeated":"1"==this.mailingList[e].is_started?"finished":"blank";this.mailingList.sort((function(e,t){return new Date(t.created_at)-new Date(e.created_at)})),this.listGroup(),this.listFilter()}catch(t){}},listGroup(){this.mailingListGrouped=this.mailingList.reduce((function(e,t){return(e[t["mailing_type"]]=e[t["mailing_type"]]||[]).push(t),e}),{})},listFilter(){for(var e in console.log(this.filter),this.mailingListActive=this.mailingListGrouped[this.filter.mailing_type.value],this.filter)if(this.filter[e]&&this.filter[e].value)if(this.filter[e].multiple){if(0==this.filter[e].value.length)continue;var t=[];for(const i in this.filter[e].value)t=t.concat(this.mailingListActive.filter((t=>t[e]==this.filter[e].value[i])));this.mailingListActive=t}else this.mailingListActive=this.mailingListActive.filter((t=>-1!==t[e].toLowerCase().indexOf(this.filter[e].value.toLowerCase())))},dateHumanize(e){var t,i=Math.round((+new Date-new Date(e))/1e3),l=60,a=60*l,n=24*a;return t=i<30?"Только что.":i<l?i+" сукунд назад.":i<2*l?"минуту назад.":i<a?Math.floor(i/l)+" минут назад.":1==Math.floor(i/a)?"Час назад.":i<n?Math.floor(i/a)+" часов назад.":i<2*n?"Вчера":new Date(e).toLocaleString("ru",{day:"numeric",month:"long"}),t}},ionViewDidEnter(){this.listGet()},watch:{"filter.mailing_type.value"(){this.filter.transport.value="",this.filter.regular_group.value="",this.filter.subject_template.value="",this.listFilter()}}},f=i(6262);const _=(0,f.A)(p,[["render",r],["__scopeId","data-v-11ba3492"]]);var h=_}}]);
//# sourceMappingURL=3709.fcafa123.js.map