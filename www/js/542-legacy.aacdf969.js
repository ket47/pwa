"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[542],{8542:function(e,t,o){o.r(t),o.d(t,{default:function(){return U}});o(6699),o(4916),o(5306);var i=o(6252),n=o(3577);const l=["onClick"],r=["onClick"],a={key:3,style:{display:"flex","align-items":"center","justify-content":"center",height:"70vh"}},s={key:0,style:{width:"max-content","text-align":"center"}},d=(0,i._)("br",null,null,-1),u={key:1,style:{width:"max-content","text-align":"center"}},c=(0,i._)("br",null,null,-1);function m(e,t,o,m,_,p){const f=(0,i.up)("ion-segment-button"),w=(0,i.up)("ion-segment"),h=(0,i.up)("ion-text"),k=(0,i.up)("ion-label"),y=(0,i.up)("ion-item"),v=(0,i.up)("ion-icon"),W=(0,i.up)("ion-chip"),g=(0,i.up)("ion-img"),b=(0,i.up)("ion-avatar"),I=(0,i.up)("ion-list"),L=(0,i.up)("ion-note"),j=(0,i.up)("ion-skeleton-text"),D=(0,i.up)("ion-infinite-scroll-content"),C=(0,i.up)("ion-infinite-scroll"),x=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(x,{"page-title":"Заказы",hideBackLink:"true"},{default:(0,i.w5)((()=>{var o,x,U;return[(0,i.Wm)(w,{"swipe-gesture":"true",modelValue:_.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>_.orderType=e),onIonChange:t[1]||(t[1]=e=>p.listTypeChanged(e))},{default:(0,i.w5)((()=>[_.courierJobsInclude?((0,i.wg)(),(0,i.j4)(f,{key:0,value:"jobs"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Задания ")])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{value:"active"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Активные ")])),_:1}),(0,i.Wm)(f,{value:"done"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Завершенные ")])),_:1})])),_:1},8,["modelValue"]),(null===(o=_.orderList)||void 0===o?void 0:o.length)>0?((0,i.wg)(),(0,i.j4)(I,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.orderListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>p.itemClick(t)},[(0,i.Wm)(y,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Uk)("#"+(0,n.zw)(t.order_id),1)])),_:2},1024),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name),1)])),_:2},1024),(0,i.Wm)(h,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.date),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(y,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{slot:"start",icon:t.icon,color:"primary"},null,8,["icon"]),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.stage_current_name?((0,i.wg)(),(0,i.j4)(W,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{icon:m.checkmarkOutline},null,8,["icon"]),(0,i.Wm)(k,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.stage_current_name),1)])),_:2},1024)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024)])),_:2},1024),t.image_hash?((0,i.wg)(),(0,i.j4)(b,{key:0,slot:"end"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{style:{"border-radius":"10px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024)],8,l)))),128))])),_:1})):(0,i.kq)("",!0),_.jobList?((0,i.wg)(),(0,i.j4)(I,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.jobListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>p.itemClick(t)},[(0,i.Wm)(y,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name),1)])),_:2},1024),(0,i.Wm)(h,{slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.date_time),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(y,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{slot:"start",icon:m.rocketOutline,color:"primary"},null,8,["icon"]),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.distance_km?((0,i.wg)(),(0,i.j4)(W,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.distance_km),1)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024),(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.location_address),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)],8,r)))),128))])),_:1})):(0,i.kq)("",!0),["active","done"].includes(_.orderType)&&null==_.orderList?((0,i.wg)(),(0,i.j4)(I,{key:2},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3],(e=>(0,i._)("div",{key:e},[(0,i.Wm)(y,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{style:{width:"50px"},slot:"start"}),(0,i.Wm)(j,{style:{width:"100%"}}),(0,i.Wm)(j,{style:{width:"50px"},slot:"end"})])),_:1}),(0,i.Wm)(y,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"30px",height:"30px","border-radius":"50px"},slot:"start"}),(0,i.Wm)(W,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"80px"}})])),_:1})])),_:1}),(0,i.Wm)(W,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{icon:m.checkmarkOutline},null,8,["icon"]),(0,i.Wm)(k,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"80px"}})])),_:1})])),_:1}),(0,i.Wm)(j,{animated:"",style:{width:"40px",height:"40px","border-radius":"10px"},slot:"end"})])),_:1})]))),64))])),_:1})):_.orderList&&0!=(null===(x=_.orderList)||void 0===x?void 0:x.length)||_.jobList&&0!=(null===(U=_.jobList)||void 0===U?void 0:U.length)?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",a,[e.$heap.getters.userIsLogged?((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(v,{icon:m.sparklesOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Заказов нет")])),_:1}),d,(0,i.Wm)(L,{onClick:t[2]||(t[2]=t=>e.$router.replace("/")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("но вы можете создать новый")])),_:1})])):((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(v,{icon:m.informationOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Необходимо войти в систему")])),_:1}),c,(0,i.Wm)(L,{onClick:t[3]||(t[3]=t=>e.$router.replace("/user/sign-in")),style:{cursor:"pointer"},color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("вход в систему")])),_:1})]))])),(0,i.Wm)(C,{onIonInfinite:t[4]||(t[4]=e=>p.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{"loading-spinner":"bubbles","loading-text":"Загрузка..."})])),_:1})]})),_:1})}var _=o(8534),p=(o(3948),o(6964)),f=o(8903),w=o(8764),h=o(7782),k=o(351),y=o(9042);const v={class:"center_chip"},W={class:"center_chip"},g={class:"center_chip"};function b(e,t,o,l,r,a){const s=(0,i.up)("ion-title"),d=(0,i.up)("ion-icon"),u=(0,i.up)("ion-toolbar"),c=(0,i.up)("ion-header"),m=(0,i.up)("ion-avatar"),_=(0,i.up)("ion-text"),p=(0,i.up)("ion-label"),f=(0,i.up)("ion-item"),w=(0,i.up)("ion-chip"),h=(0,i.up)("ion-note"),k=(0,i.up)("ion-skeleton-text"),y=(0,i.up)("ion-button"),b=(0,i.up)("ion-item-group"),I=(0,i.up)("ion-list"),L=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Просмотр задания")])),_:1}),(0,i.Wm)(d,{slot:"end",onClick:t[0]||(t[0]=e=>{a.close()}),icon:l.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(L,null,{default:(0,i.w5)((()=>[o.orderData?((0,i.wg)(),(0,i.j4)(I,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Курьер "+(0,n.zw)(e.$heap.state.user.user_name),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(f,{lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",v,[(0,i.Wm)(w,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>{var e;return[(0,i.Uk)((0,n.zw)(null===(e=o.orderData)||void 0===e?void 0:e.distance_km),1)]})),_:1})])),_:1})])])),_:1}),(0,i.Wm)(f,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.store_name),1)])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.location_address),1)])),_:1})])),_:1})])),_:1}),a.start_finish_distance_km?((0,i.wg)(),(0,i.j4)(f,{key:0,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",W,[(0,i.Wm)(w,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(a.start_finish_distance_km),1)])),_:1})])),_:1})])])),_:1})):((0,i.wg)(),(0,i.j4)(f,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i.Wm)(w,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{animated:"",style:{width:"100%"}})])),_:1})])])),_:1})),r.job?((0,i.wg)(),(0,i.j4)(f,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Покупатель")])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(r.job.finish_location_address),1)])),_:1})])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(f,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{icon:l.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Покупатель")])),_:1}),(0,i.Wm)(k,{animated:"",style:{width:"60%"}}),(0,i.Wm)(k,{animated:"",style:{width:"80%"}})])),_:1})])),_:1})),r.job?((0,i.wg)(),(0,i.j4)(b,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{onClick:t[1]||(t[1]=e=>a.deliveryStart()),expand:"full"},{default:(0,i.w5)((()=>[(0,i.Uk)("Начать доставку")])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})):(0,i.kq)("",!0)])),_:1})],64)}o(5069),o(3123);var I={props:["orderData"],components:{IonList:p.q_,IonItemGroup:p.Ub,IonTitle:p.wd,IonButton:p.YG,IonSkeletonText:p.CK,IonNote:p.uN,IonChip:p.hM,IonItem:p.Ie,IonLabel:p.Q$,IonText:p.yW,IonAvatar:p.BJ,IonIcon:p.gu,IonHeader:p.Gu,IonToolbar:p.sr,IonContent:p.W2},setup(){return{storefrontOutline:f.qRG,locationOutline:f.Iv7,flagOutline:f.FMn,closeOutline:f.fID}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){var e,t;return null!==(e=this.job)&&void 0!==e&&e.start_finish_distance?Math.round((null===(t=this.job)||void 0===t?void 0:t.start_finish_distance)/1e3)+"км":"-"}},methods:{jobGet(){var e=this;return(0,_.Z)((function*(){try{let t=yield h.Z.api.itemJobGet(e.orderData.order_id);t.finish_location_address=t.finish_location_address.split(",").reverse().join(","),e.job=t}catch(i){var t,o;const n=null===(t=i.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;if("notfound"==n)return void e.$flash("Задание не найдено");if("notready"==n)return void e.$flash("Смена курьера не открыта")}}))()},deliveryStart(){var e=this;return(0,_.Z)((function*(){var t,o;const i=null===(t=k.Z.courier)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.courier_id;try{yield h.Z.api.itemJobStart(e.orderData.order_id,i),e.$go("order-"+e.orderData.order_id)}catch(r){var n,l;const t=null===(n=r.responseJSON)||void 0===n||null===(l=n.messages)||void 0===l?void 0:l.error;"notfound"==t&&e.$flash("Задание не найдено"),"notready"==t&&e.$flash("Смена курьера не открыта"),"notsearching"!=t&&"idle"!=t||e.$flash("Заданию уже назначен курьер")}y.Z.publish("dismissModal")}))()},close(){y.Z.publish("dismissModal")}}},L=o(3744);const j=(0,L.Z)(I,[["render",b],["__scopeId","data-v-9cfef60e"]]);var D=j,C={components:{IonSegment:p.cJ,IonSegmentButton:p.GO,IonIcon:p.gu,IonAvatar:p.BJ,IonText:p.yW,IonLabel:p.Q$,IonItem:p.Ie,IonList:p.q_,IonChip:p.hM,IonNote:p.uN,IonImg:p.Xz,IonInfiniteScroll:p.ju,IonInfiniteScrollContent:p.MB,IonSkeletonText:p.CK},setup(){return{sparklesOutline:f.Fcs,storefrontOutline:f.qRG,timeOutline:f.bdY,ordersIcon:w,rocketOutline:f.G$D,ribbonOutline:f.Muk,checkmarkOutline:f.TjA,informationOutline:f.cQG}},data(){return{jobList:null,orderList:null,orderType:null,courierJobsInclude:null,clock:null}},computed:{orderListComputed(){for(let e of this.orderList){switch(e.user_role){case"customer":e.icon=w;break;case"admin":e.icon=f.Muk;break;case"courier":e.icon=f.G$D;break;case"supplier":e.icon=f.qRG;break}e.date=this.toLocDate(e.created_at)}return this.orderList},jobListComputed(){for(let e of this.jobList)e.location_address||(e.location_address=""),e.distance?e.distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="",e.date_time=this.toLocDateTime(e.created_at);return this.jobList}},created(){this.$topic.on("courierStatusChange",(()=>{this.courierReadinessCheck()})),this.$topic.on("userGet",(()=>{this.listLoad(this.orderType,"reload")})),this.courierReadinessCheck()},methods:{toLocDate(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,o)},toLocDateTime(e){const t=new Date(Date.parse(e)),o={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,o)},courierReadinessCheck(){const e="ready"==k.Z.courier.status?1:0;this.courierJobsInclude!==e&&(this.courierJobsInclude=e,0==this.courierJobsInclude?this.orderType="active":this.orderType="jobs")},listLoad(e,t="reload"){var o=this;return(0,_.Z)((function*(){var i;if("jobs"==e)return o.autoReload(e),void o.listJobLoad();let n="system_finish";"active"==e&&(o.autoReload(e),n="active_only");const l={order_group_type:n,offset:0,limit:(null===(i=o.orderList)||void 0===i?void 0:i.length)||10};var r,a;"append"==t&&(l.offset=null!==(r=null===(a=o.orderList)||void 0===a?void 0:a.length)&&void 0!==r?r:0,l.limit=10);let s=yield h.Z.api.listLoad(l);var d;"append"==t&&(null!==(d=o.orderList)&&void 0!==d||(o.orderList=[]),s=o.orderList.concat(s));o.orderList=s,o.jobList=null}))()},listLoadMore(e){var t=this;return(0,_.Z)((function*(){yield t.listLoad(t.orderType,"append"),e.target.complete()}))()},listTypeChanged(e){const t=e.target.value;this.orderList=null,this.listLoad(t)},listJobLoad(){var e=this;return(0,_.Z)((function*(){try{var t,o;const i=null===(t=k.Z.courier)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.courier_id;e.jobList=yield h.Z.api.listJobGet(i),e.orderList=null}catch(l){var i,n;const t=null===(i=l.responseJSON)||void 0===i||null===(n=i.messages)||void 0===n?void 0:n.error;"notready"==t&&(k.Z.courier.status="notready",e.courierReadinessCheck())}}))()},autoReload(e){clearTimeout(this.clock);const t=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((()=>{this.listLoad(this.orderType)}),t))},ionViewDidEnter(){this.courierReadinessCheck(),this.listLoad(this.orderType)},ionViewDidLeave(){clearTimeout(this.clock)},itemClick(e){var t=this;return(0,_.Z)((function*(){if(e.is_courier_job){const t=yield p.Fy.create({component:D,componentProps:{orderData:e},initialBreakpoint:.6,breakpoints:[0,.6,.75]}),o=function(){t.dismiss()};return y.Z.on("dismissModal",o),t.present()}t.itemOpen(e.order_id)}))()},itemOpen(e){this.$go(`/order/order-${e}`)}}};const x=(0,L.Z)(C,[["render",m]]);var U=x}}]);
//# sourceMappingURL=542-legacy.aacdf969.js.map