"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[7316],{3123:function(e,t,n){var r=n(2104),i=n(6916),o=n(1702),u=n(7007),a=n(7850),l=n(9670),s=n(4488),c=n(6707),d=n(1530),f=n(7466),m=n(1340),p=n(8173),h=n(1589),_=n(7651),w=n(2261),k=n(2999),v=n(7293),g=k.UNSUPPORTED_Y,b=4294967295,y=Math.min,W=[].push,I=o(/./.exec),x=o(W),j=o("".slice),L=!v((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));u("split",(function(e,t,n){var o;return o="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var o=m(s(this)),u=void 0===n?b:n>>>0;if(0===u)return[];if(void 0===e)return[o];if(!a(e))return i(t,o,e,u);var l,c,d,f=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),_=0,k=new RegExp(e.source,p+"g");while(l=i(w,k,o)){if(c=k.lastIndex,c>_&&(x(f,j(o,_,l.index)),l.length>1&&l.index<o.length&&r(W,f,h(l,1)),d=l[0].length,_=c,f.length>=u))break;k.lastIndex===l.index&&k.lastIndex++}return _===o.length?!d&&I(k,"")||x(f,""):x(f,j(o,_)),f.length>u?h(f,0,u):f}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:i(t,this,e,n)}:t,[function(t,n){var r=s(this),u=void 0==t?void 0:p(t,e);return u?i(u,t,r,n):i(o,m(r),t,n)},function(e,r){var i=l(this),u=m(e),a=n(o,i,u,r,o!==t);if(a.done)return a.value;var s=c(i,RegExp),p=i.unicode,h=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(g?"g":"y"),w=new s(g?"^(?:"+i.source+")":i,h),k=void 0===r?b:r>>>0;if(0===k)return[];if(0===u.length)return null===_(w,u)?[u]:[];var v=0,W=0,I=[];while(W<u.length){w.lastIndex=g?0:W;var L,C=_(w,g?j(u,W):u);if(null===C||(L=y(f(w.lastIndex+(g?W:0)),u.length))===v)W=d(u,W,p);else{if(x(I,j(u,v,W)),I.length===k)return I;for(var D=1;D<=C.length-1;D++)if(x(I,C[D]),I.length===k)return I;W=v=L}}return x(I,j(u,v)),I}]}),!L,g)},7316:function(e,t,n){n.r(t),n.d(t,{default:function(){return R}});n(4916),n(5306);var r=n(6252),i=n(3577),o=(0,r.Uk)(" Задания "),u=(0,r.Uk)(" Активные "),a=(0,r.Uk)(" Исполненые "),l=["onClick"],s=["onClick"],c={key:2,style:{display:"flex","align-items":"center","justify-content":"center",height:"70vh"}},d={style:{width:"max-content","text-align":"center"}},f=(0,r.Uk)("Заказов нет"),m=(0,r._)("br",null,null,-1),p=(0,r.Uk)("но вы можете создать новый");function h(e,t,n,h,_,w){var k=(0,r.up)("ion-segment-button"),v=(0,r.up)("ion-segment"),g=(0,r.up)("ion-text"),b=(0,r.up)("ion-label"),y=(0,r.up)("ion-item"),W=(0,r.up)("ion-icon"),I=(0,r.up)("ion-chip"),x=(0,r.up)("ion-img"),j=(0,r.up)("ion-avatar"),L=(0,r.up)("ion-list"),C=(0,r.up)("ion-note"),D=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(D,{"page-title":"Заказы"},{default:(0,r.w5)((function(){var n;return[(0,r.Wm)(v,{"swipe-gesture":"true",modelValue:_.orderType,"onUpdate:modelValue":t[0]||(t[0]=function(e){return _.orderType=e}),onIonChange:t[1]||(t[1]=function(e){return w.listTypeChanged(e)})},{default:(0,r.w5)((function(){return[_.courierJobsInclude?((0,r.wg)(),(0,r.j4)(k,{key:0,value:"jobs"},{default:(0,r.w5)((function(){return[o]})),_:1})):(0,r.kq)("",!0),(0,r.Wm)(k,{value:"active"},{default:(0,r.w5)((function(){return[u]})),_:1}),(0,r.Wm)(k,{value:"done"},{default:(0,r.w5)((function(){return[a]})),_:1})]})),_:1},8,["modelValue"]),(null===(n=_.orderList)||void 0===n?void 0:n.length)>0?((0,r.wg)(),(0,r.j4)(L,{key:0},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(w.orderListComputed,(function(t){return(0,r.wg)(),(0,r.iD)("div",{key:t.order_id,onClick:function(e){return w.itemClick(t)}},[(0,r.Wm)(y,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r.Wm)(g,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Uk)("#"+(0,i.zw)(t.order_id),1)]})),_:2},1024),(0,r.Wm)(b,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.store_name),1)]})),_:2},1024),(0,r.Wm)(g,{slot:"end"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.date),1)]})),_:2},1024)]})),_:2},1024),(0,r.Wm)(y,{lines:"full"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{slot:"start",icon:t.icon,color:"primary"},null,8,["icon"]),(0,r.Wm)(g,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(b,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{color:"medium"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.order_sum_total)+(0,i.zw)(e.$heap.state.currencySign),1)]})),_:2},1024),t.stage_current_name?((0,r.wg)(),(0,r.j4)(I,{key:0,color:"primary"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{icon:h.checkmarkOutline},null,8,["icon"]),(0,r.Wm)(b,{color:"dark"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.stage_current_name),1)]})),_:2},1024)]})),_:2},1024)):(0,r.kq)("",!0)]})),_:2},1024)]})),_:2},1024),t.image_hash?((0,r.wg)(),(0,r.j4)(j,{key:0,slot:"end"},{default:(0,r.w5)((function(){return[(0,r.Wm)(x,{style:{"border-radius":"10px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])]})),_:2},1024)):(0,r.kq)("",!0)]})),_:2},1024)],8,l)})),128))]})),_:1})):(0,r.kq)("",!0),_.jobList?((0,r.wg)(),(0,r.j4)(L,{key:1},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(w.jobListComputed,(function(t){return(0,r.wg)(),(0,r.iD)("div",{key:t.order_id,onClick:function(e){return w.itemClick(t)}},[(0,r.Wm)(y,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.store_name),1)]})),_:2},1024),(0,r.Wm)(g,{slot:"end"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.date_time),1)]})),_:2},1024)]})),_:2},1024),(0,r.Wm)(y,{lines:"full"},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{slot:"start",icon:h.rocketOutline,color:"primary"},null,8,["icon"]),(0,r.Wm)(g,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(b,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{color:"medium"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.order_sum_total)+(0,i.zw)(e.$heap.state.currencySign),1)]})),_:2},1024),t.distance_km?((0,r.wg)(),(0,r.j4)(I,{key:0,color:"primary"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.distance_km),1)]})),_:2},1024)):(0,r.kq)("",!0)]})),_:2},1024),(0,r.Wm)(C,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(t.location_address),1)]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)],8,s)})),128))]})),_:1})):(0,r.kq)("",!0),_.orderList&&0!=_.orderList.length||_.jobList&&0!=_.jobList.length?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",c,[(0,r._)("div",d,[(0,r.Wm)(W,{icon:h.sparklesOutline,size:"large"},null,8,["icon"]),(0,r.Wm)(b,null,{default:(0,r.w5)((function(){return[f]})),_:1}),m,(0,r.Wm)(C,{onClick:t[2]||(t[2]=function(t){return e.$router.replace("/")}),style:{cursor:"pointer"},color:"primary"},{default:(0,r.w5)((function(){return[p]})),_:1})])]))]})),_:1})}var _=n(6835),w=n(8534),k=n(8439),v=n(8292),g=n(8903),b=n(8764),y=n(7782),W=n(351),I=n(9042),x=n(6488),j=(0,r.Uk)("Просмотр задания"),L={class:"center_chip"},C={class:"center_chip"},D={class:"center_chip"},Z=(0,r.Uk)("Покупатель"),U=(0,r.Uk)("Покупатель"),z=(0,r.Uk)("Начать доставку");function O(e,t,n,o,u,a){var l=(0,r.up)("ion-title"),s=(0,r.up)("ion-icon"),c=(0,r.up)("ion-toolbar"),d=(0,r.up)("ion-header"),f=(0,r.up)("ion-avatar"),m=(0,r.up)("ion-text"),p=(0,r.up)("ion-label"),h=(0,r.up)("ion-item"),_=(0,r.up)("ion-chip"),w=(0,r.up)("ion-note"),k=(0,r.up)("ion-skeleton-text"),v=(0,r.up)("ion-button"),g=(0,r.up)("ion-item-group"),b=(0,r.up)("ion-list"),y=(0,r.up)("ion-content");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(d,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(c,{color:"secondary"},{default:(0,r.w5)((function(){return[(0,r.Wm)(l,null,{default:(0,r.w5)((function(){return[j]})),_:1}),(0,r.Wm)(s,{slot:"end",onClick:t[0]||(t[0]=function(e){a.close()}),icon:o.closeOutline,size:"large"},null,8,["icon"])]})),_:1})]})),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[n.orderData?((0,r.wg)(),(0,r.j4)(b,{key:0},{default:(0,r.w5)((function(){return[(0,r.Wm)(h,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r.Wm)(f,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Wm)(s,{icon:o.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])]})),_:1}),(0,r.Wm)(p,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(m,{color:"primary"},{default:(0,r.w5)((function(){return[(0,r.Uk)("Курьер "+(0,i.zw)(e.$heap.state.user.user_name),1)]})),_:1})]})),_:1})]})),_:1}),(0,r.Wm)(h,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r._)("div",L,[(0,r.Wm)(_,{color:"success"},{default:(0,r.w5)((function(){return[(0,r.Wm)(m,null,{default:(0,r.w5)((function(){var e;return[(0,r.Uk)((0,i.zw)(null===(e=n.orderData)||void 0===e?void 0:e.distance_km),1)]})),_:1})]})),_:1})])]})),_:1}),(0,r.Wm)(h,{lines:"none"},{default:(0,r.w5)((function(){return[(0,r.Wm)(f,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Wm)(s,{icon:o.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])]})),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{color:"primary"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.orderData.store_name),1)]})),_:1}),(0,r.Wm)(w,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.orderData.location_address),1)]})),_:1})]})),_:1})]})),_:1}),a.start_finish_distance_km?((0,r.wg)(),(0,r.j4)(h,{key:0,lines:"none"},{default:(0,r.w5)((function(){return[(0,r._)("div",C,[(0,r.Wm)(_,{color:"success"},{default:(0,r.w5)((function(){return[(0,r.Wm)(m,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(a.start_finish_distance_km),1)]})),_:1})]})),_:1})])]})),_:1})):((0,r.wg)(),(0,r.j4)(h,{key:1,lines:"none"},{default:(0,r.w5)((function(){return[(0,r._)("div",D,[(0,r.Wm)(_,{color:"success"},{default:(0,r.w5)((function(){return[(0,r.Wm)(k,{animated:"",style:{width:"100%"}})]})),_:1})])]})),_:1})),u.job?((0,r.wg)(),(0,r.j4)(h,{key:2},{default:(0,r.w5)((function(){return[(0,r.Wm)(f,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Wm)(s,{icon:o.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])]})),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{color:"primary"},{default:(0,r.w5)((function(){return[Z]})),_:1}),(0,r.Wm)(w,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(u.job.finish_location_address),1)]})),_:1})]})),_:1})]})),_:1})):((0,r.wg)(),(0,r.j4)(h,{key:3},{default:(0,r.w5)((function(){return[(0,r.Wm)(f,{slot:"start"},{default:(0,r.w5)((function(){return[(0,r.Wm)(s,{icon:o.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])]})),_:1}),(0,r.Wm)(p,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(m,{color:"primary"},{default:(0,r.w5)((function(){return[U]})),_:1}),(0,r.Wm)(k,{animated:"",style:{width:"60%"}}),(0,r.Wm)(k,{animated:"",style:{width:"80%"}})]})),_:1})]})),_:1})),u.job?((0,r.wg)(),(0,r.j4)(g,{key:4},{default:(0,r.w5)((function(){return[(0,r.Wm)(v,{onClick:t[1]||(t[1]=function(e){return a.deliveryStart()}),expand:"full"},{default:(0,r.w5)((function(){return[z]})),_:1})]})),_:1})):(0,r.kq)("",!0)]})),_:1})):(0,r.kq)("",!0)]})),_:1})],64)}n(5069),n(3123);var T={props:["orderData"],components:{IonList:v.q_,IonItemGroup:v.Ub,IonTitle:v.wd,IonButton:v.YG,IonSkeletonText:v.CK,IonNote:v.uN,IonChip:v.hM,IonItem:v.Ie,IonLabel:v.Q$,IonText:v.yW,IonAvatar:v.BJ,IonIcon:v.gu,IonHeader:v.Gu,IonToolbar:v.sr,IonContent:v.W2},setup(){return{storefrontOutline:g.qRG,locationOutline:g.Iv7,flagOutline:g.FMn,closeOutline:g.fID}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){var e,t;return null!==(e=this.job)&&void 0!==e&&e.start_finish_distance?Math.round((null===(t=this.job)||void 0===t?void 0:t.start_finish_distance)/1e3)+"км":"-"}},methods:{jobGet(){var e=this;return(0,w.Z)((0,_.Z)().mark((function t(){var n,r,i,o;return(0,_.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y.Z.api.itemJobGet(e.orderData.order_id);case 3:n=t.sent,n.finish_location_address=n.finish_location_address.split(",").reverse().join(","),e.job=n,t.next=17;break;case 8:if(t.prev=8,t.t0=t["catch"](0),o=null===(r=t.t0.responseJSON)||void 0===r||null===(i=r.messages)||void 0===i?void 0:i.error,"notfound"!=o){t.next=14;break}return e.$flash("Задание не найдено"),t.abrupt("return");case 14:if("notready"!=o){t.next=17;break}return e.$flash("Смена курьера не открыта"),t.abrupt("return");case 17:case"end":return t.stop()}}),t,null,[[0,8]])})))()},deliveryStart(){var e=this;return(0,w.Z)((0,_.Z)().mark((function t(){var n,r,i,o,u,a;return(0,_.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=null===(n=W.Z.courier)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.courier_id,t.prev=1,t.next=4,y.Z.api.itemJobStart(e.orderData.order_id,i);case 4:e.$router.push("order-"+e.orderData.order_id),t.next=13;break;case 7:t.prev=7,t.t0=t["catch"](1),a=null===(o=t.t0.responseJSON)||void 0===o||null===(u=o.messages)||void 0===u?void 0:u.error,"notfound"==a&&e.$flash("Задание не найдено"),"notready"==a&&e.$flash("Смена курьера не открыта"),"notsearching"!=a&&"idle"!=a||e.$flash("Заданию уже назначен курьер");case 13:I.Z.publish("dismissModal");case 14:case"end":return t.stop()}}),t,null,[[1,7]])})))()},close(){I.Z.publish("dismissModal")}}},$=n(3744);const J=(0,$.Z)(T,[["render",O],["__scopeId","data-v-13745910"]]);var S=J,q={components:{IonSegment:v.cJ,IonSegmentButton:v.GO,IonIcon:v.gu,IonAvatar:v.BJ,IonText:v.yW,IonLabel:v.Q$,IonItem:v.Ie,IonList:v.q_,IonChip:v.hM,IonNote:v.uN,IonImg:v.Xz},setup(){return{sparklesOutline:g.Fcs,storefrontOutline:g.qRG,timeOutline:g.bdY,ordersIcon:b,rocketOutline:g.G$D,ribbonOutline:g.Muk,checkmarkOutline:g.TjA}},data(){return{jobList:null,orderList:null,orderType:null,courierJobsInclude:null,clock:null}},computed:{orderListComputed(){var e,t=(0,k.Z)(this.orderList);try{for(t.s();!(e=t.n()).done;){var n=e.value;switch(n.user_role){case"customer":n.icon=b;break;case"admin":n.icon=g.Muk;break;case"courier":n.icon=g.G$D;break;case"supplier":n.icon=g.qRG;break}n.date=this.toLocDate(n.created_at)}}catch(r){t.e(r)}finally{t.f()}return this.orderList},jobListComputed(){var e,t=(0,k.Z)(this.jobList);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.location_address||(n.location_address=""),n.distance?n.distance_km=Math.round(n.distance/1e3)+"км":n.distance_km="",n.date_time=this.toLocDateTime(n.created_at)}}catch(r){t.e(r)}finally{t.f()}return this.jobList}},created(){var e=this;this.$topic.on("courierStatusChange",(function(){e.courierReadinessCheck()})),e.courierReadinessCheck()},methods:{toLocDate(e){var t=new Date(Date.parse(e)),n={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,n)},toLocDateTime(e){var t=new Date(Date.parse(e)),n={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,n)},courierReadinessCheck(){var e="ready"==W.Z.courier.status?1:0;this.courierJobsInclude!==e&&(this.courierJobsInclude=e,0==this.courierJobsInclude?this.orderType="active":this.orderType="jobs")},listLoad(e){var t=this;return(0,w.Z)((0,_.Z)().mark((function n(){var r;return(0,_.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.autoReload(e),"jobs"!=e){n.next=4;break}return t.listJobLoad(),n.abrupt("return");case 4:return r="system_finish","active"==e&&(r="active_only"),n.next=8,y.Z.api.listLoad(r);case 8:t.orderList=n.sent,t.jobList=null;case 10:case"end":return n.stop()}}),n)})))()},listTypeChanged(e){var t=e.target.value;this.listLoad(t)},listJobLoad(){var e=this;return(0,w.Z)((0,_.Z)().mark((function t(){var n,r,i,o,u,a;return(0,_.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,i=null===(n=W.Z.courier)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.courier_id,t.next=4,y.Z.api.listJobGet(i);case 4:e.jobList=t.sent,e.orderList=null,t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),a=null===(o=t.t0.responseJSON)||void 0===o||null===(u=o.messages)||void 0===u?void 0:u.error,"notready"==a&&(W.Z.courier.status="notready",e.courierReadinessCheck());case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},autoReload(e){clearTimeout(this.clock);var t=this,n=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((function(){t.listLoad(e)}),n))},ionViewDidEnter(){this.courierReadinessCheck(),this.listLoad(this.orderType)},ionViewDidLeave(){clearTimeout(this.clock)},itemClick(e){var t=this;return(0,w.Z)((0,_.Z)().mark((function n(){var r,i;return(0,_.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.is_courier_job){n.next=7;break}return n.next=3,v.Fy.create({component:S,componentProps:{orderData:e},initialBreakpoint:.6,breakpoints:[0,.6,.75]});case 3:return r=n.sent,i=function(){r.dismiss()},I.Z.on("dismissModal",i),n.abrupt("return",r.present());case 7:t.itemOpen(e.order_id);case 8:case"end":return n.stop()}}),n)})))()},itemOpen(e){x.Z.push(`order-${e}`)}}};const G=(0,$.Z)(q,[["render",h]]);var R=G},8764:function(e,t,n){e.exports=n.p+"img/orders.ea36eab8.svg"}}]);
//# sourceMappingURL=7316-legacy.2bd96b4c.js.map