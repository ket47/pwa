"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[3422],{4405:function(e,r,t){t(4916),t(5306);var o=t(2008);const n={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const r=e.locations[0].distance,t=e.store_time_preparation||0;return n.deliveryTimeCalculate(r,t)},deliveryTimeCalculate(e,r){var t;r=parseInt(null!==(t=r)&&void 0!==t?t:o.Z.getters.settings.delivery.timePreparationDefault);const n=parseInt(o.Z.getters.settings.delivery.timeDelta),i=parseInt(o.Z.getters.settings.delivery.speed),l=5*Math.round(e/i*60/5)+r,a=l>n?l-n:l,s=a+n;return{time:l,timeMin:a,timeMax:s}},render(e,r){for(let t in r)e=e.replace(`{{${t}}}`,r[t]);return e=e.replace(/{{\.}}/,"-"),e}};r["Z"]=n},5265:function(e,r,t){t.d(r,{Z:function(){return f}});var o=t(6252);const n=(0,o.Uk)("Привязка новой карты"),i=(0,o.Uk)("Оплата картой"),l=["src"],a={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},s=["src"];function d(e,r,t,d,u,c){const m=(0,o.up)("ion-title"),p=(0,o.up)("ion-icon"),y=(0,o.up)("ion-toolbar"),_=(0,o.up)("ion-header"),h=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{color:"secondary"},{default:(0,o.w5)((()=>["card_registering"==this.order_data?((0,o.wg)(),(0,o.j4)(m,{key:0},{default:(0,o.w5)((()=>[n])),_:1})):((0,o.wg)(),(0,o.j4)(m,{key:1},{default:(0,o.w5)((()=>[i])),_:1})),(0,o.Wm)(p,{icon:d.closeOutline,onClick:r[0]||(r[0]=e=>{d.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o._)("iframe",{src:u.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"calc( 100% - 5px )",border:"none"},onLoad:r[1]||(r[1]=e=>c.onLoad())},null,40,l),u.loadAnimation?((0,o.wg)(),(0,o.iD)("div",a,[(0,o._)("img",{src:d.loading},null,8,s)])):(0,o.kq)("",!0)])),_:1})],64)}var u=t(8534),c=t(8292),m=t(8903),p=t(659),y=t(9755),_=t.n(y),h={components:{IonTitle:c.wd,IonIcon:c.gu,IonToolbar:c.sr,IonHeader:c.Gu,IonContent:c.W2},props:["order_data"],setup(){const e=function(){c.Fy.dismiss()};return{closeModal:e,closeOutline:m.fID,cardOutline:m.pvm,loading:p}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{postToIframe(){var e=this;return(0,u.Z)((function*(){try{if("card_registering"==e.order_data)return void(e.paymentLink=yield _().post(e.$heap.state.hostname+"CardAcquirer/cardRegisterLinkGet"));e.paymentLink=yield _().post(e.$heap.state.hostname+"CardAcquirer/paymentLinkGet",e.order_data)}catch(o){var r,t;const n=null===o||void 0===o||null===(r=o.responseJSON)||void 0===r||null===(t=r.messages)||void 0===t?void 0:t.error;"nocardid"==n?e.$flash("Не удалось добавить карту"):e.$flash("Нет возможности принять оплату картой"),e.closeModal()}}))()},onLoad(){this.loadAnimation=0},listenFrame(){let e=this;window.addEventListener("message",(r=>{"paymentOk"!=r.data&&"paymentNo"!=r.data||e.closeModal()}))}}},k=t(3744);const v=(0,k.Z)(h,[["render",d]]);var f=v},9064:function(e,r,t){t.d(r,{Z:function(){return $}});var o=t(6252),n=t(3577);const i={class:"delivery-adress",style:{"font-size":"1em"}},l={class:"center"},a=(0,o.Uk)("Адрес доставки заказа"),s={class:"center"},d={key:0,class:"delivery-time"},u=(0,o.Uk)("мин"),c=(0,o.Uk)(" Выбрать адрес доставки ");function m(e,r,t,m,p,y){const _=(0,o.up)("ion-text"),h=(0,o.up)("ion-icon"),k=(0,o.up)("ion-note"),v=(0,o.up)("ion-label"),f=(0,o.up)("ion-item"),w=(0,o.up)("ion-textarea");return(0,o.wg)(),(0,o.iD)(o.HY,null,[y.isMainLocationSet?((0,o.wg)(),(0,o.iD)("div",{key:0,onClick:r[0]||(r[0]=e=>y.selectDeliveryAddress()),class:"selector"},[(0,o._)("div",i,[(0,o._)("div",l,[(0,o.Wm)(_,{size:"small",color:"medium"},{default:(0,o.w5)((()=>[a])),_:1}),(0,o.Wm)(h,{icon:m.chevronDownOutline,color:"medium"},null,8,["icon"])]),(0,o._)("div",s,[(0,o.Wm)(h,{slot:"start",color:"secondary",icon:m.location},null,8,["icon"]),(0,o.Wm)(_,{color:"dark"},{default:(0,o.w5)((()=>{var r,t;return[(0,o._)("b",null,(0,n.zw)(null===(r=e.$heap.state.user)||void 0===r||null===(t=r.location_main)||void 0===t?void 0:t.location_address),1)]})),_:1})])]),t.deliveryTime?((0,o.wg)(),(0,o.iD)("div",d,[(0,o.Wm)(_,{style:{"font-size":"24px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(t.deliveryTime.time),1)])),_:1}),(0,o.Wm)(k,{style:{"font-size":"10px",color:"var(--ion-color-secondary-contrast)"}},{default:(0,o.w5)((()=>[u])),_:1})])):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.j4)(f,{key:1,detail:"",button:"",onClick:r[1]||(r[1]=e=>y.selectDeliveryAddress()),class:"selector"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{slot:"start",style:{color:"var(--ion-color-primary)"},icon:m.location},null,8,["icon"]),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[c])),_:1})])),_:1})),t.showComment&&e.$heap.state.user.location_main?((0,o.wg)(),(0,o.j4)(f,{key:2},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{rows:"1",placeholder:"комментарий к адресу",onChange:r[2]||(r[2]=e=>y.locationCommentChanged()),modelValue:e.$heap.state.user.location_main.location_comment,"onUpdate:modelValue":r[3]||(r[3]=r=>e.$heap.state.user.location_main.location_comment=r)},null,8,["modelValue"])])),_:1})):(0,o.kq)("",!0)],64)}var p=t(8534),y=(t(8862),t(8292)),_=t(8903),h=t(2008),k=t(422),v=t(9042),f=t(9755),w=t.n(f),g={props:["deliveryTime","showComment"],components:{IonIcon:y.gu,IonTextarea:y.g2,IonText:y.yW,IonNote:y.uN,IonLabel:y.Q$,IonItem:y.Ie},setup(){return{location:_.xhW,chevronDownOutline:_.Y$3}},data(){return{location_main:h.Z.state.user.location_main}},created(){let e=this;v.Z.on("userMainLocationSet",(r=>{e.location_main=r})),v.Z.on("userGet",(r=>{e.location_main=r.location_main}))},methods:{selectDeliveryAddress(){k.Z.push("/user/user-addresses")},locationCommentChanged(){var e=this;return(0,p.Z)((function*(){const r={location_id:h.Z.state.user.location_main.location_id,location_comment:h.Z.state.user.location_main.location_comment};w().post(e.$heap.state.hostname+"Location/itemUpdate",JSON.stringify(r))}))()}},computed:{isSignedIn(){return h.Z.state.user.user_id&&h.Z.state.user.user_id>-1},isMainLocationSet(){return this.location_main?1:0}}},C=t(3744);const b=(0,C.Z)(g,[["render",m],["__scopeId","data-v-48384b7b"]]);var $=b},3422:function(e,r,t){t.r(r),t.d(r,{default:function(){return be}});var o=t(6252),n=t(3577);const i=e=>((0,o.dD)("data-v-40aecfe4"),e=e(),(0,o.Cn)(),e),l=i((()=>(0,o._)("label",{for:"store_correction_allow",style:{"font-size":"0.9em"},color:"medium"}," Разрешить изменять заказ ",-1))),a=(0,o.Uk)("Способы доставки"),s={for:"delivery_by_courier"},d=(0,o.Uk)("Доставит "),u={slot:"end"},c=["checked"],m={for:"delivery_by_store"},p=(0,o.Uk)("Доставит "),y={slot:"end"},_=["checked"],h=i((()=>(0,o._)("label",{for:"pickup_by_customer"},"Самовывоз",-1))),k={slot:"end"},v=["checked"],f=(0,o.Uk)("Способы оплаты"),w=i((()=>(0,o._)("label",{for:"payment_cash"},"Оплата наличными",-1))),g={slot:"end"},C=["checked"],b=i((()=>(0,o._)("label",{for:"payment_cash_store"},"Оплата наличными продавцу",-1))),$={slot:"end"},W=["checked"],I={key:7},O=i((()=>(0,o._)("label",{for:"payment_card"},"Оплата картой без привязки",-1))),R={slot:"end"},B=["checked"],S={for:"use_card_recurrent"},T={slot:"end"},U=["checked"],L=(0,o.Uk)("Выбрать другую карту"),z=(0,o.Uk)("Привязать карту"),Z=(0,o.Uk)("Итог"),D=(0,o.Uk)(" Сумма заказа "),j={key:8},q={slot:"start"},x={class:"righttop_badge"},A={slot:"start"},G={class:"righttop_badge"},P=(0,o.Uk)(" Выберите скидку "),M={key:9},N={slot:"start"},V=(0,o.Uk)(" Скидка доступна при доставке "),F=(0,o.Uk)(" Доставка "),H=(0,o.Uk)(" Итого к оплате "),E=(0,o.Uk)(" Я согласен(на) с "),J=(0,o.Uk)("офертой об оказании услуг доставки"),Y=(0,o.Uk)("Оплатить картой"),K=(0,o.Uk)("Послать заказ");function Q(e,r,t,i,Q,X){const ee=(0,o.up)("user-address-widget"),re=(0,o.up)("ion-item-divider"),te=(0,o.up)("ion-textarea"),oe=(0,o.up)("ion-item"),ne=(0,o.up)("ion-checkbox"),ie=(0,o.up)("ion-icon"),le=(0,o.up)("ion-img"),ae=(0,o.up)("ion-label"),se=(0,o.up)("ion-text"),de=(0,o.up)("ion-badge"),ue=(0,o.up)("router-link"),ce=(0,o.up)("ion-list"),me=(0,o.up)("ion-card-content"),pe=(0,o.up)("ion-card"),ye=(0,o.up)("ion-button"),_e=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(_e,{pageTitle:"Оформление заказа",pageDefaultBackLink:"/order/order-list"},{default:(0,o.w5)((()=>[(0,o.Wm)(ee,{deliveryTime:Q.deliveryTime,showComment:"1"},null,8,["deliveryTime"]),Q.order?((0,o.wg)(),(0,o.j4)(ce,{key:0},{default:(0,o.w5)((()=>{var t;return[(0,o.Wm)(re,null,{default:(0,o.w5)((()=>{var e,r,t;return[(0,o.Uk)("Заказ #"+(0,n.zw)(null===(e=Q.order)||void 0===e?void 0:e.order_id)+' из "'+(0,n.zw)(null===(r=Q.order)||void 0===r||null===(t=r.store)||void 0===t?void 0:t.store_name)+'"',1)]})),_:1}),(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[(0,o.Wm)(te,{rows:"2",placeholder:"комментарий к заказу",onChange:r[0]||(r[0]=e=>X.orderDescriptionChanged()),modelValue:Q.order.order_description,"onUpdate:modelValue":r[1]||(r[1]=e=>Q.order.order_description=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[l,(0,o.Wm)(ne,{slot:"end",id:"store_correction_allow",modelValue:Q.storeCorrectionAllow,"onUpdate:modelValue":r[2]||(r[2]=e=>Q.storeCorrectionAllow=e)},null,8,["modelValue"])])),_:1}),Q.storeIsReady?((0,o.wg)(),(0,o.j4)(re,{key:0},{default:(0,o.w5)((()=>[a])),_:1})):(0,o.kq)("",!0),X.deliveryByCourierRule?((0,o.wg)(),(0,o.j4)(oe,{key:1,button:"",onClick:r[3]||(r[3]=e=>X.tariffRuleSet(X.deliveryByCourierRule))},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),(0,o._)("label",s,[d,(0,o._)("b",null,(0,n.zw)(e.$heap.state.settings.app_title),1)]),(0,o._)("div",u,[(0,o._)("input",{type:"radio",name:"deliveryBy",id:"delivery_by_courier",value:"courier",checked:X.deliveryByCourierRuleChecked},null,8,c)])])),_:1})):(0,o.kq)("",!0),X.deliveryByStoreRule?((0,o.wg)(),(0,o.j4)(oe,{key:2,button:"",onClick:r[4]||(r[4]=e=>X.tariffRuleSet(X.deliveryByStoreRule))},{default:(0,o.w5)((()=>{var e,r;return[(0,o.Wm)(ie,{icon:i.rocketOutline,slot:"start"},null,8,["icon"]),(0,o._)("label",m,[p,(0,o._)("b",null,(0,n.zw)(null===(e=Q.order)||void 0===e||null===(r=e.store)||void 0===r?void 0:r.store_name),1)]),(0,o._)("div",y,[(0,o._)("input",{type:"radio",name:"deliveryBy",id:"delivery_by_store",value:"store",checked:X.deliveryByStoreRuleChecked},null,8,_)])]})),_:1})):(0,o.kq)("",!0),X.pickupByCustomerRule?((0,o.wg)(),(0,o.j4)(oe,{key:3,button:"",onClick:r[5]||(r[5]=e=>X.tariffRuleSet(X.pickupByCustomerRule))},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.storefrontOutline,slot:"start"},null,8,["icon"]),h,(0,o._)("div",k,[(0,o._)("input",{type:"radio",name:"deliveryBy",id:"pickup_by_customer",value:"store",checked:X.pickupByCustomerRuleChecked},null,8,v)])])),_:1})):(0,o.kq)("",!0),Q.storeIsReady?((0,o.wg)(),(0,o.j4)(re,{key:4},{default:(0,o.w5)((()=>[f])),_:1})):(0,o.kq)("",!0),1==Q.tariffRule.paymentByCash?((0,o.wg)(),(0,o.j4)(oe,{key:5,button:"",onClick:r[6]||(r[6]=e=>Q.paymentType="use_cash")},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),w,(0,o._)("div",g,[(0,o._)("input",{type:"radio",name:"paymentType",id:"payment_cash",value:"cash",checked:"use_cash"==Q.paymentType},null,8,C)])])),_:1})):(0,o.kq)("",!0),1==Q.tariffRule.paymentByCashStore?((0,o.wg)(),(0,o.j4)(oe,{key:6,button:"",onClick:r[7]||(r[7]=e=>Q.paymentType="use_cash_store")},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.cashOutline,slot:"start",color:"primary"},null,8,["icon"]),b,(0,o._)("div",$,[(0,o._)("input",{type:"radio",name:"paymentType",id:"payment_cash_store",value:"cash",checked:"use_cash_store"==Q.paymentType},null,8,W)])])),_:1})):(0,o.kq)("",!0),1==Q.tariffRule.paymentByCard?((0,o.wg)(),(0,o.iD)("div",I,[(0,o.Wm)(oe,{button:"",onClick:r[8]||(r[8]=e=>Q.paymentType="use_card")},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.cardOutline,slot:"start",color:"primary"},null,8,["icon"]),O,(0,o._)("div",R,[(0,o._)("input",{type:"radio",name:"paymentType",id:"payment_card",value:"card",checked:"use_card"==Q.paymentType},null,8,B)])])),_:1}),null!==(t=Q.bankCard)&&void 0!==t&&t.card_type?((0,o.wg)(),(0,o.j4)(oe,{key:0,button:"",onClick:r[9]||(r[9]=e=>Q.paymentType="use_card_recurrent")},{default:(0,o.w5)((()=>{var e;return["mir"==Q.bankCard.card_type?((0,o.wg)(),(0,o.j4)(le,{key:0,class:"card_type",src:`/img/icons/card-${Q.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==Q.bankCard.card_type?((0,o.wg)(),(0,o.j4)(le,{key:1,class:"card_type",src:`/img/icons/card-${Q.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==Q.bankCard.card_type?((0,o.wg)(),(0,o.j4)(le,{key:2,class:"card_type",src:`/img/icons/card-${Q.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):((0,o.wg)(),(0,o.j4)(ie,{key:3,src:i.cardOutline,slot:"start",color:"primary"},null,8,["src"])),(0,o._)("label",S,"Оплата картой "+(0,n.zw)(null===(e=Q.bankCard)||void 0===e?void 0:e.card_mask),1),(0,o._)("div",T,[(0,o._)("input",{type:"radio",name:"paymentType",id:"use_card_recurrent",value:"registered_card",checked:"use_card_recurrent"==Q.paymentType},null,8,U)])]})),_:1})):(0,o.kq)("",!0),Q.recurrentPaymentAllow?((0,o.wg)(),(0,o.j4)(oe,{key:1,button:"",detail:"",onClick:r[10]||(r[10]=r=>e.$router.push("/user/user-cards"))},{default:(0,o.w5)((()=>{var e;return[null!==(e=Q.bankCard)&&void 0!==e&&e.card_type?((0,o.wg)(),(0,o.j4)(ae,{key:0,color:"medium"},{default:(0,o.w5)((()=>[L])),_:1})):((0,o.wg)(),(0,o.j4)(ae,{key:1,color:"medium"},{default:(0,o.w5)((()=>[z])),_:1}))]})),_:1})):(0,o.kq)("",!0)])):(0,o.kq)("",!0),(0,o.Wm)(re,null,{default:(0,o.w5)((()=>[Z])),_:1}),(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.cubeOutline,slot:"start",color:"primary"},null,8,["icon"]),D,(0,o.Wm)(se,{slot:"end"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(Q.order.order_sum_product)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),X.deliveryByCourierRuleChecked?((0,o.wg)(),(0,o.iD)("div",j,[Q.promo?((0,o.wg)(),(0,o.j4)(oe,{key:0,button:"",onClick:r[11]||(r[11]=e=>X.promoPick()),color:"success"},{default:(0,o.w5)((()=>[(0,o._)("div",q,[(0,o.Wm)(ie,{icon:i.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,o._)("sup",x,[Q.promoCount>0?((0,o.wg)(),(0,o.j4)(de,{key:0,color:"secondary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(Q.promoCount),1)])),_:1})):(0,o.kq)("",!0)])]),(0,o.Uk)(" "+(0,n.zw)(Q.promo.promo_name)+" ",1),(0,o.Wm)(se,{slot:"end"},{default:(0,o.w5)((()=>[(0,o.Uk)("-"+(0,n.zw)(Q.order.order_sum_promo)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):((0,o.wg)(),(0,o.j4)(oe,{key:1,button:"",detail:"",onClick:r[12]||(r[12]=e=>X.promoPick())},{default:(0,o.w5)((()=>[(0,o._)("div",A,[(0,o.Wm)(ie,{icon:i.giftOutline,color:"primary",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,o._)("sup",G,[Q.promoCount>0?((0,o.wg)(),(0,o.j4)(de,{key:0,color:"secondary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(Q.promoCount),1)])),_:1})):(0,o.kq)("",!0)])]),P])),_:1}))])):((0,o.wg)(),(0,o.iD)("div",M,[(0,o.Wm)(oe,null,{default:(0,o.w5)((()=>[(0,o._)("div",N,[(0,o.Wm)(ie,{icon:i.giftOutline,color:"medium",style:{"font-size":"1.5em"}},null,8,["icon"])]),(0,o.Wm)(se,{color:"medium"},{default:(0,o.w5)((()=>[V,(0,o._)("b",null,(0,n.zw)(e.$heap.state.settings.app_title),1)])),_:1})])),_:1})])),Q.order_sum_delivery>0?((0,o.wg)(),(0,o.j4)(oe,{key:10},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.rocketOutline,slot:"start",color:"primary"},null,8,["icon"]),F,(0,o.Wm)(se,{slot:"end"},{default:(0,o.w5)((()=>{var r;return[(0,o.Uk)((0,n.zw)(null!==(r=Q.order_sum_delivery)&&void 0!==r?r:0)+(0,n.zw)(e.$heap.state.currencySign),1)]})),_:1})])),_:1})):(0,o.kq)("",!0),X.order_sum_total>0?((0,o.wg)(),(0,o.j4)(oe,{key:11},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{icon:i.walletOutline,slot:"start",color:"primary"},null,8,["icon"]),H,(0,o.Wm)(se,{slot:"end"},{default:(0,o.w5)((()=>[(0,o._)("b",null,(0,n.zw)(X.order_sum_total),1),(0,o.Uk)((0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(oe,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(se,{style:{"font-size":"0.9em"}},{default:(0,o.w5)((()=>[E,(0,o.Wm)(ue,{to:"/page/rules-customer"},{default:(0,o.w5)((()=>[J])),_:1})])),_:1}),(0,o.Wm)(ne,{slot:"end",modelValue:Q.termsAccepted,"onUpdate:modelValue":r[13]||(r[13]=e=>Q.termsAccepted=e)},null,8,["modelValue"])])),_:1})]})),_:1})):(0,o.kq)("",!0),X.checkoutError?((0,o.wg)(),(0,o.j4)(pe,{key:1,color:"warning"},{default:(0,o.w5)((()=>[(0,o.Wm)(me,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(X.checkoutError),1)])),_:1})])),_:1})):(0,o.kq)("",!0),"use_card"==Q.paymentType||"use_card_recurrent"==Q.paymentType?((0,o.wg)(),(0,o.j4)(ye,{key:2,expand:"block",onClick:r[14]||(r[14]=e=>X.proceed()),disabled:X.checkoutError},{default:(0,o.w5)((()=>[Y])),_:1},8,["disabled"])):((0,o.wg)(),(0,o.j4)(ye,{key:3,expand:"block",onClick:r[15]||(r[15]=e=>X.proceed()),disabled:X.checkoutError},{default:(0,o.w5)((()=>[K])),_:1},8,["disabled"]))])),_:1})}var X=t(8534),ee=(t(4916),t(5306),t(8862),t(7782)),re=t(4405),te=t(9042),oe=t(422),ne=t(9755),ie=t.n(ne),le=t(8764),ae=t(8903),se=t(8292),de=t(9064),ue=t(5265);const ce=(0,o.Uk)("Ваши доступные скидки"),me=(0,o.Uk)("Без скидки"),pe=(0,o.Uk)("К сожалению, доступных скидок нет."),ye=(0,o.Uk)("Показать все ваши скидки "),_e={key:0};function he(e,r,t,i,l,a){const s=(0,o.up)("ion-title"),d=(0,o.up)("ion-icon"),u=(0,o.up)("ion-toolbar"),c=(0,o.up)("ion-header"),m=(0,o.up)("ion-skeleton-text"),p=(0,o.up)("ion-item"),y=(0,o.up)("ion-list"),_=(0,o.up)("ion-text"),h=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{color:"secondary"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[ce])),_:1}),(0,o.Wm)(d,{icon:i.closeOutline,onClick:r[0]||(r[0]=r=>e.$topic.publish("dismissModal")),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[null==l.promoList?((0,o.wg)(),(0,o.j4)(y,{key:0},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2,3],(e=>(0,o.Wm)(p,{lines:"none",key:e},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{slot:"start",icon:i.giftOutline,color:"primary"},null,8,["icon"]),(0,o.Wm)(m,{style:{width:"70%"}}),(0,o.Wm)(m,{slot:"end",style:{width:"50px"}})])),_:2},1024))),64))])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>{var t;return[null!==(t=l.promoList)&&void 0!==t&&t.length?((0,o.wg)(),(0,o.j4)(p,{key:0,button:"",onClick:r[1]||(r[1]=e=>a.promoPick({}))},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{slot:"start",icon:i.banOutline,color:"danger"},null,8,["icon"]),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[me])),_:1}),(0,o.Wm)(_,{slot:"end"},{default:(0,o.w5)((()=>[(0,o.Uk)("0"+(0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):((0,o.wg)(),(0,o.j4)(p,{key:1},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{slot:"start",icon:i.giftOutline,color:"medium"},null,8,["icon"]),(0,o.Wm)(_,{color:"medium"},{default:(0,o.w5)((()=>[pe])),_:1})])),_:1})),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.promoList,(r=>((0,o.wg)(),(0,o.j4)(p,{key:r.promo_id,button:"",onClick:e=>a.promoPick(r)},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{slot:"start",icon:i.giftOutline,color:"primary"},null,8,["icon"]),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(r.promo_name),1)])),_:2},1024),(0,o.Wm)(_,{slot:"end",color:"success"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(r.promo_value)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),(0,o.Wm)(p,{button:"",detail:"",onClick:r[2]||(r[2]=r=>{e.$router.push("/user/user-promo"),e.$topic.publish("dismissModal")})},{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>{var e;return[ye,null!==(e=l.promoList)&&void 0!==e&&e.length?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("span",_e,"или получить ещё"))]})),_:1})])),_:1})]})),_:1})])),_:1})],64)}var ke={components:{IonIcon:se.gu,IonToolbar:se.sr,IonHeader:se.Gu,IonContent:se.W2,IonTitle:se.wd,IonList:se.q_,IonItem:se.Ie,IonText:se.yW,IonSkeletonText:se.CK},setup(){return{giftOutline:ae._$o,closeOutline:ae.fID,banOutline:ae.L6S}},data(){return{promoList:null}},mounted(){this.listGet()},methods:{listGet(){var e=this;return(0,X.Z)((function*(){try{const r={type:"active",user_id:e.$heap.state.user.user_id};e.promoList=yield ie().post(`${e.$heap.state.hostname}Promo/listGet`,r)}catch(r){}}))()},promoPick(e){se.Fy.dismiss(e)}}},ve=t(3744);const fe=(0,ve.Z)(ke,[["render",he]]);var we=fe,ge={components:{UserAddressWidget:de.Z,IonTextarea:se.g2,IonItemDivider:se.rH,IonIcon:se.gu,IonItem:se.Ie,IonList:se.q_,IonText:se.yW,IonButton:se.YG,IonCheckbox:se.nz,IonCard:se.PM,IonCardContent:se.FN,IonBadge:se.yp,IonImg:se.Xz,IonLabel:se.Q$},setup(){return{cardOutline:ae.pvm,cashOutline:ae.zaw,giftOutline:ae._$o,cubeOutline:ae.XFf,walletOutline:ae.S5P,pieChartOutline:ae.qlh,storefrontOutline:ae.qRG,ordersIcon:le,rocketOutline:ae.G$D,documentTextOutline:ae.L82}},data(){var e,r;return{order_id:this.$route.params.id,order:null,order_sum_delivery:0,storeCorrectionAllow:0==localStorage.storeCorrectionAllow?0:1,promo:null,promoCount:0,deliveryTime:{},termsAccepted:1,storeIsReady:0,errNotfound:0,paymentType:"use_card",bankCard:null,recurrentPaymentAllow:1==(null===(e=this.$heap.state.settings)||void 0===e||null===(r=e.other)||void 0===r?void 0:r.recurrentPaymentAllow)?1:0,tariffRule:{},tariffRuleList:[]}},computed:{checkoutError(){var e,r,t,o,n,i,l,a;return!!this.order&&(this.order_sum_total<2*this.order.order_sum_promo?`Сумма к оплате со скидкой ${this.order.order_sum_promo}${this.$heap.state.currencySign} должна быть больше чем ${2*this.order.order_sum_promo}${this.$heap.state.currencySign}`:1*this.order.order_sum_product<1*(null===(e=this.order)||void 0===e||null===(r=e.store)||void 0===r?void 0:r.store_minimal_order)?`Сумма заказа у "${null===(t=this.order)||void 0===t||null===(o=t.store)||void 0===o?void 0:o.store_name}" должна быть больше чем ${null===(n=this.order)||void 0===n||null===(i=n.store)||void 0===i?void 0:i.store_minimal_order}${this.$heap.state.currencySign}`:1*this.order_sum_total<=1*this.order_sum_delivery?`Сумма к оплате должна быть больше чем ${this.order_sum_delivery}${this.$heap.state.currencySign}`:this.order_sum_total<=10?"Сумма к оплате слишком маленькая":0==this.storeIsReady?`К сожалению, ${(null===(l=this.order)||void 0===l||null===(a=l.store)||void 0===a?void 0:a.store_name)||"продавец"} не готов к заказам`:0==this.termsAccepted?"К сожалению, мы не можем доставить вам заказ, без согласия с условиями":1==this.errNotfound?"Заказ удален":1==this.tariffRule.deliveryByCourier&&0==this.tariffRule.deliveryIsReady&&"К сожалению, нет доступных курьеров")},order_sum_total(){return this.order.order_sum_product-this.order.order_sum_promo+this.order_sum_delivery},deliveryByCourierRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.deliveryByCourier)).shift()},deliveryByCourierRuleChecked(){return 1==this.tariffRule.deliveryByCourier},deliveryByStoreRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.deliveryByStore)).shift()},deliveryByStoreRuleChecked(){return 1==this.tariffRule.deliveryByStore},pickupByCustomerRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.pickupByCustomer)).shift()},pickupByCustomerRuleChecked(){return 1==this.tariffRule.pickupByCustomer}},mounted(){this.checkoutDataGet()},ionViewDidEnter(){this.checkoutDataGet()},methods:{itemLoad(){var e=this;return(0,X.Z)((function*(){try{e.order=yield ie().post(`${e.$heap.state.hostname}Order/itemGet`,{order_id:e.order_id}),0==e.order_sum_delivery&&(e.order_sum_delivery,e.order.order_sum_delivery),e.$heap.commit("setCurrentOrder",e.order)}catch(r){}}))()},checkoutDataGet(){var e=this;return(0,X.Z)((function*(){if(e.order=e.$heap.state.currentOrder,e.order||(yield e.itemLoad()),e.order)if("customer_confirmed"==e.order.stage_current)try{const r=yield ie().post(`${e.$heap.state.hostname}Order/itemCheckoutDataGet`,{order_id:e.order.order_id});e.deliveryTime=re.Z.deliveryTimeCalculate(r.Location_distanceHolderGet,null),e.promo=r.Promo_itemLinkGet,e.promoCount=r.Promo_listGet,e.storeIsReady=Array.isArray(r.Store_deliveryOptions)?1:0,e.bankCard=null===r||void 0===r?void 0:r.bankCard,e.tariffRuleList=r.Store_deliveryOptions,e.tariffRuleSet(e.tariffRuleList[0]||{})}catch(r){const t=null===r||void 0===r?void 0:r.responseJSON;if(!t)return!1;const o=t.messages.error;switch(o){case"not_ready":case"no_tariff":e.storeIsReady=0;break;default:e.errNotfound=1}return!1}else e.$router.replace("order-"+e.order.order_id);else e.$flash("Заказ не найден")}))()},tariffRuleSet(e){var r;this.tariffRule=e,this.order_sum_delivery=e.order_sum_delivery,this.paymentType="use_card",null!==(r=this.bankCard)&&void 0!==r&&r.card_type&&(this.paymentType="use_card_recurrent"),1==e.paymentByCashStore?this.paymentType="use_cash_store":1==e.paymentByCash&&(this.paymentType="use_cash"),1!=e.deliveryByCourier&&null!=this.promo&&(this.promoLink({order_id:this.order_id}),this.promo=null)},orderDescriptionChanged(){var e=this;return(0,X.Z)((function*(){const r={order_id:e.order.order_id,order_description:e.order.order_description};ee.Z.api.itemUpdate(r)}))()},proceed(){var e=this;return(0,X.Z)((function*(){const r={order_id:e.order.order_id,tariff_id:e.tariffRule.tariff_id,deliveryByStore:e.deliveryByStoreRuleChecked?1:0,deliveryByCourier:e.deliveryByCourierRuleChecked?1:0,pickupByCustomer:e.pickupByCustomerRuleChecked?1:0,paymentByCard:"use_card"==e.paymentType?1:0,paymentByCardRecurrent:"use_card_recurrent"==e.paymentType?1:0,paymentByCash:"use_cash"==e.paymentType?1:0,paymentByCashStore:"use_cash_store"==e.paymentType?1:0,storeCorrectionAllow:e.storeCorrectionAllow?1:0};localStorage.storeCorrectionAllow=e.storeCorrectionAllow?1:0;try{yield ie().post(`${e.$heap.state.hostname}Order/itemCheckoutDataSet`,JSON.stringify(r))}catch(n){const r=null===n||void 0===n?void 0:n.responseJSON;if(!r)return!1;r.messages.error;return e.$flash("С заказом возникла проблема"),!1}if(1!=r.paymentByCard){if(1==r.paymentByCardRecurrent){const r={order_id:e.order.order_id,card_id:e.bankCard.card_id};try{yield ie().post(`${e.$heap.state.hostname}CardAcquirer/paymentDo`,r)}catch(n){return e.$flash("Оплата привязанной картой не удалась"),!1}}try{yield ee.Z.api.itemStageCreate(e.order.order_id,"customer_start"),e.$router.replace("/order/order-"+e.order.order_id)}catch(n){var t,o;const r=null===n||void 0===n||null===(t=n.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;switch(r){case"order_is_empty":e.$alert("К сожалению, товара не осталось в наличии &#9785;","Заказ пуст");break;case"address_not_set":e.$flash("Необходимо добавить адрес доставки"),e.$topic.publish("dismissModal"),e.$router.push("/user/user-addresses");break}return!1}}else e.paymentFormOpen({order_id:e.order.order_id,order_sum_total:e.order_sum_total,user_id:e.order.owner_id})}))()},cancel(){var e=this;return(0,X.Z)((function*(){e.$router.replace("order-"+e.order.order_id)}))()},paymentFormOpen(e){var r=this;return(0,X.Z)((function*(){const t=r,o=yield se.Fy.create({component:ue.Z,componentProps:{order_data:e},initialBreakpoint:.85,breakpoints:[0,.85,.95]}),n=function(){o.dismiss()};return te.Z.on("dismissModal",n),o.onDidDismiss().then((()=>{t.paymentStatusCheck()})),o.present()}))()},paymentStatusCheck(){var e=this;return(0,X.Z)((function*(){const r={order_id:e.order.order_id};try{const t=yield ie().post(e.$heap.state.hostname+"CardAcquirer/statusGet",r);"OK"==t&&oe.Z.replace("order-"+e.order.order_id)}catch(n){var t,o;e.$flash("Данный заказ не может быть оплачен");const r=null===(t=n.responseJSON)||void 0===t||null===(o=t.messages)||void 0===o?void 0:o.error;"wrong_status"==r&&oe.Z.replace("order-"+e.order.order_id)}}))()},promoPick(){var e=this;return(0,X.Z)((function*(){var r;const t=yield se.Fy.create({component:we,showBackdrop:!0,backdropDismiss:!0,initialBreakpoint:.6,breakpoints:[0,.6,.75]});t.present(),e.$topic.on("dismissModal",(()=>{t.dismiss()}));const o=yield t.onDidDismiss();e.promoLink(o.data),null!==o&&void 0!==o&&null!==(r=o.data)&&void 0!==r&&r.promo_id?e.promo=o.data:e.promo=null}))()},promoLink(e){var r=this;return(0,X.Z)((function*(){try{const t={promo_id:null===e||void 0===e?void 0:e.promo_id,order_id:r.order.order_id};yield ie().post(`${r.$heap.state.hostname}Promo/itemLink`,t),r.itemLoad()}catch(t){}}))()},promoGet(){var e=this;return(0,X.Z)((function*(){try{const r={order_id:e.order.order_id};return yield ie().post(`${e.$heap.state.hostname}Promo/itemLinkGet`,r)}catch(r){}}))()},promoCountGet(){var e=this;return(0,X.Z)((function*(){try{const r={mode:"count",type:"active",user_id:e.$heap.state.user.user_id};return yield ie().post(`${e.$heap.state.hostname}Promo/listGet`,r)}catch(r){}}))()}}};const Ce=(0,ve.Z)(ge,[["render",Q],["__scopeId","data-v-40aecfe4"]]);var be=Ce},659:function(e,r,t){e.exports=t.p+"img/loading.30880178.svg"},8764:function(e,r,t){e.exports=t.p+"img/orders.ea36eab8.svg"}}]);
//# sourceMappingURL=3422-legacy.a55581f8.js.map