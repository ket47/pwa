"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[653],{1653:function(e,t,o){o.r(t),o.d(t,{default:function(){return J}});var i=o(6252),n=o(3577);const s=e=>((0,i.dD)("data-v-7b6db47d"),e=e(),(0,i.Cn)(),e),r=(0,i.Uk)(" Задания "),a=(0,i.Uk)(" Активные "),l=(0,i.Uk)(" Исполненые "),u={key:1,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},d={style:{width:"max-content","text-align":"center"}},c=(0,i.Uk)("Заказов нет"),_=s((()=>(0,i._)("br",null,null,-1)));function m(e,t,o,s,m,p){const f=(0,i.up)("ion-segment-button"),w=(0,i.up)("ion-segment"),h=(0,i.up)("ion-icon"),k=(0,i.up)("ion-avatar"),y=(0,i.up)("ion-label"),g=(0,i.up)("ion-chip"),b=(0,i.up)("ion-note"),W=(0,i.up)("ion-text"),v=(0,i.up)("ion-item"),I=(0,i.up)("ion-list"),j=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(j,{"page-default-back-link":"/home","page-title":"Заказы"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{"swipe-gesture":"true",modelValue:m.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>m.orderType=e),onIonChange:t[1]||(t[1]=e=>p.listTypeChanged(e))},{default:(0,i.w5)((()=>[m.courierJobsInclude?((0,i.wg)(),(0,i.j4)(f,{key:0,value:"jobs"},{default:(0,i.w5)((()=>[r])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(f,{value:"active"},{default:(0,i.w5)((()=>[a])),_:1}),(0,i.Wm)(f,{value:"done"},{default:(0,i.w5)((()=>[l])),_:1})])),_:1},8,["modelValue"]),m.orderList.length?((0,i.wg)(),(0,i.j4)(I,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(p.orderListComputed,(t=>((0,i.wg)(),(0,i.j4)(v,{key:t.order_id,onClick:e=>p.itemClick(t),detail:"",lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{slot:"start"},{default:(0,i.w5)((()=>["customer"==t.user_role?((0,i.wg)(),(0,i.j4)(h,{key:0,src:"./assets/icon/box-delivery.svg"})):(0,i.kq)("",!0),"courier"==t.user_role?((0,i.wg)(),(0,i.j4)(h,{key:1,src:"./assets/icon/delivery_staying.svg"})):(0,i.kq)("",!0),"admin"==t.user_role?((0,i.wg)(),(0,i.j4)(h,{key:2,src:"./assets/icon/crown.svg",style:{"font-size":"24px"}})):(0,i.kq)("",!0),"supplier"==t.user_role?((0,i.wg)(),(0,i.j4)(h,{key:3,icon:s.storefrontOutline,style:{"font-size":"24px"}},null,8,["icon"])):(0,i.kq)("",!0)])),_:2},1024),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name)+" #"+(0,n.zw)(t.order_id)+" ("+(0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign)+")",1)])),_:2},1024),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[t.distance_km?((0,i.wg)(),(0,i.j4)(g,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.distance_km),1)])),_:2},1024)):(0,i.kq)("",!0),t.stage_current_name?((0,i.wg)(),(0,i.j4)(g,{key:1,color:"success"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.stage_current_name),1)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.location_address),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,i.wg)(),(0,i.iD)("div",u,[(0,i._)("div",d,[(0,i.Wm)(h,{icon:s.sparklesOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[c])),_:1}),_])]))])),_:1})}var p=o(7248),f=o(8903),w=o(7782),h=o(351),k=o(9042),y=o(1933);const g={class:"center_chip"},b={class:"center_chip"},W={class:"center_chip"},v=(0,i.Uk)("Покупатель"),I=(0,i.Uk)("Покупатель"),j=(0,i.Uk)("Начать доставку");function z(e,t,o,s,r,a){const l=(0,i.up)("ion-icon"),u=(0,i.up)("ion-avatar"),d=(0,i.up)("ion-text"),c=(0,i.up)("ion-label"),_=(0,i.up)("ion-item"),m=(0,i.up)("ion-chip"),p=(0,i.up)("ion-note"),f=(0,i.up)("ion-skeleton-text"),w=(0,i.up)("ion-button"),h=(0,i.up)("ion-item-group"),k=(0,i.up)("ion-list");return o.orderData?((0,i.wg)(),(0,i.j4)(k,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{icon:s.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Курьер "+(0,n.zw)(e.$heap.state.user.user_name),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(_,{lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i.Wm)(m,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData?.courier_supplier_distance_km),1)])),_:1})])),_:1})])])),_:1}),(0,i.Wm)(_,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{icon:s.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.store_name),1)])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.location_address),1)])),_:1})])),_:1})])),_:1}),a.start_finish_distance_km?((0,i.wg)(),(0,i.j4)(_,{key:0,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",b,[(0,i.Wm)(m,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(a.start_finish_distance_km),1)])),_:1})])),_:1})])])),_:1})):((0,i.wg)(),(0,i.j4)(_,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",W,[(0,i.Wm)(m,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{animated:"",style:{width:"100%"}})])),_:1})])])),_:1})),r.job?((0,i.wg)(),(0,i.j4)(_,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{icon:s.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"primary"},{default:(0,i.w5)((()=>[v])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(r.job.finish_location_address),1)])),_:1})])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(_,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{icon:s.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{color:"primary"},{default:(0,i.w5)((()=>[I])),_:1}),(0,i.Wm)(f,{animated:"",style:{width:"60%"}}),(0,i.Wm)(f,{animated:"",style:{width:"80%"}})])),_:1})])),_:1})),r.job?((0,i.wg)(),(0,i.j4)(h,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Бонус "+(0,n.zw)(r.job.order_sum_delivery),1)])),_:1})])),_:1}),(0,i.Wm)(w,{onClick:t[0]||(t[0]=e=>a.deliveryStart()),expand:"full"},{default:(0,i.w5)((()=>[j])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})):(0,i.kq)("",!0)}var C={props:["orderData"],components:{IonList:p.q_,IonItemGroup:p.Ub,IonTitle:p.wd,IonButton:p.YG,IonSkeletonText:p.CK,IonNote:p.uN,IonChip:p.hM,IonItem:p.Ie,IonLabel:p.Q$,IonText:p.yW,IonAvatar:p.BJ,IonIcon:p.gu},setup(){return{storefrontOutline:f.qRG,locationOutline:f.Iv7,flagOutline:f.FMn}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){return this.job?.start_finish_distance?Math.round(this.job?.start_finish_distance/1e3)+"км":"-"}},methods:{async jobGet(){try{let e=await w.Z.api.itemJobGet(this.orderData.order_id);e.finish_location_address=e.finish_location_address.split(",").reverse().join(","),this.job=e,console.log(this.job)}catch(e){console.log(e);const t=e.responseJSON?.messages?.error;if("notfound"==t)return void this.$flash("Задание не найдено");if("notready"==t)return void this.$flash("Смена курьера не открыта")}},async deliveryStart(){const e=h.Z.courier.data.courier_id;try{await w.Z.api.itemJobStart(this.orderData.order_id,e),this.$router.push("order-"+this.orderData.order_id)}catch(t){const e=t.responseJSON?.messages?.error;"notfound"==e&&this.$flash("Задание не найдено"),"notready"==e&&this.$flash("Смена курьера не открыта"),"notsearching"!=e&&"idle"!=e||this.$flash("Заданию уже назначен курьер")}k.Z.publish("dismissModal")}}},L=o(3744);const U=(0,L.Z)(C,[["render",z],["__scopeId","data-v-3f162f31"]]);var O=U,x={components:{IonSegment:p.cJ,IonSegmentButton:p.GO,IonIcon:p.gu,IonAvatar:p.BJ,IonText:p.yW,IonLabel:p.Q$,IonItem:p.Ie,IonList:p.q_,IonChip:p.hM,IonNote:p.uN},setup(){return{sparklesOutline:f.Fcs,storefrontOutline:f.qRG,timeOutline:f.bdY}},data(){return{orderList:[],orderType:"active",courierJobsInclude:0,clock:null}},computed:{orderListComputed(){for(let e of this.orderList)e.location_address||(e.location_address=""),e.distance?e.courier_supplier_distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="";return this.orderList}},created(){let e=this;k.Z.on("courierStatusChange",(function(){e.courierReadinessCheck()})),e.courierReadinessCheck()},methods:{async listLoad(e){if(this.autoReload(e),"jobs"==e)return void this.listJobLoad();let t="customer_finish";"active"==e&&(t="!customer_finish"),this.orderList=await w.Z.api.listLoad(t)},listTypeChanged(e){const t=e.target.value;this.listLoad(t)},courierReadinessCheck(){this.courierJobsInclude="ready"==h.Z.courier.status?1:0,0==this.courierJobsInclude&&(this.orderType="active")},async listJobLoad(){try{const e=h.Z.courier.data.courier_id;this.orderList=await w.Z.api.listJobGet(e)}catch(e){const t=e.responseJSON?.messages?.error;"notready"==t&&(h.Z.courier.status="notready",this.courierReadinessCheck())}},autoReload(e){clearTimeout(this.clock);const t=this,o=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((()=>{t.listLoad(e)}),o))},ionViewDidEnter(){this.courierReadinessCheck(),"active"==this.orderType?this.listLoad("active"):this.orderType="active"},ionViewDidLeave(){clearTimeout(this.clock)},async itemClick(e){if(e.is_courier_job){const t=await p.Fy.create({component:O,componentProps:{orderData:e},initialBreakpoint:.5,breakpoints:[0,.5,.75]}),o=function(){t.dismiss()};return k.Z.on("dismissModal",o),t.present()}this.itemOpen(e.order_id)},itemOpen(e){y.Z.push(`order-${e}`)}}};const T=(0,L.Z)(x,[["render",m],["__scopeId","data-v-7b6db47d"]]);var J=T}}]);
//# sourceMappingURL=653.8630d00a.js.map