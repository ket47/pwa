"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[4557],{5908:function(t,e,a){a.d(e,{A:function(){return I}});var s=a(641),l=a(33);const i=t=>((0,s.Qi)("data-v-ccaff9d8"),t=t(),(0,s.jt)(),t),r={slot:"end",style:{display:"grid","grid-template-columns":"120px"}},n={slot:"end",style:{display:"grid","grid-template-columns":"120px"}},o={class:"horizontalScroller"},d={key:1,class:"printDiv"},u={class:"table_head"},c=i((()=>(0,s.Lk)("div",null,"Количество",-1))),h=i((()=>(0,s.Lk)("div",null,"Скидка",-1))),p=i((()=>(0,s.Lk)("div",null,"Сумма",-1))),v=i((()=>(0,s.Lk)("div",null,"Вознаграждение",-1))),f=i((()=>(0,s.Lk)("div",null,"К выплате",-1))),m={class:"table",style:{"overflow-x":"scroll"}},b=(0,s.Fv)('<div class="table_h" data-v-ccaff9d8><div data-v-ccaff9d8>Время</div><div data-v-ccaff9d8>Заказ №</div><div data-v-ccaff9d8>Товар</div><div data-v-ccaff9d8>Цена</div><div data-v-ccaff9d8>Количество</div><div data-v-ccaff9d8>Скидка</div><div data-v-ccaff9d8>Сумма</div><div data-v-ccaff9d8>Вознаграждение %</div><div data-v-ccaff9d8>Доставка</div><div data-v-ccaff9d8>Оплата</div><div data-v-ccaff9d8>Чек</div></div>',1),_=["href"];function k(t,e,a,i,k,g){const y=(0,s.g2)("ion-icon"),F=(0,s.g2)("ion-text"),w=(0,s.g2)("ion-item"),x=(0,s.g2)("ion-input"),L=(0,s.g2)("ion-list"),C=(0,s.g2)("ion-accordion"),I=(0,s.g2)("ion-accordion-group"),S=(0,s.g2)("ion-label"),D=(0,s.g2)("ion-chip"),O=(0,s.g2)("ion-searchbar"),z=(0,s.g2)("ion-skeleton-text");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(C,{value:"period"},{default:(0,s.k6)((()=>[(0,s.bF)(w,{slot:"header"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{icon:i.calendarOutline,slot:"start"},null,8,["icon"]),(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.eW)("Период "),(0,s.Lk)("small",null,(0,l.v_)(k.start_at)+" до "+(0,l.v_)(k.finish_at),1)])),_:1})])),_:1}),(0,s.bF)(L,{slot:"content"},{default:(0,s.k6)((()=>[(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.eW)("Начальная дата")])),_:1}),(0,s.Lk)("div",r,[(0,s.bF)(x,{type:"date",modelValue:k.start_at,"onUpdate:modelValue":e[0]||(e[0]=t=>k.start_at=t),onIonInput:e[1]||(e[1]=t=>g.reportGet())},null,8,["modelValue"])])])),_:1}),(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.eW)("Конечная дата")])),_:1}),(0,s.Lk)("div",n,[(0,s.bF)(x,{type:"date",modelValue:k.finish_at,"onUpdate:modelValue":e[2]||(e[2]=t=>k.finish_at=t),onIonInput:e[3]||(e[3]=t=>g.reportGet())},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1})])),_:1}),(0,s.Lk)("div",o,[(0,s.bF)(D,{onClick:e[4]||(e[4]=t=>g.reportExport()),color:"medium"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{src:i.downloadOutline},null,8,["src"]),(0,s.bF)(S,null,{default:(0,s.k6)((()=>[(0,s.eW)("Скачать")])),_:1})])),_:1}),(0,s.bF)(D,{onClick:e[5]||(e[5]=t=>g.reportGet()),color:"medium"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{src:i.reloadOutline},null,8,["src"]),(0,s.bF)(S,null,{default:(0,s.k6)((()=>[(0,s.eW)("Обновить")])),_:1})])),_:1})]),(0,s.bF)(O,{modelValue:k.searchQuery,"onUpdate:modelValue":e[6]||(e[6]=t=>k.searchQuery=t),placeholder:"Поиск по товару",onIonInput:e[7]||(e[7]=t=>g.reportGet()),debounce:"500"},null,8,["modelValue"]),null==k.report?((0,s.uX)(),(0,s.Wv)(L,{key:0},{default:(0,s.k6)((()=>[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([1,2,3],(t=>(0,s.bF)(w,{key:t},{default:(0,s.k6)((()=>[(0,s.bF)(F,{slot:"start"},{default:(0,s.k6)((()=>[(0,s.bF)(z,{animated:"",style:{width:"50px"}})])),_:1}),(0,s.bF)(S,null,{default:(0,s.k6)((()=>[(0,s.bF)(z,{animated:"",style:{width:"100%"}})])),_:1}),(0,s.bF)(S,{slot:"end",color:"success"},{default:(0,s.k6)((()=>[(0,s.bF)(z,{animated:"",style:{width:"50px"}})])),_:1})])),_:2},1024))),64))])),_:1})):k.report.body.length>0?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("div",u,[c,(0,s.Lk)("div",null,(0,l.v_)(k.report.head.total_quantity),1),h,(0,s.Lk)("div",null,(0,l.v_)(k.report.head.total_discount),1),p,(0,s.Lk)("div",null,(0,l.v_)(k.report.head.total_sum),1),v,(0,s.Lk)("div",null,(0,l.v_)(k.report.head.total_commission),1),f,(0,s.Lk)("div",null,(0,l.v_)(k.report.head.total_topay),1)]),(0,s.Lk)("div",m,[b,((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(k.report.body,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"table_r"},[(0,s.Lk)("div",null,(0,l.v_)(t.created_at),1),(0,s.Lk)("div",null,(0,l.v_)(t.order_id),1),(0,s.Lk)("div",null,(0,l.v_)(t.entry_text),1),(0,s.Lk)("div",null,(0,l.v_)(t.entry_price),1),(0,s.Lk)("div",null,(0,l.v_)(t.entry_quantity),1),(0,s.Lk)("div",null,(0,l.v_)(t.entry_discount),1),(0,s.Lk)("div",null,(0,l.v_)(t.entry_sum),1),(0,s.Lk)("div",null,(0,l.v_)(t.fee),1),(0,s.Lk)("div",null,(0,l.v_)(t.delivery),1),(0,s.Lk)("div",null,(0,l.v_)(t.payment_type),1),(0,s.Lk)("div",null,[t.invoice_link?((0,s.uX)(),(0,s.CE)("a",{key:0,href:t.invoice_link,target:"_new"},"онлайн чек",8,_)):(0,s.Q3)("",!0)])])))),128))])])):((0,s.uX)(),(0,s.Wv)(L,{key:2},{default:(0,s.k6)((()=>[(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.eW)(" Нет заказов в данном периоде ")])),_:1})])),_:1}))])}var g=a(5654),y=a(5480),F=a(2311),w=a.n(F),x={components:{IonIcon:g.iq,IonLabel:g.he,IonItem:g.uz,IonInput:g.$w,IonList:g.nf,IonAccordion:g.xk,IonAccordionGroup:g.YH,IonText:g.IO,IonSkeletonText:g.ds,IonSearchbar:g.S1,IonChip:g.ZB},props:["store"],setup(){return{calendarOutline:y.RXF,addOutline:y.EKF,closeCircle:y.P0k,pricetagOutline:y.eOv,downloadOutline:y.fPB,reloadOutline:y.QMU,printOutline:y.SfY}},data(){const t=new Date,e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),1));return{start_at:e.toISOString().slice(0,10),finish_at:t.toISOString().slice(0,10),searchQuery:"",report:null,today:t}},watch:{store:function(){this.reportGet()}},methods:{async reportGet(){var t;if(null===(t=this.store)||void 0===t||!t.store_id)return this.report=null,void(this.head=null);try{var e;const t={store_id:null===(e=this.store)||void 0===e?void 0:e.store_id,start_at:this.start_at,finish_at:this.finish_at,searchQuery:this.searchQuery},a=await w().post(`${this.$heap.state.hostname}Statistics/sellReportProductGet`,t);this.report=a}catch(l){var a,s;const t=null===l||void 0===l||null===(a=l.responseJSON)||void 0===a||null===(s=a.messages)||void 0===s?void 0:s.error;switch(t){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},reportPrint(){window.print()},async reportExport(){var t;if(null===(t=this.store)||void 0===t||!t.store_id)return this.report=null,void(this.head=null);try{var e;const t={store_id:null===(e=this.store)||void 0===e?void 0:e.store_id,start_at:this.start_at,finish_at:this.finish_at,searchQuery:this.searchQuery,output:"xlsx"},a=await w().post(`${this.$heap.state.hostname}Statistics/sellReportProductGet`,t),s=this.store.store_name.replace(/[^\wа-яА-Яa-zA-Z]/gi,""),l=`${this.$heap.state.hostname}Statistics/download/${a}/sellReport_${s}_${this.start_at}.xlsx`,i=document.createElement("a");i.href=l,i.download="download",i.click()}catch(l){var a,s;const t=null===l||void 0===l||null===(a=l.responseJSON)||void 0===a||null===(s=a.messages)||void 0===s?void 0:s.error;switch(t){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки"),console.log(l);break}return this.ledger=[],this.balance=0,!1}},toLocDate(t){const e=new Date(Date.parse(t)),a={month:"short",day:"numeric"};return e.toLocaleDateString(void 0,a)}},mounted(){this.reportGet()}},L=a(6262);const C=(0,L.A)(x,[["render",k],["__scopeId","data-v-ccaff9d8"]]);var I=C},8399:function(t,e,a){a.r(e),a.d(e,{default:function(){return tt}});var s=a(641);function l(t,e,a,l,i,r){const n=(0,s.g2)("ion-segment-button"),o=(0,s.g2)("ion-segment"),d=(0,s.g2)("ledger-comp"),u=(0,s.g2)("statistics-seller-report"),c=(0,s.g2)("statistics-seller-analytics"),h=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(h,{pageTitle:"Статистика продавца",pageDefaultBackLink:"/user"},{default:(0,s.k6)((()=>[(0,s.bF)(o,{"swipe-gesture":"true",modelValue:i.activeTab,"onUpdate:modelValue":e[0]||(e[0]=t=>i.activeTab=t)},{default:(0,s.k6)((()=>[(0,s.bF)(n,{value:"sellerAnalytics"},{default:(0,s.k6)((()=>[(0,s.eW)(" Аналитика ")])),_:1}),(0,s.bF)(n,{value:"sellerReport"},{default:(0,s.k6)((()=>[(0,s.eW)(" Отчет ")])),_:1}),(0,s.bF)(n,{value:"ledger"},{default:(0,s.k6)((()=>[(0,s.eW)(" Баланс ")])),_:1})])),_:1},8,["modelValue"]),"ledger"==i.activeTab?((0,s.uX)(),(0,s.Wv)(d,{key:0,permanentTag:"acc::supplier"})):(0,s.Q3)("",!0),"sellerReport"==i.activeTab?((0,s.uX)(),(0,s.Wv)(u,{key:1,store:i.store},null,8,["store"])):(0,s.Q3)("",!0),"sellerAnalytics"==i.activeTab&&i.store?((0,s.uX)(),(0,s.Wv)(c,{key:2,store:i.store},null,8,["store"])):(0,s.Q3)("",!0)])),_:1})}var i=a(5654),r=a(5480),n=a(8062),o=a(5908),d=a(33);const u={class:"horizontalScroller"},c={class:"printDiv"},h={class:"ion-padding-horizontal"},p=(0,s.Lk)("p",null,"За последние 7 дней",-1),v={class:"printDiv"},f={class:"ion-padding-horizontal"},m=(0,s.Lk)("p",null,"За последние 7 дней",-1);function b(t,e,a,l,i,r){var n,o;const b=(0,s.g2)("ion-icon"),_=(0,s.g2)("ion-label"),k=(0,s.g2)("ion-chip"),g=(0,s.g2)("statistics-card"),y=(0,s.g2)("ion-col"),F=(0,s.g2)("ion-row"),w=(0,s.g2)("ion-grid"),x=(0,s.g2)("statistics-funnel"),L=(0,s.g2)("statistics-timeline");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",u,[(0,s.bF)(k,{onClick:e[0]||(e[0]=t=>r.reportPrint()),color:"medium"},{default:(0,s.k6)((()=>[(0,s.bF)(b,{src:l.printOutline},null,8,["src"]),(0,s.bF)(_,null,{default:(0,s.k6)((()=>[(0,s.eW)("Напечатать")])),_:1})])),_:1}),(0,s.bF)(k,{onClick:e[1]||(e[1]=t=>r.load()),color:"medium"},{default:(0,s.k6)((()=>[(0,s.bF)(b,{src:l.reloadOutline},null,8,["src"]),(0,s.bF)(_,null,{default:(0,s.k6)((()=>[(0,s.eW)("Обновить")])),_:1})])),_:1})]),(0,s.Lk)("div",c,[(0,s.Lk)("div",h,[(0,s.Lk)("h5",null,"Общая статистика "+(0,d.v_)(null!==(n=a.store.store_name)&&void 0!==n?n:""),1),p]),(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{size:"12","size-sm":"6"},{default:(0,s.k6)((()=>[i.dataset.order_count?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Заказы",data:i.dataset.order_count,format:"integer",color:"#008FFB",dates:i.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(y,{size:"12","size-sm":"6"},{default:(0,s.k6)((()=>[i.dataset.order_sum?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Сумма",data:i.dataset.order_sum,format:"currency",color:"#04e398",dates:i.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(y,{size:"12","size-sm":"6"},{default:(0,s.k6)((()=>[i.dataset.order_sum_avg?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Средний чек",data:i.dataset.order_sum_avg,format:"currency",color:"#feba37",dates:i.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(y,{size:"12","size-sm":"6"},{default:(0,s.k6)((()=>[i.dataset.product_quantity?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Товаров продано",data:i.dataset.product_quantity,format:"integer",color:"#c304f9",dates:i.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1})])),_:1})])),_:1})]),(0,s.Lk)("div",v,[(0,s.Lk)("div",f,[(0,s.Lk)("h5",null,"Товарная статистика "+(0,d.v_)(null!==(o=a.store.store_name)&&void 0!==o?o:""),1),m]),(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{size:"12","size-sm":"4"},{default:(0,s.k6)((()=>[i.dataset.product_viewed?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Показы",data:i.dataset.product_viewed,format:"integer",color:"#008FFB",dates:i.productDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(y,{size:"12","size-sm":"4"},{default:(0,s.k6)((()=>[i.dataset.product_added?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Оформление",data:i.dataset.product_added,format:"integer",color:"#04e398",dates:i.productDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(y,{size:"12","size-sm":"4"},{default:(0,s.k6)((()=>[i.dataset.product_purchased?((0,s.uX)(),(0,s.Wv)(g,{key:0,label:"Продано",data:i.dataset.product_purchased,format:"integer",color:"#feba37",dates:i.productDates},null,8,["data","dates"])):(0,s.Q3)("",!0)])),_:1})])),_:1}),(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.bF)(y,{size:"12","size-sm":"6"},{default:(0,s.k6)((()=>[(0,s.bF)(x,{label:"Воронка продаж",data:i.funnelData},null,8,["data"])])),_:1}),(0,s.bF)(y,{size:"12","size-sm":"6"},{default:(0,s.k6)((()=>[(0,s.bF)(L,{label:"Динамика",data:i.timelineSeries,dates:i.productDates},null,8,["data","dates"])])),_:1})])),_:1})])),_:1})])],64)}a(4114);var _=a(2311),k=a.n(_);const g={style:{"font-size":"22px"}},y={key:1,class:"ion-padding ion-text-center"},F=(0,s.Lk)("h2",null,"Недостаточно данных",-1),w=(0,s.Lk)("p",null,"для показа статистики",-1),x=[F,w];function L(t,e,a,l,i,r){const n=(0,s.g2)("ion-card-subtitle"),o=(0,s.g2)("ion-icon"),u=(0,s.g2)("ion-label"),c=(0,s.g2)("ion-chip"),h=(0,s.g2)("ion-card-title"),p=(0,s.g2)("ion-card-header"),v=(0,s.g2)("apexchart"),f=(0,s.g2)("ion-card-content"),m=(0,s.g2)("ion-card");return(0,s.uX)(),(0,s.Wv)(m,{style:{contain:"initial",overflow:"visible"}},{default:(0,s.k6)((()=>[(0,s.bF)(p,{style:{"padding-bottom":"0"}},{default:(0,s.k6)((()=>[(0,s.bF)(n,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,d.v_)(a.label),1)])),_:1}),(0,s.bF)(h,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",null,[(0,s.Lk)("b",g,(0,d.v_)(r.mainValue),1),a.data.series.length>0?((0,s.uX)(),(0,s.Wv)(c,{key:0,outline:!0,color:r.dynamicsData.color,class:"ion-no-margin",style:{"font-size":"12px",border:"none"}},{default:(0,s.k6)((()=>[(0,s.bF)(o,{icon:r.dynamicsData.icon},null,8,["icon"]),(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,d.v_)(r.dynamicsData.value)+"%",1)])),_:1})])),_:1},8,["color"])):(0,s.Q3)("",!0)])])),_:1})])),_:1}),(0,s.bF)(f,{class:"ion-no-padding"},{default:(0,s.k6)((()=>[a.data.series.length>1?((0,s.uX)(),(0,s.Wv)(v,{key:0,type:"area",height:"70",options:i.chartOptions,series:i.series,ref:"apexChart"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",y,x))])),_:1})])),_:1})}var C=a(1079),I={components:{IonIcon:i.iq,IonLabel:i.he,IonCard:i.b_,IonCardHeader:i.ME,IonCardTitle:i.tN,IonCardSubtitle:i.HW,IonCardContent:i.I9,IonChip:i.ZB,apexchart:C.A},props:["label","data","format","color","dates"],setup(){return{calendarOutline:r.RXF,caretUpOutline:r.rHB,caretDownOutline:r.mF9,caretForwardOutline:r.d2Q}},data(){return{value:0,series:[{name:this.label,data:this.data.series}],chartOptions:{chart:{height:70,type:"area",zoom:{enabled:!1},toolbar:{show:!1},parentHeightOffset:0,sparkline:{enabled:!0}},stroke:{width:2},colors:["#008FFB"],legend:{show:!1},fill:{type:"gradient",gradient:{opacityFrom:.6,opacityTo:.4}},dataLabels:{enabled:!1},grid:{padding:{left:-10,right:-10,top:-15,bottom:-15},yaxis:{lines:{show:!1}}},xaxis:{show:!1,labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1},categories:[]},yaxis:{show:!1,labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}}}}},computed:{mainValue(){var t;const e=null!==(t=this.data.value)&&void 0!==t?t:0;return"integer"==this.format?new Intl.NumberFormat("ru-RU").format(Math.round(e)):"float"==this.format?new Intl.NumberFormat("ru-RU",{maximumSignificantDigits:2}).format(parseFloat(e).toFixed(2)):"currency"==this.format?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(parseFloat(e).toFixed(2)):null},dynamicsData(){var t,e;const a=null!==(t=1*this.data.avg)&&void 0!==t?t:0,s=null!==(e=1*this.data.value)&&void 0!==e?e:0,l=((s-a)/((s+a)/2)*100||0).toFixed(2);var i="medium",n=r.d2Q;return l>0&&(i="success",n=r.rHB),l<0&&(i="danger",n=r.mF9),{value:l,color:i,icon:n}},datesParsed(){return this.getDates(this.dates)}},methods:{initChart(){this.$refs.apexChart&&this.$refs.apexChart.updateSeries(this.series),this.$refs.apexChart.updateOptions({xaxis:{categories:this.datesParsed}})},getDates(t){let e=[];for(let a=0;a<t.length;a++)e.unshift(new Date(t[a]).toLocaleString("ru",{day:"numeric",month:"long"}));return e}},mounted(){var t;this.chartOptions.colors=null!==(t=[this.color])&&void 0!==t?t:["#008FFB"],setTimeout((()=>{this.initChart()}),10)},updated(){this.initChart()}},S=a(6262);const D=(0,S.A)(I,[["render",L]]);var O=D;const z={class:"ion-padding-horizontal"},$={key:1,class:"ion-padding ion-text-center"},W=(0,s.Lk)("h2",null,"Недостаточно данных",-1),X=(0,s.Lk)("p",null,"для показа статистики",-1),E=[W,X];function T(t,e,a,l,i,r){const n=(0,s.g2)("apexchart");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",z,(0,d.v_)(a.label),1),i.series.length>0?((0,s.uX)(),(0,s.Wv)(n,{key:0,type:"bar",height:"350",options:i.chartOptions,series:i.series,ref:"apexChartElement"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",$,E))],64)}var Q={components:{apexchart:C.A},props:["label","data","format","color"],setup(){return{}},data(){var t,e;return{value:0,series:[{name:this.label,data:null!==(t=this.data.series)&&void 0!==t?t:[]}],chartOptions:{chart:{type:"bar",height:350,zoom:{enabled:!1},toolbar:{show:!1}},plotOptions:{bar:{borderRadius:0,horizontal:!0,barHeight:"80%",isFunnel:!0}},dataLabels:{enabled:!0,formatter:function(t,e){return e.w.globals.labels[e.dataPointIndex]+":  "+t},dropShadow:{enabled:!0}},xaxis:{categories:null!==(e=this.data.labels)&&void 0!==e?e:[]},legend:{show:!1}}}},methods:{initChart(){var t;this.$refs.apexChartElement&&(this.$refs.apexChartElement.updateSeries([{data:this.data.series}]),this.$refs.apexChartElement.updateOptions({xaxis:{categories:null!==(t=this.data.labels)&&void 0!==t?t:[]}}))}},mounted(){setTimeout((()=>{this.initChart()}),100)},updated(){setTimeout((()=>{this.initChart()}),1)}};const G=(0,S.A)(Q,[["render",T]]);var A=G;const R={class:"ion-padding-horizontal"},B={key:1,class:"ion-padding ion-text-center"},P=(0,s.Lk)("h2",null,"Недостаточно данных",-1),V=(0,s.Lk)("p",null,"для показа статистики",-1),U=[P,V];function N(t,e,a,l,i,r){const n=(0,s.g2)("apexchart");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",R,(0,d.v_)(a.label),1),a.data.length>0?((0,s.uX)(),(0,s.Wv)(n,{key:0,type:"bar",height:"370",options:i.chartOptions,series:i.series,ref:"apexChartElement"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",B,U))],64)}var q={components:{apexchart:C.A},props:["label","data","format","color","dates"],setup(){return{}},data(){return{value:0,series:this.data,chartOptions:{chart:{type:"bar",height:350,zoom:{enabled:!1},toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},fill:{opacity:1}}}},computed:{datesParsed(){return this.getDates(this.dates)}},methods:{initChart(){this.$refs.apexChartElement&&(this.$refs.apexChartElement.updateSeries(this.data),this.$refs.apexChartElement.updateOptions({xaxis:{categories:this.datesParsed}}))},getDates(t){let e=[];for(let a=0;a<t.length;a++)e.unshift(new Date(t[a]).toLocaleString("ru",{day:"numeric",month:"long"}));return e}},mounted(){setTimeout((()=>{this.initChart()}),100)},updated(){setTimeout((()=>{this.initChart()}),1)}};const H=(0,S.A)(q,[["render",N]]);var K=H,M={components:{IonGrid:i.lO,IonRow:i.ln,IonCol:i.hU,IonChip:i.ZB,IonLabel:i.he,IonIcon:i.iq,StatisticsCard:O,StatisticsFunnel:A,StatisticsTimeline:K},props:["store"],setup(){return{printOutline:r.SfY,reloadOutline:r.QMU}},data(){return{dataset:{},head:{},body:{},productStatistics:{},funnelData:{},timelineSeries:[],totalDates:[],productDates:[]}},methods:{async parametersGet(){try{const t=await k().post(`${this.$heap.state.hostname}Statistics/sellParametersGet`,{store_id:this.store.store_id,point_span:7,point_num:10});t.body.length>0&&(t.body.reverse(),this.parseStatisticResponse(t),this.totalDates=this.parseDates(t))}catch(a){var t,e;const s=null===a||void 0===a||null===(t=a.responseJSON)||void 0===t||null===(e=t.messages)||void 0===e?void 0:e.error;switch(s){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:console.log(a),this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},async productsGet(){try{const t=await k().post(`${this.$heap.state.hostname}Statistics/sellProductFunnelGet`,{store_id:this.store.store_id,point_span:7,point_num:10});t.body.length>0&&(t.body.reverse(),this.productDates=this.parseDates(t),this.parseStatisticResponse(t),this.parseFunnelData(t),this.parseTimelineData(t))}catch(a){var t,e;const s=null===a||void 0===a||null===(t=a.responseJSON)||void 0===t||null===(e=t.messages)||void 0===e?void 0:e.error;switch(s){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},parseStatisticResponse(t){for(var e in t.head.avg)for(var a in this.dataset[e]={avg:t.head.avg[e],value:t.body[t.body.length-1][e],series:[]},t.body)t.body[a][e]&&this.dataset[e].series.push(t.body[a][e])},parseFunnelData(t){this.funnelData={};const e={product_viewed:"Показы",product_added:"Оформления",product_purchased:"Продажи"};this.funnelData={series:[],labels:[]};const a=t.body[t.body.length-1];for(var s in e)this.funnelData.series.push(a[s]),this.funnelData.labels.push(e[s])},parseTimelineData(t){this.timelineSeries=[];const e={product_viewed:"Показы",product_added:"Оформления",product_purchased:"Продажи"};for(var a in this.timelineSeries=[],e)this.timelineSeries.push({name:e[a],data:this.dataset[a].series})},parseDates(t){let e=[];for(var a in t.body)e.unshift(t.body[a].point_finish);return e},async load(){await this.parametersGet(),this.productsGet()},reportPrint(){window.print()}},async mounted(){this.load()}};const J=(0,S.A)(M,[["render",b]]);var Y=J,Z={components:{IonSegment:i.Gp,IonSegmentButton:i.eP,ledgerComp:n.A,StatisticsSellerReport:o.A,StatisticsSellerAnalytics:Y},setup(){return{receiptOutline:r.BVr}},data(){return{activeTab:"sellerAnalytics",storeId:this.$route.params.id,store:null}},mounted(){this.storeGet(this.storeId)},methods:{async storeGet(t){const e={store_id:t};this.store=await k().post(`${this.$heap.state.hostname}Store/itemGet`,e)}}};const j=(0,S.A)(Z,[["render",l]]);var tt=j}}]);
//# sourceMappingURL=4557.d83aed1d.js.map