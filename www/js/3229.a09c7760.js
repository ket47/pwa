"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[3229],{6794:function(e,t,r){r.d(t,{A:function(){return m}});var i=r(641);const o=e=>((0,i.Qi)("data-v-6215f93d"),e=e(),(0,i.jt)(),e),a={style:{height:"100%"}},l=o((()=>(0,i.Lk)("h3",{style:{color:"#999"}},"Выбрать день и время",-1)));function d(e,t,r,o,d,s){const n=(0,i.g2)("ion-datetime"),u=(0,i.g2)("ion-button"),c=(0,i.g2)("ion-content");return(0,i.uX)(),(0,i.CE)("div",a,[(0,i.bF)(c,{class:"ion-padding"},{default:(0,i.k6)((()=>{var e,o;return[l,(0,i.bF)(n,{style:{"max-width":"100%","border-radius":"10px"},presentation:"date-time",modelValue:d.datetime,"onUpdate:modelValue":t[0]||(t[0]=e=>d.datetime=e),"prefer-wheel":!0,"first-day-of-week":1,min:null===(e=r.dateRange)||void 0===e?void 0:e.dayFirst,max:null===(o=r.dateRange)||void 0===o?void 0:o.dayLast,"hour-values":s.hourValues,"minute-values":s.minuteValues,onIonChange:t[1]||(t[1]=e=>s.validate(d.datetime))},null,8,["modelValue","min","max","hour-values","minute-values"]),(0,i.bF)(u,{color:"primary",onClick:t[2]||(t[2]=e=>s.confirm()),expand:"block",disabled:d.notvalid},{default:(0,i.k6)((()=>[(0,i.eW)("Ок")])),_:1},8,["disabled"]),(0,i.bF)(u,{color:"light",onClick:t[3]||(t[3]=e=>s.cancel()),expand:"block"},{default:(0,i.k6)((()=>[(0,i.eW)("Закрыть")])),_:1})]})),_:1})])}r(4114);var s=r(5654),n=r(5480),u={props:["dateRange","defaultDatetime"],components:{IonDatetime:s.A9,IonContent:s.W9,IonButton:s.Jm},setup(){return{closeOutline:n.xfX}},data(){var e;const t=null===(e=this.defaultDatetime)||void 0===e?void 0:e.replace(" ","T");return{datetime:t,notvalid:!1}},computed:{hourValues(){if(this.dateRange&&this.dateRange.dayHours&&this.datetime){const[e]=this.datetime.split("T");let t=[];for(let r in this.dateRange.dayHours[e]){const e=r.split("_")[1];t.push(e)}return t}return null},minuteValues(){var e;const[t,r]=this.datetime.split("T"),[i,o,a]=r.split(":");return null===(e=this.dateRange.dayHours[t])||void 0===e?void 0:e[`h_${i}`]}},methods:{validate(){const[e]=this.datetime.split("T"),t=this.dateRange.dayHours[e];t?this.notvalid=0:(this.$flash("Выходной день"),this.notvalid=1)},confirm(){this.notvalid||s.OZ.dismiss(this.datetime,"confirm")},cancel(){s.OZ.dismiss(null,"cancel")}},mounted(){this.validate()}},c=r(6262);const h=(0,c.A)(u,[["render",d],["__scopeId","data-v-6215f93d"]]);var m=h},59:function(e,t,r){r.r(t),r.d(t,{default:function(){return G}});var i=r(641),o=r(33),a=r(3751),l=r.p+"img/sleeping_wolf.3f39ee7e.png";const d=e=>((0,i.Qi)("data-v-4f44d4c4"),e=e(),(0,i.jt)(),e),s={key:0},n={key:0,class:"ion-padding-top ion-padding-bottom"},u=d((()=>(0,i.Lk)("div",{style:{display:"grid","grid-template-columns":"30% 70%"}},[(0,i.Lk)("div",null,[(0,i.Lk)("img",{src:l,style:{height:"60px"}})]),(0,i.Lk)("p",null,[(0,i.eW)("Получить заказ в ближайшее время не удастся. "),(0,i.Lk)("br"),(0,i.eW)(" Выберите когда вам удобно.")])],-1))),c=d((()=>(0,i.Lk)("div",null,null,-1))),h=d((()=>(0,i.Lk)("span",null,"как можно скорее",-1))),m=d((()=>(0,i.Lk)("span",null,"заказ в очереди",-1))),y=d((()=>(0,i.Lk)("b",null,"Запланировать",-1))),_={key:0},p={key:1},v={key:2},f={key:3},k={slot:"start"},b={class:"righttop_badge"},C={slot:"start"},g={class:"righttop_badge"},$={key:4},F={slot:"start"},R={key:0,style:{"font-size":"0.75em",color:"#666"}},W={slot:"start"},B={key:1};function S(e,t,r,l,d,S){var w,T;const O=(0,i.g2)("ion-item-divider"),L=(0,i.g2)("ion-radio"),X=(0,i.g2)("ion-item"),I=(0,i.g2)("ion-radio-group"),P=(0,i.g2)("ion-card-content"),A=(0,i.g2)("ion-card"),D=(0,i.g2)("ion-icon"),x=(0,i.g2)("ion-label"),V=(0,i.g2)("ion-segment-button"),E=(0,i.g2)("ion-segment"),Q=(0,i.g2)("order-checkout-address"),G=(0,i.g2)("ion-img"),N=(0,i.g2)("ion-badge"),M=(0,i.g2)("ion-text"),z=(0,i.g2)("ion-list"),J=(0,i.g2)("ion-accordion"),H=(0,i.g2)("ion-accordion-group"),U=(0,i.g2)("router-link"),Z=(0,i.g2)("ion-checkbox"),q=(0,i.g2)("ion-button"),K=(0,i.g2)("ion-skeleton-text"),j=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(j,{pageTitle:`Оформление заказа из ${(null===(w=d.order)||void 0===w||null===(T=w.store)||void 0===T?void 0:T.store_name)||""}`,pageDefaultBackLink:`/order/order-${d.order_id}`,ref:"page"},{default:(0,i.k6)((()=>[d.is_checkout_data_loaded?((0,i.uX)(),(0,i.CE)("div",s,[S.isNoFatalError?((0,i.uX)(),(0,i.Wv)(z,{key:0,lines:"none"},{default:(0,i.k6)((()=>{var r,s;return[(0,i.bF)(O,{style:{"margin-top":"0px","box-shadow":"none"}},{default:(0,i.k6)((()=>[(0,i.eW)("Доставка")])),_:1}),(0,i.bF)(I,{modelValue:d.deliveryType,"onUpdate:modelValue":t[4]||(t[4]=e=>d.deliveryType=e)},{default:(0,i.k6)((()=>[S.deliveryByCourierRule?((0,i.uX)(),(0,i.Wv)(X,{key:0,button:"",detail:"false",onClick:t[0]||(t[0]=e=>S.tariffRuleSet(S.deliveryByCourierRule))},{default:(0,i.k6)((()=>[(0,i.bF)(L,{value:"delivery_by_courier"},{default:(0,i.k6)((()=>{var t;return[(0,i.eW)("Доставит "),(0,i.Lk)("b",null,(0,o.v_)(null===(t=e.$heap.state.settings)||void 0===t?void 0:t.app_title),1)]})),_:1})])),_:1})):(0,i.Q3)("",!0),S.deliveryByStoreRule?((0,i.uX)(),(0,i.Wv)(X,{key:1,button:"",detail:"false",onClick:t[2]||(t[2]=e=>S.tariffRuleSet(S.deliveryByStoreRule))},{default:(0,i.k6)((()=>[(0,i.bF)(L,{value:"delivery_by_store"},{default:(0,i.k6)((()=>{var r,l;return[(0,i.eW)(" Доставит "),(0,i.Lk)("b",null,(0,o.v_)(null===(r=d.order)||void 0===r||null===(l=r.store)||void 0===l?void 0:l.store_name),1),(0,i.eW)(),(0,i.Lk)("a",{onClick:t[1]||(t[1]=(0,a.D$)((t=>{var r,i;return e.$go(`/modal/store-dmethods-${null===(r=d.order)||void 0===r||null===(i=r.store)||void 0===i?void 0:i.store_id}`)}),["stop"]))},"(условия)")]})),_:1})])),_:1})):(0,i.Q3)("",!0),S.pickupByCustomerRule?((0,i.uX)(),(0,i.Wv)(X,{key:2,button:"",detail:"false",onClick:t[3]||(t[3]=e=>S.tariffRuleSet(S.pickupByCustomerRule))},{default:(0,i.k6)((()=>[(0,i.bF)(L,{value:"pickup_by_customer"},{default:(0,i.k6)((()=>[(0,i.eW)("Самовывоз")])),_:1})])),_:1})):(0,i.Q3)("",!0)])),_:1},8,["modelValue"]),null!==(r=d.tariffRule)&&void 0!==r&&r.routePlan?((0,i.uX)(),(0,i.CE)("div",n,["scheduled"==(null===(s=d.tariffRule.routePlan)||void 0===s?void 0:s.start_plan_mode)?((0,i.uX)(),(0,i.Wv)(A,{key:0,color:"light"},{default:(0,i.k6)((()=>[(0,i.bF)(P,null,{default:(0,i.k6)((()=>[u])),_:1})])),_:1})):(0,i.Q3)("",!0),c,(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.bF)(E,{mode:"ios",modelValue:d.routePlanMode,"onUpdate:modelValue":t[8]||(t[8]=e=>d.routePlanMode=e)},{default:(0,i.k6)((()=>{var e,r;return["inited"==(null===(e=d.tariffRule.routePlan)||void 0===e?void 0:e.start_plan_mode)?((0,i.uX)(),(0,i.Wv)(V,{key:0,value:"inited",onClick:t[5]||(t[5]=e=>d.deliveryFinishScheduled=null)},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.rocketOutline},null,8,["icon"]),(0,i.bF)(x,null,{default:(0,i.k6)((()=>[(0,i.eW)("Привезти сразу")])),_:1}),h])),_:1})):"awaited"==(null===(r=d.tariffRule.routePlan)||void 0===r?void 0:r.start_plan_mode)?((0,i.uX)(),(0,i.Wv)(V,{key:1,value:"awaited",onClick:t[6]||(t[6]=e=>d.deliveryFinishScheduled=null)},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.timeOutline},null,8,["icon"]),(0,i.bF)(x,null,{default:(0,i.k6)((()=>[(0,i.eW)("Подождать")])),_:1}),m])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(V,{value:"scheduled",onClick:t[7]||(t[7]=e=>S.datetimePick())},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.alarmOutline},null,8,["icon"]),(0,i.bF)(x,null,{default:(0,i.k6)((()=>[y])),_:1}),S.routePlanLocal?((0,i.uX)(),(0,i.CE)("span",_,(0,o.v_)(S.routePlanLocal),1)):((0,i.uX)(),(0,i.CE)("span",p,"выберите день и время"))])),_:1})]})),_:1},8,["modelValue"])])),_:1})])):(0,i.Q3)("",!0),"delivery_by_store"==d.deliveryType||"delivery_by_courier"==d.deliveryType?((0,i.uX)(),(0,i.Wv)(Q,{key:1,deliveryTime:d.deliveryTime,deliveryAddressOnly:"1",nextRoute:`/modal/order-checkout-${d.order_id}`},null,8,["deliveryTime","nextRoute"])):(0,i.Q3)("",!0),d.storeIsReady?((0,i.uX)(),(0,i.Wv)(O,{key:2},{default:(0,i.k6)((()=>[(0,i.eW)("Оплата")])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(I,{modelValue:d.paymentType,"onUpdate:modelValue":t[11]||(t[11]=e=>d.paymentType=e)},{default:(0,i.k6)((()=>{var r,a;return[1==d.tariffRule.paymentByCash?((0,i.uX)(),(0,i.Wv)(X,{key:0,button:"",detail:"false"},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.cashOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.bF)(L,{value:"use_cash"},{default:(0,i.k6)((()=>[(0,i.eW)("Наличными курьеру")])),_:1})])),_:1})):(0,i.Q3)("",!0),1==d.tariffRule.paymentByCashStore?((0,i.uX)(),(0,i.Wv)(X,{key:1,button:"",detail:"false"},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.cashOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.bF)(L,{value:"use_cash_store"},{default:(0,i.k6)((()=>[(0,i.eW)("Наличными продавцу")])),_:1})])),_:1})):(0,i.Q3)("",!0),1==d.tariffRule.paymentByCard?((0,i.uX)(),(0,i.CE)("div",v,[(0,i.bF)(X,{detail:"false",button:""},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.cardOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.bF)(L,{value:"use_card"},{default:(0,i.k6)((()=>[(0,i.eW)(" Банковская карта ")])),_:1})])),_:1}),null!==(r=S.bankCardCalc)&&void 0!==r&&r.card_type?((0,i.uX)(),(0,i.Wv)(X,{key:0,button:"",detail:"false"},{default:(0,i.k6)((()=>[S.bankCardCalc.card_type?((0,i.uX)(),(0,i.Wv)(G,{key:0,style:{width:"22px",height:"auto"},src:`/img/icons/card-${S.bankCardCalc.card_type.toLowerCase()}.svg`,slot:"start"},null,8,["src"])):((0,i.uX)(),(0,i.Wv)(D,{key:1,src:l.cardOutline,slot:"start",color:"medium"},null,8,["src"])),(0,i.bF)(L,{value:"use_card_recurrent"},{default:(0,i.k6)((()=>[(0,i.eW)(" Сохраненная карта "+(0,o.v_)(S.bankCardCalc.label),1)])),_:1})])),_:1})):(0,i.Q3)("",!0),null!==(a=S.bankCardCalc)&&void 0!==a&&a.card_type?((0,i.uX)(),(0,i.Wv)(X,{key:1,button:"",detail:"",onClick:t[9]||(t[9]=t=>e.$go("/user/user-cards"))},{default:(0,i.k6)((()=>[(0,i.bF)(x,{color:"medium"},{default:(0,i.k6)((()=>[(0,i.eW)("Выбрать другую карту")])),_:1})])),_:1})):d.recurrentPaymentAllow?((0,i.uX)(),(0,i.Wv)(X,{key:2,button:"",detail:"",onClick:t[10]||(t[10]=t=>e.$go("/user/user-cards"))},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.addOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.bF)(x,{color:"medium"},{default:(0,i.k6)((()=>[(0,i.eW)("Добавить карту")])),_:1})])),_:1})):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)]})),_:1},8,["modelValue"]),(0,i.bF)(O,null,{default:(0,i.k6)((()=>[(0,i.eW)("Итог")])),_:1}),!S.deliveryByCourierRuleChecked||"use_card"!=d.paymentType&&"use_card_recurrent"!=d.paymentType?((0,i.uX)(),(0,i.CE)("div",$,[(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",F,[(0,i.bF)(D,{icon:l.giftOutline,color:"medium",style:{"font-size":"1.5em"}},null,8,["icon"])]),(0,i.bF)(M,{color:"medium"},{default:(0,i.k6)((()=>{var t;return[(0,i.eW)(" Скидка доступна при доставке "),(0,i.Lk)("b",null,(0,o.v_)(null===(t=e.$heap.state.settings)||void 0===t?void 0:t.app_title),1),(0,i.eW)(" и оплате картой ")]})),_:1})])),_:1})])):((0,i.uX)(),(0,i.CE)("div",f,[d.promo?((0,i.uX)(),(0,i.Wv)(X,{key:0,button:"",onClick:t[12]||(t[12]=e=>S.promoPick()),color:"success"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",k,[(0,i.bF)(D,{icon:l.giftOutline,color:"medium",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,i.Lk)("sup",b,[d.promoCount>0?((0,i.uX)(),(0,i.Wv)(N,{key:0,color:"secondary"},{default:(0,i.k6)((()=>[(0,i.eW)((0,o.v_)(d.promoCount),1)])),_:1})):(0,i.Q3)("",!0)])]),(0,i.eW)(" "+(0,o.v_)(d.promo.promo_name)+" ",1),(0,i.bF)(M,{slot:"end"},{default:(0,i.k6)((()=>[(0,i.eW)("-"+(0,o.v_)(d.order.order_sum_promo)+(0,o.v_)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):((0,i.uX)(),(0,i.Wv)(X,{key:1,button:"",detail:"",onClick:t[13]||(t[13]=e=>S.promoPick())},{default:(0,i.k6)((()=>[(0,i.Lk)("div",C,[(0,i.bF)(D,{icon:l.giftOutline,color:"medium",style:{"font-size":"1.5em"}},null,8,["icon"]),(0,i.Lk)("sup",g,[d.promoCount>0?((0,i.uX)(),(0,i.Wv)(N,{key:0,color:"secondary"},{default:(0,i.k6)((()=>[(0,i.eW)((0,o.v_)(d.promoCount),1)])),_:1})):(0,i.Q3)("",!0)])]),(0,i.eW)(" Выберите скидку ")])),_:1}))])),(0,i.bF)(H,null,{default:(0,i.k6)((()=>[(0,i.bF)(J,null,{default:(0,i.k6)((()=>[(0,i.bF)(X,{slot:"header"},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.walletOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.bF)(M,null,{default:(0,i.k6)((()=>[(0,i.eW)("Итого к оплате")])),_:1}),(0,i.bF)(x,{slot:"end",color:"primary"},{default:(0,i.k6)((()=>[(0,i.Lk)("b",null,(0,o.v_)(S.order_sum_total)+(0,o.v_)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),(0,i.bF)(z,{slot:"content"},{default:(0,i.k6)((()=>[(0,i.bF)(X,null,{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.cubeOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.eW)(" Сумма заказа "),(0,i.bF)(M,{slot:"end"},{default:(0,i.k6)((()=>[(0,i.eW)((0,o.v_)(d.order.order_sum_product)+(0,o.v_)(e.$heap.state.currencySign),1)])),_:1})])),_:1}),d.order_sum_delivery>0?((0,i.uX)(),(0,i.Wv)(X,{key:0},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.rocketOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,i.Lk)("div",null,[(0,i.eW)(" Доставка "),d.tariffRule.deliveryHeavyCost?((0,i.uX)(),(0,i.CE)("div",R,(0,o.v_)(d.order_sum_delivery-d.tariffRule.deliveryHeavyCost)+"+"+(0,o.v_)(d.tariffRule.deliveryHeavyCost)+" (непогода или высокая загруженность)",1)):(0,i.Q3)("",!0)]),(0,i.bF)(M,{slot:"end"},{default:(0,i.k6)((()=>{var t;return[(0,i.eW)((0,o.v_)(null!==(t=d.order_sum_delivery)&&void 0!==t?t:0)+(0,o.v_)(e.$heap.state.currencySign),1)]})),_:1})])),_:1})):(0,i.Q3)("",!0),d.promo?((0,i.uX)(),(0,i.Wv)(X,{key:1,button:""},{default:(0,i.k6)((()=>[(0,i.Lk)("div",W,[(0,i.bF)(D,{icon:l.giftOutline,color:"medium",style:{"font-size":"1.5em"}},null,8,["icon"])]),(0,i.eW)(" "+(0,o.v_)(d.promo.promo_name)+" ",1),(0,i.bF)(M,{slot:"end"},{default:(0,i.k6)((()=>[(0,i.eW)("-"+(0,o.v_)(d.order.order_sum_promo)+(0,o.v_)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,i.Q3)("",!0)])),_:1})])),_:1})])),_:1}),"delivery_by_courier"==d.deliveryType?((0,i.uX)(),(0,i.Wv)(X,{key:5},{default:(0,i.k6)((()=>[(0,i.bF)(M,{style:{"font-size":"0.9em"}},{default:(0,i.k6)((()=>[(0,i.eW)(" Я согласен(на) с "),(0,i.bF)(U,{to:"/page/rules-customer"},{default:(0,i.k6)((()=>[(0,i.eW)("офертой об оказании услуг доставки")])),_:1})])),_:1}),(0,i.bF)(Z,{slot:"end",modelValue:d.termsAccepted,"onUpdate:modelValue":t[14]||(t[14]=e=>d.termsAccepted=e),"aria-label":""},null,8,["modelValue"])])),_:1})):((0,i.uX)(),(0,i.Wv)(X,{key:6},{default:(0,i.k6)((()=>[(0,i.bF)(M,{style:{"font-size":"0.9em"}},{default:(0,i.k6)((()=>{var e,t;return[(0,i.eW)(" Я согласен(на) с "),(0,i.bF)(U,{to:`/modal/store-dmethods-${null===(e=d.order)||void 0===e||null===(t=e.store)||void 0===t?void 0:t.store_id}`},{default:(0,i.k6)((()=>{var e,t;return[(0,i.eW)("с условиями доставки "+(0,o.v_)(null===(e=d.order)||void 0===e||null===(t=e.store)||void 0===t?void 0:t.store_name),1)]})),_:1},8,["to"])]})),_:1}),(0,i.bF)(Z,{slot:"end",modelValue:d.termsAccepted,"onUpdate:modelValue":t[15]||(t[15]=e=>d.termsAccepted=e),"aria-label":""},null,8,["modelValue"])])),_:1}))]})),_:1})):(0,i.Q3)("",!0),S.checkoutError?((0,i.uX)(),(0,i.Wv)(A,{key:1,color:"warning"},{default:(0,i.k6)((()=>[(0,i.bF)(P,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,o.v_)(S.checkoutError),1)])),_:1})])),_:1})):(0,i.Q3)("",!0),S.isNoFatalError?"scheduled"!=d.routePlanMode||d.deliveryFinishScheduled?"use_card"==d.paymentType||"use_card_recurrent"==d.paymentType?((0,i.uX)(),(0,i.Wv)(q,{key:4,expand:"block",onClick:t[18]||(t[18]=e=>S.proceed()),disabled:S.checkoutError},{default:(0,i.k6)((()=>[(0,i.eW)("Оплатить заказ")])),_:1},8,["disabled"])):((0,i.uX)(),(0,i.Wv)(q,{key:5,expand:"block",onClick:t[19]||(t[19]=e=>S.proceed()),disabled:S.checkoutError},{default:(0,i.k6)((()=>[(0,i.eW)("Заказать")])),_:1},8,["disabled"])):((0,i.uX)(),(0,i.Wv)(q,{key:3,expand:"block",onClick:t[17]||(t[17]=e=>S.datetimePick()),color:"medium"},{default:(0,i.k6)((()=>[(0,i.bF)(D,{icon:l.alarmOutline,slot:"start"},null,8,["icon"]),(0,i.eW)(" Выбрать время ")])),_:1})):((0,i.uX)(),(0,i.Wv)(q,{key:2,expand:"block",onClick:t[16]||(t[16]=t=>e.$router.replace("/order/order-"+d.order_id))},{default:(0,i.k6)((()=>[(0,i.eW)("Назад")])),_:1}))])):((0,i.uX)(),(0,i.CE)("div",B,[(0,i.bF)(X,{lines:"none"},{default:(0,i.k6)((()=>[(0,i.bF)(K,{animated:"",style:{width:"200px"}})])),_:1}),(0,i.bF)(z,null,{default:(0,i.k6)((()=>[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([1,2,3,4,5],(e=>(0,i.bF)(X,{key:e},{default:(0,i.k6)((()=>[(0,i.bF)(K,{animated:"",style:{width:"100%"}})])),_:2},1024))),64))])),_:1}),(0,i.bF)(q,{color:"light",expand:"block"})]))])),_:1},8,["pageTitle","pageDefaultBackLink"])}r(6028);var w=r(6859),T=r(2311),O=r.n(T),L=r(1376),X=r(5480),I=r(5654),P=r(8120),A=r(9369),D=r(7445),x=r(6794),V={components:{OrderCheckoutAddress:P.A,IonItemDivider:I.Dg,IonIcon:I.iq,IonItem:I.uz,IonList:I.nf,IonText:I.IO,IonButton:I.Jm,IonCheckbox:I.eY,IonCard:I.b_,IonCardContent:I.I9,IonBadge:I.In,IonImg:I.KW,IonLabel:I.he,IonSkeletonText:I.ds,IonRadioGroup:I.f0,IonRadio:I.KO,IonAccordion:I.xk,IonAccordionGroup:I.YH,IonSegmentButton:I.eP,IonSegment:I.Gp},setup(){return{cardOutline:X.VR9,cashOutline:X.A3w,giftOutline:X.Lsq,cubeOutline:X.a7r,walletOutline:X.eF1,pieChartOutline:X.p1S,storefrontOutline:X.te8,ordersIcon:L,rocketOutline:X.hGQ,documentTextOutline:X.pXZ,addOutline:X.EKF,alarmOutline:X.WYB,timeOutline:X.CVk}},data(){var e,t;return{is_checkout_data_loaded:0,can_load_at:0,order_id:this.$route.params.id,order:{},order_sum_delivery:0,storeCorrectionAllow:1,promo:null,promoCount:0,deliveryTime:{},termsAccepted:1,storeIsReady:null,errNotfound:0,errTooFar:0,errNoTariff:0,paymentType:"use_card",deliveryType:"delivery_by_courier",bankCard:null,tariffRule:{},tariffRuleList:[],recurrentPaymentAllow:1==(null===(e=this.$heap.state.settings)||void 0===e||null===(t=e.other)||void 0===t?void 0:t.recurrentPaymentAllow)?1:0,deliveryFinishScheduled:null,routePlanMode:"inited",scheduleRange:null}},computed:{routePlanLocal(){if(!this.deliveryFinishScheduled)return null;const e={month:"short",day:"numeric",hour:"numeric",minute:"numeric"},t=new Date(Date.parse(this.deliveryFinishScheduled));return t.toLocaleDateString(void 0,e)},isAtonceEnabled(){return["inited"].includes(this.routePlan.start_plan_mode)},isNoFatalError(){return!(1==this.errTooFar||0==this.storeIsReady||1==this.errNoTariff||1==this.errNotfound)},checkoutError(){var e,t,r,i,o,a,l,d,s,n,u,c;if(!this.order)return!1;if(1==(null===(e=this.$heap.state.user)||void 0===e||null===(t=e.location_main)||void 0===t?void 0:t.is_default))return"Нужно указать адрес, куда доставить заказ";if(1==this.errTooFar)return"Адрес доставки заказа вне зоны обслуживания";if(1==this.errNotfound)return"Заказ удален";if(0==this.storeIsReady)return`К сожалению, ${(null===(o=this.order)||void 0===o||null===(a=o.store)||void 0===a?void 0:a.store_name)||"продавец"} сейчас не принимает заказы`;if(1==this.errNoTariff)return`К сожалению, ${(null===(l=this.order)||void 0===l||null===(d=l.store)||void 0===d?void 0:d.store_name)||"продавец"} отключен`;if(0==this.termsAccepted)return"К сожалению, мы не можем доставить вам заказ, без согласия с условиями";if(this.promo){var h,m;const e=null!==(h=null===(m=this.promo)||void 0===m?void 0:m.min_order_sum_product)&&void 0!==h?h:0;if(1*this.order.order_sum_product<1*e)return`Сумма заказа со скидкой в ${this.order.order_sum_promo}${this.$heap.state.currencySign} должна быть больше чем ${e}${this.$heap.state.currencySign}`}return 1*this.order.order_sum_product<1*this.tariffRule.order_sum_minimal?`Сумма заказа должна быть больше чем ${this.tariffRule.order_sum_minimal}${this.$heap.state.currencySign}`:1*this.order.order_sum_product<1*(null===(r=this.order)||void 0===r||null===(i=r.store)||void 0===i?void 0:i.store_minimal_order)?`Сумма заказа у "${null===(s=this.order)||void 0===s||null===(n=s.store)||void 0===n?void 0:n.store_name}" должна быть больше чем ${null===(u=this.order)||void 0===u||null===(c=u.store)||void 0===c?void 0:c.store_minimal_order}${this.$heap.state.currencySign}`:1*this.order_sum_total<=1*this.order_sum_delivery?`Сумма к оплате должна быть больше чем ${this.order_sum_delivery}${this.$heap.state.currencySign}`:this.order_sum_total<=10&&"Сумма к оплате слишком маленькая"},order_sum_total(){return Math.round(100*(1*this.order.order_sum_product-1*this.order.order_sum_promo+1*this.order_sum_delivery))/100},deliveryByCourierRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.deliveryByCourier)).shift()},deliveryByCourierRuleChecked(){return 1==this.tariffRule.deliveryByCourier},deliveryByStoreRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.deliveryByStore)).shift()},deliveryByStoreRuleChecked(){return 1==this.tariffRule.deliveryByStore},pickupByCustomerRule(){var e;return null===(e=this.tariffRuleList)||void 0===e?void 0:e.filter((e=>1==e.pickupByCustomer)).shift()},pickupByCustomerRuleChecked(){return 1==this.tariffRule.pickupByCustomer},bankCardCalc(){let e=this.bankCard;return e&&e.card_type&&(e.label=`${e.card_type.toUpperCase()} (**** ${e.card_mask.split("*").pop()})`),e}},mounted(){this.itemCheckoutDataGet()},created(){this.$topic.on("userMainLocationSet",(()=>{this.can_load_at=0,this.itemCheckoutDataGet()})),this.$topic.on("userMainPaymentMethodSet",(()=>{this.can_load_at=0,this.itemCheckoutDataGet()})),this.$topic.on("settingsGet",(e=>{var t;this.can_load_at=0,this.recurrentPaymentAllow=null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.recurrentPaymentAllow}))},ionViewDidEnter(){this.itemCheckoutDataGet()},methods:{debounce(){const e=Date.now();let t=!1;return this.can_load_at>e&&(t=!0),this.can_load_at=e+1e3,t},async itemCheckoutDataGet(){if(!this.debounce())try{const e={order_id:this.order_id,features:"schedule"},t=await O().post(`${this.$heap.state.hostname}Order/itemCheckoutDataGet`,e);if(this.order=t.order||{},"customer_confirmed"!=this.order.stage_current)return void this.$router.replace("/order/order-"+this.order.order_id);this.promo=t.Promo_itemLinkGet,this.promoCount=t.Promo_listGet,this.storeIsReady=Array.isArray(t.Store_deliveryOptions)?1:0,this.errTooFar=0,this.errNoTariff=0,this.errNotfound=0,this.bankCard=null===t||void 0===t?void 0:t.bankCard,this.tariffRuleList=t.Store_deliveryOptions,this.tariffRule.tariff_id||this.tariffRuleSet(this.tariffRuleList[0]||{}),this.is_checkout_data_loaded=1,0==this.order_sum_delivery&&(this.order_sum_delivery=this.order.order_sum_delivery)}catch(r){var e,t;this.is_checkout_data_loaded=1;const i=null===r||void 0===r||null===(e=r.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.error;switch(i){case"too_far":this.errTooFar=1;break;case"not_ready":this.storeIsReady=0;break;case"no_tariff":this.errNoTariff=1;break;default:this.errNotfound=1,this.$flash("Заказ не найден"),this.$go("/order/order-list");break}return!1}},tariffRuleSet(e){var t,r,i;if(this.deliveryType="delivery_by_courier",1==e.deliveryByCourier)this.tariffRule=this.tariffMerge(null===(i=this.tariffRuleList)||void 0===i?void 0:i.filter((e=>1==e.deliveryByCourier))),this.deliveryType="delivery_by_courier";else if(1==e.deliveryByStore){var o;this.tariffRule=this.tariffMerge(null===(o=this.tariffRuleList)||void 0===o?void 0:o.filter((e=>1==e.deliveryByStore))),this.deliveryType="delivery_by_store"}else{if(1!=e.pickupByCustomer)return;var a;this.tariffRule=this.tariffMerge(null===(a=this.tariffRuleList)||void 0===a?void 0:a.filter((e=>1==e.pickupByCustomer))),this.deliveryType="pickup_by_customer"}this.order_sum_delivery=e.order_sum_delivery,this.paymentType="use_card",null!==(t=this.bankCard)&&void 0!==t&&t.card_type?this.paymentType="use_card_recurrent":1==e.paymentByCard?this.paymentType="use_card":1==e.paymentByCashStore?this.paymentType="use_cash_store":1==e.paymentByCash&&(this.paymentType="use_cash"),1!=e.deliveryByCourier&&null!=this.promo&&(this.promoLink({order_id:this.order_id}),this.promo=null),this.routePlanMode=null===(r=e.routePlan)||void 0===r?void 0:r.start_plan_mode},tariffMerge(e){if(null===e||void 0===e||!e.length)return null;let t;for(let a of e){var r,i,o;t?(t.tariff_id+=`,${a.tariff_id}`,(r=t).paymentByCard||(r.paymentByCard=a.paymentByCard),(i=t).paymentByCash||(i.paymentByCash=a.paymentByCash),(o=t).paymentByCashStore||(o.paymentByCashStore=a.paymentByCashStore)):t=Object.assign({},a)}return t},tariffSplit(){if(!this.tariffRule.tariff_id.includes(","))return this.tariffRule.tariff_id;const e=this.tariffRule.tariff_id.split(",");for(let t of e){let e=this.tariffRuleList.find((e=>e.tariff_id==t));e&&(("use_card"!=this.paymentType&&"use_card_recurrent"!=this.paymentType||1==e.paymentByCard)&&("use_cash"==this.paymentType&&1!=e.paymentByCash||"use_cash_store"==this.paymentType&&1!=e.paymentByCashStore||(this.tariffRule=e)))}},async scheduleRangeGet(){try{var e,t;const r=null===(e=this.tariffRule)||void 0===e||null===(t=e.routePlan)||void 0===t?void 0:t.finish_plan_timetable;if(!r)return;const i={timetable:JSON.stringify(r)};this.scheduleRange=await O().post(`${this.$heap.state.hostname}Order/itemScheduleRangeGet`,i),this.deliveryFinishScheduled=this.scheduleRange.nearest}catch{}},async datetimePick(){this.scheduleRange||await this.scheduleRangeGet();const e=await I.OZ.create({component:x.A,presentingElement:this.$refs.page.$el,initialBreakpoint:"0.6",showBackdrop:!0,canDismiss:!0,componentProps:{dateRange:this.scheduleRange.range,defaultDatetime:this.scheduleRange.nearest}});e.present(),this.routePlanMode="scheduled";const t=await e.onDidDismiss();var r,i;"confirm"==t.role?this.deliveryFinishScheduled=t.data:(this.deliveryFinishScheduled=null,this.routePlanMode=null===(r=this.tariffRule)||void 0===r||null===(i=r.routePlan)||void 0===i?void 0:i.start_plan_mode)},async proceed(){if(this.deliveryByCourierRuleChecked&&!await this.deliveryAddressConfirm())return!1;this.tariffSplit();const e={order_id:this.order.order_id,tariff_id:this.tariffRule.tariff_id,deliveryByStore:this.deliveryByStoreRuleChecked?1:0,deliveryByCourier:this.deliveryByCourierRuleChecked?1:0,deliveryFinishScheduled:this.deliveryFinishScheduled,pickupByCustomer:this.pickupByCustomerRuleChecked?1:0,paymentByCard:"use_card"==this.paymentType?1:0,paymentByCardRecurrent:"use_card_recurrent"==this.paymentType?1:0,paymentByCash:"use_cash"==this.paymentType?1:0,paymentByCashStore:"use_cash_store"==this.paymentType?1:0,storeCorrectionAllow:this.storeCorrectionAllow?1:0};localStorage.storeCorrectionAllow=this.storeCorrectionAllow?1:0;try{await O().post(`${this.$heap.state.hostname}Order/itemCheckoutDataSet`,JSON.stringify(e))}catch(d){var t,r;const e=null===d||void 0===d||null===(t=d.responseJSON)||void 0===t||null===(r=t.messages)||void 0===r?void 0:r.error;if(!e)return!1;switch(e){case"payment_already_done":return this.$flash("Уже оплачен"),void this.$go(`/order/shipment-${this.order.order_id}`);case"credit_balance_low":return void this.$flash("Не достаточно средств на счету");case"promo_share_too_high":return void this.$flash("Сумма заказа с этой скидкой должна быть больше")}return this.$flash("Не удается оформить заказ, обратитесь на горячую линию"),!1}if(1!=e.paymentByCard){if(1==e.paymentByCardRecurrent){const e={order_id:this.order.order_id,card_id:this.bankCard.card_id};try{this.$flash("Оплачиваем сохраненной картой..."),await O().post(`${this.$heap.state.hostname}CardAcquirer/paymentDo`,e)}catch(d){var i,o;const e=null===d||void 0===d||null===(i=d.responseJSON)||void 0===i||null===(o=i.messages)||void 0===o?void 0:o.error;switch(e){case"error_nocof":this.$flash("Нет привязанного способа оплаты");break;case"error_fund":this.$alert("На счету недостаточно средств","Оплата не прошла");break;case"error_card":this.$alert("Возможно карта заблокирована или просрочена","Не действительная карта");break;case"error_fraud":this.$alert("Отказано в оплате! Обратитесь в ваш банк.","Оплата отклонена");break;default:this.$flash("Оплата сохраненной картой не удалась")}return!1}}try{this.$router.replace("/order/order-"+this.order.order_id)}catch(d){var a,l;const e=null===d||void 0===d||null===(a=d.responseJSON)||void 0===a||null===(l=a.messages)||void 0===l?void 0:l.error;switch(e){case"order_is_empty":this.$alert("К сожалению, товара не осталось в наличии &#9785;","Заказ пуст");break;case"address_not_set":this.$flash("Необходимо добавить адрес доставки"),this.$topic.publish("dismissModal"),this.$go("/modal/user-addresses");break}return!1}}else this.paymentFormOpen({order_id:this.order.order_id})},async cancel(){this.$router.replace("/order/order-"+this.order.order_id)},async paymentFormOpen(e){const t=document.querySelector("ion-router-outlet"),r=this,i=await I.OZ.create({component:A.A,componentProps:{order_data:e},presentingElement:t}),o=function(){i.dismiss()};return w.A.on("dismissModal",o),i.onDidDismiss().then((()=>{r.paymentStatusCheck()})),i.present()},async paymentStatusCheck(){const e={order_id:this.order.order_id};try{const t=await O().post(this.$heap.state.hostname+"CardAcquirer/statusGet",e);"OK"==t&&this.$router.replace("/order/order-"+this.order.order_id)}catch(i){var t,r;const e=null===(t=i.responseJSON)||void 0===t||null===(r=t.messages)||void 0===r?void 0:r.error;"wrong_status"==e&&this.$flash("Данный заказ не может быть оплачен"),"not_authorized"==e&&this.$flash("Оплата не удалась, возможно недостаточно средств"),"waiting"==e&&this.$flash("Ваш платеж на ожидании"),this.$router.replace("/order/order-"+this.order.order_id)}},async deliveryAddressConfirm(){const e=await I.TN.create({header:"Адрес доставки",message:this.$heap.state.user.location_main.location_address,buttons:[{text:"Изменить",role:"cancel"},{text:"Верно",role:"confirm"}]});await e.present();const{role:t}=await e.onDidDismiss();return"confirm"==t||(this.$go("/modal/user-addresses"),!1)},async promoPick(){var e;const t=await I.OZ.create({component:D.A,showBackdrop:!0,backdropDismiss:!0,initialBreakpoint:.6,breakpoints:[0,.6,.75]});t.present(),this.$topic.on("dismissModal",(()=>{t.dismiss()}));const r=await t.onDidDismiss();this.promoLink(r.data),null!==r&&void 0!==r&&null!==(e=r.data)&&void 0!==e&&e.promo_id?this.promo=r.data:this.promo=null},async promoLink(e){try{const t={promo_id:null===e||void 0===e?void 0:e.promo_id,order_id:this.order.order_id};await O().post(`${this.$heap.state.hostname}Promo/itemLink`,t),this.itemCheckoutDataGet()}catch(t){}},async promoGet(){try{const e={order_id:this.order.order_id};return await O().post(`${this.$heap.state.hostname}Promo/itemLinkGet`,e)}catch(e){}},async promoCountGet(){try{const e={mode:"count",type:"active",user_id:this.$heap.state.user.user_id};return await O().post(`${this.$heap.state.hostname}Promo/listGet`,e)}catch(e){}}}},E=r(6262);const Q=(0,E.A)(V,[["render",S],["__scopeId","data-v-4f44d4c4"]]);var G=Q}}]);
//# sourceMappingURL=3229.a09c7760.js.map