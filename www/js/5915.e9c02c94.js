"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[5915],{7444:function(e,t,i){i.d(t,{Z:function(){return h}});var o=i(6252),n=i(3577);const a={style:{position:"absolute",top:"0px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},l={slot:"end",style:{color:"#666"}};function s(e,t,i,s,r,c){const d=(0,o.up)("ymap-marker"),u=(0,o.up)("yandex-map"),m=(0,o.up)("ion-searchbar"),p=(0,o.up)("ion-item"),h=(0,o.up)("ion-content"),_=(0,o.up)("ion-icon"),y=(0,o.up)("ion-button"),g=(0,o.up)("ion-toolbar");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{onClick:t[0]||(t[0]=e=>c.onClick(e)),style:{height:"100%"},coords:r.coords,zoom:16,settings:r.settings,controls:["zoomControl"]},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{coords:r.coords,"marker-id":"1",properties:r.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,o._)("div",a,[(0,o.Wm)(m,{debounce:"500",modelValue:r.addressSearchQuery,"onUpdate:modelValue":t[1]||(t[1]=e=>r.addressSearchQuery=e),onIonInput:t[2]||(t[2]=e=>c.suggestionsGet()),placeholder:"поиск адреса",style:{margin:"0px","padding-bottom":"0px"}},null,8,["modelValue"]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.suggestions,((e,t)=>((0,o.wg)(),(0,o.j4)(p,{key:t,onClick:t=>c.suggestionSelect(`${e.subtitle.text} ${e.title.text}`,e.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.subtitle.text)+" "+(0,n.zw)(e.title.text)+" ",1),(0,o._)("span",l,(0,n.zw)(e.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{strong:!0,onClick:t[3]||(t[3]=e=>c.pickAddress()),color:"primary",expand:"block"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{src:s.checkmark,slot:"start"},null,8,["src"]),(0,o.Uk)(" Ок ")])),_:1}),(0,o.Wm)(y,{onClick:t[4]||(t[4]=e=>s.closeModal()),color:"light",expand:"block"},{default:(0,o.w5)((()=>[(0,o.Uk)("Закрыть")])),_:1})])),_:1})],64)}i(3948),i(7658);var r=i(4929),c=i(5836),d=i(8903),u={components:{IonContent:r.W2,IonToolbar:r.sr,IonButton:r.YG,IonButtons:r.Sm,IonSearchbar:r.VI,IonHeader:r.Gu,IonIcon:r.gu,IonList:r.q_,IonItem:r.Ie,yandexMap:c.xR,ymapMarker:c.Jk},setup(){const e=function(){r.Fy.dismiss()};return{closeModal:e,locationOutline:d.Iv7,closeOutline:d.fID,checkmark:d.d29}},props:{location_group_name_low:String,location_group_id:Number},data(){let e=this.location_group_name_low+" адрес",t=this.$heap.state.settings.location,i=JSON.parse(t.mapCenter);return{settings:{apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},placemarkProperties:{iconCaption:e},suggestions:[],addressSearchQuery:null,locationType:e,locSettings:t,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:i}},methods:{async pickAddress(){try{if(!this.selectedAddress){var e;const t=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(e=t.geoObjects.get(0))||void 0===e?void 0:e.getAddressLine()}}catch(i){}var t={location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1]};r.Fy.dismiss(t)},filterAddress(e){const t=this.locSettings.addressErase.split(", "),i=e.split(", ");let o=[];for(const n of i)t.find((e=>e==n))||o.push(n);return o.reverse().join(", ")},onClick(e){e&&e.get&&(this.suggestions=[],this.selectedAddress=null,this.coords=e.get("coords"))},async suggestionsGet(){if(this.addressSearchQuery)try{const e=this.$heap.state.settings.location.ymapSuggestionApiKey,t=this.coords.slice().reverse().join(","),i=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${e}&lang=ru_RU&ll=${t}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),o=await i.json();this.suggestions=o.results||[]}catch(e){}else this.suggestions=[]},async suggestionSelect(e,t){this.selectedAddress=e,this.geocode(t)},async geocode(e){try{this.suggestions=[];const t=this.$heap.state.settings.location.ymapApiKey,i=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${t}&format=json&results=1&uri=${e}`),o=await i.json(),n=o.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=n.Point.pos.split(" ").reverse()}catch(t){console.log(t)}}},async mounted(){await(0,c.xk)();let e=window.ymaps;this.$flash("Получаем местоположение устройства"),e.geolocation.get().then((e=>{this.coords=e.geoObjects.position,this.$flash("На карте отмечено ваше местоположение")}))}},m=i(3744);const p=(0,m.Z)(u,[["render",s]]);var h=p},5915:function(e,t,i){i.r(t),i.d(t,{default:function(){return te}});var o=i(6252),n=i(3577);const a=e=>((0,o.dD)("data-v-b9276c8c"),e=e(),(0,o.Cn)(),e),l=a((()=>(0,o._)("h1",null,"Ваш заказ",-1))),s=a((()=>(0,o._)("p",null,[(0,o._)("b",null,"Курьер")],-1))),r=a((()=>(0,o._)("b",null,"Откуда:",-1))),c=a((()=>(0,o._)("b",null,"Куда:",-1))),d=a((()=>(0,o._)("span",null,"отвезти сразу",-1))),u=a((()=>(0,o._)("b",null,"Ко времени",-1))),m={key:0},p={key:1},h=a((()=>(0,o._)("label",{for:"use_credit_store"},"Со счета предприятия",-1))),_={slot:"end"},y=["checked"],g=a((()=>(0,o._)("label",{for:"payment_cash"},"Оплата наличными",-1))),k={slot:"end"},f=["checked"],w={key:7},v=a((()=>(0,o._)("label",{for:"payment_card"},"Оплата картой без привязки",-1))),b={slot:"end"},C=["checked"],W={for:"use_card_recurrent"},I={slot:"end"},D=["checked"];function S(e,t,i,a,S,U){const O=(0,o.up)("ion-label"),$=(0,o.up)("ion-item"),x=(0,o.up)("ion-icon"),V=(0,o.up)("ion-text"),L=(0,o.up)("ion-item-divider"),j=((0,o.up)("ymap-marker"),(0,o.up)("yandex-map"),(0,o.up)("ion-segment-button")),A=(0,o.up)("ion-segment"),T=(0,o.up)("ion-img"),R=(0,o.up)("router-link"),z=(0,o.up)("ion-checkbox"),F=(0,o.up)("ion-list"),G=(0,o.up)("ion-card-content"),P=(0,o.up)("ion-card"),B=(0,o.up)("ion-button"),H=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(H,{pageTitle:"Оформление вызова курьера",pageDefaultBackLink:"/order/order-list",ref:"page"},{default:(0,o.w5)((()=>[(0,o.Wm)(F,{lines:"none"},{default:(0,o.w5)((()=>{var i;return[(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Wm)(O,null,{default:(0,o.w5)((()=>[l,s])),_:1})])),_:1}),(0,o.Wm)($,{detail:"",lines:"none",onClick:t[0]||(t[0]=e=>U.descriptionPick())},{default:(0,o.w5)((()=>{var e;return[(0,o.Wm)(x,{src:a.cubeOutline,slot:"start",size:"large",color:"medium",style:{"font-size":"2em"}},null,8,["src"]),null!==(e=S.ship)&&void 0!==e&&e.ship_description?((0,o.wg)(),(0,o.j4)(V,{key:0,color:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(S.ship.ship_description),1)])),_:1})):((0,o.wg)(),(0,o.j4)(V,{key:1,color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Скажите нам, что нужно перевезти?")])),_:1}))]})),_:1}),(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Детали перевозки")])),_:1}),(0,o.kq)("",!0),S.locationStart?((0,o.wg)(),(0,o.j4)($,{key:1,button:"",onClick:t[1]||(t[1]=e=>U.locationStartSelect())},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{color:"primary",src:a.locationOutline,slot:"start"},null,8,["src"]),(0,o.Wm)(V,null,{default:(0,o.w5)((()=>[r,(0,o.Uk)(" "+(0,n.zw)(S.locationStart.location_address),1)])),_:1})])),_:1})):((0,o.wg)(),(0,o.j4)($,{key:2,button:"","detail-icon":a.addOutline,onClick:t[2]||(t[2]=e=>U.locationStartSelect())},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{color:"medium",src:a.locationOutline,slot:"start"},null,8,["src"]),(0,o.Wm)(V,{color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Откуда забрать?")])),_:1})])),_:1},8,["detail-icon"])),S.locationFinish?((0,o.wg)(),(0,o.j4)($,{key:3,button:"",onClick:t[3]||(t[3]=e=>U.locationFinishSelect())},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{color:"primary",src:a.flagOutline,slot:"start"},null,8,["src"]),(0,o.Wm)(V,null,{default:(0,o.w5)((()=>[c,(0,o.Uk)(" "+(0,n.zw)(S.locationFinish.location_address),1)])),_:1})])),_:1})):((0,o.wg)(),(0,o.j4)($,{key:4,button:"","detail-icon":a.addOutline,onClick:t[4]||(t[4]=e=>U.locationFinishSelect())},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{color:"medium",src:a.flagOutline,slot:"start"},null,8,["src"]),(0,o.Wm)(V,{color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Куда отвезти?")])),_:1})])),_:1},8,["detail-icon"])),(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Wm)(A,{mode:"ios",value:"atonce"},{default:(0,o.w5)((()=>[(0,o.Wm)(j,{value:"atonce"},{default:(0,o.w5)((()=>[(0,o.Wm)(O,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Как можно скорее")])),_:1}),d])),_:1}),(0,o.Wm)(j,{value:"schedule",onClick:t[5]||(t[5]=e=>U.datetimePick())},{default:(0,o.w5)((()=>[(0,o.Wm)(O,null,{default:(0,o.w5)((()=>[u])),_:1}),U.deliveryArriveDatetimeLoc?((0,o.wg)(),(0,o.iD)("span",m,(0,n.zw)(U.deliveryArriveDatetimeLoc),1)):((0,o.wg)(),(0,o.iD)("span",p,"выберите день и время"))])),_:1})])),_:1})])),_:1}),(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Способы оплаты")])),_:1}),1==S.tariffRule.paymentByCreditStore?((0,o.wg)(),(0,o.j4)($,{key:5,button:"",detail:"false",onClick:t[6]||(t[6]=e=>S.paymentType="use_credit_store")},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:a.businessOutline,slot:"start",color:"medium"},null,8,["icon"]),h,(0,o._)("div",_,[(0,o._)("input",{type:"radio",name:"paymentType",id:"payment_credit_store",value:"cash",checked:"use_credit_store"==S.paymentType},null,8,y)])])),_:1})):(0,o.kq)("",!0),1==S.tariffRule.paymentByCash?((0,o.wg)(),(0,o.j4)($,{key:6,button:"",detail:"false",onClick:t[7]||(t[7]=e=>S.paymentType="use_cash")},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:a.cashOutline,slot:"start",color:"medium"},null,8,["icon"]),g,(0,o._)("div",k,[(0,o._)("input",{type:"radio",name:"paymentType",id:"payment_cash",value:"cash",checked:"use_cash"==S.paymentType},null,8,f)])])),_:1})):(0,o.kq)("",!0),1==S.tariffRule.paymentByCard?((0,o.wg)(),(0,o.iD)("div",w,[(0,o.Wm)($,{detail:"false",button:"",onClick:t[8]||(t[8]=e=>S.paymentType="use_card")},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:a.cardOutline,slot:"start",color:"medium"},null,8,["icon"]),v,(0,o._)("div",b,[(0,o._)("input",{type:"radio",name:"paymentType",id:"payment_card",value:"card",checked:"use_card"==S.paymentType},null,8,C)])])),_:1}),null!==(i=S.bankCard)&&void 0!==i&&i.card_type?((0,o.wg)(),(0,o.j4)($,{key:0,button:"",detail:"false",onClick:t[9]||(t[9]=e=>S.paymentType="use_card_recurrent")},{default:(0,o.w5)((()=>{var e;return["mir"==S.bankCard.card_type?((0,o.wg)(),(0,o.j4)(T,{key:0,class:"card_type",src:`/img/icons/card-${S.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==S.bankCard.card_type?((0,o.wg)(),(0,o.j4)(T,{key:1,class:"card_type",src:`/img/icons/card-${S.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==S.bankCard.card_type?((0,o.wg)(),(0,o.j4)(T,{key:2,class:"card_type",src:`/img/icons/card-${S.bankCard.card_type}.svg`,slot:"start"},null,8,["src"])):((0,o.wg)(),(0,o.j4)(x,{key:3,src:a.cardOutline,slot:"start",color:"medium"},null,8,["src"])),(0,o._)("label",W,"Оплата картой "+(0,n.zw)(null===(e=S.bankCard)||void 0===e?void 0:e.card_mask),1),(0,o._)("div",I,[(0,o._)("input",{type:"radio",name:"paymentType",id:"use_card_recurrent",value:"registered_card",checked:"use_card_recurrent"==S.paymentType},null,8,D)])]})),_:1})):(0,o.kq)("",!0),S.recurrentPaymentAllow?((0,o.wg)(),(0,o.j4)($,{key:1,button:"",detail:"",onClick:t[10]||(t[10]=t=>e.$go("/user/user-cards"))},{default:(0,o.w5)((()=>{var e;return[null!==(e=S.bankCard)&&void 0!==e&&e.card_type?((0,o.wg)(),(0,o.j4)(O,{key:0,color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Выбрать другую карту")])),_:1})):((0,o.wg)(),(0,o.j4)(O,{key:1,color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Привязать карту")])),_:1}))]})),_:1})):(0,o.kq)("",!0)])):(0,o.kq)("",!0),(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Итог")])),_:1}),U.ship_sum_total>0?((0,o.wg)(),(0,o.j4)($,{key:8},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{icon:a.walletOutline,slot:"start",color:"medium"},null,8,["icon"]),(0,o.Uk)(" Итого к оплате "),(0,o.Wm)(V,{slot:"end"},{default:(0,o.w5)((()=>[(0,o._)("b",null,(0,n.zw)(U.ship_sum_total),1),(0,o.Uk)((0,n.zw)(e.$heap.state.currencySign),1)])),_:1})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Wm)(V,{style:{"font-size":"0.9em"}},{default:(0,o.w5)((()=>[(0,o.Uk)(" Я согласен(на) с "),(0,o.Wm)(R,{to:"/page/rules-customer"},{default:(0,o.w5)((()=>[(0,o.Uk)("офертой об оказании услуг доставки")])),_:1})])),_:1}),(0,o.Wm)(z,{slot:"end",modelValue:S.termsAccepted,"onUpdate:modelValue":t[11]||(t[11]=e=>S.termsAccepted=e),"aria-label":""},null,8,["modelValue"])])),_:1})]})),_:1}),U.checkoutError?((0,o.wg)(),(0,o.j4)(P,{key:0,color:"warning"},{default:(0,o.w5)((()=>[(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(U.checkoutError),1)])),_:1})])),_:1})):(0,o.kq)("",!0),!U.isVPNon||"use_card"!=S.paymentType&&"use_card_recurrent"!=S.paymentType?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(P,{key:1,color:"light"},{default:(0,o.w5)((()=>[(0,o.Wm)(G,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Возможно включен VPN. Банк часто блокирует платежи через VPN.")])),_:1})])),_:1})),"use_card"==S.paymentType||"use_card_recurrent"==S.paymentType?((0,o.wg)(),(0,o.j4)(B,{key:2,expand:"block",onClick:t[12]||(t[12]=t=>e.proceed()),disabled:U.checkoutError},{default:(0,o.w5)((()=>[(0,o.Uk)("Оплатить картой")])),_:1},8,["disabled"])):((0,o.wg)(),(0,o.j4)(B,{key:3,expand:"block",onClick:t[13]||(t[13]=t=>e.proceed()),disabled:U.checkoutError},{default:(0,o.w5)((()=>[(0,o.Uk)("Вызвать курьера")])),_:1},8,["disabled"]))])),_:1},512)}i(6699),i(8862);var U=i(4929),O=i(8903),$=i(5836),x=i(4405),V=i(9755),L=i.n(V);function j(e,t,i,a,l,s){const r=(0,o.up)("ion-title"),c=(0,o.up)("ion-icon"),d=(0,o.up)("ion-item"),u=(0,o.up)("ion-toolbar"),m=(0,o.up)("ion-header"),p=(0,o.up)("ion-img"),h=(0,o.up)("ion-label"),_=(0,o.up)("ion-list"),y=(0,o.up)("ion-list-header"),g=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Мои адреса")])),_:1}),(0,o.Wm)(c,{slot:"end",onClick:t[0]||(t[0]=e=>{s.modalClose()}),icon:a.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[l.locationList.length?((0,o.wg)(),(0,o.j4)(_,{key:0,lines:"full"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.locationList,((t,i)=>((0,o.wg)(),(0,o.j4)(d,{key:t.location_id},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{slot:"start",alt:"location icon",src:`${e.$heap.state.hostname}/image/get.php/${t.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,o.Wm)(h,{onClick:e=>s.locationSelect(t),style:{"white-space":"normal",cursor:"pointer"},class:(0,n.C_)(1==t.is_main?"is_main":"")},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(t.location_address),1)])),_:2},1032,["onClick","class"]),(0,o.Wm)(c,{slot:"end",icon:a.trashOutline,onClick:e=>s.locationDelete(`${t.location_id}`,`${i}`)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Добавить адрес")])),_:1})])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.locationGroupList,(t=>((0,o.wg)(),(0,o.j4)(d,{key:t.group_id,onClick:e=>s.modalLocationCreate(`${t.group_id}`,`${t.group_name}`),style:{cursor:"pointer"}},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{src:`${e.$heap.state.hostname}/image/get.php/${t.image_hash}.60.60.png`,style:{height:"24px"},slot:"start"},null,8,["src"]),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(t.group_name),1)])),_:2},1024),(0,o.Wm)(c,{src:a.addOutline,slot:"end"},null,8,["src"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})],64)}i(3948);var A=i(2008),T=i(351),R=i(7444),z={components:{IonImg:U.Xz,IonLabel:U.Q$,IonItem:U.Ie,IonList:U.q_,IonListHeader:U.yh,IonIcon:U.gu,IonHeader:U.Gu,IonToolbar:U.sr,IonTitle:U.wd,IonContent:U.W2},setup(){return{locationOutline:O.Iv7,trashOutline:O.gtu,addOutline:O.s6O,closeOutline:O.fID}},data(){return{locationList:[],locationGroupList:[]}},mounted(){this.locationListGet(),this.$topic.on("dismissModal",(()=>this.modalClose()))},computed:{mainAddress(){var e;return null===(e=this.locationList)||void 0===e?void 0:e.find((e=>1==e.is_main))}},methods:{modalClose(){U.Fy.dismiss(null,"cancel")},async modalLocationCreate(e,t){if(!A.Z.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/user/sign-in"));var i=String(t).toLowerCase();const o=await U.Fy.create({component:R.Z,showBackdrop:!0,componentProps:{location_group_name_low:i}});return o.onDidDismiss().then((t=>{this.locationCreate(e,t.data)})),o.present()},async locationListGet(){try{let e=null;const t=await L().get(A.Z.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=t.location_list,this.locationGroupList=t.location_group_list,this.locationList)for(let i of this.locationList)1==i.is_main&&(e=i);if(!e)return void T.Z.get()}catch(e){}},async locationCreate(e,t){if(!t)return;let i={location_holder:"user",location_holder_id:A.Z.state.user.user_id,location_group_id:e,location_address:t.location_address,location_latitude:t.location_latitude,location_longitude:t.location_longitude};try{await L().post(A.Z.state.hostname+"User/locationCreate",i),this.locationListGet()}catch(o){const e=o.responseJSON,t=e.messages.error;switch(t){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},locationSelect(e){U.Fy.dismiss(e,"confirm")},async locationDelete(e,t){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(t,1),await L().post(A.Z.state.hostname+"User/locationDelete",{location_id:e})}catch(i){}this.locationListGet()}}}},F=i(3744);const G=(0,F.Z)(z,[["render",j],["__scopeId","data-v-1f3c9982"]]);var P=G;const B={style:{height:"100%"}};function H(e,t,i,n,a,l){const s=(0,o.up)("ion-title"),r=(0,o.up)("ion-icon"),c=(0,o.up)("ion-item"),d=(0,o.up)("ion-toolbar"),u=(0,o.up)("ion-header"),m=(0,o.up)("ion-datetime"),p=(0,o.up)("ion-button"),h=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)("div",B,[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Выбрать день и час")])),_:1}),(0,o.Wm)(r,{slot:"end",onClick:t[0]||(t[0]=e=>{l.cancel()}),icon:n.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(h,{class:"ion-padding"},{default:(0,o.w5)((()=>{var e,n;return[(0,o.Wm)(m,{style:{"max-width":"100%","border-radius":"10px"},presentation:"date-time",modelValue:a.datetime,"onUpdate:modelValue":t[1]||(t[1]=e=>a.datetime=e),"prefer-wheel":!0,"first-day-of-week":1,min:null===(e=i.dateRange)||void 0===e?void 0:e.dayFirst,max:null===(n=i.dateRange)||void 0===n?void 0:n.dayLast,"hour-values":l.hourValues,"minute-values":0},null,8,["modelValue","min","max","hour-values"]),(0,o.Wm)(p,{color:"primary",onClick:t[2]||(t[2]=e=>l.confirm()),expand:"block"},{default:(0,o.w5)((()=>[(0,o.Uk)("Ок")])),_:1})]})),_:1})])}var Z={props:["dateRange"],components:{IonTitle:U.wd,IonDatetime:U.x4,IonToolbar:U.sr,IonContent:U.W2,IonHeader:U.Gu,IonIcon:U.gu,IonItem:U.Ie,IonButton:U.YG},setup(){return{closeOutline:O.fID}},data(){var e;const t=this.dateRange.dayHours[this.dateRange.dayFirst][0];let i=`${this.dateRange.dayFirst}T${t}:00:00`;return null!==(e=this.dateRange)&&void 0!==e&&e.defaultValue&&(i=this.dateRange.defaultValue),{datetime:i}},computed:{hourValues(){if(this.dateRange&&this.dateRange.dayHours&&this.datetime){const[e]=this.datetime.split("T");return this.dateRange.dayHours[e]}return null}},methods:{confirm(){U.Fy.dismiss(this.datetime,"confirm")},cancel(){U.Fy.dismiss(null,"cancel")}}};const q=(0,F.Z)(Z,[["render",H],["__scopeId","data-v-2e4aab34"]]);var M=q;i(1817);const N={style:{height:"100%"}},E={style:{display:"grid","grid-template-columns":"1fr 1fr",width:"100%"}};function Y(e,t,i,n,a,l){const s=(0,o.up)("ion-title"),r=(0,o.up)("ion-icon"),c=(0,o.up)("ion-item"),d=(0,o.up)("ion-toolbar"),u=(0,o.up)("ion-header"),m=(0,o.up)("ion-textarea"),p=(0,o.up)("ion-checkbox"),h=(0,o.up)("ion-card-content"),_=(0,o.up)("ion-card"),y=(0,o.up)("ion-button"),g=(0,o.up)("ion-content");return(0,o.wg)(),(0,o.iD)("div",N,[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Описание посылки")])),_:1}),(0,o.Wm)(r,{slot:"end",onClick:t[0]||(t[0]=e=>{l.cancel()}),icon:n.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(g,{class:"ion-padding"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{lines:"full"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{modelValue:a.description,"onUpdate:modelValue":t[1]||(t[1]=e=>a.description=e),rows:"5",label:"Описание посылки","label-placement":"stacked",placeholder:"что будем везти?"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(c,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Подтверждаю, что посылка ")])),_:1}),(0,o._)("div",E,[(0,o.Wm)(_,{color:a.isDimentionValid?"light":"",mode:"md"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{modelValue:a.isDimentionValid,"onUpdate:modelValue":t[2]||(t[2]=e=>a.isDimentionValid=e),"label-placement":"end"},{default:(0,o.w5)((()=>[(0,o.Uk)("меньше 40см")])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["color"]),(0,o.Wm)(_,{color:a.isWeightValid?"light":"",mode:"md"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{modelValue:a.isWeightValid,"onUpdate:modelValue":t[3]||(t[3]=e=>a.isWeightValid=e),"label-placement":"end"},{default:(0,o.w5)((()=>[(0,o.Uk)("легче 8кг")])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["color"])]),l.isValid||a.description?l.isValid||a.isDimentionValid&&a.isWeightValid?((0,o.wg)(),(0,o.j4)(y,{key:2,expand:"block",onClick:t[4]||(t[4]=e=>l.confirm())},{default:(0,o.w5)((()=>[(0,o.Uk)("Ок")])),_:1})):((0,o.wg)(),(0,o.j4)(y,{key:1,disabled:"",expand:"block",color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Подтвердите размеры")])),_:1})):((0,o.wg)(),(0,o.j4)(y,{key:0,disabled:"",expand:"block",color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Заполните описание")])),_:1}))])),_:1})])}var J={props:["ship_description"],components:{IonTitle:U.wd,IonToolbar:U.sr,IonContent:U.W2,IonHeader:U.Gu,IonIcon:U.gu,IonItem:U.Ie,IonButton:U.YG,IonCheckbox:U.nz,IonTextarea:U.g2,IonCard:U.PM,IonCardContent:U.FN},setup(){return{closeOutline:O.fID}},data(){return{description:this.ship_description,isDimentionValid:this.ship_description?1:0,isWeightValid:this.ship_description?1:0}},computed:{isValid(){return this.description&&this.isDimentionValid&&this.isWeightValid}},methods:{confirm(){U.Fy.dismiss(this.description,"confirm")},cancel(){U.Fy.dismiss(null,"cancel")}}};const K=(0,F.Z)(J,[["render",Y]]);var Q=K,X={components:{yandexMap:$.xR,ymapMarker:$.Jk,IonText:U.yW,IonList:U.q_,IonItem:U.Ie,IonIcon:U.gu,IonLabel:U.Q$,IonSegment:U.cJ,IonSegmentButton:U.GO,IonImg:U.Xz,IonCard:U.PM,IonCardContent:U.FN,IonButton:U.YG,IonCheckbox:U.nz,IonItemDivider:U.rH},setup(){return{cubeOutline:O.XFf,locationOutline:O.Iv7,flagOutline:O.FMn,chevronDown:O.Dd1,addOutline:O.s6O,checkmark:O.d29,cardOutline:O.pvm,cashOutline:O.zaw,businessOutline:O.c1X,walletOutline:O.S5P}},data(){var e,t;return{presentingElement:null,isDatePickerOpen:!1,deliveryArriveRange:{},deliveryArriveRangeHours:[],deliveryArriveDatetime:null,ship_id:this.$route.params.id,ship:null,shipAutoloadClock:null,ship_sum_delivery:0,termsAccepted:1,iplocation:null,paymentType:"use_card",bankCard:null,recurrentPaymentAllow:1==(null===(e=this.$heap.state.settings)||void 0===e||null===(t=e.other)||void 0===t?void 0:t.recurrentPaymentAllow)?1:0,tariffRule:{},tariffRuleList:[],errorCode:null,locationStart:null,locationFinish:null,mapsettings:null,placemarkCoords:null,placemarkProperties:{},placemarkIcon:{layout:"default#imageWithContent",content:"some content here",contentLayout:'<div class="placemarkBaloon">$[properties.iconContent]</div>',contentOffset:[45,10],imageHref:"/img/tezkel-placemark.png",imageSize:[50,50],imageOffset:[-25,-50]}}},computed:{deliveryArriveDatetimeLoc(){if(!this.deliveryArriveDatetime)return null;const e=new Date(Date.parse(this.deliveryArriveDatetime)),t={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return e.toLocaleDateString(void 0,t)},checkoutError(){return"no_input"==this.errorCode?"Выберите адрес забора и доставки посылки":"no_courier"==this.errorCode?"Нет доступных курьеров":0==this.termsAccepted?"К сожалению, мы не можем доставить вам заказ, без согласия с условиями":null},isVPNon(){var e;return!(!this.iplocation||["UA","RU","???"].includes(null!==(e=this.iplocation.country_code)&&void 0!==e?e:"???"))},ship_sum_total(){return this.ship_sum_delivery}},methods:{deliveryTimeAllowed(e){const t=new Date(e);t.getUTCDay();return!0},async itemLoad(){this.itemCheckoutDataGet()},async itemCheckoutDataGet(){try{let e=await x.Z.prePost(`${this.$heap.state.hostname}Shipment/itemCheckoutDataGet`,{ship_id:this.ship_id});this.itemCheckoutDataUse(e),e=await x.Z.post(`${this.$heap.state.hostname}Shipment/itemCheckoutDataGet`,{ship_id:this.ship_id}),this.ship=e.ship,this.itemCheckoutDataUse(e)}catch(i){var e,t;return this.is_checkout_data_loaded=1,this.errorCode=null===i||void 0===i||null===(e=i.responseJSON)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.error,console.log(this.errorCode),!1}},async itemCheckoutDataUse(e){var t;e&&(this.deliveryTime=x.Z.deliveryTimeCalculate(e.Location_distanceGet,0),this.deliveryArriveRange=e.deliveryArriveRange,this.locationStart=e.Ship_locationStart,this.locationFinish=e.Ship_locationFinish,this.bankCard=null===e||void 0===e?void 0:e.bankCard,this.tariffRuleList=e.Ship_deliveryOptions,this.tariffRuleSet((null===(t=this.tariffRuleList)||void 0===t?void 0:t[0])||{}),this.is_checkout_data_loaded=1)},async itemCheckoutDataSet(){var e,t;const i={ship_id:this.ship_id,ship_start_location_id:null===(e=this.locationStart)||void 0===e?void 0:e.location_id,ship_finish_location_id:null===(t=this.locationFinish)||void 0===t?void 0:t.location_id,ship_arrive_time:this.deliveryArriveDatetime,ship_description:this.ship.ship_description};try{await L().post(`${this.$heap.state.hostname}Shipment/itemCheckoutDataSet`,JSON.stringify(i))}catch(o){console.log(o)}},tariffRuleSet(e){var t;this.tariffRule=e,this.ship_sum_delivery=e.ship_sum_delivery,this.paymentType="use_card",null!==(t=this.bankCard)&&void 0!==t&&t.card_type&&(this.paymentType="use_card_recurrent"),1==e.paymentByCreditStore?this.paymentType="use_credit_store":1==e.paymentByCash&&(this.paymentType="use_cash")},async locationSelect(){const e=document.querySelector("ion-router-outlet"),t=await U.Fy.create({component:P,canDismiss:!0,backdropDismiss:!0,keyboardClose:!0,presentingElement:e});t.present();const{data:i,role:o}=await t.onWillDismiss();return i},async locationStartSelect(){this.locationStart=await this.locationSelect()},async locationFinishSelect(){this.locationFinish=await this.locationSelect()},async datetimePick(){var e;this.deliveryArriveRange.defaultValue=null!==(e=this.deliveryArriveDatetime)&&void 0!==e?e:null;const t=await U.Fy.create({component:M,initialBreakpoint:"0.5",showBackdrop:!0,componentProps:{dateRange:this.deliveryArriveRange}});t.present();const i=await t.onDidDismiss();"confirm"==i.role&&(this.deliveryArriveDatetime=i.data)},async descriptionPick(){var e;const t=null===(e=this.ship)||void 0===e?void 0:e.ship_description,i=await U.Fy.create({component:Q,initialBreakpoint:"0.5",showBackdrop:!0,componentProps:{ship_description:t}});i.present();const o=await i.onDidDismiss();"confirm"==o.role&&(this.ship.ship_description=o.data,this.itemCheckoutDataSet())},async customerIpLocationGet(){try{const e=await fetch("https://geolocation-db.com/json/");this.iplocation=await e.json()}catch(e){}}},mounted(){this.itemLoad();let e=this.$heap.state.settings;null!==e&&void 0!==e&&e.location&&this.ymapInit(e.location),this.$topic.on("settingsGet",(async e=>{this.ymapInit(e.location)})),this.presentingElement=this.$refs.page.$el},ionViewDidEnter(){this.itemLoad()}};const ee=(0,F.Z)(X,[["render",S],["__scopeId","data-v-b9276c8c"]]);var te=ee}}]);
//# sourceMappingURL=5915.e9c02c94.js.map