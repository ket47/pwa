"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[956],{5265:function(t,e,a){a.d(e,{Z:function(){return k}});var n=a(6252);const i=["src"],s={key:0,style:{position:"fixed",top:"200px",left:"calc( 50% - 50px )"}},o=["src"];function r(t,e,a,r,l,c){const d=(0,n.up)("ion-title"),u=(0,n.up)("ion-icon"),m=(0,n.up)("ion-toolbar"),p=(0,n.up)("ion-header"),h=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(m,{color:"secondary"},{default:(0,n.w5)((()=>["card_registering"==this.order_data?((0,n.wg)(),(0,n.j4)(d,{key:0},{default:(0,n.w5)((()=>[(0,n.Uk)("Привязка новой карты")])),_:1})):((0,n.wg)(),(0,n.j4)(d,{key:1},{default:(0,n.w5)((()=>[(0,n.Uk)("Оплата картой")])),_:1})),(0,n.Wm)(u,{icon:r.closeOutline,onClick:e[0]||(e[0]=t=>{r.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n._)("iframe",{src:l.paymentLink,id:"paymentFrame1",style:{width:"100%",height:"calc( 100% - 5px )",border:"none"},onLoad:e[1]||(e[1]=t=>c.onLoad())},null,40,i),l.loadAnimation?((0,n.wg)(),(0,n.iD)("div",s,[(0,n._)("img",{src:r.loading},null,8,o)])):(0,n.kq)("",!0)])),_:1})],64)}var l=a(6964),c=a(8903),d=a(659),u=a(9755),m=a.n(u),p={components:{IonTitle:l.wd,IonIcon:l.gu,IonToolbar:l.sr,IonHeader:l.Gu,IonContent:l.W2},props:["order_data"],setup(){const t=function(){l.Fy.dismiss()};return{closeModal:t,closeOutline:c.fID,cardOutline:c.pvm,loading:d}},data(){return{paymentLink:null,loadAnimation:1}},mounted(){this.listenFrame(),this.postToIframe()},methods:{async postToIframe(){try{if("card_registering"==this.order_data)return void(this.paymentLink=await m().post(this.$heap.state.hostname+"CardAcquirer/cardRegisterLinkGet"));this.paymentLink=await m().post(this.$heap.state.hostname+"CardAcquirer/paymentLinkGet",this.order_data)}catch(a){var t,e;const n=null===a||void 0===a||null===(t=a.responseJSON)||void 0===t||null===(e=t.messages)||void 0===e?void 0:e.error;"nocardid"==n?this.$flash("Не удалось добавить карту"):this.$flash("Нет возможности принять оплату картой"),this.closeModal()}},onLoad(){this.loadAnimation=0},listenFrame(){let t=this;window.addEventListener("message",(e=>{"paymentOk"!=e.data&&"paymentNo"!=e.data||t.closeModal()}))}}},h=a(3744);const g=(0,h.Z)(p,[["render",r]]);var k=g},2956:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var n=a(6252),i=a(3577);function s(t,e,a,s,o,r){const l=(0,n.up)("ion-icon"),c=(0,n.up)("ion-skeleton-text"),d=(0,n.up)("ion-item"),u=(0,n.up)("ion-list"),m=(0,n.up)("ion-img"),p=(0,n.up)("ion-label"),h=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(h,{pageTitle:"Мои банковские карты",pageDefaultBackLink:"/user"},{default:(0,n.w5)((()=>{var t;return[null==o.cardList?((0,n.wg)(),(0,n.j4)(u,{key:0},{default:(0,n.w5)((()=>[((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([1],(t=>(0,n.Wm)(d,{key:t},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{style:{"background-color":"var(--ion-color-light)"},slot:"start"}),(0,n.Wm)(c,{animated:"",style:{width:"100%"}}),(0,n.Wm)(l,{style:{"background-color":"var(--ion-color-light)"},slot:"end"})])),_:2},1024))),64))])),_:1})):(null===(t=o.cardList)||void 0===t?void 0:t.length)>0?((0,n.wg)(),(0,n.j4)(u,{key:1},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.cardList,((t,e)=>((0,n.wg)(),(0,n.j4)(d,{key:t.order_id,button:""},{default:(0,n.w5)((()=>["mir"==t.card_type?((0,n.wg)(),(0,n.j4)(m,{key:0,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):"visa"==t.card_type?((0,n.wg)(),(0,n.j4)(m,{key:1,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):"mastercard"==t.card_type?((0,n.wg)(),(0,n.j4)(m,{key:2,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):((0,n.wg)(),(0,n.j4)(l,{key:3,src:s.cardOutline,slot:"start",color:"primary"},null,8,["src"])),(0,n.Wm)(p,{onClick:a=>0!=e&&r.itemMainSet(t.card_id),class:(0,i.C_)(0==e?"is_main":"")},{default:(0,n.w5)((()=>[(0,n.Uk)((0,i.zw)(t.card_mask),1)])),_:2},1032,["onClick","class"]),(0,n.Wm)(l,{icon:s.trashOutline,slot:"end",onClick:e=>r.itemDelete(t.card_id)},null,8,["icon","onClick"])])),_:2},1024)))),128))])),_:1})):((0,n.wg)(),(0,n.j4)(u,{key:2},{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p,{color:"medium"},{default:(0,n.w5)((()=>[(0,n.Uk)("Привязанных карт нет")])),_:1})])),_:1})])),_:1})),(0,n.Wm)(d,{button:"",onClick:e[0]||(e[0]=t=>r.cardRegistrationOpen())},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{icon:s.addOutline,slot:"start"},null,8,["icon"]),(0,n.Uk)(" Добавить новую карту ")])),_:1})]})),_:1})}var o=a(6964),r=a(8903),l=a(5265),c=a(9042),d=a(9755),u=a.n(d),m={components:{IonList:o.q_,IonItem:o.Ie,IonSkeletonText:o.CK,IonLabel:o.Q$,IonIcon:o.gu,IonImg:o.Xz},setup(){return{cardOutline:r.pvm,addOutline:r.s6O,trashOutline:r.gtu}},data(){return{cardList:null,isOpen:!1,billLink:""}},methods:{async listGet(){try{this.cardList=await u().post(this.$heap.state.hostname+"UserCards/listGet")}catch{}},async itemMainSet(t){const e={card_id:t};try{await u().post(`${this.$heap.state.hostname}UserCards/itemMainSet`,e),this.listGet()}catch{}},async itemDelete(t){if(!confirm("Вы уверенны?"))return;const e={card_id:t};try{await u().post(`${this.$heap.state.hostname}UserCards/itemDelete`,e),this.listGet()}catch{this.flash("Не удалось открепить карту")}},async cardRegistrationOpen(){const t="card_registering",e=this,a=await o.Fy.create({component:l.Z,componentProps:{order_data:t},initialBreakpoint:.85,breakpoints:[0,.85,.95]}),n=function(){a.dismiss()};return c.Z.on("dismissModal",n),a.onDidDismiss().then((()=>{e.cardRegistrationCheck()})),a.present()},async cardRegistrationCheck(){try{const t=await u().post(this.$heap.state.hostname+"CardAcquirer/cardRegisterActivate");"ok"==t&&(this.$flash("Карта успешно привязана"),this.listGet())}catch(t){this.$flash("Не удалось привязать карту")}}},mounted(){this.listGet()}},p=a(3744);const h=(0,p.Z)(m,[["render",s],["__scopeId","data-v-2e696c9d"]]);var g=h},659:function(t,e,a){t.exports=a.p+"img/loading.30880178.svg"}}]);
//# sourceMappingURL=956.58e54938.js.map