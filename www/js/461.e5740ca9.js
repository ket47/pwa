"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[461],{4405:function(t,e,a){a(5306);var n=a(2008);const s={deliveryCalculate(t){if(!t.locations||!t.locations[0]||!t.locations[0].distance)return null;const e=t.locations[0].distance,a=t.store_time_preparation||0;return s.deliveryTimeCalculate(e,a)},deliveryTimeCalculate(t,e){var a;e=parseInt(null!==(a=e)&&void 0!==a?a:n.Z.getters.settings.delivery.timePreparationDefault);const s=parseInt(n.Z.getters.settings.delivery.timeDelta),i=parseInt(n.Z.getters.settings.delivery.speed),r=5*Math.round(t/i*60/5)+e,o=r>s?r-s:r,l=o+s;return{time:r,timeMin:o,timeMax:l}},render(t,e){for(let a in e)t=t.replace(`{{${a}}}`,e[a]);return t}};e["Z"]=s},4461:function(t,e,a){a.r(e),a.d(e,{default:function(){return D}});var n=a(6252),s=a(3577);const i=(0,n.Uk)("–î–∞—Ç–∞"),r=(0,n.Uk)("–¢–∏–ø –ø—Ä–æ–≤–æ–¥–∫–∏"),o=(0,n.Uk)("–ó–∞–∫–∞–∑ #"),l=(0,n.Uk)("–ü—Ä–æ–¥–∞–≤–µ—Ü #"),d=(0,n.Uk)("–ö—É—Ä—å–µ—Ä #"),u=(0,n.Uk)("–°—É–º–º–∞"),c=(0,n.Uk)("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"),_=(0,n.Uk)("–û—Ç–∫–ª—é—á–µ–Ω–∞"),m=(0,n.Uk)("–£–¥–∞–ª–∏—Ç—å"),h=(0,n.Uk)("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å");function p(t,e,a,p,f,w){const y=(0,n.up)("ion-label"),k=(0,n.up)("ion-input"),g=(0,n.up)("ion-item"),$=(0,n.up)("ion-select-option"),I=(0,n.up)("ion-select"),W=(0,n.up)("ion-icon"),v=(0,n.up)("ion-button"),b=(0,n.up)("ion-textarea"),U=(0,n.up)("ion-toggle"),q=(0,n.up)("ion-note"),G=(0,n.up)("ion-list"),T=(0,n.up)("ion-col"),V=(0,n.up)("ion-row"),C=(0,n.up)("ion-grid"),D=(0,n.up)("base-layout");return(0,n.wg)(),(0,n.j4)(D,{pageDefaultBackLink:"/user","page-title":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∫–∏"},{default:(0,n.w5)((()=>[f.transaction?((0,n.wg)(),(0,n.j4)(G,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(y,{position:"floating"},{default:(0,n.w5)((()=>[i])),_:1}),(0,n.Wm)(k,{modelValue:f.transaction.trans_date,"onUpdate:modelValue":e[0]||(e[0]=t=>f.transaction.trans_date=t),placeholder:"–¥–∞—Ç–∞",type:"date"},null,8,["modelValue"])])),_:1}),(0,n.Wm)(g,{lines:"none"},{default:(0,n.w5)((()=>[(0,n.Wm)(y,{position:"floating"},{default:(0,n.w5)((()=>[r])),_:1}),(0,n.Wm)(I,{interface:"popover",placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–æ–≤–æ–¥–∫–∏",modelValue:f.transaction.trans_role,"onUpdate:modelValue":e[1]||(e[1]=t=>f.transaction.trans_role=t),required:"",onIonChange:e[2]||(e[2]=t=>w.itemUpdateRole())},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(f.transTypes,(t=>((0,n.wg)(),(0,n.j4)($,{key:t.trans_role,value:t.trans_role},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(t.trans_name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(I,{slot:"start",modelValue:f.transaction.trans_holder,"onUpdate:modelValue":e[3]||(e[3]=t=>f.transaction.trans_holder=t),disabled:"",placeholder:"–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞"},{default:(0,n.w5)((()=>[(0,n.Wm)($,{value:"order"},{default:(0,n.w5)((()=>[o])),_:1}),(0,n.Wm)($,{value:"store"},{default:(0,n.w5)((()=>[l])),_:1}),(0,n.Wm)($,{value:"courier"},{default:(0,n.w5)((()=>[d])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(y,{onClick:e[4]||(e[4]=t=>w.holderIdPick())},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(f.transaction.trans_holder_label),1)])),_:1}),(0,n.Wm)(v,{slot:"end",onClick:e[5]||(e[5]=t=>w.holderIdPick())},{default:(0,n.w5)((()=>[(0,n.Wm)(W,{icon:p.searchOutline},null,8,["icon"])])),_:1})])),_:1}),(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(y,{position:"floating"},{default:(0,n.w5)((()=>[u])),_:1}),(0,n.Wm)(k,{modelValue:f.transaction.trans_amount,"onUpdate:modelValue":e[6]||(e[6]=t=>f.transaction.trans_amount=t),placeholder:"—Å—É–º–º–∞",inputmode:"decimal",autocomplete:"transaction-amount",min:"1"},null,8,["modelValue"])])),_:1}),(0,n.Wm)(g,null,{default:(0,n.w5)((()=>[(0,n.Wm)(y,{position:"floating"},{default:(0,n.w5)((()=>[c])),_:1}),(0,n.Wm)(b,{modelValue:f.transaction.trans_description,"onUpdate:modelValue":e[7]||(e[7]=t=>f.transaction.trans_description=t)},null,8,["modelValue"])])),_:1}),(0,n.Wm)(g,{lines:"full"},{default:(0,n.w5)((()=>[(0,n.Wm)(y,null,{default:(0,n.w5)((()=>[_])),_:1}),(0,n.Wm)(U,{modelValue:f.transaction.is_disabled,"onUpdate:modelValue":e[8]||(e[8]=t=>f.transaction.is_disabled=t)},null,8,["modelValue"])])),_:1}),(0,n.Wm)(g,{lines:"none"},{default:(0,n.w5)((()=>[f.transaction.created_at?((0,n.wg)(),(0,n.j4)(q,{key:0},{default:(0,n.w5)((()=>[(0,n.Uk)(" –°–æ–∑–¥–∞–Ω–æ "+(0,s.zw)(f.transaction.created_user_name)+" "+(0,s.zw)(f.transaction.created_at),1)])),_:1})):(0,n.kq)("",!0),f.transaction.created_at?((0,n.wg)(),(0,n.j4)(q,{key:1},{default:(0,n.w5)((()=>[(0,n.Uk)(" –ò–∑–º–µ–Ω–µ–Ω–æ "+(0,s.zw)(f.transaction.updated_user_name)+" "+(0,s.zw)(f.transaction.updated_at),1)])),_:1})):(0,n.kq)("",!0)])),_:1})])),_:1})):(0,n.kq)("",!0),f.transaction?((0,n.wg)(),(0,n.j4)(C,{key:1},{default:(0,n.w5)((()=>[(0,n.Wm)(V,null,{default:(0,n.w5)((()=>[(0,n.Wm)(T,null,{default:(0,n.w5)((()=>[(0,n.Wm)(v,{color:"medium",onClick:e[9]||(e[9]=t=>w.itemDelete()),expand:"block"},{default:(0,n.w5)((()=>[m])),_:1})])),_:1}),(0,n.Wm)(T,null,{default:(0,n.w5)((()=>[(0,n.Wm)(v,{color:"primary",onClick:e[10]||(e[10]=t=>w.itemSave()),expand:"block"},{default:(0,n.w5)((()=>[h])),_:1})])),_:1})])),_:1})])),_:1})):(0,n.kq)("",!0)])),_:1})}a(5306),a(8862);var f=a(2066),w=a(8903),y=a(9755),k=a.n(y),g=a(351),$=a(4405);const I={class:"ion-page"},W=(0,n.Uk)(" –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ");function v(t,e,a,i,r,o){const l=(0,n.up)("ion-title"),d=(0,n.up)("ion-icon"),u=(0,n.up)("ion-toolbar"),c=(0,n.up)("ion-header"),_=(0,n.up)("ion-searchbar"),m=(0,n.up)("ion-skeleton-text"),h=(0,n.up)("ion-item"),p=(0,n.up)("ion-list"),f=(0,n.up)("ion-img"),w=(0,n.up)("ion-content");return(0,n.wg)(),(0,n.iD)("div",I,[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,{color:"secondary"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,null,{default:(0,n.w5)((()=>[(0,n.Uk)("–í—ã–±—Ä–∞—Ç—å "+(0,s.zw)(r.itemTypeName),1)])),_:1}),(0,n.Wm)(d,{icon:i.closeOutline,onClick:e[0]||(e[0]=t=>{o.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,n.Wm)(w,null,{default:(0,n.w5)((()=>{var a;return[(0,n.Wm)(_,{modelValue:r.query,"onUpdate:modelValue":e[1]||(e[1]=t=>r.query=t),debounce:100,onIonChange:e[2]||(e[2]=t=>o.listGet())},null,8,["modelValue"]),r.itemList?null!==(a=r.itemList)&&void 0!==a&&a.length?((0,n.wg)(),(0,n.j4)(p,{key:1},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.itemList,(e=>((0,n.wg)(),(0,n.j4)(h,{key:e.id,button:"",detail:"",onClick:t=>o.itemPick(e)},{default:(0,n.w5)((()=>[e.image_hash?((0,n.wg)(),(0,n.j4)(f,{key:0,slot:"start",src:`${t.$heap.state.hostname}image/get.php/${e.image_hash}.50.50.webp`},null,8,["src"])):(0,n.kq)("",!0),(0,n.Uk)(" "+(0,s.zw)(e.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,n.wg)(),(0,n.j4)(p,{key:2},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[W])),_:1})])),_:1})):((0,n.wg)(),(0,n.j4)(p,{key:0},{default:(0,n.w5)((()=>[((0,n.wg)(),(0,n.iD)(n.HY,null,(0,n.Ko)([0,1,2,3,4,5,6,7,8,9],(t=>(0,n.Wm)(h,{key:t,button:"",detail:""},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{style:{height:"35px",width:"40px"},animated:""}),(0,n.Wm)(m,{style:{width:"100%"},animated:""})])),_:2},1024))),64))])),_:1}))]})),_:1})])}var b={props:["itemType"],components:{IonContent:f.W2,IonHeader:f.Gu,IonToolbar:f.sr,IonTitle:f.wd,IonIcon:f.gu,IonImg:f.Xz,IonList:f.q_,IonItem:f.Ie,IonSearchbar:f.VI,IonSkeletonText:f.CK},setup(){return{closeOutline:w.fID}},data(){return{query:null,itemList:null,itemTypeName:""}},mounted(){this.listGet()},methods:{async listGet(){"order"==this.itemType?(this.itemTypeName="–ó–∞–∫–∞–∑",this.ordersGet()):"store"==this.itemType?(this.itemTypeName="–ü—Ä–æ–¥–∞–≤–µ—Ü",this.storesGet()):"courier"==this.itemType?(this.itemTypeName="–ö—É—Ä—å–µ—Ä",this.couriersGet()):this.$flash("unknown item type "+this.itemType)},async storesGet(){const t={name_query:this.query,name_query_fields:"store_name",limit:10};try{let e=await k().post(`${this.$heap.state.hostname}Store/listGet`,t);this.itemList=e.map((t=>(t.name=`–ø—Ä–æ–¥–∞–≤–µ—Ü ${t.store_name}`,t.id=t.store_id,t)))}catch{}},async couriersGet(){const t={name_query:this.query,name_query_fields:"user_name,user_phone",limit:10};try{let e=await k().post(`${this.$heap.state.hostname}Courier/listGet`,t);this.itemList=e.map((t=>(t.name=`–∫—É—Ä—å–µ—Ä ${t.user_name} ${t.user_phone}`,t.id=t.courier_id,t.image_hash=t.courier_photo_image_hash,t)))}catch{}},async ordersGet(){const t={name_query:this.query,name_query_fields:"store_name,order_id,user_name",limit:10};try{let e=await k().post(`${this.$heap.state.hostname}Order/listGet`,t);this.itemList=e.map((t=>(t.name=`–∑–∞–∫–∞–∑#${t.order_id} ${t.store_name} > ${t.user_name}`,t.id=t.order_id,t)))}catch{}},itemPick(t){f.Fy.dismiss(t)},closeModal(){f.Fy.dismiss()}}},U=a(3744);const q=(0,U.Z)(b,[["render",v]]);var G=q;const T=[{trans_role:"transit->supplier",trans_holder:"order",trans_name:"–ü—Ä–æ–¥–∞–≤–µ—Ü –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞",trans_description:"–°—Ä–µ–¥—Å—Ç–≤–∞ –≤–∑–∏–º–∞–µ–º—ã–µ —Å –ü—Ä–æ–¥–∞–≤—Ü–∞ –¥–ª—è –≤–æ–≤—Ä–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã –ü–æ–∫—É–ø–∞—Ç–µ–ª—é. –ó–∞–∫–∞–∑ ‚Ññ{{trans_holder_id}}"},{trans_role:"supplier->transit",trans_holder:"order",trans_name:"–ü—Ä–æ–¥–∞–≤–µ—Ü –û—Ç–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–∞",trans_description:"–°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞, –æ—Ç–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –ü–æ–∫—É–ø–∞—Ç–µ–ª—é. –ó–∞–∫–∞–∑ ‚Ññ{{trans_holder_id}}"},{trans_role:"capital.profit->supplier",trans_holder:"order",trans_name:"–ü—Ä–æ–¥–∞–≤–µ—Ü –ö–æ–º–∏—Å—Å–∏—è —Å–∞–π—Ç–∞",trans_description:"–ö–æ–º–∏—Å—Å–∏—è —Å–∞–π—Ç–∞ –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏. –ó–∞–∫–∞–∑ ‚Ññ{{trans_holder_id}}"},{trans_role:"money.account->supplier",trans_holder:"store",trans_name:"–ü—Ä–æ–¥–∞–≤–µ—Ü –í—ã–ø–ª–∞—Ç–∞",trans_description:"–û–ø–ª–∞—Ç–∞ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã–µ –∑–∞–∫–∞–∑—ã"},{trans_role:"supplier->money.account",trans_holder:"store",trans_name:"–ü—Ä–æ–¥–∞–≤–µ—Ü –ê–≤–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥",trans_description:"–ê–≤–∞–Ω—Å –∑–∞ —É—Å–ª—É–≥–∏ —Å–∞–π—Ç–∞"},{trans_role:"money.account->courier",trans_holder:"courier",trans_name:"–ö—É—Ä—å–µ—Ä –í—ã–ø–ª–∞—Ç–∞",trans_description:"–û–ø–ª–∞—Ç–∞ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É –∑–∞ –æ–∫–∞–∑–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏"},{trans_role:"courier->capital.profit",trans_holder:"order",trans_name:"–ö—É—Ä—å–µ—Ä –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞",trans_description:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ –ó–∞–∫–∞–∑ ‚Ññ{{trans_holder_id}}"},{trans_role:"capital.profit->courier",trans_holder:"order",trans_name:"–ö—É—Ä—å–µ—Ä –®—Ç—Ä–∞—Ñ",trans_description:"–®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ó–∞–∫–∞–∑–∞ ‚Ññ{{trans_holder_id}}"}];var V={components:{IonInput:f.pK,IonIcon:f.gu,IonList:f.q_,IonItem:f.Ie,IonToggle:f.ho,IonLabel:f.Q$,IonSelect:f.t9,IonSelectOption:f.n0,IonTextarea:f.g2,IonButton:f.YG,IonGrid:f.jY,IonRow:f.Nd,IonCol:f.wI,IonNote:f.uN},setup(){return{trashOutline:w.gtu,searchOutline:w.W6I}},data(){return{transactionId:this.$route.params.id,transaction:null,transTypes:T}},computed:{},created(){const t=this;this.$topic.on("userGet",(()=>{t.init()})),g.Z.isAdmin()&&this.init()},methods:{init(){g.Z.isAdmin()||this.$router.replace("/"),this.itemGet()},async itemGet(){if(0==this.transactionId)return void(this.transaction={});let t={trans_id:this.transactionId};try{this.transaction=await k().post(`${this.$heap.state.hostname}Transaction/itemGet`,t),this.holderLabelGet()}catch(n){var e,a;const t=null===n||void 0===n||null===(e=n.responseJSON)||void 0===e||null===(a=e.messages)||void 0===a?void 0:a.error;switch(t){case"forbidden":this.$flash("–ù–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤");break;case"notfound":this.$flash("–ü—Ä–æ–≤–æ–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");break}return!1}},async holderLabelGet(){try{if(this.transaction.trans_holder_label="","order"==this.transaction.trans_holder){const t={name_query:this.transaction.trans_holder_id,name_query_fields:"order_id"},e=await k().post(`${this.$heap.state.hostname}Order/listGet`,t),a=e[0];this.transaction.trans_holder_label=`–∑–∞–∫–∞–∑#${a.order_id} ${a.store_name} > ${a.user_name}`}if("store"==this.transaction.trans_holder){const t={name_query:this.transaction.trans_holder_id,name_query_fields:"store_id"},e=await k().post(`${this.$heap.state.hostname}Store/listGet`,t),a=e[0];this.transaction.trans_holder_label=`–ø—Ä–æ–¥–∞–≤–µ—Ü ${a.store_name}`}if("courier"==this.transaction.trans_holder){const t={name_query:this.transaction.trans_holder_id,name_query_fields:"courier_id"},e=await k().post(`${this.$heap.state.hostname}Courier/listGet`,t),a=e[0];this.transaction.trans_holder_label=`–∫—É—Ä—å–µ—Ä ${a.user_name} ${a.user_phone}`}}catch{}},async holderIdPick(){if(!this.transaction.trans_holder)return;const t=this.transaction.trans_holder,e=await f.Fy.create({component:G,componentProps:{itemType:t},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});e.present(),this.$topic.on("dismissModal",(()=>{e.dismiss()}));const a=await e.onDidDismiss();a.data&&(this.transaction.trans_holder_id=a.data.id,this.transaction.trans_holder_label=a.data.name,this.itemRender())},validate(){return this.transaction.trans_date?this.transaction.trans_role?this.transaction.trans_holder_id>0?0!=this.transaction.trans_amount||(this.$flash("–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –Ω–µ —Ä–∞–≤–Ω—è—Ç—å—Å—è –Ω—É–ª—é"),!1):(this.$flash("–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω"),!1):(this.$flash("–¢–∏–ø –ø—Ä–æ–≤–æ–¥–∫–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω"),!1):(this.$flash("–î–∞—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞"),!1)},async itemSave(){if(!this.validate())return;const t={trans_id:this.transaction.trans_id,trans_date:this.transaction.trans_date,trans_holder:this.transaction.trans_holder,trans_holder_id:this.transaction.trans_holder_id,trans_amount:this.transaction.trans_amount,trans_role:this.transaction.trans_role,trans_description:this.transaction.trans_description,is_disabled:this.transaction.is_disabled};try{const e=t.trans_id?"itemUpdate":"itemCreate";await k().post(`${this.$heap.state.hostname}Transaction/${e}`,JSON.stringify(t)),this.$flash("üíæ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ"),this.$router.go(-1)}catch(n){var e,a;const t=null===n||void 0===n||null===(e=n.responseJSON)||void 0===e||null===(a=e.messages)||void 0===a?void 0:a.error;switch(t){case"forbidden":this.$flash("–ù–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤");break}return this.$flash("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≤–æ–¥–∫—É"),!1}},async itemUpdateRole(){this.transaction.trans_holder_id="",this.transaction.trans_holder_label="–í—ã–±–µ—Ä–∏—Ç–µ –∞–≥–µ–Ω—Ç–∞",this.itemRender()},itemRender(){const t=this.transTypes.find((t=>t.trans_role==this.transaction.trans_role));t?(this.transaction.trans_tags="",this.transaction.trans_holder=t.trans_holder,this.transaction.trans_description=$.Z.render(t.trans_description,this.transaction)):this.$flash("–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø –ø—Ä–æ–≤–æ–¥–∫–∏")},async itemDelete(){if(confirm("–í—ã —É–≤–µ—Ä–µ–Ω–Ω—ã?"))try{await k().post(`${this.$heap.state.hostname}Transaction/itemDelete`,{trans_id:this.transactionId}),this.$router.go(-1)}catch{}}}};const C=(0,U.Z)(V,[["render",p]]);var D=C}}]);
//# sourceMappingURL=461.e5740ca9.js.map