"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[254],{6321:function(e,t,a){a.d(t,{Z:function(){return _}});var i=a(6252),l=a(3577);const n={class:"ion-page"},s=(0,i.Uk)(" Ничего не найдено ");function o(e,t,a,o,r,u){const d=(0,i.up)("ion-title"),m=(0,i.up)("ion-icon"),c=(0,i.up)("ion-toolbar"),h=(0,i.up)("ion-header"),p=(0,i.up)("ion-searchbar"),_=(0,i.up)("ion-skeleton-text"),g=(0,i.up)("ion-item"),y=(0,i.up)("ion-list"),w=(0,i.up)("ion-img"),k=(0,i.up)("ion-avatar"),f=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"secondary"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Выбрать "+(0,l.zw)(r.itemTypeName),1)])),_:1}),(0,i.Wm)(m,{icon:o.closeOutline,onClick:t[0]||(t[0]=e=>{u.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(f,null,{default:(0,i.w5)((()=>{var a;return["acc"!=r.itemTypeLabel?((0,i.wg)(),(0,i.j4)(p,{key:0,modelValue:r.query,"onUpdate:modelValue":t[1]||(t[1]=e=>r.query=e),placeholder:"поиск",debounce:100,onIonChange:t[2]||(t[2]=e=>u.listGet())},null,8,["modelValue"])):(0,i.kq)("",!0),r.itemList?null!==(a=r.itemList)&&void 0!==a&&a.length?((0,i.wg)(),(0,i.j4)(y,{key:2},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.itemList,(t=>((0,i.wg)(),(0,i.j4)(g,{key:t.id,button:"",detail:"",onClick:e=>u.itemPick(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{slot:"start"},{default:(0,i.w5)((()=>[t.image_hash?((0,i.wg)(),(0,i.j4)(w,{key:0,src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.50.50.webp`},null,8,["src"])):(0,i.kq)("",!0)])),_:2},1024),(0,i.Uk)(" "+(0,l.zw)(t.name),1)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,i.wg)(),(0,i.j4)(y,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[s])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(y,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([0,1,2,3,4,5,6,7,8,9],(e=>(0,i.Wm)(g,{key:e,button:"",detail:""},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{style:{height:"35px",width:"40px"},animated:""}),(0,i.Wm)(_,{style:{width:"100%"},animated:""})])),_:2},1024))),64))])),_:1}))]})),_:1})])}var r=a(8903),u=a(3716),d=a(9755),m=a.n(d),c={props:["itemType"],components:{IonContent:u.W2,IonHeader:u.Gu,IonToolbar:u.sr,IonTitle:u.wd,IonIcon:u.gu,IonImg:u.Xz,IonList:u.q_,IonItem:u.Ie,IonSearchbar:u.VI,IonSkeletonText:u.CK,IonAvatar:u.BJ},setup(){return{closeOutline:r.fID}},data(){const e=this.itemType?this.itemType:"order";return{query:null,itemList:null,itemTypeLabel:e,itemTypeName:""}},mounted(){this.listGet()},methods:{async listGet(){"order"==this.itemTypeLabel?(this.itemTypeName="Заказ",this.ordersGet()):"store"==this.itemTypeLabel?(this.itemTypeName="Продавец",this.storesGet()):"courier"==this.itemTypeLabel?(this.itemTypeName="Курьер",this.couriersGet()):"acc"==this.itemTypeLabel?(this.itemTypeName="Счет",this.accountsGet()):this.$flash("unknown item type "+this.itemTypeLabel)},async storesGet(){const e={name_query:this.query,name_query_fields:"store_name",limit:10};try{let t=await m().post(`${this.$heap.state.hostname}Store/listGet`,e);this.itemList=t.map((e=>(e.name=`продавец ${e.store_name}`,e.id=e.store_id,e)))}catch{}},async couriersGet(){const e={name_query:this.query,name_query_fields:"user_name,user_phone",limit:10};try{let t=await m().post(`${this.$heap.state.hostname}Courier/listGet`,e);this.itemList=t.map((e=>(e.name=`курьер ${e.user_name} ${e.user_phone}`,e.id=e.courier_id,e.image_hash=e.courier_photo_image_hash,e)))}catch{}},async ordersGet(){const e={name_query:this.query,name_query_fields:"store_name,order_id,user_name",limit:10};try{let t=await m().post(`${this.$heap.state.hostname}Order/listGet`,e);this.itemList=t.map((e=>(e.name=`заказ#${e.order_id} ${e.store_name} > ${e.user_name}`,e.id=e.order_id,e)))}catch{}},async accountsGet(){const e={group_table:"transaction_account_list"};try{let t=await m().post(`${this.$heap.state.hostname}Admin/GroupManager/listGet`,e);this.itemList=t.map((e=>(e.name=`${e.group_name}`,e.type=e.group_type,e)))}catch{}},itemPick(e){u.Fy.dismiss(e)},closeModal(){u.Fy.dismiss()}}},h=a(3744);const p=(0,h.Z)(c,[["render",o]]);var _=p},254:function(e,t,a){a.d(t,{Z:function(){return D}});var i=a(6252),l=a(3577);const n=(0,i.Uk)("Баланс"),s=(0,i.Uk)("Период"),o=(0,i.Uk)("Начальная дата"),r={slot:"end",style:{display:"grid","grid-template-columns":"120px 100px"}},u=(0,i.Uk)("Обороты"),d={slot:"end",style:{display:"grid","grid-template-columns":"120px 100px"}},m=(0,i.Uk)("Конечная дата"),c={slot:"end",style:{display:"grid","grid-template-columns":"120px 100px"}},h=(0,i.Uk)("Фильтр по тегам"),p=(0,i.Uk)("Добавить #тег"),_=["onClick"],g=(0,i.Uk)(" Нет операций в данном периоде ");function y(e,t,a,y,w,k){const f=(0,i.up)("ion-title"),v=(0,i.up)("ion-text"),W=(0,i.up)("ion-item"),$=(0,i.up)("ion-list"),T=(0,i.up)("ion-icon"),I=(0,i.up)("ion-input"),b=(0,i.up)("ion-accordion"),D=(0,i.up)("ion-chip"),C=(0,i.up)("ion-label"),x=(0,i.up)("ion-accordion-group"),G=(0,i.up)("ion-searchbar"),j=(0,i.up)("ion-skeleton-text");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)($,null,{default:(0,i.w5)((()=>[(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[n])),_:1}),w.balance>0?((0,i.wg)(),(0,i.j4)(v,{key:0,slot:"end",color:"success"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(w.balance)+(0,l.zw)(e.$heap.state.currencySign),1)])),_:1})):((0,i.wg)(),(0,i.j4)(v,{key:1,slot:"end"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(w.balance)+(0,l.zw)(e.$heap.state.currencySign),1)])),_:1}))])),_:1})])),_:1}),(0,i.Wm)(x,{value:w.settingsType},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{value:"period"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{slot:"header"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{icon:y.calendarOutline,slot:"start"},null,8,["icon"]),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[s])),_:1})])),_:1}),(0,i.Wm)($,{slot:"content"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[o])),_:1}),(0,i._)("div",r,[(0,i.Wm)(I,{type:"date",modelValue:w.start_at,"onUpdate:modelValue":t[0]||(t[0]=e=>w.start_at=e),onIonChange:t[1]||(t[1]=e=>k.listGet())},null,8,["modelValue"]),w.meta.sum_start?((0,i.wg)(),(0,i.j4)(I,{key:0,type:"text",style:{"text-align":"right"},color:"medium",value:`${w.meta.sum_start}${e.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,i.kq)("",!0)])])),_:1}),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[u])),_:1}),(0,i._)("div",d,[w.meta.sum_debit?((0,i.wg)(),(0,i.j4)(I,{key:0,type:"text",style:{"text-align":"right"},color:"medium",value:`+${w.meta.sum_debit}${e.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,i.kq)("",!0),w.meta.sum_credit?((0,i.wg)(),(0,i.j4)(I,{key:1,type:"text",style:{"text-align":"right"},color:"medium",value:`-${w.meta.sum_credit}${e.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,i.kq)("",!0)])])),_:1}),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[m])),_:1}),(0,i._)("div",c,[(0,i.Wm)(I,{type:"date",modelValue:w.finish_at,"onUpdate:modelValue":t[2]||(t[2]=e=>w.finish_at=e),onIonChange:t[3]||(t[3]=e=>k.listGet())},null,8,["modelValue"]),w.meta.sum_finish?((0,i.wg)(),(0,i.j4)(I,{key:0,type:"text",style:{"text-align":"right"},color:"medium",value:`${w.meta.sum_finish}${e.$heap.state.currencySign}`,readonly:""},null,8,["value"])):(0,i.kq)("",!0)])])),_:1})])),_:1})])),_:1}),(0,i.Wm)(b,{value:"tags"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{slot:"header"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{icon:y.pricetagOutline,slot:"start"},null,8,["icon"]),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[h])),_:1})])),_:1}),(0,i.Wm)($,{slot:"content"},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.tagDict,((e,t)=>((0,i.wg)(),(0,i.j4)(D,{key:t,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("#"+(0,l.zw)(e)+" ",1),(0,i.Wm)(T,{src:y.closeCircle,onClick:e=>k.itemTagRemove(t)},null,8,["src","onClick"])])),_:2},1024)))),128)),k.is_admin?((0,i.wg)(),(0,i.j4)(D,{key:0,onClick:t[4]||(t[4]=e=>k.itemTagCreate()),color:"medium"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{src:y.addOutline},null,8,["src"]),(0,i.Wm)(C,null,{default:(0,i.w5)((()=>[p])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["value"]),(0,i.Wm)(G,{modelValue:w.searchQuery,"onUpdate:modelValue":t[5]||(t[5]=e=>w.searchQuery=e),placeholder:"Поиск по сумме или описанию",onIonChange:t[6]||(t[6]=e=>k.listGet())},null,8,["modelValue"]),null==w.ledger?((0,i.wg)(),(0,i.j4)($,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)(i.HY,null,(0,i.Ko)([1,2,3],(e=>(0,i.Wm)(W,{key:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"50px"}})])),_:1}),(0,i.Wm)(C,null,{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"100%"}})])),_:1}),(0,i.Wm)(C,{slot:"end",color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(j,{animated:"",style:{width:"50px"}})])),_:1})])),_:2},1024))),64))])),_:1})):w.ledger.length>0?((0,i.wg)(),(0,i.j4)($,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(k.ledgerCalc,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.trans_id},[(0,i.Wm)(W,{detail:k.is_admin,lines:"none",onClick:t=>k.itemClick(e.trans_id)},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.date),1)])),_:2},1024),(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.trans_description),1)])),_:2},1024),e.amount_sign*e.trans_amount>0?((0,i.wg)(),(0,i.j4)(C,{key:0,slot:"end",color:"success"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.trans_amount),1)])),_:2},1024)):e.amount_sign*e.trans_amount<0?((0,i.wg)(),(0,i.j4)(C,{key:1,slot:"end",color:"danger"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.trans_amount),1)])),_:2},1024)):((0,i.wg)(),(0,i.j4)(C,{key:2,slot:"end",color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.trans_amount),1)])),_:2},1024))])),_:2},1032,["detail","onClick"]),(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.tag_list,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"tag",key:t,onClick:t=>k.itemTagAdd(e)},"#"+(0,l.zw)(e[1]),9,_)))),128))])),_:2},1024)])),_:2},1024)])))),128))])),_:1})):((0,i.wg)(),(0,i.j4)($,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(W,null,{default:(0,i.w5)((()=>[g])),_:1})])),_:1}))])}a(3948);var w=a(3716),k=a(8903),f=a(9755),v=a.n(f),W=a(351),$=a(6321),T={components:{IonIcon:w.gu,IonTitle:w.wd,IonLabel:w.Q$,IonItem:w.Ie,IonInput:w.pK,IonList:w.q_,IonAccordion:w.We,IonAccordionGroup:w.eh,IonText:w.yW,IonSkeletonText:w.CK,IonSearchbar:w.VI,IonChip:w.hM},props:["permanentTag"],setup(){return{calendarOutline:k.rom,addOutline:k.s6O,closeCircle:k.XZx,pricetagOutline:k.TuG}},data(){console.log(this.query);const e=new Date,t=new Date(Date.parse(`${e.getFullYear()}-${e.getMonth()+1}-1`));return{balance:"-",start_at:t.toISOString().slice(0,10),finish_at:e.toISOString().slice(0,10),searchQuery:"",tagQuery:"",tagDict:null,ledger:null,meta:{},today:e,settingsType:null}},computed:{ledgerCalc(){if(null==this.ledger)return null;let e=[];for(let n of this.ledger){var t,a,i,l;n.date=this.toLocDate(n.trans_date),n.tag_list=null===(t=n.tags)||void 0===t||null===(a=t.substring(1))||void 0===a||null===(i=a.toLowerCase())||void 0===i||null===(l=i.split("|"))||void 0===l?void 0:l.map((e=>e.split("#"))),e.push(n)}return e},is_admin(){return W.Z.isAdmin()}},watch:{query:function(){this.listGet()}},methods:{async listGet(){try{var e,t,a;const i=null===(e=Object.keys(null!==(t=this.tagDict)&&void 0!==t?t:{}))||void 0===e?void 0:e.join(" "),l={start_at:this.start_at,finish_at:this.finish_at,tagQuery:`${i} ${null!==(a=this.permanentTag)&&void 0!==a?a:""}`,searchQuery:this.searchQuery},n=await v().post(`${this.$heap.state.hostname}Transaction/listGet`,l);this.ledger=n.ledger,this.meta=n.meta,this.finish_at==this.today.toISOString().slice(0,10)&&(this.balance=n.meta.sum_finish)}catch(n){var i,l;const e=null===n||void 0===n||null===(i=n.responseJSON)||void 0===i||null===(l=i.messages)||void 0===l?void 0:l.error;switch(e){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},toLocDate(e){const t=new Date(Date.parse(e)),a={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,a)},itemClick(e){W.Z.isAdmin()&&this.$router.push(`/admin/transaction-edit-${e}`)},async itemTagPick(e){var t,a,i,l;const n=await w.Fy.create({component:$.Z,componentProps:{itemType:e},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});n.present(),this.$topic.on("dismissModal",(()=>{n.dismiss()}));const s=await n.onDidDismiss();s.data&&(null!==(t=s.data.order_id)&&void 0!==t&&t&&this.itemTagAdd([`order:${s.data.order_id}`,`заказ ${s.data.order_id}`]),null!==(a=s.data.store_id)&&void 0!==a&&a&&this.itemTagAdd([`store:${s.data.store_id}`,`продавец ${s.data.store_name}`]),null!==(i=s.data.courier_id)&&void 0!==i&&i&&this.itemTagAdd([`courier:${s.data.courier_id}`,`курьер ${s.data.courier_name}`]),null!==(l=s.data.type)&&void 0!==l&&l&&this.itemTagAdd([`acc::${s.data.type}`,`счет ${s.data.name}`]))},async itemTagCreate(){const e=await w.BO.create({header:"Тип тега",buttons:[{text:"Заказ",role:"destructive",data:"order"},{text:"Продавец",role:"destructive",data:"store"},{text:"Курьер",role:"destructive",data:"courier"},{text:"Счет",role:"destructive",data:"acc"}]});await e.present();const t=await e.onDidDismiss();null!==t&&void 0!==t&&t.data&&this.itemTagPick(null===t||void 0===t?void 0:t.data)},itemTagAdd(e){var t;let a=null!==(t=this.tagDict)&&void 0!==t?t:{};a[e[0]]=e[1],this.tagDict=a,this.listGet(),this.settingsType="tags"},itemTagRemove(e){var t;let a=null!==(t=this.tagDict)&&void 0!==t?t:{};a[e]&&delete a[e];const i=Object.keys(a).length;this.tagDict=i?a:null,this.listGet(),this.settingsType="tags"}},mounted(){this.listGet()}},I=a(3744);const b=(0,I.Z)(T,[["render",y]]);var D=b}}]);
//# sourceMappingURL=254.278932c6.js.map