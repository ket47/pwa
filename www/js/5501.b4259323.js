"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[5501],{9158:function(e,t,s){s.d(t,{A:function(){return f}});s(4114);var n=s(641);const o={validate:""},l=(0,n.Lk)("div",{style:{padding:"15px","font-size":"0.8em",color:"#999"}}," Рекомендуем сначала проверить СМС сообщение с паролем, которое было выслано вам при регистрации в сервисе. ",-1),a=(0,n.Lk)("u",{style:{color:"blue"}},"службу поддержки",-1);function r(e,t,s,r,u,i){const d=(0,n.g2)("ion-title"),p=(0,n.g2)("ion-icon"),h=(0,n.g2)("ion-toolbar"),c=(0,n.g2)("ion-header"),_=(0,n.g2)("ion-input"),f=(0,n.g2)("ion-item"),b=(0,n.g2)("ion-list"),k=(0,n.g2)("ion-button"),m=(0,n.g2)("ion-content");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(c,null,{default:(0,n.k6)((()=>[(0,n.bF)(h,null,{default:(0,n.k6)((()=>[(0,n.bF)(d,null,{default:(0,n.k6)((()=>[(0,n.eW)("Восстановление пароля")])),_:1}),(0,n.bF)(p,{slot:"end",onClick:t[0]||(t[0]=e=>{i.closeModal()}),icon:r.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,n.bF)(m,null,{default:(0,n.k6)((()=>[(0,n.Lk)("form",o,[(0,n.bF)(b,null,{default:(0,n.k6)((()=>[(0,n.bF)(f,null,{default:(0,n.k6)((()=>[(0,n.bF)(_,{label:"Ваш номер телефона","label-placement":"stacked",modelValue:u.userphone,"onUpdate:modelValue":t[1]||(t[1]=e=>u.userphone=e),placeholder:"Ваш телефон",required:""},null,8,["modelValue"])])),_:1}),(0,n.bF)(f,null,{default:(0,n.k6)((()=>[(0,n.bF)(_,{label:"Ваш ник","label-placement":"stacked",modelValue:u.username,"onUpdate:modelValue":t[2]||(t[2]=e=>u.username=e),placeholder:"Имя, указанное вами при регистрации"},null,8,["modelValue"])])),_:1})])),_:1}),(0,n.bF)(k,{onClick:t[3]||(t[3]=e=>i.passwordReset()),expand:"block"},{default:(0,n.k6)((()=>[(0,n.eW)("Создать новый пароль")])),_:1})]),l,(0,n.Lk)("div",{style:{padding:"15px","font-size":"0.8em"},onClick:t[4]||(t[4]=t=>e.$router.push("/page/contacts"))},[(0,n.eW)(" Если у вас возникли сложности с восстановлением пароля, обращайтесь в "),a])])),_:1})],64)}var u=s(972),i=s(5480),d=s(2311),p=s.n(d),h={components:{IonContent:u.W9,IonHeader:u.eU,IonTitle:u.BC,IonToolbar:u.ai,IonList:u.nf,IonItem:u.uz,IonInput:u.$w,IonButton:u.Jm,IonIcon:u.iq},props:["phone"],setup(){return{closeOutline:i.xfX}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return u.OZ.dismiss()},async passwordReset(){if(this.userphone.replace(/\D/g,"").length<11)return void alert("Проверьте ваш номер телефона");if(!this.username)return void alert("Введите ваше имя при регистрации");let e={user_phone:"+"+this.userphone.replace(/\D/g,""),user_name:this.username};try{await p().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$flash(`Ваш новый пароль выслан на номер '${this.userphone}'`),this.closeModal()}catch(n){var t,s;const e=null===n||void 0===n||null===(t=n.responseJSON)||void 0===t||null===(s=t.messages)||void 0===s?void 0:s.error;"user_notfound"==e?this.$flash(`Пользователь с телефоном '${this.userphone}' и именем '${this.username}' не найден`):this.$flash("Не удалось восстановить пароль")}}},mouted(){this.$topic.on("dismissModal",(()=>{this.closeModal()}))}},c=s(6262);const _=(0,c.A)(h,[["render",r]]);var f=_},5501:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});s(4114);var n=s(641),o=s(33),l=s(3751);const a={novalidate:""},r={style:{display:"grid","grid-template-columns":"100px auto",width:"100%"}},u={"padding-left":""},i={"padding-left":""},d={"padding-left":""};function p(e,t,s,p,h,c){const _=(0,n.g2)("ion-card-title"),f=(0,n.g2)("ion-card-header"),b=(0,n.g2)("ion-card-content"),k=(0,n.g2)("ion-card"),m=(0,n.g2)("ion-input"),g=(0,n.g2)("ion-text"),v=(0,n.g2)("ion-item"),F=(0,n.g2)("ion-list"),I=(0,n.g2)("ion-button"),$=(0,n.g2)("ion-col"),x=(0,n.g2)("ion-row"),w=(0,n.g2)("ion-grid"),y=(0,n.g2)("base-layout");return(0,n.uX)(),(0,n.Wv)(y,{"page-title":"Вход в систему",pageDefaultBackLink:"/user"},{default:(0,n.k6)((()=>[e.$heap.state.user.user_id>0?((0,n.uX)(),(0,n.Wv)(k,{key:0,style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,n.k6)((()=>[(0,n.bF)(f,null,{default:(0,n.k6)((()=>[(0,n.bF)(_,{color:"primary"},{default:(0,n.k6)((()=>[(0,n.eW)((0,o.v_)(e.$heap.state.user.user_name)+" "+(0,o.v_)(e.$heap.state.user.user_surname)+" "+(0,o.v_)(e.$heap.state.user.user_middlename),1)])),_:1})])),_:1}),(0,n.bF)(b,null,{default:(0,n.k6)((()=>[(0,n.eW)(" Вы уже вошли в систему с номером телефона "),(0,n.Lk)("b",null,(0,o.v_)(e.$heap.state.user.user_phone),1)])),_:1})])),_:1})):(0,n.Q3)("",!0),(0,n.Lk)("form",a,[(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(v,{lines:"full"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",r,[(0,n.Lk)("div",null,[(0,n.bF)(m,{readonly:"",label:"Код",labelPlacement:"stacked"},{default:(0,n.k6)((()=>[(0,n.eW)("+7")])),_:1})]),(0,n.Lk)("div",null,[(0,n.bF)(m,{modelValue:h.user_phone,"onUpdate:modelValue":t[0]||(t[0]=e=>h.user_phone=e),onIonChange:t[1]||(t[1]=e=>c.phoneFormat()),name:"phone",type:"tel",inputmode:"tel",placeholder:"(xxx)xxxxxxxxx",required:"",label:"Мобильный телефон*",labelPlacement:"stacked",autocomplete:"tel-national"},null,8,["modelValue"]),(0,n.bF)(g,{color:"danger",slot:"helper"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.Lk)("p",u,"Неверный номер телефона",512),[[l.aG,!c.phoneValid&&1==h.submitted]])])),_:1})])]),(0,n.bF)(g,{color:"danger",slot:"helper"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.Lk)("p",i,"Неверный номер телефона",512),[[l.aG,!c.phoneValid&&1==h.submitted]])])),_:1})])),_:1}),(0,n.bF)(v,{lines:"full"},{default:(0,n.k6)((()=>[(0,n.bF)(m,{modelValue:h.user_pass,"onUpdate:modelValue":t[2]||(t[2]=e=>h.user_pass=e),name:"password",type:"password",autocorrect:"off",placeholder:"Пароль (Минимум 4 символа)",required:"",label:"Пароль (Минимум 4 символа)*",labelPlacement:"stacked",autocomplete:"current-password"},null,8,["modelValue"]),(0,n.bF)(g,{color:"danger",slot:"helper"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.Lk)("p",d,"Пароль должен содержать не менее 4 символов.",512),[[l.aG,!c.passwordValid&&1==h.submitted]])])),_:1})])),_:1})])),_:1}),(0,n.bF)(w,null,{default:(0,n.k6)((()=>[(0,n.bF)(x,{"responsive-sm":""},{default:(0,n.k6)((()=>[(0,n.bF)($,null,{default:(0,n.k6)((()=>[(0,n.bF)(I,{onClick:c.onSubmit,expand:"block"},{default:(0,n.k6)((()=>[(0,n.eW)("Войти")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,n.bF)(x,{"responsive-sm":""},{default:(0,n.k6)((()=>[(0,n.bF)($,null,{default:(0,n.k6)((()=>[(0,n.bF)(I,{color:"light",expand:"block",onClick:t[3]||(t[3]=t=>e.$router.push({path:"/user/sign-up"}))},{default:(0,n.k6)((()=>[(0,n.eW)("Зарегистрироваться")])),_:1})])),_:1})])),_:1}),(0,n.bF)(x,{"responsive-sm":""},{default:(0,n.k6)((()=>[(0,n.bF)($,null,{default:(0,n.k6)((()=>[(0,n.bF)(I,{onClick:c.forgotPassModal,color:"light",expand:"block"},{default:(0,n.k6)((()=>[(0,n.eW)("Забыли пароль?")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1})}var h=s(972),c=s(9158),_=s(8701),f=s(9752),b={components:{IonCol:h.hU,IonInput:h.$w,IonRow:h.ln,IonText:h.IO,IonButton:h.Jm,IonGrid:h.lO,IonCard:h.b_,IonCardHeader:h.ME,IonCardTitle:h.tN,IonCardContent:h.I9,IonList:h.nf,IonItem:h.uz},data(){return{submitted:!1,user_pass:null,user_phone:null,user_phone_prefix:"7",modalOpen:!1}},computed:{phoneValid(){var e;return 10==(null===(e=this.user_phone)||void 0===e?void 0:e.replace(/\D/g,"").length)},passwordValid(){var e;return(null===(e=this.user_pass)||void 0===e?void 0:e.length)>=4}},created(){var e;const t=JSON.parse(null!==(e=localStorage.signInData)&&void 0!==e?e:"{}");t&&t.user_phone&&(this.user_phone=t.user_phone,this.phoneFormat()),t&&t.user_pass&&(this.user_pass=t.user_pass)},methods:{async onSubmit(){if(this.submitted=!0,!this.phoneValid||!this.passwordValid)return!1;let e={user_phone:this.user_phone_prefix+this.user_phone,user_pass:this.user_pass,user_pass_confirm:this.user_pass};try{await _.A.signIn(e),await _.A.get(),f.A.go(-1)}catch(t){const e=t.responseJSON,s=e.messages.error;switch(s){case"user_not_found":this.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":this.$flash("Неверный пароль");break;case"user_is_disabled":this.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":this.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":this.$flash("Номер телефона не подтвержден"),this.phoneVerify();break;default:this.$flash("Не удалось войти в систему")}}},phoneFormat(){this.user_phone||(this.user_phone="");try{let e=this.user_phone.replace(/\D/g,"");e.length>10&&(e=e.substring(e.length-10)),this.user_phone=e}catch{}},async forgotPassModal(){var e,t;this.modalOpen=!0;const s=(null!==(e=this.user_phone_prefix)&&void 0!==e?e:"")+(null!==(t=this.user_phone)&&void 0!==t?t:""),n=await h.OZ.create({component:c.A,componentProps:{phone:s},initialBreakpoint:.5,breakpoints:[.5,.75]});return n.present()},phoneVerify(){try{this.$heap.state.user.tmp_userphone=this.user_phone_prefix+this.user_phone,this.$go("/user/verify-phone")}catch{this.$flash("Не удалось выслать смс с подтверждением")}}}},k=s(6262);const m=(0,k.A)(b,[["render",p],["__scopeId","data-v-5b89585f"]]);var g=m}}]);
//# sourceMappingURL=5501.b4259323.js.map