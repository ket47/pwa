(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[6751],{4699:function(e,s,a){var l=a(9781),t=a(1702),n=a(1956),o=a(5656),r=a(5296).f,u=t(r),i=t([].push),d=function(e){return function(s){var a,t=o(s),r=n(t),d=r.length,p=0,m=[];while(d>p)a=r[p++],l&&!u(t,a)||i(m,e?[a,t[a]]:t[a]);return m}};e.exports={entries:d(!0),values:d(!1)}},2479:function(e,s,a){var l=a(2109),t=a(4699).values;l({target:"Object",stat:!0},{values:function(e){return t(e)}})},6751:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return P}});var l=a(6252);const t=["src"],n=(0,l.Uk)("аватар 1"),o=["src"],r=(0,l.Uk)("аватар 2"),u=(0,l.Uk)("Данные пользователя"),i=(0,l.Uk)("Ваш псевдоним"),d=(0,l.Uk)("Фамилия (не обязательно)"),p=(0,l.Uk)("Телефон"),m=(0,l.Uk)("Подтвердить"),f=(0,l.Uk)("Подтверждено"),_=(0,l.Uk)("Электронная почта"),h=(0,l.Uk)("Пароль пользователя"),c=(0,l.Uk)("Сбросить"),k=(0,l.Uk)("Изменить"),w=(0,l.Uk)("Новый пароль"),v=(0,l.Uk)("Новый пароль"),W=(0,l.Uk)("Новый пароль (повтор)"),g=(0,l.Uk)("Изменить");function b(e,s,a,b,y,U){const V=(0,l.up)("ion-thumbnail"),$=(0,l.up)("ion-label"),I=(0,l.up)("ion-radio"),O=(0,l.up)("ion-item"),C=(0,l.up)("ion-radio-group"),x=(0,l.up)("ion-item-divider"),P=(0,l.up)("ion-input"),S=(0,l.up)("ion-button"),q=(0,l.up)("ion-list"),D=(0,l.up)("ion-icon"),j=(0,l.up)("ion-col"),B=(0,l.up)("ion-row"),N=(0,l.up)("ion-title"),R=(0,l.up)("ion-toolbar"),J=(0,l.up)("ion-header"),Z=(0,l.up)("ion-content"),G=(0,l.up)("ion-modal"),M=(0,l.up)("base-layout");return(0,l.wg)(),(0,l.j4)(M,{"page-title":"Мой профиль",pageDefaultBackLink:"/user"},{default:(0,l.w5)((()=>[(0,l.Wm)(q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(C,{modelValue:y.fields.user_avatar_name,"onUpdate:modelValue":s[2]||(s[2]=e=>y.fields.user_avatar_name=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)(V,{slot:"start"},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,t)])),_:1}),(0,l.Wm)($,null,{default:(0,l.w5)((()=>[n])),_:1}),(0,l.Wm)(I,{slot:"end",value:"man",onIonFocus:s[0]||(s[0]=e=>U.save("user_avatar_name",e.target.value))})])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)(V,{slot:"start"},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,o)])),_:1}),(0,l.Wm)($,null,{default:(0,l.w5)((()=>[r])),_:1}),(0,l.Wm)(I,{slot:"end",value:"woman",onIonFocus:s[1]||(s[1]=e=>U.save("user_avatar_name",e.target.value))})])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(x,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,null,{default:(0,l.w5)((()=>[u])),_:1})])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[i])),_:1}),(0,l.Wm)(P,{modelValue:y.fields.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>y.fields.user_name=e),name:"user_name",type:"text",onChange:s[4]||(s[4]=e=>U.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",required:""},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[d])),_:1}),(0,l.Wm)(P,{modelValue:y.fields.user_surname,"onUpdate:modelValue":s[5]||(s[5]=e=>y.fields.user_surname=e),name:"user_surname",type:"text",onChange:s[6]||(s[6]=e=>U.save("user_surname",e.target.value)),placeholder:"Фамилия (не обязательно)"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[p])),_:1}),(0,l.Wm)(P,{readonly:"",modelValue:y.fields.user_phone,"onUpdate:modelValue":s[7]||(s[7]=e=>y.fields.user_phone=e)},null,8,["modelValue"]),!y.fields.user_phone||y.fields.user_phone_verified&&"0"!==y.fields.user_phone_verified?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(S,{key:0,slot:"end",onClick:U.phoneVerify,expand:"block"},{default:(0,l.w5)((()=>[m])),_:1},8,["onClick"])),y.fields.user_phone&&y.fields.user_phone_verified&&"0"!==y.fields.user_phone_verified?((0,l.wg)(),(0,l.j4)(S,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,l.w5)((()=>[f])),_:1})):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked",color:"primary"},{default:(0,l.w5)((()=>[_])),_:1}),(0,l.Wm)(P,{modelValue:y.fields.user_email,"onUpdate:modelValue":s[8]||(s[8]=e=>y.fields.user_email=e),name:"user_email",type:"email",onChange:s[9]||(s[9]=e=>U.save("user_email",e.target.value)),placeholder:"Электронная почта"},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(x,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,null,{default:(0,l.w5)((()=>[h])),_:1})])),_:1}),(0,l.Wm)(B,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(S,{onClick:s[10]||(s[10]=e=>U.passwordReset()),expand:"block"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{icon:b.keyOutline,slot:"start"},null,8,["icon"]),c])),_:1})])),_:1}),(0,l.Wm)(j,null,{default:(0,l.w5)((()=>[(0,l.Wm)(S,{id:"passwordPromptButton",expand:"block"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,{icon:b.keyOutline,slot:"start"},null,8,["icon"]),k])),_:1})])),_:1})])),_:1}),(0,l.Wm)(G,{ref:"passwordPrompt",trigger:"passwordPromptButton","initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,l.w5)((()=>[(0,l.Wm)(J,null,{default:(0,l.w5)((()=>[(0,l.Wm)(R,{color:"secondary"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,null,{default:(0,l.w5)((()=>[w])),_:1}),(0,l.Wm)(D,{icon:b.closeOutline,onClick:s[11]||(s[11]=()=>{this.$refs.passwordPrompt.$el.dismiss()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,l.Wm)(Z,{class:"ion-padding"},{default:(0,l.w5)((()=>[(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked"},{default:(0,l.w5)((()=>[v])),_:1}),(0,l.Wm)(P,{modelValue:y.fields.user_pass,"onUpdate:modelValue":s[12]||(s[12]=e=>y.fields.user_pass=e),type:"text",placeholder:"пароль"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(O,null,{default:(0,l.w5)((()=>[(0,l.Wm)($,{position:"stacked"},{default:(0,l.w5)((()=>[W])),_:1}),(0,l.Wm)(P,{modelValue:y.fields.user_pass_confirm,"onUpdate:modelValue":s[13]||(s[13]=e=>y.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(S,{onClick:s[14]||(s[14]=e=>U.passwordSave()),expand:"full"},{default:(0,l.w5)((()=>[g])),_:1})])),_:1})])),_:1},8,["initial-breakpoint","breakpoints"])])),_:1})}var y=a(8534),U=(a(4916),a(5306),a(8862),a(2479),a(8292)),V=a(8903),$=a(9755),I=a.n($),O={components:{IonList:U.q_,IonItem:U.Ie,IonLabel:U.Q$,IonThumbnail:U.Bs,IonRadio:U.B7,IonRadioGroup:U.se,IonInput:U.pK,IonCol:U.wI,IonRow:U.Nd,IonItemDivider:U.rH,IonButton:U.YG,IonModal:U.ki,IonHeader:U.Gu,IonTitle:U.wd,IonContent:U.W2,IonIcon:U.gu,IonToolbar:U.sr},setup(){return{closeOutline:V.fID,keyOutline:V.eyg}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{save(e,s){var a=this;return(0,y.Z)((function*(){if("user_phone"==e){if(!a.isPhoneValid)return!1;s=s.replace(/\D/g,"")}var l={};l.user_id=a.$heap.state.user.user_id,l[e]=s,yield a.itemUpdate(l),a.fields[e]=s}))()},itemUpdate(e){var s=this;return(0,y.Z)((function*(){try{return yield I().post(`${s.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e)),!0}catch(a){let e="unknown";try{const s=Object.keys(JSON.parse(a.responseJSON.messages.error))[0],l=Object.values(JSON.parse(a.responseJSON.messages.error))[0];e=s+"_"+l}catch(l){}switch(e){case"user_phone_notunique":s.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":s.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":s.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":s.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":s.$flash("Такой е-маил уже используется");break;case"user_pass_short":s.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":s.$flash("Пароль не совпадает с подтверждением");break}return!1}}))()},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{I().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$router.push({name:"UserVerifyPhone",params:{phone:e}})}catch(s){}},passwordSave(){var e=this;return(0,y.Z)((function*(){if(e.fields.user_pass!=e.fields.user_pass_confirm)return void e.$flash("Пароль и подтверждение не совпадают");const s={user_id:e.$heap.state.user.user_id,user_pass:e.fields.user_pass},a=yield e.itemUpdate(s);a&&(e.$refs.passwordPrompt.$el.dismiss(),e.$flash("Пароль изменен"))}))()},passwordReset(){var e=this;return(0,y.Z)((function*(){const s={user_phone:e.fields.user_phone,user_email:e.fields.user_email,user_name:e.fields.user_name};try{yield I().post(`${e.$heap.state.hostname}User/passwordReset`,s),e.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch(a){}}))()},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let s="",a=0;for(let l in this.config.phoneMask){if(!this.fields.user_phone[a])break;let e=this.config.phoneMask[l];"0"==e?(s+=this.fields.user_phone[a],a++):s+=e}return this.fields.user_phone=s,this.fields.user_phone}},created(){const e=this;this.$topic.on("userGet",(s=>{e.fields=s}))}},C=a(3744);const x=(0,C.Z)(O,[["render",b]]);var P=x}}]);
//# sourceMappingURL=6751-legacy.e132338d.js.map