"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[8195],{8195:function(t,e,o){o.r(e),o.d(e,{default:function(){return U}});var i=o(641),l=o(33);const s={key:0,style:{position:"relative"}},a={class:"post-preview"},n={class:"slide-container"},d={class:"slide-content"},r={style:{display:"grid","grid-template-columns":"1fr 150px"}},u={key:1,style:{position:"relative"}},p={class:"post-preview"},c={class:"slide-container"},m={class:"story-toolbar"},h=["src"],_={class:"slide-content"},k={style:{display:"grid","grid-template-columns":"1fr 150px"}},f={style:{"padding-left":"10px",background:"#0000004d","border-radius":"16px"}},b={style:{"padding-left":"10px",background:"#0000004d","border-radius":"16px"}},g={class:"crop-to-fit"},v=["src"],I={class:"ion-padding"};function F(t,e,o,F,y,$){const W=(0,i.g2)("ion-skeleton-text"),C=(0,i.g2)("ion-label"),O=(0,i.g2)("ion-chip"),P=(0,i.g2)("ion-avatar"),L=(0,i.g2)("ion-icon"),w=(0,i.g2)("ion-input"),X=(0,i.g2)("ion-textarea"),x=(0,i.g2)("ion-segment-button"),V=(0,i.g2)("ion-segment"),G=(0,i.g2)("ion-button"),D=(0,i.g2)("ion-item"),S=(0,i.g2)("ion-list"),U=(0,i.g2)("ion-modal"),A=(0,i.g2)("image-tile-comp"),z=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(z,{hideTitle:1},{default:(0,i.k6)(()=>{var o,z,E,q;return[null==y.postItem?((0,i.uX)(),(0,i.CE)("div",s,[(0,i.Lk)("div",a,[(0,i.Lk)("div",n,[(0,i.Lk)("div",d,[(0,i.Lk)("div",r,[e[37]||(e[37]=(0,i.Lk)("div",null,null,-1)),(0,i.Lk)("div",null,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([0,1,2,3,4],t=>(0,i.bF)(O,{key:t},{default:(0,i.k6)(()=>[(0,i.bF)(C,null,{default:(0,i.k6)(()=>[(0,i.bF)(W,{style:{width:"50px"},animated:""})]),_:1}),(0,i.bF)(W,{style:{width:"20px",height:"20px"},animated:""})]),_:2},1024)),64))])]),((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)([0,1,2,3],t=>(0,i.bF)(W,{key:t,style:{width:"100%",height:"70px"},animated:""})),64))])])])])):y.postItem?((0,i.uX)(),(0,i.CE)("div",u,[(0,i.Lk)("div",p,[(0,i.Lk)("div",c,[(0,i.Lk)("div",m,[(0,i.Lk)("div",null,[null!==(o=y.pickedStore)&&void 0!==o&&o.avatar_hash?((0,i.uX)(),(0,i.Wv)(P,{key:0},{default:(0,i.k6)(()=>[(0,i.Lk)("img",{src:`${t.$heap.state.hostname}image/get.php/${y.pickedStore.avatar_hash}.150.150.webp`},null,8,h)]),_:1})):(0,i.Q3)("",!0),(0,i.bF)(C,null,{default:(0,i.k6)(()=>{var t;return[(0,i.Lk)("b",null,(0,l.v_)(null===(t=y.pickedStore)||void 0===t?void 0:t.store_name),1)]}),_:1})])]),(0,i.Lk)("div",_,[(0,i.Lk)("div",k,[e[48]||(e[48]=(0,i.Lk)("div",null,null,-1)),(0,i.Lk)("div",null,[(0,i.bF)(O,{onClick:e[0]||(e[0]=t=>y.popovers.image=1)},{default:(0,i.k6)(()=>{var t,o;return[null!==(t=y.postItem)&&void 0!==t&&null!==(o=t.images)&&void 0!==o&&o.length?((0,i.uX)(),(0,i.Wv)(C,{key:0,color:"light"},{default:(0,i.k6)(()=>e[38]||(e[38]=[(0,i.eW)("Фото")])),_:1,__:[38]})):((0,i.uX)(),(0,i.Wv)(C,{key:1,color:"danger"},{default:(0,i.k6)(()=>e[39]||(e[39]=[(0,i.eW)("Нет фото")])),_:1,__:[39]})),(0,i.bF)(L,{icon:F.imageOutline,color:"light"},null,8,["icon"])]}),_:1}),(0,i.bF)(O,{onClick:e[1]||(e[1]=t=>y.popovers.holder=1)},{default:(0,i.k6)(()=>{var t,o;return[null!==(t=y.postItem)&&void 0!==t&&null!==(o=t.holder)&&void 0!==o&&o.store_name?((0,i.uX)(),(0,i.Wv)(C,{key:0,color:"light"},{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(y.postItem.holder.store_name),1)]),_:1})):((0,i.uX)(),(0,i.Wv)(C,{key:1,color:"danger"},{default:(0,i.k6)(()=>e[40]||(e[40]=[(0,i.eW)("Автор")])),_:1,__:[40]})),(0,i.bF)(L,{icon:F.personOutline,color:"light"},null,8,["icon"])]}),_:1}),(0,i.bF)(O,{onClick:e[2]||(e[2]=t=>y.popovers.link=1)},{default:(0,i.k6)(()=>{var t;return[null!==(t=y.postItem)&&void 0!==t&&t.post_route?((0,i.uX)(),(0,i.Wv)(C,{key:0,color:"primary"},{default:(0,i.k6)(()=>e[41]||(e[41]=[(0,i.eW)("Ссылка")])),_:1,__:[41]})):((0,i.uX)(),(0,i.Wv)(C,{key:1,color:"light"},{default:(0,i.k6)(()=>e[42]||(e[42]=[(0,i.eW)("Нет ссылки")])),_:1,__:[42]})),(0,i.bF)(L,{icon:F.linkOutline,color:"light"},null,8,["icon"])]}),_:1}),(0,i.bF)(O,{onClick:e[3]||(e[3]=t=>y.popovers.date=1)},{default:(0,i.k6)(()=>[(0,i.bF)(C,{color:"light"},{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)($.dateRange),1)]),_:1}),(0,i.bF)(L,{icon:F.calendarOutline,color:"light"},null,8,["icon"])]),_:1}),(0,i.bF)(O,null,{default:(0,i.k6)(()=>[(0,i.bF)(C,{onClick:e[4]||(e[4]=t=>$.itemDelete()),color:"light"},{default:(0,i.k6)(()=>e[43]||(e[43]=[(0,i.eW)("Удалить")])),_:1,__:[43]}),(0,i.bF)(L,{icon:F.trashOutline,color:"light"},null,8,["icon"])]),_:1}),1==(null===(z=y.postItem)||void 0===z?void 0:z.is_disabled)?((0,i.uX)(),(0,i.Wv)(O,{key:0,onClick:e[5]||(e[5]=t=>$.save("is_disabled",0))},{default:(0,i.k6)(()=>[(0,i.bF)(C,{color:"danger"},{default:(0,i.k6)(()=>e[44]||(e[44]=[(0,i.eW)("На модерации")])),_:1,__:[44]}),(0,i.bF)(L,{icon:F.ban,color:"danger"},null,8,["icon"])]),_:1})):((0,i.uX)(),(0,i.Wv)(O,{key:1,onClick:e[6]||(e[6]=t=>$.save("is_disabled",1))},{default:(0,i.k6)(()=>[(0,i.bF)(C,{color:"light"},{default:(0,i.k6)(()=>e[45]||(e[45]=[(0,i.eW)("Проверен")])),_:1,__:[45]}),(0,i.bF)(L,{icon:F.checkmarkOutline,color:"light"},null,8,["icon"])]),_:1})),1==(null===(E=y.postItem)||void 0===E?void 0:E.is_promoted)?((0,i.uX)(),(0,i.Wv)(O,{key:2,onClick:e[7]||(e[7]=t=>$.save("is_promoted",0))},{default:(0,i.k6)(()=>[(0,i.bF)(C,{color:"primary"},{default:(0,i.k6)(()=>e[46]||(e[46]=[(0,i.eW)("Приоритет")])),_:1,__:[46]}),(0,i.bF)(L,{icon:F.star,color:"primary"},null,8,["icon"])]),_:1})):((0,i.uX)(),(0,i.Wv)(O,{key:3,onClick:e[8]||(e[8]=t=>$.save("is_promoted",1))},{default:(0,i.k6)(()=>[(0,i.bF)(C,{color:"light"},{default:(0,i.k6)(()=>e[47]||(e[47]=[(0,i.eW)("Обычный пост")])),_:1,__:[47]}),(0,i.bF)(L,{icon:F.starOutline,color:"light"},null,8,["icon"])]),_:1}))])]),"story"==y.postItem.post_type?((0,i.uX)(),(0,i.CE)("form",{key:0,onChange:e[11]||(e[11]=(...t)=>$.saveForm&&$.saveForm(...t))},[(0,i.Lk)("h3",f,[(0,i.bF)(w,{modelValue:y.postItem.post_title,"onUpdate:modelValue":e[9]||(e[9]=t=>y.postItem.post_title=t),labelPlacement:"stacked",name:"post_title",placeholder:"Заголовок",clearInput:"true",style:{"--placeholder-color":"#fff","--color":"#fff"}},null,8,["modelValue"])]),(0,i.Lk)("p",b,[(0,i.bF)(X,{modelValue:y.postItem.post_content,"onUpdate:modelValue":e[10]||(e[10]=t=>y.postItem.post_content=t),labelPlacement:"stacked",name:"post_content",rows:"3",placeholder:"Описание",style:{"--placeholder-color":"#fff","--color":"#fff"}},null,8,["modelValue"])])],32)):(0,i.Q3)("",!0),(0,i.bF)(V,{mode:"ios",modelValue:y.postItem.is_published,"onUpdate:modelValue":e[12]||(e[12]=t=>y.postItem.is_published=t),onIonChange:e[13]||(e[13]=t=>$.itemPublish()),style:{"--background":"#ffffff66"}},{default:(0,i.k6)(()=>[(0,i.bF)(x,{value:"0",style:{height:"50px","--indicator-color":"var(--ion-color-light)"}},{default:(0,i.k6)(()=>[(0,i.bF)(L,{icon:F.eyeOffOutline},null,8,["icon"]),(0,i.bF)(C,null,{default:(0,i.k6)(()=>e[49]||(e[49]=[(0,i.eW)("Скрыт")])),_:1,__:[49]})]),_:1}),(0,i.bF)(x,{value:"1",style:{height:"50px","--indicator-color":"var(--ion-color-success)"}},{default:(0,i.k6)(()=>[(0,i.bF)(L,{icon:F.eyeOutline},null,8,["icon"]),(0,i.bF)(C,null,{default:(0,i.k6)(()=>e[50]||(e[50]=[(0,i.eW)("Опубликован")])),_:1,__:[50]})]),_:1})]),_:1},8,["modelValue"]),(0,i.bF)(G,{color:"light",expand:"block",onClick:e[14]||(e[14]=e=>t.$router.go(-1))},{default:(0,i.k6)(()=>[(0,i.bF)(L,{icon:F.closeOutline,slot:"start"},null,8,["icon"]),e[51]||(e[51]=(0,i.eW)("Закрыть"))]),_:1,__:[51]})]),(0,i.Lk)("div",g,[(0,i.Lk)("img",{src:`${t.$heap.state.hostname}image/get.php/${null===(q=y.postItem.images[0])||void 0===q?void 0:q.image_hash}.1500.1000.webp`},null,8,v)])])])])):(0,i.Q3)("",!0),(0,i.bF)(U,{"is-open":y.popovers.link,"initial-breakpoint":.5,onDidDismiss:e[20]||(e[20]=t=>{$.itemGet(),y.popovers.link=!1})},{default:(0,i.k6)(()=>[(0,i.Lk)("form",{onChange:e[19]||(e[19]=(...t)=>$.saveForm&&$.saveForm(...t))},[e[54]||(e[54]=(0,i.Lk)("h6",{class:"ion-padding-horizontal"},"Ссылка",-1)),(0,i.bF)(S,null,{default:(0,i.k6)(()=>[(0,i.bF)(D,null,{default:(0,i.k6)(()=>[(0,i.bF)(w,{type:"text",modelValue:y.postItem.post_route,"onUpdate:modelValue":e[15]||(e[15]=t=>y.postItem.post_route=t),label:"Ссылка",labelPlacement:"stacked",name:"post_route",readonly:!$.isAdmin},null,8,["modelValue","readonly"]),y.postItem.post_route?((0,i.uX)(),(0,i.Wv)(L,{key:0,slot:"end",src:F.trashOutline,onClick:e[16]||(e[16]=t=>{$.save("post_route",null),y.popovers.link=!1})},null,8,["src"])):(0,i.Q3)("",!0)]),_:1}),(0,i.bF)(D,{button:"",onClick:e[17]||(e[17]=t=>$.productPick())},{default:(0,i.k6)(()=>[(0,i.bF)(L,{slot:"start",src:F.addOutline},null,8,["src"]),(0,i.bF)(C,null,{default:(0,i.k6)(()=>e[52]||(e[52]=[(0,i.eW)("Выбрать товар")])),_:1,__:[52]})]),_:1})]),_:1}),(0,i.bF)(G,{color:"light",expand:"block",onClick:e[18]||(e[18]=t=>y.popovers.link=!1)},{default:(0,i.k6)(()=>e[53]||(e[53]=[(0,i.eW)("Закрыть")])),_:1,__:[53]})],32)]),_:1},8,["is-open"]),(0,i.bF)(U,{"is-open":y.popovers.holder,"initial-breakpoint":.5,onDidDismiss:e[26]||(e[26]=t=>{$.itemGet(),y.popovers.holder=!1})},{default:(0,i.k6)(()=>[(0,i.Lk)("div",null,[e[57]||(e[57]=(0,i.Lk)("h6",{class:"ion-padding-horizontal"},"Автор поста",-1)),(0,i.bF)(S,null,{default:(0,i.k6)(()=>{var t;return[null!==(t=y.postItem)&&void 0!==t&&t.holder?((0,i.uX)(),(0,i.Wv)(D,{key:0,button:""},{default:(0,i.k6)(()=>[(0,i.bF)(L,{onClick:e[21]||(e[21]=t=>$.storePick()),slot:"start",src:F.storefrontOutline},null,8,["src"]),(0,i.bF)(C,{onClick:e[22]||(e[22]=t=>$.storePick())},{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(y.postItem.holder.store_name),1)]),_:1}),(0,i.bF)(L,{slot:"end",src:F.trashOutline,onClick:e[23]||(e[23]=t=>$.storeReset())},null,8,["src"])]),_:1})):((0,i.uX)(),(0,i.Wv)(D,{key:1,button:"",onClick:e[24]||(e[24]=t=>$.storePick())},{default:(0,i.k6)(()=>[(0,i.bF)(L,{slot:"start",src:F.addOutline},null,8,["src"]),(0,i.bF)(C,null,{default:(0,i.k6)(()=>e[55]||(e[55]=[(0,i.eW)("Добавить автора")])),_:1,__:[55]})]),_:1}))]}),_:1}),(0,i.bF)(G,{color:"light",expand:"block",onClick:e[25]||(e[25]=t=>y.popovers.holder=!1)},{default:(0,i.k6)(()=>e[56]||(e[56]=[(0,i.eW)("Закрыть")])),_:1,__:[56]})])]),_:1},8,["is-open"]),(0,i.bF)(U,{"is-open":y.popovers.date,"initial-breakpoint":.5,onDidDismiss:e[31]||(e[31]=t=>{$.itemGet(),y.popovers.date=!1})},{default:(0,i.k6)(()=>[(0,i.Lk)("form",{onChange:e[30]||(e[30]=(...t)=>$.saveForm&&$.saveForm(...t))},[e[59]||(e[59]=(0,i.Lk)("h6",{class:"ion-padding-horizontal"},"Время действия",-1)),(0,i.bF)(S,{addOutlinelines:"full"},{default:(0,i.k6)(()=>[(0,i.bF)(D,null,{default:(0,i.k6)(()=>[(0,i.bF)(w,{type:"date",modelValue:y.postItem.started_at,"onUpdate:modelValue":e[27]||(e[27]=t=>y.postItem.started_at=t),label:"Начало показа",labelPlacement:"stacked",name:"started_at"},null,8,["modelValue"])]),_:1}),(0,i.bF)(D,null,{default:(0,i.k6)(()=>[(0,i.bF)(w,{type:"date",modelValue:y.postItem.finished_at,"onUpdate:modelValue":e[28]||(e[28]=t=>y.postItem.finished_at=t),label:"Конец показа",labelPlacement:"stacked",name:"finished_at"},null,8,["modelValue"])]),_:1})]),_:1}),(0,i.bF)(G,{color:"light",expand:"block",onClick:e[29]||(e[29]=t=>y.popovers.date=!1)},{default:(0,i.k6)(()=>e[58]||(e[58]=[(0,i.eW)("Закрыть")])),_:1,__:[58]})],32)]),_:1},8,["is-open"]),(0,i.bF)(U,{"is-open":y.popovers.image,"initial-breakpoint":.5,onDidDismiss:e[36]||(e[36]=t=>{$.itemGet(),y.popovers.image=!1})},{default:(0,i.k6)(()=>{var t;return[(0,i.Lk)("div",I,[(0,i.bF)(V,{mode:"ios",modelValue:y.postItem.post_type,"onUpdate:modelValue":e[32]||(e[32]=t=>y.postItem.post_type=t),style:{height:"70px"},onIonChange:e[33]||(e[33]=t=>$.itemImageDelete())},{default:(0,i.k6)(()=>[(0,i.bF)(x,{value:"story"},{default:(0,i.k6)(()=>[(0,i.bF)(L,{icon:F.phonePortraitOutline},null,8,["icon"]),(0,i.bF)(C,null,{default:(0,i.k6)(()=>e[60]||(e[60]=[(0,i.eW)("История 1080х1920")])),_:1,__:[60]})]),_:1}),(0,i.bF)(x,{value:"slide"},{default:(0,i.k6)(()=>[(0,i.bF)(L,{icon:F.phoneLandscapeOutline},null,8,["icon"]),(0,i.bF)(C,null,{default:(0,i.k6)(()=>e[61]||(e[61]=[(0,i.eW)("Слайд 1920х700")])),_:1,__:[61]})]),_:1})]),_:1},8,["modelValue"]),(0,i.bF)(A,{ref:"postImgs",title:"Фото поста",controller:"Post",params:y.imageParams,images:(null===(t=y.postItem)||void 0===t?void 0:t.images)??[],image_holder_id:y.postId,onChange:e[34]||(e[34]=t=>{$.itemGet(),y.popovers.image=!1})},null,8,["params","images","image_holder_id"]),(0,i.bF)(G,{onClick:e[35]||(e[35]=t=>$.itemImageUpload()),expand:"block"},{default:(0,i.k6)(()=>[(0,i.bF)(L,{src:F.imageOutline,slot:"start"},null,8,["src"]),e[62]||(e[62]=(0,i.eW)(" Загрузить изображение "))]),_:1,__:[62]})])]}),_:1},8,["is-open"])]}),_:1})}var y=o(5634),$=o(5480),W=o(4933),C=o(2311),O=o.n(C),P=o(6383);function L(t,e,o,s,a,n){const d=(0,i.g2)("ion-title"),r=(0,i.g2)("ion-icon"),u=(0,i.g2)("ion-toolbar"),p=(0,i.g2)("ion-header"),c=(0,i.g2)("ion-searchbar"),m=(0,i.g2)("ion-img"),h=(0,i.g2)("ion-chip"),_=(0,i.g2)("ion-item"),k=(0,i.g2)("ion-list"),f=(0,i.g2)("ion-content");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(p,null,{default:(0,i.k6)(()=>[(0,i.bF)(u,null,{default:(0,i.k6)(()=>[(0,i.bF)(d,null,{default:(0,i.k6)(()=>e[3]||(e[3]=[(0,i.eW)("Выбрать товар")])),_:1,__:[3]}),(0,i.bF)(r,{icon:s.closeOutline,onClick:e[0]||(e[0]=t=>{n.closeModal()}),slot:"end",size:"large"},null,8,["icon"])]),_:1})]),_:1}),(0,i.bF)(f,null,{default:(0,i.k6)(()=>[(0,i.bF)(c,{modelValue:a.query,"onUpdate:modelValue":e[1]||(e[1]=t=>a.query=t),debounce:300,onIonInput:e[2]||(e[2]=t=>n.listGet())},null,8,["modelValue"]),a.productList?((0,i.uX)(),(0,i.Wv)(k,{key:0},{default:(0,i.k6)(()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.productList,e=>((0,i.uX)(),(0,i.Wv)(_,{key:e.product_id,button:"",detail:"",onClick:t=>n.itemPick(e.product_id)},{default:(0,i.k6)(()=>[(0,i.bF)(m,{slot:"start",src:`${t.$heap.state.hostname}image/get.php/${e.image_hash}.50.50.webp`},null,8,["src"]),(0,i.eW)(" "+(0,l.v_)(e.product_name)+" "+(0,l.v_)(e.product_code)+" ",1),e.product_option?((0,i.uX)(),(0,i.Wv)(h,{key:0},{default:(0,i.k6)(()=>[(0,i.eW)((0,l.v_)(e.product_option),1)]),_:2},1024)):(0,i.Q3)("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})):((0,i.uX)(),(0,i.Wv)(k,{key:1},{default:(0,i.k6)(()=>[(0,i.bF)(_,null,{default:(0,i.k6)(()=>e[4]||(e[4]=[(0,i.eW)(" Ничего не найдено ")])),_:1,__:[4]})]),_:1}))]),_:1})],64)}o(8111),o(2489);var w={props:["store_id","exclude_product_id"],components:{IonContent:y.W9,IonHeader:y.eU,IonToolbar:y.ai,IonTitle:y.BC,IonIcon:y.iq,IonImg:y.KW,IonList:y.nf,IonItem:y.uz,IonChip:y.ZB,IonSearchbar:y.S1},setup(){return{closeOutline:$.xfX}},data(){return{productList:null,query:null}},mounted(){this.listGet()},methods:{async listGet(){const t={name_query:this.query,name_query_fields:"product_name,product_code",store_id:this.store_id,limit:10};try{let e=await O().post(`${this.$heap.state.hostname}Product/listGet`,t);this.productList=e.product_list.filter(t=>t.product_id!=this.exclude_product_id)}catch{}},itemPick(t){y.OZ.dismiss(t)},closeModal(){y.OZ.dismiss()}}},X=o(6262);const x=(0,X.A)(w,[["render",L]]);var V=x,G=o(8701),D={components:{ImageTileComp:W.A,IonModal:y.Sb,IonInput:y.$w,IonTextarea:y.nc,IonIcon:y.iq,IonItem:y.uz,IonList:y.nf,IonLabel:y.he,IonButton:y.Jm,IonAvatar:y.mC,IonSegmentButton:y.eP,IonSegment:y.Gp,IonChip:y.ZB,IonSkeletonText:y.ds},setup(){return{trashOutline:$.P1A,checkmarkOutline:$.g1L,banOutline:$.Av6,ban:$._LG,personOutline:$.wAZ,addOutline:$.EKF,eyeOutline:$.ov$,eyeOffOutline:$.f_X,storefrontOutline:$.te8,imageOutline:$.ETD,calendarOutline:$.RXF,starOutline:$.zV,star:$.d49,closeOutline:$.xfX,phonePortraitOutline:$.g_S,phoneLandscapeOutline:$.abj,linkOutline:$.R4e}},data(){return{postId:this.$route.params.id,postItem:null,imageParams:null,pickedStore:null,pickedProduct:null,storeList:[],popovers:{image:0,holder:!1,date:!1,link:!1},is_deleted:0,is_disabled:0,is_promoted:0}},created(){this.itemGet()},computed:{dateRange(){const t=this.postItem.started_at.split(" ").shift().split("-").reverse().splice(0,2).join("."),e=this.postItem.finished_at.split(" ").shift().split("-").reverse().splice(0,2).join(".");return`${t}-${e}`},isAdmin(){return G.A.isAdmin()}},methods:{async itemGet(){try{if(0==this.postId)return void await this.itemCreatedGet();let t=await O().post(`${this.$heap.state.hostname}Post/itemGet`,{post_id:this.postId});this.postItem=this.itemPrepare(t),this.itemImageParamsSet(),"store"==t.post_holder?(this.pickedStore=t.holder,this.pickedProduct=t.post_route):(this.pickedStore=null,this.pickedProduct=null)}catch(t){404==t.responseJSON.status&&this.$flash("Пост не найден"),this.$router.go(-1)}},itemImageParamsSet(){this.imageParams={post_type:this.postItem.post_type}},async itemImageDelete(){try{const t=this.postItem.images.pop(),e={image_id:t.image_id};this.$flash("Удаляем предыдущее фото"),await O().post(`${this.$heap.state.hostname}Image/itemDelete`,e)}catch{}},async itemImageUpload(){1==this.postItem.is_published&&(this.postItem.is_published=0,await this.itemPublish()),await this.itemImageDelete(),this.itemImageParamsSet(),await this.$refs.postImgs.take_photo()},async itemPublish(){try{let t="itemUnpublish";1==this.postItem.is_published&&(t="itemPublish"),await O().post(`${this.$heap.state.hostname}Post/${t}`,{post_id:this.postId}),1==this.postItem.is_published?this.$flash("Пост опубликован!"):this.$flash("Пост снят с публикации")}catch(t){const e=t.responseJSON.messages.error;"noimage"==e&&this.$flash("У поста нет фото"),"noholder"==e&&this.$flash("Укажите автора"),"disabled"==e&&this.$flash("Пост на модерации"),this.itemGet()}},itemPrepare(t){return t.started_at&&(t.started_at=t.started_at.split(" ")[0]),t.finished_at&&(t.finished_at=t.finished_at.split(" ")[0]),t},async itemCreatedGet(){const t={post_title:"",post_type:"story"};try{const e=await O().post(`${this.$heap.state.hostname}Post/itemCreatedGet`,t);e&&this.$router.replace(`/wall/post-user-edit-${e}`)}catch(i){var e,o;const t=null===i||void 0===i||null===(e=i.responseJSON)||void 0===e||null===(o=e.messages)||void 0===o?void 0:o.error;"forbidden"==t&&(this.$flash("Вы не можете создавать посты"),this.$router.go(-1))}},async itemDelete(){if(confirm("Вы уверены?"))try{await O().post(`${this.$heap.state.hostname}Post/itemDelete`,{post_id:this.postId}),this.$flash("🗑️ Пост удален"),this.$router.go(-1)}catch{this.$flash("Ошибка удаления"),this.itemGet()}},async itemUpdate(t){try{return await O().post(`${this.$heap.state.hostname}Post/itemUpdate`,JSON.stringify(t)),this.$flash("💾 сохранено"),!0}catch(e){const t=e.responseJSON.messages.error;return null!==t&&void 0!==t&&t.includes("post_content")?this.$flash("Описание слишком короткое"):null!==t&&void 0!==t&&t.includes("post_title")?this.$flash("Заголовок слишком короткий"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},async save(t,e){if(!this.postItem.post_id)return;if(["is_disabled","is_promoted"].includes(t)&&!this.isAdmin)return;let o={post_id:this.postItem.post_id,[t]:e};this.itemUpdate(o)&&(this.postItem[t]=e)},saveForm(t){const e=t.target.name,o=this.postItem[e]=t.target.value;this.save(e,o)},async storePick(){let t={};G.A.isAdmin()||(t.owner_id=this.$heap.state.user.user_id??0);const e=await y.OZ.create({component:P.A,componentProps:{itemType:"store",filter:t},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});e.present(),this.$topic.on("dismissModal",()=>{e.dismiss()});const o=await e.onDidDismiss();if(!o.data)return;this.popovers.holder=!1;const i={post_id:this.postItem.post_id,post_holder:"store",post_holder_id:o.data.store_id};await this.itemUpdate(i),await this.itemGet()},async storeReset(){this.popovers.holder=!1;const t={post_id:this.postItem.post_id,post_holder:"store",post_holder_id:null};await this.itemUpdate(t),await this.itemGet()},async productPick(){const t=await y.OZ.create({component:V,componentProps:{store_id:this.postItem.post_holder_id},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});t.present(),this.$topic.on("dismissModal",()=>{t.dismiss()});const e=await t.onDidDismiss();if(!e.data)return;this.popovers.link=!1;const o={post_id:this.postItem.post_id,post_route:`/catalog/product-${e.data}`};await this.itemUpdate(o),await this.itemGet()}}};const S=(0,X.A)(D,[["render",F],["__scopeId","data-v-5173520a"]]);var U=S}}]);
//# sourceMappingURL=8195.bf08554a.js.map