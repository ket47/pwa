"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[1552],{6642:function(t,o,e){e.d(o,{A:function(){return _}});var i=e(641),a=e(33);const n={style:{position:"absolute",top:"30px",width:"100%","--ion-item-background":"#ffffffdd","border-radius":"10px"}},s={slot:"end",style:{color:"#666"}},l={style:{width:"100%"}};function c(t,o,e,c,r,d){const u=(0,i.g2)("ymap-marker"),h=(0,i.g2)("yandex-map"),p=(0,i.g2)("ion-searchbar"),m=(0,i.g2)("ion-item"),g=(0,i.g2)("ion-content"),_=(0,i.g2)("ion-img"),k=(0,i.g2)("ion-label"),f=(0,i.g2)("ion-segment-button"),b=(0,i.g2)("ion-segment"),y=(0,i.g2)("ion-textarea"),v=(0,i.g2)("ion-icon"),C=(0,i.g2)("ion-button"),A=(0,i.g2)("ion-toolbar");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.bF)(g,null,{default:(0,i.k6)((()=>[(0,i.bF)(h,{ref:"harita",onClick:o[0]||(o[0]=t=>{d.onClick(t)}),style:{height:"100%"},coords:r.coords,zoom:16,settings:r.settings,controls:["zoomControl"]},{default:(0,i.k6)((()=>[(0,i.bF)(u,{coords:r.coords,"marker-id":"1",properties:d.placemarkProperties},null,8,["coords","properties"])])),_:1},8,["coords","settings"]),(0,i.Lk)("div",n,[(0,i.bF)(p,{debounce:"500",modelValue:r.addressSearchQuery,"onUpdate:modelValue":o[1]||(o[1]=t=>r.addressSearchQuery=t),onIonInput:o[2]||(o[2]=t=>d.suggestionsGet()),placeholder:"поиск по адресу",color:"light"},null,8,["modelValue"]),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.suggestions,((t,o)=>((0,i.uX)(),(0,i.Wv)(m,{key:o,onClick:o=>d.suggestionSelect(`${t.subtitle.text}, ${t.title.text}`,t.uri),style:{"margin-right":"10px","margin-left":"10px"}},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(t.subtitle.text)+" "+(0,a.v_)(t.title.text)+" ",1),(0,i.Lk)("span",s,(0,a.v_)(t.distance.text),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),(0,i.bF)(A,{style:{"--background":"white"}},{default:(0,i.k6)((()=>[(0,i.Lk)("div",l,[(0,i.bF)(b,{mode:"ios",modelValue:r.locationGroup,"onUpdate:modelValue":o[3]||(o[3]=t=>r.locationGroup=t)},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.locationGroupList,(o=>((0,i.uX)(),(0,i.Wv)(f,{key:o.group_id,value:o},{default:(0,i.k6)((()=>[(0,i.bF)(_,{src:`${t.$heap.state.hostname}/image/get.php/${o.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.bF)(k,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(o.group_name),1)])),_:2},1024)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"]),(0,i.bF)(y,{label:"комментарий к адресу","label-placement":"floating",modelValue:r.addressComment,"onUpdate:modelValue":o[4]||(o[4]=t=>r.addressComment=t)},null,8,["modelValue"]),(0,i.bF)(C,{strong:!0,onClick:o[5]||(o[5]=t=>d.pickAddress()),color:"primary",expand:"block"},{default:(0,i.k6)((()=>[(0,i.bF)(v,{src:c.checkmark,slot:"start"},null,8,["src"]),(0,i.eW)(" Ок ")])),_:1}),(0,i.bF)(C,{onClick:o[6]||(o[6]=t=>c.closeModal()),color:"light",expand:"block"},{default:(0,i.k6)((()=>[(0,i.eW)("Закрыть")])),_:1})])])),_:1})],64)}e(4114);var r=e(5654),d=e(5221),u=e(5480),h=e(8701),p={components:{IonContent:r.W9,IonToolbar:r.ai,IonButton:r.Jm,IonSearchbar:r.S1,IonIcon:r.iq,IonItem:r.uz,IonTextarea:r.nc,IonSegment:r.Gp,IonSegmentButton:r.eP,IonImg:r.KW,IonLabel:r.he,yandexMap:d.IK,ymapMarker:d.cT},setup(){const t=function(){r.OZ.dismiss()};return{closeModal:t,locationOutline:u.UN$,closeOutline:u.xfX,checkmark:u.AIp}},props:{location_group_name_low:String,locationGroupList:Array},data(){this.location_group_name_low;let t=this.$heap.state.settings.location,o=JSON.parse(t.mapCenter);return{settings:{apiKey:t.ymapApiKey,lang:"ru_RU",coordorder:"latlong",version:"2.1"},suggestions:[],addressSearchQuery:null,markDeviceOnMap:!0,locationGroup:this.locationGroupList[0],locSettings:t,selectedPlacemark:0,selectedAddress:"",selectedCoords:[],coords:o,addressComment:""}},computed:{locationType(){return this.locationGroup.group_name+" адрес"},placemarkProperties(){return{iconCaption:this.locationType}}},methods:{async pickAddress(){try{if(!this.selectedAddress){var t;const o=await window.ymaps.geocode(this.coords);this.selectedAddress=null===(t=o.geoObjects.get(0))||void 0===t?void 0:t.getAddressLine()}}catch(e){}var o={location_group_id:this.locationGroup.group_id,location_address:this.filterAddress(this.selectedAddress),location_latitude:this.coords[0],location_longitude:this.coords[1],location_comment:this.addressComment};r.OZ.dismiss(o)},filterAddress(t){const o=this.locSettings.addressErase.split(", "),e=t.split(", ");let i=[];for(const a of e)o.find((t=>t==a))||i.push(a);return i.reverse().join(", ")},onClick(t){t&&t.get&&(this.markDeviceOnMap=!1,this.suggestions=[],this.selectedAddress=null,this.coords=t.get("coords"))},async suggestionsGet(){if(this.markDeviceOnMap=!1,this.addressSearchQuery)try{const t=this.$heap.state.settings.location.ymapSuggestionApiKey,o=this.coords.slice().reverse().join(","),e=await fetch(`https://suggest-maps.yandex.ru/v1/suggest?apikey=${t}&lang=ru_RU&ll=${o}&spn=1,1&attrs=uri&types=house&results=5&text=${this.addressSearchQuery}`),i=await e.json();this.suggestions=i.results||[]}catch{}else this.suggestions=[]},async suggestionSelect(t,o){this.selectedAddress=t,this.geocode(o)},async geocode(t){try{this.suggestions=[];const o=this.$heap.state.settings.location.ymapApiKey,e=await fetch(`https://geocode-maps.yandex.ru/1.x?apikey=${o}&format=json&results=1&uri=${t}`),i=await e.json(),a=i.response.GeoObjectCollection.featureMember[0].GeoObject;this.coords=a.Point.pos.split(" ").reverse()}catch(o){console.log(o)}}},async mounted(){await(0,d.wc)();const t=h.A.geo.lastStoredGet();null!==t&&void 0!==t&&t.location_latitude&&(this.coords=[t.location_latitude,t.location_longitude]);const o=await h.A.geo.get();if(this.markDeviceOnMap&&o){const{coords:t}=o;this.coords=[t.latitude,t.longitude],this.$flash("На карте отмечено ваше местоположение")}}},m=e(6262);const g=(0,m.A)(p,[["render",c]]);var _=g},1552:function(t,o,e){e.r(o),e.d(o,{default:function(){return v}});var i=e(641),a=e(33);const n=t=>((0,i.Qi)("data-v-8d37b50a"),t=t(),(0,i.jt)(),t),s={style:{color:"var(--ion-color-primary)"}},l=n((()=>(0,i.Lk)("p",null,"Нам нужно знать куда привезти ваш заказ",-1))),c={class:"ion-padding"};function r(t,o,e,n,r,d){const u=(0,i.g2)("ion-card-title"),h=(0,i.g2)("ion-card-header"),p=(0,i.g2)("ion-card-content"),m=(0,i.g2)("ion-card"),g=(0,i.g2)("ion-img"),_=(0,i.g2)("ion-label"),k=(0,i.g2)("ion-item"),f=(0,i.g2)("ion-icon"),b=(0,i.g2)("ion-chip"),y=(0,i.g2)("ion-list"),v=(0,i.g2)("ion-button"),C=(0,i.g2)("base-layout");return(0,i.uX)(),(0,i.Wv)(C,{"page-title":"Мои адреса",ref:"UserAddressPage"},{default:(0,i.k6)((()=>[d.mainAddress?((0,i.uX)(),(0,i.Wv)(m,{key:0},{default:(0,i.k6)((()=>[(0,i.bF)(h,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.eW)(" Адрес доставки заказа ")])),_:1})])),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)((()=>[(0,i.Lk)("p",null,[(0,i.Lk)("b",s,(0,a.v_)(d.mainAddress.location_address),1),(0,i.eW)(", выбран как адрес доставки заказов.")])])),_:1})])),_:1})):((0,i.uX)(),(0,i.Wv)(m,{key:1},{default:(0,i.k6)((()=>[(0,i.bF)(h,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.eW)(" Добавьте адрес ")])),_:1})])),_:1}),(0,i.bF)(p,null,{default:(0,i.k6)((()=>[l])),_:1})])),_:1})),r.locationList.length?((0,i.uX)(),(0,i.Wv)(y,{key:2,lines:"none"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.locationList,((e,s)=>((0,i.uX)(),(0,i.CE)("div",{key:e.location_id},[(0,i.bF)(k,{button:"",detail:"",onClick:t=>d.locationSetMain(`${e.location_id}`,`${s}`)},{default:(0,i.k6)((()=>[(0,i.bF)(g,{slot:"start",alt:"",src:`${t.$heap.state.hostname}/image/get.php/${e.image_hash}.60.60.png`,style:{height:"24px"}},null,8,["src"]),(0,i.bF)(_,{style:{"white-space":"normal",cursor:"pointer"},class:(0,a.C4)(1==e.is_main?"is_main":"")},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.location_address),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"]),1==e.is_main?((0,i.uX)(),(0,i.Wv)(k,{key:0,lines:"full"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",null,[e.location_comment?((0,i.uX)(),(0,i.CE)("div",{key:0,onClick:o[0]||(o[0]=t=>d.locationCommentEdit("locationStart")),style:{padding:"10px","background-color":"var(--ion-color-light)",color:"#666","border-radius":"15px",display:"inline-block"}},(0,a.v_)(e.location_comment),1)):((0,i.uX)(),(0,i.Wv)(b,{key:1,color:"medium",onClick:o[1]||(o[1]=t=>d.locationCommentEdit("locationStart"))},{default:(0,i.k6)((()=>[(0,i.bF)(f,{src:n.addOutline},null,8,["src"]),(0,i.bF)(_,null,{default:(0,i.k6)((()=>[(0,i.eW)("комментарий")])),_:1})])),_:1})),e.location_phone>0?((0,i.uX)(),(0,i.Wv)(b,{key:2,color:"medium",onClick:o[2]||(o[2]=t=>d.locationPhoneEdit("locationStart"))},{default:(0,i.k6)((()=>[(0,i.bF)(f,{src:n.callOutline},null,8,["src"]),(0,i.bF)(_,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.location_phone),1)])),_:2},1024)])),_:2},1024)):((0,i.uX)(),(0,i.Wv)(b,{key:3,color:"medium",onClick:o[3]||(o[3]=t=>d.locationPhoneEdit("locationStart"))},{default:(0,i.k6)((()=>[(0,i.bF)(f,{src:n.addOutline},null,8,["src"]),(0,i.bF)(_,null,{default:(0,i.k6)((()=>[(0,i.eW)("телефон")])),_:1})])),_:1}))]),(0,i.bF)(f,{slot:"end",icon:n.trashOutline,onClick:t=>d.locationDelete(`${e.location_id}`,`${s}`),color:"medium"},null,8,["icon","onClick"])])),_:2},1024)):(0,i.Q3)("",!0)])))),128))])),_:1})):(0,i.Q3)("",!0),(0,i.Lk)("div",c,[(0,i.bF)(v,{expand:"block",onClick:o[4]||(o[4]=t=>d.modalLocationCreate())},{default:(0,i.k6)((()=>[(0,i.bF)(f,{src:n.locationOutline,slot:"start"},null,8,["src"]),(0,i.eW)(" Добавить адрес")])),_:1}),(0,i.bF)(v,{onClick:o[5]||(o[5]=o=>t.$router.go(-1)),color:"light",expand:"block"},{default:(0,i.k6)((()=>[(0,i.eW)("Назад")])),_:1})])])),_:1},512)}var d=e(5654),u=e(6300),h=e(5538),p=e(8701),m=e(2311),g=e.n(m),_=e(6642),k=e(5480),f={name:"UserAddresses",components:{IonImg:d.KW,IonLabel:d.he,IonItem:d.uz,IonList:d.nf,IonIcon:d.iq,IonCard:d.b_,IonCardHeader:d.ME,IonCardContent:d.I9,IonCardTitle:d.tN,IonChip:d.ZB,IonButton:d.Jm},setup(){return{locationOutline:k.UN$,trashOutline:k.P1A,addOutline:k.EKF,callOutline:k.bNN}},mounted(){this.locationListGet()},computed:{mainAddress(){var t;return null===(t=this.locationList)||void 0===t?void 0:t.find((t=>1==t.is_main))}},methods:{async modalLocationCreate(){if(!h.A.getters.userIsLogged)return void(confirm("Чтобы добавленный адрес сохранился, необходимо авторизироваться")&&this.$go("/modal/user-authorize"));const t=await d.OZ.create({component:_.A,showBackdrop:!0,componentProps:{locationGroupList:this.locationGroupList}});return t.onDidDismiss().then((t=>{const o=t.data;o&&this.locationCreate(o)})),t.present()},async locationListGet(){try{var t,o;let e=null;const i=await g().get(h.A.state.hostname+"User/locationListGet",{includeGroupList:1});if(this.locationList=i.location_list,this.locationGroupList=i.location_group_list,this.locationList)for(let t of this.locationList)1==t.is_main&&(e=t);if(e||this.modalLocationCreate(),!e)return void p.A.get();e&&(null===(t=e)||void 0===t?void 0:t.location_id)!=(null===(o=h.A.state.user.location_main)||void 0===o?void 0:o.location_id)&&(h.A.state.user.location_main=e,this.$topic.publish("userMainLocationSet",h.A.state.user.location_main))}catch{}},async locationCreate(t){let o={location_holder:"user",location_holder_id:h.A.state.user.user_id,location_group_id:t.location_group_id,location_address:t.location_address,location_latitude:t.location_latitude,location_longitude:t.location_longitude,location_comment:t.location_comment};try{await g().post(h.A.state.hostname+"User/locationCreate",o),this.$heap.state.next_route&&(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null),this.locationListGet()}catch(e){const t=e.responseJSON,o=t.messages.error;switch(o){case"limit_exeeded":this.$flash("Больше адресов добавить нельзя");break}return!1}},async locationSetMain(t,o){const e=this.locationList[o];h.A.state.user.location_main={location_id:e.location_id,location_latitude:e.location_latitude,location_longitude:e.location_longitude,location_address:e.location_address,image_hash:e.image_hash},await g().post(h.A.state.hostname+"User/locationSetMain",{location_id:t}),this.$topic.publish("userMainLocationSet",h.A.state.user.location_main),this.$flash("Адрес доставки изменен"),this.$heap.state.next_route?(this.$go(this.$heap.state.next_route),this.$heap.state.next_route=null):this.locationListGet()},async locationDelete(t,o){if(confirm("Удалить адрес доставки?")){try{this.locationList.splice(o,1),await g().post(h.A.state.hostname+"User/locationDelete",{location_id:t})}catch{}this.locationListGet()}},async locationCurrentSet(){const t=await d.FJ.create({message:"Определяем ваше местоположение"});t.present();try{await p.A.geo.locationCurrentGet(),this.$flash("Ваше местоположение определено")}catch(o){this.$flash("Не удалось получить ваше местоположение")}t.dismiss(),u.A.go(-1)},async locationUpdate(t){await g().post(h.A.state.hostname+"Location/itemUpdate",JSON.stringify(t)),this.$flash("Сохранено"),this.locationListGet()},async locationPhoneEdit(t){var o;let e=null!==(o=h.A.state.user.location_main.location_phone)&&void 0!==o?o:"";const i=await d.TN.create({header:"Напишите номер телефона",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{name:"phone",placeholder:"+7 xxxxxxxxxx",value:e}]});try{await i.present();const{data:t,role:o}=await i.onDidDismiss();if("confirm"==o&&(e=t.values.phone.replace(/\D/g,"").replace(/^7/,""),e)){if(10!=e.length)return void this.$flash("Проверьте правильность телефона");e="+7"+e}"cancel"==o&&(e=""),h.A.state.user.location_main.location_phone=e;const a={location_id:h.A.state.user.location_main.location_id,location_phone:e};this.locationUpdate(a)}catch(a){console.log(a)}},async locationCommentEdit(t){var o;let e=null!==(o=h.A.state.user.location_main.location_comment)&&void 0!==o?o:"";const i=await d.TN.create({header:"Комментарий к адресу",buttons:[{text:"Удалить",role:"cancel"},{text:"OK",role:"confirm"}],inputs:[{type:"textarea",name:"comment",placeholder:"напишите комментарий",value:e}]});try{await i.present();const{data:t,role:o}=await i.onDidDismiss();e=t.values.comment,"cancel"==o&&(e=""),h.A.state.user.location_main.location_comment=e;const a={location_id:h.A.state.user.location_main.location_id,location_comment:e};this.locationUpdate(a)}catch(a){console.log(a)}}},data(){return{locationList:[],locationGroupList:[]}}},b=e(6262);const y=(0,b.A)(f,[["render",r],["__scopeId","data-v-8d37b50a"]]);var v=y}}]);
//# sourceMappingURL=1552.5c7d22f0.js.map