"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[655],{8377:function(t,e,o){o.d(e,{Z:function(){return G}});var i=o(6252),l=o(3577);const r=(0,i.Uk)("Фотографии"),a={key:0,class:"image_grid"},d=["onClick"],s={key:0},u={key:1},n={key:0,class:"image_controls"},c=["id"];function m(t,e,o,m,p,_){const h=(0,i.up)("ion-label"),g=(0,i.up)("ion-icon"),k=(0,i.up)("ion-item"),I=(0,i.up)("ion-img"),f=(0,i.up)("ion-avatar");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",null,[(0,i.Wm)(k,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[r])),_:1}),p.editMode?((0,i.wg)(),(0,i.j4)(g,{key:0,slot:"end",icon:m.settingsSharp,color:"primary",onClick:e[0]||(e[0]=t=>p.editMode=0)},null,8,["icon"])):((0,i.wg)(),(0,i.j4)(g,{key:1,slot:"end",icon:m.settingsOutline,onClick:e[1]||(e[1]=t=>{p.editMode=1,_.load()})},null,8,["icon"]))])),_:1}),_.imageList?.length?((0,i.wg)(),(0,i.iD)("div",a,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.imageList,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.image_id,style:{position:"relative"}},[(0,i._)("div",{style:{position:"absolute",top:"0px","background-color":"#fffc","font-size":"0.75em"},onClick:t=>_.imagePreview(e.image_hash)},[e.deleted_at?((0,i.wg)(),(0,i.iD)("div",s,"будет удалено")):1==e.is_disabled?((0,i.wg)(),(0,i.iD)("div",u,"на модерации")):(0,i.kq)("",!0)],8,d),(0,i.Wm)(f,{onClick:t=>_.imagePreview(e.image_hash),class:(0,l.C_)(e.class)},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".100.100.webp"},null,8,["src"])])),_:2},1032,["onClick","class"]),p.editMode?((0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(g,{icon:m.chevronBackCircleOutline,onClick:t=>_.back(e)},null,8,["icon","onClick"]),_.isAdmin&&1==e.is_disabled?((0,i.wg)(),(0,i.j4)(g,{key:0,icon:m.checkmarkCircle,color:"success",onClick:t=>_.enable(e)},null,8,["icon","onClick"])):(0,i.kq)("",!0),e.deleted_at?((0,i.wg)(),(0,i.j4)(g,{key:1,icon:m.addCircle,color:"success",onClick:t=>_.restore(e)},null,8,["icon","onClick"])):((0,i.wg)(),(0,i.j4)(g,{key:2,icon:m.trash,color:"danger",onClick:t=>_.remove(e)},null,8,["icon","onClick"])),(0,i.Wm)(g,{icon:m.chevronForwardCircleOutline,onClick:t=>_.forward(e)},null,8,["icon","onClick"])])):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0)]),(0,i._)("input",{type:"file",id:p.fileUploaderId,accept:"image/*",onChange:e[2]||(e[2]=t=>_.uploadImage(t)),style:{display:"none"}},null,40,c)],64)}var p=o(8903),_=o(4508);const h=(0,i.Uk)("Просмотр фотографии");function g(t,e,o,l,r,a){const d=(0,i.up)("ion-title"),s=(0,i.up)("ion-icon"),u=(0,i.up)("ion-toolbar"),n=(0,i.up)("ion-header"),c=(0,i.up)("ion-img"),m=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[h])),_:1}),(0,i.Wm)(s,{icon:l.closeOutline,onClick:e[0]||(e[0]=t=>{l.closeModal()}),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{src:t.$heap.state.hostname+"image/get.php/"+o.image_hash+".1000.1000.webp"},null,8,["src"])])),_:1})],64)}var k={props:["image_hash"],components:{IonIcon:_.gu,IonToolbar:_.sr,IonHeader:_.Gu,IonImg:_.Xz,IonContent:_.W2,IonTitle:_.wd},setup(){const t=function(){_.Fy.dismiss()};return{closeModal:t,closeOutline:p.fID}}},I=o(3744);const f=(0,I.Z)(k,[["render",g]]);var w=f,y=o(9755),W=o.n(y),b=o(9042),v=o(351),C={props:["images","image_holder_id","controller"],components:{IonLabel:_.Q$,IonIcon:_.gu,IonItem:_.Ie,IonImg:_.Xz,IonAvatar:_.BJ},setup(){return{settingsOutline:p.C$N,settingsSharp:p.kiF,chevronBackCircleOutline:p.CK0,chevronForwardCircleOutline:p.esm,trash:p._Ij,addCircle:p.ZWo,checkmarkCircle:p.I1A}},data(){return{images_loaded:null,editMode:!1,fileUploaderId:this.controller+this.image_holder_id}},computed:{imageList(){let t=this.images_loaded||this.images,e=[];for(let o in t)t[o].deleted_at?(t[o].class=" deleted",this.editMode&&e.push(t[o])):1==t[o].is_disabled?(t[o].class=" disabled",this.editMode&&e.push(t[o])):e.push(t[o]);return e},isAdmin(){return v.Z.isAdmin()}},methods:{async back(t){try{await W().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:t.image_id,dir:"up"}),this.load()}catch{}},async forward(t){try{await W().post(this.$heap.state.hostname+"Image/itemUpdateOrder",{image_id:t.image_id,dir:"down"}),this.load()}catch{}},async remove(t){try{await W().post(this.$heap.state.hostname+"Image/itemDelete",{image_id:t.image_id}),this.load(),this.$flash("Фото перемещено в корзину и будет удалено")}catch{}},async restore(t){try{await W().post(this.$heap.state.hostname+"Image/itemUnDelete",{image_id:t.image_id}),this.load(),this.$flash("Фото перемещено извлечено из корзины")}catch{}},async enable(t){try{await W().post(this.$heap.state.hostname+"Image/itemDisable",{image_id:t.image_id,is_disabled:0}),this.load()}catch{}},async load(){const t={image_holder_id:this.image_holder_id,image_holder:this.controller,is_disabled:1,is_deleted:1,is_active:1};this.images_loaded=await W().post(this.$heap.state.hostname+"Image/listGet",t)},async imagePreview(t){const e=await _.Fy.create({component:w,componentProps:{image_hash:t},initialBreakpoint:.5,breakpoints:[.5,1]}),o=function(){e.dismiss()};return b.Z.on("dismissModal",o),e.present()},async uploadImage(t){let e=new FormData;e.append("files[]",t.target.files[0]),e.set("image_holder_id",this.image_holder_id);const o={url:this.$heap.state.hostname+this.controller+"/fileUpload",type:"POST",data:e,processData:!1,contentType:!1};try{await W().ajax(o),this.load()}catch(i){if("limit_exeeded"==i?.responseJSON?.messages?.error)return void this.$flash("Уже загружено максимальное количество фото");this.$flash("Не удалось загрузить фото")}},take_photo(){W()(`#${this.fileUploaderId}`).trigger("click"),this.editMode=!0}}};const U=(0,I.Z)(C,[["render",m],["__scopeId","data-v-3717a58c"]]);var G=U},2655:function(t,e,o){o.r(e),o.d(e,{default:function(){return J}});var i=o(6252),l=o(3577);const r=(0,i.Uk)(" Удалено "),a=(0,i.Uk)(" На модерации "),d=(0,i.Uk)(" Вести учет остатков "),s=(0,i.Uk)(" Показать товар "),u=(0,i.Uk)(" Показать в магазине "),n=(0,i.Uk)(" Управление магазином "),c=(0,i.Uk)("Основные настройки"),m=(0,i.Uk)("Название*"),p=(0,i.Uk)("Описание*"),_=(0,i.Uk)("Артикул"),h=(0,i.Uk)("Остаток "),g={key:0},k=(0,i.Uk)("Единица*"),I=(0,i.Uk)("Мин. заказ*"),f={key:0},w=(0,i.Uk)("Вес единицы (кг)*"),y=(0,i.Uk)("Цена"),W=(0,i.Uk)("Цена*"),b=(0,i.Uk)("Цена акционная"),v=(0,i.Uk)("Начало акции"),C=(0,i.Uk)("Конец акции"),U=(0,i.Uk)("Изображения товара*"),G=(0,i.Uk)(" Добавить "),V=(0,i.Uk)("Категории товара*"),D=(0,i.Uk)("Без категории (в разделе 'Другое')"),L=(0,i.Uk)("Добавить в категорию");function $(t,e,o,$,O,q){const P=(0,i.up)("ion-label"),M=(0,i.up)("ion-progress-bar"),z=(0,i.up)("ion-card-header"),j=(0,i.up)("ion-text"),Z=(0,i.up)("ion-card-content"),F=(0,i.up)("ion-card"),B=(0,i.up)("ion-icon"),T=(0,i.up)("ion-toggle"),x=(0,i.up)("ion-item"),H=(0,i.up)("ion-item-divider"),A=(0,i.up)("ion-list"),S=(0,i.up)("ion-input"),Y=(0,i.up)("ion-textarea"),N=(0,i.up)("ion-item-group"),J=(0,i.up)("image-tile-comp"),K=(0,i.up)("ion-button"),X=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(X,{"page-title":O.productItem?.product_name??"Товар","page-default-back-link":"/product-"+this.productId},{default:(0,i.w5)((()=>[(0,i.Wm)(F,{color:O.validity_perc<O.validity_min?"danger":""},{default:(0,i.w5)((()=>[(0,i.Wm)(z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Анкета заполнена на "+(0,l.zw)(O.validity_perc)+"%",1)])),_:1}),(0,i.Wm)(M,{value:O.validity},null,8,["value"])])),_:1}),O.validity_perc<O.validity_min?((0,i.wg)(),(0,i.j4)(Z,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(j,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Вам необходимо заполнить анкету не меньше чем на "+(0,l.zw)(O.validity_min)+"% для рассмотрения модератором ",1)])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1},8,["color"]),q.message&&O.validity_perc>O.validity_min?((0,i.wg)(),(0,i.j4)(F,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{class:(0,l.C_)(q.messageClass)},{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(q.message),1)])),_:1},8,["class"])])),_:1})):(0,i.kq)("",!0),O.productItem?((0,i.wg)(),(0,i.j4)(A,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.trashOutline,color:"primary",slot:"start"},null,8,["src"]),r,(0,i.Wm)(T,{slot:"end",modelValue:O.is_deleted,"onUpdate:modelValue":e[0]||(e[0]=t=>O.is_deleted=t),color:"danger",onIonChange:e[1]||(e[1]=t=>q.itemDelete(t.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.searchOutline,color:"primary",slot:"start"},null,8,["src"]),a,(0,i.Wm)(T,{slot:"end",modelValue:O.is_disabled,"onUpdate:modelValue":e[2]||(e[2]=t=>O.is_disabled=t),onIonChange:e[3]||(e[3]=t=>q.itemDisable(t.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.pizzaOutline,color:"primary",slot:"start"},null,8,["src"]),d,(0,i.Wm)(T,{slot:"end",modelValue:O.is_counted,"onUpdate:modelValue":e[4]||(e[4]=t=>O.is_counted=t),onIonChange:e[5]||(e[5]=t=>q.save("is_counted",t.target.checked?1:0))},null,8,["modelValue"])])),_:1}),(0,i.Wm)(H),(0,i.Wm)(x,{button:"",onClick:e[6]||(e[6]=e=>t.$router.push("product-"+O.productItem.product_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.chevronBack,slot:"start"},null,8,["src"]),s])),_:1}),(0,i.Wm)(x,{button:"",onClick:e[7]||(e[7]=t=>q.showProductInStore())},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.chevronBack,slot:"start"},null,8,["src"]),u])),_:1}),(0,i.Wm)(x,{button:"",onClick:e[8]||(e[8]=e=>t.$router.push("store-edit-"+O.productItem.store_id))},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.chevronBack,slot:"start"},null,8,["src"]),n])),_:1})])),_:1})):(0,i.kq)("",!0),O.productItem?((0,i.wg)(),(0,i.iD)("form",{key:2,onChange:e[20]||(e[20]=(...t)=>q.saveForm&&q.saveForm(...t))},[(0,i.Wm)(A,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(N,null,{default:(0,i.w5)((()=>[(0,i.Wm)(H,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[c])),_:1})])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[m])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_name,"onUpdate:modelValue":e[9]||(e[9]=t=>O.productItem.product_name=t),name:"product_name",placeholder:"полное название товара",clearInput:"true",autofocus:""},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{position:"stacked",color:"primary"},{default:(0,i.w5)((()=>[p])),_:1}),(0,i.Wm)(Y,{modelValue:O.productItem.product_description,"onUpdate:modelValue":e[10]||(e[10]=t=>O.productItem.product_description=t),name:"product_description",rows:"6",placeholder:"характеристики, свойства, состав товара"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"primary"},{default:(0,i.w5)((()=>[_])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_code,"onUpdate:modelValue":e[11]||(e[11]=t=>O.productItem.product_code=t),name:"product_code",slot:"end",placeholder:"код товара"},null,8,["modelValue"])])),_:1}),O.is_counted?((0,i.wg)(),(0,i.j4)(x,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"primary"},{default:(0,i.w5)((()=>[h,O.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",g,"("+(0,l.zw)(O.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_quantity,"onUpdate:modelValue":e[12]||(e[12]=t=>O.productItem.product_quantity=t),name:"product_quantity",slot:"end",placeholder:"в наличии"},null,8,["modelValue"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"primary"},{default:(0,i.w5)((()=>[k])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_unit,"onUpdate:modelValue":e[13]||(e[13]=t=>O.productItem.product_unit=t),name:"product_unit",slot:"end",placeholder:"шт,кг и т.д."},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"primary"},{default:(0,i.w5)((()=>[I,O.productItem.product_unit?((0,i.wg)(),(0,i.iD)("span",f,"("+(0,l.zw)(O.productItem.product_unit)+")",1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_quantity_min,"onUpdate:modelValue":e[14]||(e[14]=t=>O.productItem.product_quantity_min=t),name:"product_quantity_min",type:"number",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"primary"},{default:(0,i.w5)((()=>[w])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_weight,"onUpdate:modelValue":e[15]||(e[15]=t=>O.productItem.product_weight=t),name:"product_weight",type:"number",step:"0.1",inputmode:"numeric",pattern:"\\d\\.",slot:"end"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,i.Wm)(A,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(N,null,{default:(0,i.w5)((()=>[(0,i.Wm)(H,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[y])),_:1})])),_:1})])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"primary"},{default:(0,i.w5)((()=>[W])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_price,"onUpdate:modelValue":e[16]||(e[16]=t=>O.productItem.product_price=t),name:"product_price",type:"number",inputmode:"numeric",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"success"},{default:(0,i.w5)((()=>[b])),_:1}),(0,i.Wm)(S,{modelValue:O.productItem.product_promo_price,"onUpdate:modelValue":e[17]||(e[17]=t=>O.productItem.product_promo_price=t),name:"product_promo_price",type:"number",inputmode:"numeric",slot:"end",color:"success"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"success"},{default:(0,i.w5)((()=>[v])),_:1}),(0,i.Wm)(S,{type:"date",modelValue:O.productItem.product_promo_start,"onUpdate:modelValue":e[18]||(e[18]=t=>O.productItem.product_promo_start=t),name:"product_promo_start",slot:"end"},null,8,["modelValue"])])),_:1}),(0,i.Wm)(x,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,{color:"success"},{default:(0,i.w5)((()=>[C])),_:1}),(0,i.Wm)(S,{type:"date",modelValue:O.productItem.product_promo_finish,"onUpdate:modelValue":e[19]||(e[19]=t=>O.productItem.product_promo_finish=t),name:"product_promo_finish",slot:"end"},null,8,["modelValue"])])),_:1})])),_:1})],32)):(0,i.kq)("",!0),O.productItem?((0,i.wg)(),(0,i.j4)(A,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(H,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[U])),_:1})])),_:1}),(0,i.Wm)(J,{images:O.productItem.images,image_holder_id:O.productItem.product_id,controller:"Product",ref:"productImgs"},null,8,["images","image_holder_id"]),(0,i.Wm)(K,{onClick:e[21]||(e[21]=e=>t.$refs.productImgs.take_photo()),size:"small",expand:"full",color:"medium"},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.cameraOutline},null,8,["src"]),G])),_:1})])),_:1})):(0,i.kq)("",!0),q.categoryList?((0,i.wg)(),(0,i.j4)(A,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(H,null,{default:(0,i.w5)((()=>[(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[V])),_:1})])),_:1}),0==q.categoryList.length?((0,i.wg)(),(0,i.j4)(x,{key:0,color:"light"},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.compassOutline,slot:"start",color:"danger"},null,8,["src"]),(0,i.Wm)(P,{color:"danger"},{default:(0,i.w5)((()=>[D])),_:1})])),_:1})):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(q.categoryList,(t=>((0,i.wg)(),(0,i.j4)(x,{key:t.group_id},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.compassOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(t.group_name),1)])),_:2},1024),(0,i.Wm)(B,{src:$.trashOutline,slot:"end",onClick:e=>q.categoryDelete(t.group_id,t.group_name)},null,8,["src","onClick"])])),_:2},1024)))),128)),(0,i.Wm)(x,{button:"",onClick:e[22]||(e[22]=t=>q.categoryAdd())},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{src:$.addOutline,slot:"start",color:"primary"},null,8,["src"]),(0,i.Wm)(P,null,{default:(0,i.w5)((()=>[L])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1},8,["page-title","page-default-back-link"])}var O=o(4508),q=o(8903),P=o(8377);const M=(0,i.Uk)("Категории"),z=(0,i.Uk)("Готово");function j(t,e,o,r,a,d){const s=(0,i.up)("ion-title"),u=(0,i.up)("ion-icon"),n=(0,i.up)("ion-toolbar"),c=(0,i.up)("ion-button"),m=(0,i.up)("ion-header"),p=(0,i.up)("ion-img"),_=(0,i.up)("ion-avatar"),h=(0,i.up)("ion-label"),g=(0,i.up)("ion-checkbox"),k=(0,i.up)("ion-item"),I=(0,i.up)("ion-item-divider"),f=(0,i.up)("ion-list"),w=(0,i.up)("ion-content");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[(0,i.Wm)(s,null,{default:(0,i.w5)((()=>[M])),_:1}),(0,i.Wm)(u,{slot:"end",onClick:e[0]||(e[0]=t=>{d.closeModal()}),icon:r.closeCircle,size:"large",color:"medium"},null,8,["icon"])])),_:1}),(0,i.Wm)(c,{onClick:e[1]||(e[1]=t=>{d.closeModal()}),color:"medium",expand:"full"},{default:(0,i.w5)((()=>[z])),_:1})])),_:1}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[a.groupList?((0,i.wg)(),(0,i.j4)(f,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.groupList,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.group_id},[e.group_parent_id>0?((0,i.wg)(),(0,i.j4)(k,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{src:t.$heap.state.hostname+"image/get.php/"+e.image_hash+".50.50.webp"},null,8,["src"])])),_:2},1024),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,l.zw)(e.group_name),1)])),_:2},1024),(0,i.Wm)(g,{slot:"end",checked:e.is_marked,onClick:t=>d.mimickChage(t.target,e.group_id)},null,8,["checked","onClick"])])),_:2},1024)):((0,i.wg)(),(0,i.j4)(I,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i._)("b",null,(0,l.zw)(e.group_name),1)])),_:2},1024)])),_:2},1024))])))),128))])),_:1})):(0,i.kq)("",!0)])),_:1})],64)}var Z=o(9755),F=o.n(Z),B={props:["controller","memberId","memberOfIds","memberLimit"],components:{IonCheckbox:O.nz,IonContent:O.W2,IonHeader:O.Gu,IonToolbar:O.sr,IonTitle:O.wd,IonIcon:O.gu,IonButton:O.YG,IonImg:O.Xz,IonAvatar:O.BJ,IonLabel:O.Q$,IonItemDivider:O.rH,IonList:O.q_,IonItem:O.Ie},setup(){return{closeCircle:q.XZx}},data(){return{groupList:null,checkedGroupList:[]}},created(){this.listGroupGet(),this.checkedGroupList=this.memberOfIds||[]},methods:{async listGroupGet(){this.groupList=await F().get(this.$heap.state.hostname+this.controller+"/listGroupGet"),this.itemMarkGroups()},itemMarkGroups(){if(this.groupList)try{for(let t of this.groupList)t.is_marked=this.checkedGroupList.includes(t.group_id)?1:0}catch{}},async itemUpdateGroup(t,e){const o={[this.controller.toLowerCase()+"_id"]:this.memberId,is_joined:t,group_id:e};try{await F().post(this.$heap.state.hostname+this.controller+"/itemUpdateGroup",o)}catch(i){this.$flash("Не удалось сохранить изменение")}},mimickChage(t,e){const o=this;setTimeout((()=>{o.groupChanged(t,e)}),0)},async groupChanged(t,e){const o=t.checked?1:0;if(o){if(this.checkedGroupList.length>=this.memberLimit)return this.$flash(`Можно выбрать не больше ${this.memberLimit} категорий`),void(t.checked=0);1==this.memberLimit&&this.closeModal(),this.checkedGroupList.push(e)}else this.checkedGroupList=this.checkedGroupList.filter((function(t,o,i){return t!=e}));this.itemUpdateGroup(o,e)},closeModal(){O.Fy.dismiss(this.checkedGroupList)}}},T=o(3744);const x=(0,T.Z)(B,[["render",j]]);var H=x,A=o(2008),S=o(9042),Y={components:{IonInput:O.pK,IonTextarea:O.g2,IonCard:O.PM,IonCardContent:O.FN,IonCardHeader:O.Zi,IonToggle:O.ho,IonIcon:O.gu,IonItem:O.Ie,IonList:O.q_,IonLabel:O.Q$,IonItemDivider:O.rH,IonItemGroup:O.Ub,IonButton:O.YG,IonProgressBar:O.X7,IonText:O.yW,imageTileComp:P.Z},setup(){return{cameraOutline:q.kuq,trashOutline:q.gtu,searchOutline:q.W6I,personOutline:q.QJ7,addOutline:q.s6O,pizzaOutline:q.fqo,compassOutline:q.gmD,chevronBack:q.Mny}},data(){return{productId:this.$route.params.id,productItem:null,productGroupList:null,is_groups_marked:0,is_deleted:0,is_disabled:0,is_counted:0,validity:0,validity_perc:100,validity_min:90}},computed:{message(){return this.productItem?.deleted_at?"Товар не активен и будет удален. Вы еще можете отменить удаление":1==this.productItem?.is_disabled?"Товар не активен и находится на рассмотрении у администратора":1!=this.productItem?.is_counted?"Товар активен и готов к продаже. Товар произодится вами, например еда":"Товар активен и готов к продаже."},messageClass(){return this.productItem?.deleted_at?"deleted":1==this.productItem?.is_disabled?"disabled":1!=this.productItem?.is_counted?"primary":"active"},categoryList(){let t=[];try{let e=this.productItem.member_of_groups.group_ids.split(","),o=this.productItem.member_of_groups.group_names.split(",");for(let i in e)t.push({group_id:e[i],group_name:o[i]})}catch{}return t}},created(){this.listGroupGet(),this.itemGet()},methods:{async itemGet(){try{let t=await F().post(A.Z.state.hostname+"Product/itemGet",{product_id:this.productId});this.productItem=this.itemPrepare(t),this.itemValidityCalc(),this.itemParseFlags(),this.itemMarkGroups()}catch{}},itemPrepare(t){return t.product_promo_start&&(t.product_promo_start=t.product_promo_start.split(" ")[0]),t.product_promo_finish&&(t.product_promo_finish=t.product_promo_finish.split(" ")[0]),t},itemParseFlags(){this.is_deleted=null==this.productItem.deleted_at?0:1,this.is_disabled=0==this.productItem.is_disabled?0:1,this.is_counted=0==this.productItem.is_counted?0:1},async itemDelete(t){const e=t?"itemDelete":"itemUnDelete";try{await F().post(A.Z.state.hostname+"Product/"+e,{product_id:this.productId}),this.productItem.deleted_at=t?1:null}catch{this.itemGet()}},async itemDisable(t){if(this.productItem.is_disabled!=t)try{await F().post(A.Z.state.hostname+"Product/itemDisable",{product_id:this.productId,is_disabled:t}),this.productItem.is_disabled=t}catch{this.itemGet()}},itemValidityCalc(){const t=["product_name","product_description","product_code","product_unit","product_quantity_min","product_weight","product_price","images","member_of_groups.group_ids"],e=t.length;let o=0;for(const i of t){let t=0;for(const e of i.split("|")){let o=null;const i=e.split(".");if(o=i[1]?this.productItem[i[0]][i[1]]:this.productItem[i[0]],o?.length>0){t=1;break}}o+=t}this.validity=o/e,this.validity_perc=Math.round(100*this.validity)},async itemUpdate(t){try{return t["validity"]=this.validity_perc,await F().post(A.Z.state.hostname+"Product/itemUpdate",JSON.stringify(t)),!0}catch(e){const t=e.responseJSON.messages.error;return t?.includes("product_description")?this.$flash("Описание слишком короткое"):t?.includes("product_name")?this.$flash("Название слишком короткое"):this.$flash("Изменение не сохранено"),this.itemGet(),!1}},checkPromoPrice(t){if(this.productItem.product_price<=this.productItem.product_promo_price){"product_promo_price"==t&&(this.productItem.product_price=Number(this.productItem.product_promo_price)+1),"product_price"==t&&(this.productItem.product_promo_price=Number(this.productItem.product_price)-1);const e={product_id:this.productId,product_promo_price:this.productItem.product_promo_price,product_price:this.productItem.product_price};return this.itemValidityCalc(),this.itemUpdate(e),this.$flash("Акционная цена должна быть ниже основной. Внимание цена изменена!"),!1}return!0},saveForm(t){const e=t.target.name,o=this.productItem[e]=t.target.value;this.checkPromoPrice(e)&&this.save(e,o)},async save(t,e){let o={product_id:this.productId,[t]:e};this.itemUpdate(o)&&(this.productItem[t]=e,this.itemValidityCalc(),this.itemParseFlags())},categoryDelete(t,e){if(confirm("Исключить товар из категории "+e+"?"))try{this.itemUpdateGroup(0,t)}catch{}},async categoryAdd(){const t=this.productItem?.member_of_groups?.group_ids?.split(",")||[],e=await O.Fy.create({component:H,componentProps:{controller:"Product",memberId:this.productId,memberOfIds:t,memberLimit:1},initialBreakpoint:.75,breakpoints:[.75,1],canDissmiss:!0});e.present(),S.Z.on("dismissModal",(()=>{e.dismiss()})),await e.onDidDismiss(),this.itemGet()},async itemUpdateGroup(t,e){const o={product_id:this.productId,is_joined:t,group_id:e};try{await F().post(A.Z.state.hostname+"Product/itemUpdateGroup",o)}catch(i){this.$flash("Не удалось сохранить изменение")}this.itemGet()},async listGroupGet(){try{this.productGroupList=await F().get(A.Z.state.hostname+"Product/listGroupGet"),this.itemMarkGroups()}catch{}},showProductInStore(){console.log(this.productItem);let t=0;try{t=this.productItem.member_of_groups.group_ids.split(",")[0]}catch{}this.$router.push({path:"store-"+this.productItem.store_id,query:{sub_group_id:t}})}}};const N=(0,T.Z)(Y,[["render",$],["__scopeId","data-v-04358a36"]]);var J=N}}]);
//# sourceMappingURL=655.3323b1a8.js.map