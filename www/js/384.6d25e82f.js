"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[384],{1384:function(e,t,o){o.r(t),o.d(t,{default:function(){return x}});var i=o(6252),n=o(3577);const s=(0,i.Uk)(" Задания "),l=(0,i.Uk)(" Активные "),a=(0,i.Uk)(" Исполненые "),r=["onClick"],u=["onClick"],d={key:2,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},c={style:{width:"max-content","text-align":"center"}},m=(0,i.Uk)("Заказов нет"),_=(0,i._)("br",null,null,-1);function h(e,t,o,h,w,f){const p=(0,i.up)("ion-segment-button"),k=(0,i.up)("ion-segment"),y=(0,i.up)("ion-icon"),b=(0,i.up)("ion-label"),W=(0,i.up)("ion-item"),g=(0,i.up)("ion-chip"),j=(0,i.up)("ion-note"),I=(0,i.up)("ion-text"),v=(0,i.up)("ion-img"),L=(0,i.up)("ion-thumbnail"),z=(0,i.up)("ion-list"),C=(0,i.up)("base-layout");return(0,i.wg)(),(0,i.j4)(C,{"page-default-back-link":"/home","page-title":"Заказы"},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{"swipe-gesture":"true",modelValue:w.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>w.orderType=e),onIonChange:t[1]||(t[1]=e=>f.listTypeChanged(e))},{default:(0,i.w5)((()=>[w.courierJobsInclude?((0,i.wg)(),(0,i.j4)(p,{key:0,value:"jobs"},{default:(0,i.w5)((()=>[s])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(p,{value:"active"},{default:(0,i.w5)((()=>[l])),_:1}),(0,i.Wm)(p,{value:"done"},{default:(0,i.w5)((()=>[a])),_:1})])),_:1},8,["modelValue"]),w.orderList?((0,i.wg)(),(0,i.j4)(z,{key:0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.orderListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>f.itemClick(t)},[(0,i.Wm)(W,{detail:"",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{slot:"start",icon:t.icon},null,8,["icon"]),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name)+" #"+(0,n.zw)(t.order_id),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(W,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.stage_current_name?((0,i.wg)(),(0,i.j4)(g,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{icon:h.checkmarkOutline},null,8,["icon"]),(0,i.Wm)(b,{color:"dark"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.stage_current_name),1)])),_:2},1024)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024),(0,i.Wm)(j,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.location_address),1)])),_:2},1024)])),_:2},1024),t.image_hash?((0,i.wg)(),(0,i.j4)(L,{key:0,slot:"end"},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{style:{"border-radius":"10px"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024)],8,r)))),128))])),_:1})):(0,i.kq)("",!0),w.jobList?((0,i.wg)(),(0,i.j4)(z,{key:1},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.jobListComputed,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.order_id,onClick:e=>f.itemClick(t)},[(0,i.Wm)(W,{detail:"",lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{slot:"start",icon:h.rocketOutline},null,8,["icon"]),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.store_name),1)])),_:2},1024)])),_:2},1024),(0,i.Wm)(W,{lines:"full"},{default:(0,i.w5)((()=>[(0,i.Wm)(I,null,{default:(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{color:"medium"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.order_sum_total)+(0,n.zw)(e.$heap.state.currencySign),1)])),_:2},1024),t.distance_km?((0,i.wg)(),(0,i.j4)(g,{key:0,color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.distance_km),1)])),_:2},1024)):(0,i.kq)("",!0)])),_:2},1024),(0,i.Wm)(j,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(t.location_address),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)],8,u)))),128))])),_:1})):(0,i.kq)("",!0),w.orderList||w.jobList?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",d,[(0,i._)("div",c,[(0,i.Wm)(y,{icon:h.sparklesOutline,size:"large"},null,8,["icon"]),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[m])),_:1}),_])]))])),_:1})}var w=o(9540),f=o(8903),p=o(8764),k=o(7782),y=o(351),b=o(9042),W=o(786);const g={class:"center_chip"},j={class:"center_chip"},I={class:"center_chip"},v=(0,i.Uk)("Покупатель"),L=(0,i.Uk)("Покупатель"),z=(0,i.Uk)("Начать доставку");function C(e,t,o,s,l,a){const r=(0,i.up)("ion-icon"),u=(0,i.up)("ion-avatar"),d=(0,i.up)("ion-text"),c=(0,i.up)("ion-label"),m=(0,i.up)("ion-item"),_=(0,i.up)("ion-chip"),h=(0,i.up)("ion-note"),w=(0,i.up)("ion-skeleton-text"),f=(0,i.up)("ion-button"),p=(0,i.up)("ion-item-group"),k=(0,i.up)("ion-list");return o.orderData?((0,i.wg)(),(0,i.j4)(k,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{icon:s.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Курьер "+(0,n.zw)(e.$heap.state.user.user_name),1)])),_:1})])),_:1})])),_:1}),(0,i.Wm)(m,{lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",g,[(0,i.Wm)(_,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData?.distance_km),1)])),_:1})])),_:1})])])),_:1}),(0,i.Wm)(m,{lines:"none"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{icon:s.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"primary"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.store_name),1)])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(o.orderData.location_address),1)])),_:1})])),_:1})])),_:1}),a.start_finish_distance_km?((0,i.wg)(),(0,i.j4)(m,{key:0,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",j,[(0,i.Wm)(_,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(a.start_finish_distance_km),1)])),_:1})])),_:1})])])),_:1})):((0,i.wg)(),(0,i.j4)(m,{key:1,lines:"none"},{default:(0,i.w5)((()=>[(0,i._)("div",I,[(0,i.Wm)(_,{color:"success"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{animated:"",style:{width:"100%"}})])),_:1})])])),_:1})),l.job?((0,i.wg)(),(0,i.j4)(m,{key:2},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{icon:s.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{color:"primary"},{default:(0,i.w5)((()=>[v])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,n.zw)(l.job.finish_location_address),1)])),_:1})])),_:1})])),_:1})):((0,i.wg)(),(0,i.j4)(m,{key:3},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{slot:"start"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{icon:s.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{color:"primary"},{default:(0,i.w5)((()=>[L])),_:1}),(0,i.Wm)(w,{animated:"",style:{width:"60%"}}),(0,i.Wm)(w,{animated:"",style:{width:"80%"}})])),_:1})])),_:1})),l.job?((0,i.wg)(),(0,i.j4)(p,{key:4},{default:(0,i.w5)((()=>[(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Бонус "+(0,n.zw)(l.job.order_sum_delivery),1)])),_:1})])),_:1}),(0,i.Wm)(f,{onClick:t[0]||(t[0]=e=>a.deliveryStart()),expand:"full"},{default:(0,i.w5)((()=>[z])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})):(0,i.kq)("",!0)}var U={props:["orderData"],components:{IonList:w.q_,IonItemGroup:w.Ub,IonTitle:w.wd,IonButton:w.YG,IonSkeletonText:w.CK,IonNote:w.uN,IonChip:w.hM,IonItem:w.Ie,IonLabel:w.Q$,IonText:w.yW,IonAvatar:w.BJ,IonIcon:w.gu},setup(){return{storefrontOutline:f.qRG,locationOutline:f.Iv7,flagOutline:f.FMn}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){return this.job?.start_finish_distance?Math.round(this.job?.start_finish_distance/1e3)+"км":"-"}},methods:{async jobGet(){try{let e=await k.Z.api.itemJobGet(this.orderData.order_id);e.finish_location_address=e.finish_location_address.split(",").reverse().join(","),this.job=e,console.log(this.job)}catch(e){console.log(e);const t=e.responseJSON?.messages?.error;if("notfound"==t)return void this.$flash("Задание не найдено");if("notready"==t)return void this.$flash("Смена курьера не открыта")}},async deliveryStart(){const e=y.Z.courier.data.courier_id;try{await k.Z.api.itemJobStart(this.orderData.order_id,e),this.$router.push("order-"+this.orderData.order_id)}catch(t){const e=t.responseJSON?.messages?.error;"notfound"==e&&this.$flash("Задание не найдено"),"notready"==e&&this.$flash("Смена курьера не открыта"),"notsearching"!=e&&"idle"!=e||this.$flash("Заданию уже назначен курьер")}b.Z.publish("dismissModal")}}},O=o(3744);const T=(0,O.Z)(U,[["render",C],["__scopeId","data-v-270793c6"]]);var D=T,$={components:{IonSegment:w.cJ,IonSegmentButton:w.GO,IonIcon:w.gu,IonAvatar:w.BJ,IonText:w.yW,IonLabel:w.Q$,IonItem:w.Ie,IonList:w.q_,IonChip:w.hM,IonNote:w.uN,IonImg:w.Xz,IonThumbnail:w.Bs},setup(){return{sparklesOutline:f.Fcs,storefrontOutline:f.qRG,timeOutline:f.bdY,ordersIcon:p,rocketOutline:f.G$D,ribbonOutline:f.Muk,checkmarkOutline:f.TjA}},data(){return{jobList:null,orderList:null,orderType:null,courierJobsInclude:null,clock:null}},computed:{orderListComputed(){for(let e of this.orderList)switch(e.user_role){case"customer":e.icon=p;break;case"admin":e.icon=f.Muk;break;case"courier":e.icon=f.G$D;break;case"supplier":e.icon=f.qRG;break}return this.orderList},jobListComputed(){for(let e of this.jobList)e.location_address||(e.location_address=""),e.location_address=e.location_address.split(",").reverse().join(","),e.distance?e.distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="";return this.jobList}},created(){let e=this;b.Z.on("courierStatusChange",(function(){e.courierReadinessCheck()})),e.courierReadinessCheck()},methods:{courierReadinessCheck(){const e="ready"==y.Z.courier.status?1:0;this.courierJobsInclude!==e&&(this.courierJobsInclude=e,0==this.courierJobsInclude?this.orderType="active":this.orderType="jobs")},async listLoad(e){if(this.autoReload(e),"jobs"==e)return void this.listJobLoad();let t="customer_finish";"active"==e&&(t="!customer_finish"),this.orderList=await k.Z.api.listLoad(t),this.jobList=null},listTypeChanged(e){const t=e.target.value;this.listLoad(t)},async listJobLoad(){try{const e=y.Z.courier.data.courier_id;this.jobList=await k.Z.api.listJobGet(e),this.orderList=null}catch(e){const t=e.responseJSON?.messages?.error;"notready"==t&&(y.Z.courier.status="notready",this.courierReadinessCheck())}},autoReload(e){clearTimeout(this.clock);const t=this,o=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((()=>{t.listLoad(e)}),o))},ionViewDidEnter(){this.courierReadinessCheck(),"active"==this.orderType?this.listLoad("active"):this.orderType="active"},ionViewDidLeave(){clearTimeout(this.clock)},async itemClick(e){if(e.is_courier_job){const t=await w.Fy.create({component:D,componentProps:{orderData:e},initialBreakpoint:.5,breakpoints:[0,.5,.75]}),o=function(){t.dismiss()};return b.Z.on("dismissModal",o),t.present()}this.itemOpen(e.order_id)},itemOpen(e){W.Z.push(`order-${e}`)}}};const J=(0,O.Z)($,[["render",h]]);var x=J}}]);
//# sourceMappingURL=384.6d25e82f.js.map