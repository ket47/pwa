"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[4557],{5908:function(t,e,a){a.d(e,{A:function(){return g}});var s=a(641),i=a(33);const l={slot:"end",style:{display:"grid","grid-template-columns":"120px"}},r={slot:"end",style:{display:"grid","grid-template-columns":"120px"}},n={class:"horizontalScroller"},o={key:1,class:"printDiv"},d={class:"table_head"},u={class:"table",style:{"overflow-x":"scroll"}},c=["href"];function h(t,e,a,h,p,v){const f=(0,s.g2)("ion-icon"),_=(0,s.g2)("ion-text"),m=(0,s.g2)("ion-item"),b=(0,s.g2)("ion-input"),k=(0,s.g2)("ion-list"),g=(0,s.g2)("ion-accordion"),y=(0,s.g2)("ion-accordion-group"),F=(0,s.g2)("ion-label"),w=(0,s.g2)("ion-chip"),x=(0,s.g2)("ion-searchbar"),L=(0,s.g2)("ion-skeleton-text");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(y,null,{default:(0,s.k6)(()=>[(0,s.bF)(g,{value:"period"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{slot:"header"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{icon:h.calendarOutline,slot:"start"},null,8,["icon"]),(0,s.bF)(_,null,{default:(0,s.k6)(()=>[e[8]||(e[8]=(0,s.eW)("Период ")),(0,s.Lk)("small",null,(0,i.v_)(p.start_at)+" до "+(0,i.v_)(p.finish_at),1)]),_:1,__:[8]})]),_:1}),(0,s.bF)(k,{slot:"content"},{default:(0,s.k6)(()=>[(0,s.bF)(m,null,{default:(0,s.k6)(()=>[(0,s.bF)(_,null,{default:(0,s.k6)(()=>e[9]||(e[9]=[(0,s.eW)("Начальная дата")])),_:1,__:[9]}),(0,s.Lk)("div",l,[(0,s.bF)(b,{type:"date",modelValue:p.start_at,"onUpdate:modelValue":e[0]||(e[0]=t=>p.start_at=t),onIonInput:e[1]||(e[1]=t=>v.reportGet())},null,8,["modelValue"])])]),_:1}),(0,s.bF)(m,null,{default:(0,s.k6)(()=>[(0,s.bF)(_,null,{default:(0,s.k6)(()=>e[10]||(e[10]=[(0,s.eW)("Конечная дата")])),_:1,__:[10]}),(0,s.Lk)("div",r,[(0,s.bF)(b,{type:"date",modelValue:p.finish_at,"onUpdate:modelValue":e[2]||(e[2]=t=>p.finish_at=t),onIonInput:e[3]||(e[3]=t=>v.reportGet())},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1}),(0,s.Lk)("div",n,[(0,s.bF)(w,{onClick:e[4]||(e[4]=t=>v.reportExport()),color:"medium"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{src:h.downloadOutline},null,8,["src"]),(0,s.bF)(F,null,{default:(0,s.k6)(()=>e[11]||(e[11]=[(0,s.eW)("Скачать")])),_:1,__:[11]})]),_:1}),(0,s.bF)(w,{onClick:e[5]||(e[5]=t=>v.reportGet()),color:"medium"},{default:(0,s.k6)(()=>[(0,s.bF)(f,{src:h.reloadOutline},null,8,["src"]),(0,s.bF)(F,null,{default:(0,s.k6)(()=>e[12]||(e[12]=[(0,s.eW)("Обновить")])),_:1,__:[12]})]),_:1})]),(0,s.bF)(x,{modelValue:p.searchQuery,"onUpdate:modelValue":e[6]||(e[6]=t=>p.searchQuery=t),placeholder:"Поиск по товару",onIonInput:e[7]||(e[7]=t=>v.reportGet()),debounce:"500"},null,8,["modelValue"]),null==p.report?((0,s.uX)(),(0,s.Wv)(k,{key:0},{default:(0,s.k6)(()=>[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)([1,2,3],t=>(0,s.bF)(m,{key:t},{default:(0,s.k6)(()=>[(0,s.bF)(_,{slot:"start"},{default:(0,s.k6)(()=>[(0,s.bF)(L,{animated:"",style:{width:"50px"}})]),_:1}),(0,s.bF)(F,null,{default:(0,s.k6)(()=>[(0,s.bF)(L,{animated:"",style:{width:"100%"}})]),_:1}),(0,s.bF)(F,{slot:"end",color:"success"},{default:(0,s.k6)(()=>[(0,s.bF)(L,{animated:"",style:{width:"50px"}})]),_:1})]),_:2},1024)),64))]),_:1})):p.report.body.length>0?((0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",d,[e[13]||(e[13]=(0,s.Lk)("div",null,"Количество",-1)),(0,s.Lk)("div",null,(0,i.v_)(p.report.head.total_quantity),1),e[14]||(e[14]=(0,s.Lk)("div",null,"Скидка",-1)),(0,s.Lk)("div",null,(0,i.v_)(p.report.head.total_discount),1),e[15]||(e[15]=(0,s.Lk)("div",null,"Сумма",-1)),(0,s.Lk)("div",null,(0,i.v_)(p.report.head.total_sum),1),e[16]||(e[16]=(0,s.Lk)("div",null,"Вознаграждение",-1)),(0,s.Lk)("div",null,(0,i.v_)(p.report.head.total_commission),1),e[17]||(e[17]=(0,s.Lk)("div",null,"К выплате",-1)),(0,s.Lk)("div",null,(0,i.v_)(p.report.head.total_topay),1)]),(0,s.Lk)("div",u,[e[18]||(e[18]=(0,s.Fv)('<div class="table_h" data-v-ccaff9d8><div data-v-ccaff9d8>Время</div><div data-v-ccaff9d8>Заказ №</div><div data-v-ccaff9d8>Товар</div><div data-v-ccaff9d8>Цена</div><div data-v-ccaff9d8>Количество</div><div data-v-ccaff9d8>Скидка</div><div data-v-ccaff9d8>Сумма</div><div data-v-ccaff9d8>Вознаграждение %</div><div data-v-ccaff9d8>Доставка</div><div data-v-ccaff9d8>Оплата</div><div data-v-ccaff9d8>Чек</div></div>',1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p.report.body,(t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"table_r"},[(0,s.Lk)("div",null,(0,i.v_)(t.created_at),1),(0,s.Lk)("div",null,(0,i.v_)(t.order_id),1),(0,s.Lk)("div",null,(0,i.v_)(t.entry_text),1),(0,s.Lk)("div",null,(0,i.v_)(t.entry_price),1),(0,s.Lk)("div",null,(0,i.v_)(t.entry_quantity),1),(0,s.Lk)("div",null,(0,i.v_)(t.entry_discount),1),(0,s.Lk)("div",null,(0,i.v_)(t.entry_sum),1),(0,s.Lk)("div",null,(0,i.v_)(t.fee),1),(0,s.Lk)("div",null,(0,i.v_)(t.delivery),1),(0,s.Lk)("div",null,(0,i.v_)(t.payment_type),1),(0,s.Lk)("div",null,[t.invoice_link?((0,s.uX)(),(0,s.CE)("a",{key:0,href:t.invoice_link,target:"_new"},"онлайн чек",8,c)):(0,s.Q3)("",!0)])]))),128))])])):((0,s.uX)(),(0,s.Wv)(k,{key:2},{default:(0,s.k6)(()=>[(0,s.bF)(m,null,{default:(0,s.k6)(()=>e[19]||(e[19]=[(0,s.eW)(" Нет заказов в данном периоде ")])),_:1,__:[19]})]),_:1}))])}var p=a(5634),v=a(5480),f=a(2311),_=a.n(f),m={components:{IonIcon:p.iq,IonLabel:p.he,IonItem:p.uz,IonInput:p.$w,IonList:p.nf,IonAccordion:p.xk,IonAccordionGroup:p.YH,IonText:p.IO,IonSkeletonText:p.ds,IonSearchbar:p.S1,IonChip:p.ZB},props:["store"],setup(){return{calendarOutline:v.RXF,addOutline:v.EKF,closeCircle:v.P0k,pricetagOutline:v.eOv,downloadOutline:v.fPB,reloadOutline:v.QMU,printOutline:v.SfY}},data(){const t=new Date,e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),1));return{start_at:e.toISOString().slice(0,10),finish_at:t.toISOString().slice(0,10),searchQuery:"",report:null,today:t}},watch:{store:function(){this.reportGet()}},methods:{async reportGet(){var t;if(null===(t=this.store)||void 0===t||!t.store_id)return this.report=null,void(this.head=null);try{var e;const t={store_id:null===(e=this.store)||void 0===e?void 0:e.store_id,start_at:this.start_at,finish_at:this.finish_at,searchQuery:this.searchQuery},a=await _().post(`${this.$heap.state.hostname}Statistics/sellReportProductGet`,t);this.report=a}catch(i){var a,s;const t=null===i||void 0===i||null===(a=i.responseJSON)||void 0===a||null===(s=a.messages)||void 0===s?void 0:s.error;switch(t){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},reportPrint(){window.print()},async reportExport(){var t;if(null===(t=this.store)||void 0===t||!t.store_id)return this.report=null,void(this.head=null);try{var e;const t={store_id:null===(e=this.store)||void 0===e?void 0:e.store_id,start_at:this.start_at,finish_at:this.finish_at,searchQuery:this.searchQuery,output:"xlsx"},a=await _().post(`${this.$heap.state.hostname}Statistics/sellReportProductGet`,t),s=this.store.store_name.replace(/[^\wа-яА-Яa-zA-Z]/gi,""),i=`${this.$heap.state.hostname}Statistics/download/${a}/sellReport_${s}_${this.start_at}.xlsx`,l=document.createElement("a");l.href=i,l.download="download",l.click()}catch(i){var a,s;const t=null===i||void 0===i||null===(a=i.responseJSON)||void 0===a||null===(s=a.messages)||void 0===s?void 0:s.error;switch(t){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки"),console.log(i);break}return this.ledger=[],this.balance=0,!1}},toLocDate(t){const e=new Date(Date.parse(t)),a={month:"short",day:"numeric"};return e.toLocaleDateString(void 0,a)}},mounted(){this.reportGet()}},b=a(6262);const k=(0,b.A)(m,[["render",h],["__scopeId","data-v-ccaff9d8"]]);var g=k},8399:function(t,e,a){a.r(e),a.d(e,{default:function(){return V}});var s=a(641);function i(t,e,a,i,l,r){const n=(0,s.g2)("ion-segment-button"),o=(0,s.g2)("ion-segment"),d=(0,s.g2)("ledger-comp"),u=(0,s.g2)("statistics-seller-report"),c=(0,s.g2)("statistics-seller-analytics"),h=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(h,{pageTitle:"Статистика продавца",pageDefaultBackLink:"/user"},{default:(0,s.k6)(()=>[(0,s.bF)(o,{"swipe-gesture":"true",modelValue:l.activeTab,"onUpdate:modelValue":e[0]||(e[0]=t=>l.activeTab=t)},{default:(0,s.k6)(()=>[(0,s.bF)(n,{value:"sellerAnalytics"},{default:(0,s.k6)(()=>e[1]||(e[1]=[(0,s.eW)(" Аналитика ")])),_:1,__:[1]}),(0,s.bF)(n,{value:"sellerReport"},{default:(0,s.k6)(()=>e[2]||(e[2]=[(0,s.eW)(" Отчет ")])),_:1,__:[2]}),(0,s.bF)(n,{value:"ledger"},{default:(0,s.k6)(()=>e[3]||(e[3]=[(0,s.eW)(" Баланс ")])),_:1,__:[3]})]),_:1},8,["modelValue"]),"ledger"==l.activeTab?((0,s.uX)(),(0,s.Wv)(d,{key:0,permanentTag:"acc::supplier"})):(0,s.Q3)("",!0),"sellerReport"==l.activeTab?((0,s.uX)(),(0,s.Wv)(u,{key:1,store:l.store},null,8,["store"])):(0,s.Q3)("",!0),"sellerAnalytics"==l.activeTab&&l.store?((0,s.uX)(),(0,s.Wv)(c,{key:2,store:l.store},null,8,["store"])):(0,s.Q3)("",!0)]),_:1})}var l=a(5634),r=a(5480),n=a(8062),o=a(5908),d=a(33);const u={class:"horizontalScroller"},c={class:"printDiv"},h={class:"ion-padding-horizontal"},p={class:"printDiv"},v={class:"ion-padding-horizontal"};function f(t,e,a,i,l,r){const n=(0,s.g2)("ion-icon"),o=(0,s.g2)("ion-label"),f=(0,s.g2)("ion-chip"),_=(0,s.g2)("statistics-card"),m=(0,s.g2)("ion-col"),b=(0,s.g2)("ion-row"),k=(0,s.g2)("ion-grid"),g=(0,s.g2)("statistics-funnel"),y=(0,s.g2)("statistics-timeline");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",u,[(0,s.bF)(f,{onClick:e[0]||(e[0]=t=>r.reportPrint()),color:"medium"},{default:(0,s.k6)(()=>[(0,s.bF)(n,{src:i.printOutline},null,8,["src"]),(0,s.bF)(o,null,{default:(0,s.k6)(()=>e[2]||(e[2]=[(0,s.eW)("Напечатать")])),_:1,__:[2]})]),_:1}),(0,s.bF)(f,{onClick:e[1]||(e[1]=t=>r.load()),color:"medium"},{default:(0,s.k6)(()=>[(0,s.bF)(n,{src:i.reloadOutline},null,8,["src"]),(0,s.bF)(o,null,{default:(0,s.k6)(()=>e[3]||(e[3]=[(0,s.eW)("Обновить")])),_:1,__:[3]})]),_:1})]),(0,s.Lk)("div",c,[(0,s.Lk)("div",h,[(0,s.Lk)("h5",null,"Общая статистика "+(0,d.v_)(a.store.store_name??""),1),e[4]||(e[4]=(0,s.Lk)("p",null,"За последние 7 дней",-1))]),(0,s.bF)(k,null,{default:(0,s.k6)(()=>[(0,s.bF)(b,null,{default:(0,s.k6)(()=>[(0,s.bF)(m,{size:"12","size-sm":"6"},{default:(0,s.k6)(()=>[l.dataset.order_count?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Заказы",data:l.dataset.order_count,format:"integer",color:"#008FFB",dates:l.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(m,{size:"12","size-sm":"6"},{default:(0,s.k6)(()=>[l.dataset.order_sum?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Сумма",data:l.dataset.order_sum,format:"currency",color:"#04e398",dates:l.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(m,{size:"12","size-sm":"6"},{default:(0,s.k6)(()=>[l.dataset.order_sum_avg?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Средний чек",data:l.dataset.order_sum_avg,format:"currency",color:"#feba37",dates:l.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(m,{size:"12","size-sm":"6"},{default:(0,s.k6)(()=>[l.dataset.product_quantity?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Товаров продано",data:l.dataset.product_quantity,format:"integer",color:"#c304f9",dates:l.totalDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1})]),_:1})]),_:1})]),(0,s.Lk)("div",p,[(0,s.Lk)("div",v,[(0,s.Lk)("h5",null,"Товарная статистика "+(0,d.v_)(a.store.store_name??""),1),e[5]||(e[5]=(0,s.Lk)("p",null,"За последние 7 дней",-1))]),(0,s.bF)(k,null,{default:(0,s.k6)(()=>[(0,s.bF)(b,null,{default:(0,s.k6)(()=>[(0,s.bF)(m,{size:"12","size-sm":"4"},{default:(0,s.k6)(()=>[l.dataset.product_viewed?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Показы",data:l.dataset.product_viewed,format:"integer",color:"#008FFB",dates:l.productDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(m,{size:"12","size-sm":"4"},{default:(0,s.k6)(()=>[l.dataset.product_added?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Оформление",data:l.dataset.product_added,format:"integer",color:"#04e398",dates:l.productDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(m,{size:"12","size-sm":"4"},{default:(0,s.k6)(()=>[l.dataset.product_purchased?((0,s.uX)(),(0,s.Wv)(_,{key:0,label:"Продано",data:l.dataset.product_purchased,format:"integer",color:"#feba37",dates:l.productDates},null,8,["data","dates"])):(0,s.Q3)("",!0)]),_:1})]),_:1}),(0,s.bF)(b,null,{default:(0,s.k6)(()=>[(0,s.bF)(m,{size:"12","size-sm":"6"},{default:(0,s.k6)(()=>[(0,s.bF)(g,{label:"Воронка продаж",data:l.funnelData},null,8,["data"])]),_:1}),(0,s.bF)(m,{size:"12","size-sm":"6"},{default:(0,s.k6)(()=>[(0,s.bF)(y,{label:"Динамика",data:l.timelineSeries,dates:l.productDates},null,8,["data","dates"])]),_:1})]),_:1})]),_:1})])],64)}a(4114);var _=a(2311),m=a.n(_);const b={style:{"font-size":"22px"}},k={key:1,class:"ion-padding ion-text-center"};function g(t,e,a,i,l,r){const n=(0,s.g2)("ion-card-subtitle"),o=(0,s.g2)("ion-icon"),u=(0,s.g2)("ion-label"),c=(0,s.g2)("ion-chip"),h=(0,s.g2)("ion-card-title"),p=(0,s.g2)("ion-card-header"),v=(0,s.g2)("apexchart"),f=(0,s.g2)("ion-card-content"),_=(0,s.g2)("ion-card");return(0,s.uX)(),(0,s.Wv)(_,{style:{contain:"initial",overflow:"visible"}},{default:(0,s.k6)(()=>[(0,s.bF)(p,{style:{"padding-bottom":"0"}},{default:(0,s.k6)(()=>[(0,s.bF)(n,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(a.label),1)]),_:1}),(0,s.bF)(h,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.Lk)("b",b,(0,d.v_)(r.mainValue),1),a.data.series.length>0?((0,s.uX)(),(0,s.Wv)(c,{key:0,outline:!0,color:r.dynamicsData.color,class:"ion-no-margin",style:{"font-size":"12px",border:"none"}},{default:(0,s.k6)(()=>[(0,s.bF)(o,{icon:r.dynamicsData.icon},null,8,["icon"]),(0,s.bF)(u,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(r.dynamicsData.value)+"%",1)]),_:1})]),_:1},8,["color"])):(0,s.Q3)("",!0)])]),_:1})]),_:1}),(0,s.bF)(f,{class:"ion-no-padding"},{default:(0,s.k6)(()=>[a.data.series.length>1?((0,s.uX)(),(0,s.Wv)(v,{key:0,type:"area",height:"70",options:l.chartOptions,series:l.series,ref:"apexChart"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",k,e[0]||(e[0]=[(0,s.Lk)("h2",null,"Недостаточно данных",-1),(0,s.Lk)("p",null,"для показа статистики",-1)])))]),_:1})]),_:1})}var y=a(5564),F={components:{IonIcon:l.iq,IonLabel:l.he,IonCard:l.b_,IonCardHeader:l.ME,IonCardTitle:l.tN,IonCardSubtitle:l.HW,IonCardContent:l.I9,IonChip:l.ZB,apexchart:y.A},props:["label","data","format","color","dates"],setup(){return{calendarOutline:r.RXF,caretUpOutline:r.rHB,caretDownOutline:r.mF9,caretForwardOutline:r.d2Q}},data(){return{value:0,series:[{name:this.label,data:this.data.series}],chartOptions:{chart:{height:70,type:"area",zoom:{enabled:!1},toolbar:{show:!1},parentHeightOffset:0,sparkline:{enabled:!0}},stroke:{width:2},colors:["#008FFB"],legend:{show:!1},fill:{type:"gradient",gradient:{opacityFrom:.6,opacityTo:.4}},dataLabels:{enabled:!1},grid:{padding:{left:-10,right:-10,top:-15,bottom:-15},yaxis:{lines:{show:!1}}},xaxis:{show:!1,labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1},categories:[]},yaxis:{show:!1,labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}}}}},computed:{mainValue(){const t=this.data.value??0;return"integer"==this.format?new Intl.NumberFormat("ru-RU").format(Math.round(t)):"float"==this.format?new Intl.NumberFormat("ru-RU",{maximumSignificantDigits:2}).format(parseFloat(t).toFixed(2)):"currency"==this.format?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(parseFloat(t).toFixed(2)):null},dynamicsData(){const t=1*this.data.avg??0,e=1*this.data.value??0,a=((e-t)/((e+t)/2)*100||0).toFixed(2);var s="medium",i=r.d2Q;return a>0&&(s="success",i=r.rHB),a<0&&(s="danger",i=r.mF9),{value:a,color:s,icon:i}},datesParsed(){return this.getDates(this.dates)}},methods:{initChart(){this.$refs.apexChart&&this.$refs.apexChart.updateSeries(this.series),this.$refs.apexChart.updateOptions({xaxis:{categories:this.datesParsed}})},getDates(t){let e=[];for(let a=0;a<t.length;a++)e.unshift(new Date(t[a]).toLocaleString("ru",{day:"numeric",month:"long"}));return e}},mounted(){this.chartOptions.colors=[this.color]??0,setTimeout(()=>{this.initChart()},10)},updated(){this.initChart()}},w=a(6262);const x=(0,w.A)(F,[["render",g]]);var L=x;const C={class:"ion-padding-horizontal"},I={key:1,class:"ion-padding ion-text-center"};function S(t,e,a,i,l,r){const n=(0,s.g2)("apexchart");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",C,(0,d.v_)(a.label),1),l.series.length>0?((0,s.uX)(),(0,s.Wv)(n,{key:0,type:"bar",height:"350",options:l.chartOptions,series:l.series,ref:"apexChartElement"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",I,e[0]||(e[0]=[(0,s.Lk)("h2",null,"Недостаточно данных",-1),(0,s.Lk)("p",null,"для показа статистики",-1)])))],64)}var D={components:{apexchart:y.A},props:["label","data","format","color"],setup(){return{}},data(){return{value:0,series:[{name:this.label,data:this.data.series??[]}],chartOptions:{chart:{type:"bar",height:350,zoom:{enabled:!1},toolbar:{show:!1}},plotOptions:{bar:{borderRadius:0,horizontal:!0,barHeight:"80%",isFunnel:!0}},dataLabels:{enabled:!0,formatter:function(t,e){return e.w.globals.labels[e.dataPointIndex]+":  "+t},dropShadow:{enabled:!0}},xaxis:{categories:this.data.labels??[]},legend:{show:!1}}}},methods:{initChart(){this.$refs.apexChartElement&&(this.$refs.apexChartElement.updateSeries([{data:this.data.series}]),this.$refs.apexChartElement.updateOptions({xaxis:{categories:this.data.labels??[]}}))}},mounted(){setTimeout(()=>{this.initChart()},100)},updated(){setTimeout(()=>{this.initChart()},1)}};const O=(0,w.A)(D,[["render",S]]);var z=O;const $={class:"ion-padding-horizontal"},W={key:1,class:"ion-padding ion-text-center"};function X(t,e,a,i,l,r){const n=(0,s.g2)("apexchart");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",$,(0,d.v_)(a.label),1),a.data.length>0?((0,s.uX)(),(0,s.Wv)(n,{key:0,type:"bar",height:"370",options:l.chartOptions,series:l.series,ref:"apexChartElement"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",W,e[0]||(e[0]=[(0,s.Lk)("h2",null,"Недостаточно данных",-1),(0,s.Lk)("p",null,"для показа статистики",-1)])))],64)}var E={components:{apexchart:y.A},props:["label","data","format","color","dates"],setup(){return{}},data(){return{value:0,series:this.data,chartOptions:{chart:{type:"bar",height:350,zoom:{enabled:!1},toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},fill:{opacity:1}}}},computed:{datesParsed(){return this.getDates(this.dates)}},methods:{initChart(){this.$refs.apexChartElement&&(this.$refs.apexChartElement.updateSeries(this.data),this.$refs.apexChartElement.updateOptions({xaxis:{categories:this.datesParsed}}))},getDates(t){let e=[];for(let a=0;a<t.length;a++)e.unshift(new Date(t[a]).toLocaleString("ru",{day:"numeric",month:"long"}));return e}},mounted(){setTimeout(()=>{this.initChart()},100)},updated(){setTimeout(()=>{this.initChart()},1)}};const Q=(0,w.A)(E,[["render",X]]);var T=Q,G={components:{IonGrid:l.lO,IonRow:l.ln,IonCol:l.hU,IonChip:l.ZB,IonLabel:l.he,IonIcon:l.iq,StatisticsCard:L,StatisticsFunnel:z,StatisticsTimeline:T},props:["store"],setup(){return{printOutline:r.SfY,reloadOutline:r.QMU}},data(){return{dataset:{},head:{},body:{},productStatistics:{},funnelData:{},timelineSeries:[],totalDates:[],productDates:[]}},methods:{async parametersGet(){try{const t=await m().post(`${this.$heap.state.hostname}Statistics/sellParametersGet`,{store_id:this.store.store_id,point_span:7,point_num:10});t.body.length>0&&(t.body.reverse(),this.parseStatisticResponse(t),this.totalDates=this.parseDates(t))}catch(a){var t,e;const s=null===a||void 0===a||null===(t=a.responseJSON)||void 0===t||null===(e=t.messages)||void 0===e?void 0:e.error;switch(s){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:console.log(a),this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},async productsGet(){try{const t=await m().post(`${this.$heap.state.hostname}Statistics/sellProductFunnelGet`,{store_id:this.store.store_id,point_span:7,point_num:10});t.body.length>0&&(t.body.reverse(),this.productDates=this.parseDates(t),this.parseStatisticResponse(t),this.parseFunnelData(t),this.parseTimelineData(t))}catch(a){var t,e;const s=null===a||void 0===a||null===(t=a.responseJSON)||void 0===t||null===(e=t.messages)||void 0===e?void 0:e.error;switch(s){case"large_interval":this.$flash("Период должен быть не больше 3 месяцев");break;default:this.$flash("Ошибка получения выписки");break}return this.ledger=[],this.balance=0,!1}},parseStatisticResponse(t){for(var e in t.head.avg)for(var a in this.dataset[e]={avg:t.head.avg[e],value:t.body[t.body.length-1][e],series:[]},t.body)t.body[a][e]&&this.dataset[e].series.push(t.body[a][e])},parseFunnelData(t){this.funnelData={};const e={product_viewed:"Показы",product_added:"Оформления",product_purchased:"Продажи"};this.funnelData={series:[],labels:[]};const a=t.body[t.body.length-1];for(var s in e)this.funnelData.series.push(a[s]),this.funnelData.labels.push(e[s])},parseTimelineData(t){this.timelineSeries=[];const e={product_viewed:"Показы",product_added:"Оформления",product_purchased:"Продажи"};for(var a in this.timelineSeries=[],e)this.timelineSeries.push({name:e[a],data:this.dataset[a].series})},parseDates(t){let e=[];for(var a in t.body)e.unshift(t.body[a].point_finish);return e},async load(){await this.parametersGet(),this.productsGet()},reportPrint(){window.print()}},async mounted(){this.load()}};const A=(0,w.A)(G,[["render",f]]);var R=A,B={components:{IonSegment:l.Gp,IonSegmentButton:l.eP,ledgerComp:n.A,StatisticsSellerReport:o.A,StatisticsSellerAnalytics:R},setup(){return{receiptOutline:r.BVr}},data(){return{activeTab:"sellerAnalytics",storeId:this.$route.params.id,store:null}},mounted(){this.storeGet(this.storeId)},methods:{async storeGet(t){const e={store_id:t};this.store=await m().post(`${this.$heap.state.hostname}Store/itemGet`,e)}}};const P=(0,w.A)(B,[["render",i]]);var V=P}}]);
//# sourceMappingURL=4557.141aba3a.js.map