"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[713],{2713:function(e,t,i){i.r(t),i.d(t,{default:function(){return T}});var o=i(6252),s=i(3577);const n=e=>((0,o.dD)("data-v-45fc76f2"),e=e(),(0,o.Cn)(),e),r=(0,o.Uk)(" Задания "),a=(0,o.Uk)(" Активные "),l=(0,o.Uk)(" Исполненые "),u={key:1,style:{display:"flex","align-items":"center","justify-content":"center",height:"100%"}},d={style:{width:"max-content","text-align":"center"}},c=(0,o.Uk)("Заказов нет"),_=n((()=>(0,o._)("br",null,null,-1)));function m(e,t,i,n,m,f){const p=(0,o.up)("ion-segment-button"),w=(0,o.up)("ion-segment"),h=(0,o.up)("ion-icon"),k=(0,o.up)("ion-avatar"),y=(0,o.up)("ion-text"),g=(0,o.up)("ion-label"),W=(0,o.up)("ion-item"),v=(0,o.up)("ion-list"),b=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(b,{"page-default-back-link":"/home","page-title":"Заказы"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{"swipe-gesture":"true",modelValue:m.orderType,"onUpdate:modelValue":t[0]||(t[0]=e=>m.orderType=e),onIonChange:t[1]||(t[1]=e=>f.listTypeChanged(e))},{default:(0,o.w5)((()=>[m.courierJobsInclude?((0,o.wg)(),(0,o.j4)(p,{key:0,value:"jobs"},{default:(0,o.w5)((()=>[r])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(p,{value:"active"},{default:(0,o.w5)((()=>[a])),_:1}),(0,o.Wm)(p,{value:"done"},{default:(0,o.w5)((()=>[l])),_:1})])),_:1},8,["modelValue"]),m.orderList.length?((0,o.wg)(),(0,o.j4)(v,{key:0},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(f.orderListComputed,(t=>((0,o.wg)(),(0,o.j4)(W,{key:t.order_id,onClick:e=>f.itemClick(t),detail:"",lines:"full"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{slot1:"start"},{default:(0,o.w5)((()=>["customer"==t.user_role?((0,o.wg)(),(0,o.j4)(h,{key:0,src:"./assets/icon/box-delivery.svg"})):(0,o.kq)("",!0),"delivery"==t.user_role?((0,o.wg)(),(0,o.j4)(h,{key:1,src:"./assets/icon/delivery_staying.svg"})):(0,o.kq)("",!0),"admin"==t.user_role?((0,o.wg)(),(0,o.j4)(h,{key:2,src:"./assets/icon/crown.svg"})):(0,o.kq)("",!0),"supplier"==t.user_role?((0,o.wg)(),(0,o.j4)(h,{key:3,icon:n.storefrontOutline,style:{"font-size":"24px"}},null,8,["icon"])):(0,o.kq)("",!0)])),_:2},1024),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{color:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(t.store_name)+" #"+(0,s.zw)(t.order_id)+" ("+(0,s.zw)(t.order_sum_total)+(0,s.zw)(e.$heap.state.currencySign)+")",1)])),_:2},1024),(0,o._)("p",null,[(0,o._)("b",null,(0,s.zw)(t.distance_km),1),(0,o.Uk)((0,s.zw)(t.location_address),1)]),(0,o._)("h4",null,(0,s.zw)(t.stage_current_name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):((0,o.wg)(),(0,o.iD)("div",u,[(0,o._)("div",d,[(0,o.Wm)(h,{icon:n.sparklesOutline,size:"large"},null,8,["icon"]),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[c])),_:1}),_])]))])),_:1})}var f=i(4508),p=i(8903),w=i(7782),h=i(351),k=i(9042),y=i(1933);const g=(0,o.Uk)("Текущее место"),W={class:"center_chip"},v={class:"center_chip"},b={class:"center_chip"},j=(0,o.Uk)("Покупатель"),z=(0,o.Uk)("Покупатель"),C=(0,o.Uk)("Начать доставку");function I(e,t,i,n,r,a){const l=(0,o.up)("ion-icon"),u=(0,o.up)("ion-avatar"),d=(0,o.up)("ion-text"),c=(0,o.up)("ion-label"),_=(0,o.up)("ion-item"),m=(0,o.up)("ion-chip"),f=(0,o.up)("ion-note"),p=(0,o.up)("ion-skeleton-text"),w=(0,o.up)("ion-button"),h=(0,o.up)("ion-title"),k=(0,o.up)("ion-item-group"),y=(0,o.up)("ion-list");return(0,o.wg)(),(0,o.j4)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{icon:n.locationOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{color:"primary"},{default:(0,o.w5)((()=>[g])),_:1})])),_:1})])),_:1}),(0,o.Wm)(_,{lines:"none"},{default:(0,o.w5)((()=>[(0,o._)("div",W,[(0,o.Wm)(m,{color:"success"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(i.order.distance_km),1)])),_:1})])),_:1})])])),_:1}),(0,o.Wm)(_,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{icon:n.storefrontOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,o.Wm)(d,{color:"primary"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(i.order.store_name),1)])),_:1}),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(i.order.location_address),1)])),_:1})])),_:1})])),_:1}),a.start_finish_distance_km?((0,o.wg)(),(0,o.j4)(_,{key:0,lines:"none"},{default:(0,o.w5)((()=>[(0,o._)("div",v,[(0,o.Wm)(m,{color:"success"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(a.start_finish_distance_km),1)])),_:1})])),_:1})])])),_:1})):((0,o.wg)(),(0,o.j4)(_,{key:1,lines:"none"},{default:(0,o.w5)((()=>[(0,o._)("div",b,[(0,o.Wm)(m,{color:"success"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{animated:"",style:{width:"100%"}})])),_:1})])])),_:1})),r.job?((0,o.wg)(),(0,o.j4)(_,{key:2},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{icon:n.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{color:"primary"},{default:(0,o.w5)((()=>[j])),_:1}),(0,o._)("p",null,(0,s.zw)(r.job.finish_location_address),1)])),_:1})])),_:1})):((0,o.wg)(),(0,o.j4)(_,{key:3},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{slot:"start"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{icon:n.flagOutline,style:{"font-size":"30px"}},null,8,["icon"])])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{color:"primary"},{default:(0,o.w5)((()=>[z])),_:1}),(0,o.Wm)(p,{animated:"",style:{width:"60%"}}),(0,o.Wm)(p,{animated:"",style:{width:"80%"}})])),_:1})])),_:1})),r.job?((0,o.wg)(),(0,o.j4)(k,{key:4},{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{style:{"text-align":"center"}},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{onClick:t[0]||(t[0]=e=>a.deliveryStart())},{default:(0,o.w5)((()=>[C])),_:1})])),_:1})])),_:1}),(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Бонус "+(0,s.zw)(r.job.order_sum_shipping),1)])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1})}var L={setup(){return{storefrontOutline:p.qRG,locationOutline:p.Iv7,flagOutline:p.FMn}},props:{order:{}},data(){return{job:null}},mounted(){this.jobGet()},computed:{start_finish_distance_km(){return this.job?.start_finish_distance?Math.round(this.job?.start_finish_distance/1e3)+"км":"-"}},methods:{async jobGet(){try{let e=await w.Z.api.itemJobGet(this.order.order_id);e.finish_location_address=e.finish_location_address.split(",").reverse().join(","),this.job=e}catch(e){const t=e.responseJSON?.messages?.error;"notfound"==t&&this.$flash("Задание не найдено"),"notready"==t&&this.$flash("Смена курьера не открыта")}},async deliveryStart(){const e=h.Z.courier.data.courier_id;try{await w.Z.api.itemJobStart(this.order.order_id,e),y.Z.push("order-"+this.order.order_id)}catch(t){const e=t.responseJSON?.messages?.error;"notfound"==e&&this.$flash("Задание не найдено"),"notready"==e&&this.$flash("Смена курьера не открыта"),"notsearching"!=e&&"idle"!=e||this.$flash("Заданию уже назначен курьер")}k.Z.publish("dismissModal")}}},O=i(3744);const U=(0,O.Z)(L,[["render",I],["__scopeId","data-v-651c3f9a"]]);var Z=U,x={components:{IonSegment:f.cJ,IonSegmentButton:f.GO,IonIcon:f.gu,IonAvatar:f.BJ,IonText:f.yW,IonLabel:f.Q$,IonItem:f.Ie,IonList:f.q_},setup(){return{sparklesOutline:p.Fcs,storefrontOutline:p.qRG,timeOutline:p.bdY}},data(){return{orderList:[],orderType:"active",courierJobsInclude:0,clock:null}},computed:{orderListComputed(){for(let e of this.orderList)e.location_address||(e.location_address=""),e.location_address=e.location_address.split(",").reverse().join(","),e.distance?e.distance_km=Math.round(e.distance/1e3)+"км":e.distance_km="";return this.orderList}},created(){let e=this;k.Z.on("courierStatusChange",(function(){e.courierReadinessCheck()})),e.courierReadinessCheck()},methods:{async listLoad(e){if(this.autoReload(e),"jobs"==e)return void this.listJobLoad();let t="customer_finish";"active"==e&&(t="!customer_finish"),this.orderList=await w.Z.api.listLoad(t)},listTypeChanged(e){const t=e.target.value;this.listLoad(t)},courierReadinessCheck(){this.courierJobsInclude="ready"==h.Z.courier.status?1:0,0==this.courierJobsInclude&&(this.orderType="active")},async listJobLoad(){try{const e=h.Z.courier.data.courier_id;this.orderList=await w.Z.api.listJobGet(e)}catch(e){const t=e.responseJSON?.messages?.error;"notready"==t&&(h.Z.courier.status="notready",this.courierReadinessCheck())}},autoReload(e){clearTimeout(this.clock);const t=this,i=12e4;"jobs"!=e&&"active"!=e||(this.clock=setTimeout((()=>{t.listLoad(e)}),i))},ionViewDidEnter(){this.courierReadinessCheck(),"active"==this.orderType?this.listLoad("active"):this.orderType="active"},ionViewDidLeave(){clearTimeout(this.clock)},async itemClick(e){if(e.is_courier_job){const t=await f.Fy.create({component:Z,componentProps:{order:e},initialBreakpoint:.5,breakpoints:[0,.5,.75]}),i=function(){t.dismiss()};return k.Z.on("dismissModal",i),t.present()}this.itemOpen(e.order_id)},itemOpen(e){y.Z.push(`order-${e}`)}}};const J=(0,O.Z)(x,[["render",m],["__scopeId","data-v-45fc76f2"]]);var T=J}}]);
//# sourceMappingURL=713.bf5caf3c.js.map