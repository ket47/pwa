"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[4236],{4236:function(t,e,i){i.r(e),i.d(e,{default:function(){return h}});var o=i(6252),a=i(3577);function s(t,e,i,s,n,l){const r=(0,o.up)("ion-searchbar"),d=(0,o.up)("ion-img"),c=(0,o.up)("ion-thumbnail"),u=(0,o.up)("ion-text"),m=(0,o.up)("ion-item"),p=(0,o.up)("ion-icon"),h=(0,o.up)("ion-checkbox"),_=(0,o.up)("ion-chip"),g=(0,o.up)("ion-list"),w=(0,o.up)("ion-skeleton-text"),f=(0,o.up)("ion-card-content"),y=(0,o.up)("ion-card"),k=(0,o.up)("ion-infinite-scroll-content"),I=(0,o.up)("ion-infinite-scroll"),b=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(b,{pageDefaultBackLink:`/catalog/store-edit-${n.storeId}`,"page-title":"Управление товарами"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o.Wm)(r,{placeholder:"Фильтр",modelValue:n.filter,"onUpdate:modelValue":e[0]||(e[0]=t=>n.filter=t)},null,8,["modelValue"]),l.listComputed.length>0?((0,o.wg)(),(0,o.j4)(g,{key:0},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.listComputed,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.item_id},[(0,o.Wm)(m,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{slot:"start",class:(0,a.C_)(e.class),onClick:t=>l.itemEdit(e)},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{src:`${t.$heap.state.hostname}image/get.php/${e.image_hash}.150.150.webp`,style:{"border-radius":"10px"}},null,8,["src"])])),_:2},1032,["class","onClick"]),(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.item_name),1)])),_:2},1024)])),_:2},1024),(0,o.Wm)(m,{lines:"full"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{color:"medium"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{src:s.calculatorOutline},null,8,["src"]),(0,o.Wm)(h,{"label-placement":"start",checked:e.is_counted,onIonChange:t=>l.itemUpdate(e.product_id,{is_counted:t.target.checked})},{default:(0,o.w5)((()=>[(0,o.Uk)("учет")])),_:2},1032,["checked","onIonChange"]),(0,o.Uk)("  ")])),_:2},1024),0==e.is_counted?((0,o.wg)(),(0,o.j4)(_,{key:0,color:"medium"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{src:s.infiniteOutline},null,8,["src"])])),_:1})):((0,o.wg)(),(0,o.j4)(_,{key:1,color:e.product_quantity>0?"success":"medium",onClick:t=>l.itemPrompt(e,"product_quantity","введите остаток")},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.product_quantity)+(0,a.zw)(e.product_unit),1)])),_:2},1032,["color","onClick"])),(0,o.Wm)(_,{color:"primary",onClick:t=>l.itemPrompt(e,"product_price","введите цену")},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.product_price)+(0,a.zw)(t.$heap.state.currencySign),1)])),_:2},1032,["onClick"])])),_:2},1024)])))),128))])),_:1})):1==n.is_loading?((0,o.wg)(),(0,o.j4)(g,{key:1},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2,3],(t=>(0,o.Wm)(m,{key:t,button:"",detail:""},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{slot:"start",style:{"background-color":"lightgray"}}),(0,o.Wm)(w,{animated:""})])),_:2},1024))),64))])),_:1})):((0,o.wg)(),(0,o.j4)(y,{key:2,color:"light"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Ничего не найдено ")])),_:1})])),_:1})),(0,o.Wm)(I,{onIonInfinite:e[1]||(e[1]=t=>l.listLoadMore(t)),id:"moderation-infinite-scroll"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{"loading-spinner":"bubbles","loading-text":"Loading more data..."})])),_:1})])])),_:1},8,["pageDefaultBackLink"])}var n=i(4929),l=i(9755),r=i.n(l),d=i(1590),c=i(8903),u={components:{IonInfiniteScroll:n.ju,IonInfiniteScrollContent:n.MB,IonItem:n.Ie,IonLabel:n.Q$,IonList:n.q_,IonSegmentButton:n.GO,IonSegment:n.cJ,IonImg:n.Xz,IonThumbnail:n.Bs,IonText:n.yW,IonSkeletonText:n.CK,IonCard:n.PM,IonCardContent:n.FN,IonSearchbar:n.VI,IonSelect:n.t9,IonSelectOption:n.n0,IonChip:n.hM,IonCheckbox:n.nz,IonIcon:n.gu},setup(){return{infiniteOutline:c.QoN,calculatorOutline:c.ABu}},data(){return{storeId:this.$route.params.id,items:[],item_type:"active",filter:"",is_loading:0,moderationType:"products",holders:{store:"Поставщик",courier:"Курьер",product:"Товар",order:"Заказ",product_group_list:"Категория товара",location_group_list:"Категория местоп.",store_group_list:"Категория поставщ.",user_group_list:"Категория пользователя"}}},computed:{listComputed(){for(let e of this.items){var t;e.image_hash=e.image_hash||e.courier_photo_image_hash,e.item_id=e.image_id||e.store_id||e.courier_id||e.product_id,e.item_name=this.holders[e.image_holder]||(null!==(t=e.store_name)&&void 0!==t?t:e.store_name_new)||e.user_name||e.product_name,e.date_time=this.toLocDateTime(e.updated_at),e.class=e.deleted_at?"deleted":""}return this.items}},methods:{async listLoadMore(t){await this.listLoad(),t.target.complete()},async listReload(){this.items=[],this.listLoad()},async listLoad(){let t={is_disabled:"disabled"==this.item_type?1:0,is_active:"active"==this.item_type?1:0,is_deleted:"deleted"==this.item_type?1:0,name_query:this.filter,offset:this.items.length,limit:15,order:"group_id"};try{let e;if(this.is_loading=1,"products"==this.moderationType){t.name_query_fields="product_name,product_description,product_barcode,product_code",t.reverse="validity",t.store_id=this.storeId;const i=await r().post(`${this.$heap.state.hostname}Product/listGet`,t);e=i.product_list}this.is_loading=0,this.items=this.items.concat(e)}catch(e){}},listTypeChanged(t){t.target.value;this.items=[],this.listLoad()},listFilter(){clearTimeout(this.clock),this.clock=setTimeout((()=>{this.listReload()}),300)},toLocDate(t){const e=new Date(Date.parse(t)),i={month:"short",day:"numeric"};return e.toLocaleDateString(void 0,i)},toLocDateTime(t){const e=new Date(Date.parse(t)),i={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return e.toLocaleDateString(void 0,i)},itemUpdate(t){console.log(t)},async itemPrompt(t,e,i){const o=t[e],a=await n.Cl.create({header:i,buttons:[{text:"Отмена",role:"cancel"},{text:"Ок",role:"confirm"}],inputs:[{type:"input",name:"comment",placeholder:i,value:o}]});await a.present();const{data:s,role:l}=await a.onDidDismiss();if("cancel"==l)return;const d={product_id:t.product_id,[e]:s.values.comment};try{await r().post(`${this.$heap.state.hostname}Product/itemUpdate`,d),this.$flash("Сохранено")}catch(c){this.$flash("Не сохранено")}},itemEdit(t){"images"==this.moderationType&&this.imageEdit(t),"products"==this.moderationType&&this.$go("/catalog/product-edit-"+t.product_id),"stores"==this.moderationType&&this.$go("/catalog/store-edit-"+t.store_id),"couriers"==this.moderationType&&this.$go("/user/courier-dashboard?courier_id="+t.courier_id)},async imageEdit(t){const e={delete:["Удалить","danger"],postpone:["Потом","primary"],enable:["Ок","success"]},i=await n.Fy.create({component:d.Z,componentProps:{image_hash:t.image_hash,actions:e},initialBreakpoint:.75,breakpoints:[.75,1]});this.$topic.on("dismissModal",(()=>{i.dismiss()})),i.present();const o=await i.onDidDismiss();"delete"==o.role&&await this.imageDelete(t),"enable"==o.role&&await this.imageEnable(t),"postpone"==o.role&&await this.imagePostpone(t),this.listReload()},async imageEnable(t){await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:t.image_id,is_disabled:0})},async imagePostpone(t){await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:t.image_id,is_disabled:0}),await r().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:t.image_id,is_disabled:1})},async imageDelete(t){await r().post(`${this.$heap.state.hostname}Image/itemDelete`,{image_id:t.image_id})}},mounted(){this.listLoad()},watch:{filter:function(){this.listFilter()}}},m=i(3744);const p=(0,m.Z)(u,[["render",s],["__scopeId","data-v-c7cc0c30"]]);var h=p}}]);
//# sourceMappingURL=4236.7130efd5.js.map