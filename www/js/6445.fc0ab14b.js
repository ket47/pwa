"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[6445],{6445:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var o=a(6252),n=a(3577),i=a(9963);const l={key:2},s={class:"is_main"};function r(t,e,a,r,c,u){const d=(0,o.up)("ion-icon"),m=(0,o.up)("ion-toggle"),h=(0,o.up)("ion-item"),p=(0,o.up)("ion-list"),_=(0,o.up)("ion-skeleton-text"),g=(0,o.up)("ion-img"),f=(0,o.up)("ion-label"),w=(0,o.up)("ion-button"),k=(0,o.up)("ion-fab"),y=(0,o.up)("base-layout");return(0,o.wg)(),(0,o.j4)(y,{pageTitle:"Мои способы оплаты"},{default:(0,o.w5)((()=>{var t;return[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{lines:"none"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{src:r.cardOutline,slot:"start"},null,8,["src"]),(0,o.Wm)(m,{modelValue:c.enable_auto_cof,"onUpdate:modelValue":e[0]||(e[0]=t=>c.enable_auto_cof=t),onIonChange:e[1]||(e[1]=t=>u.saveAutoCof())},{default:(0,o.w5)((()=>[(0,o.Uk)(" Автоматически сохранять карты ")])),_:1},8,["modelValue"])])),_:1})])),_:1}),null==c.cardList?((0,o.wg)(),(0,o.j4)(p,{key:0},{default:(0,o.w5)((()=>[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)([1,2],(t=>(0,o.Wm)(h,{key:t},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{style:{"background-color":"var(--ion-color-light)"},slot:"start"}),(0,o.Wm)(_,{animated:"",style:{width:"100%"}}),(0,o.Wm)(d,{style:{"background-color":"var(--ion-color-light)"},slot:"end"})])),_:2},1024))),64))])),_:1})):(null===(t=c.cardList)||void 0===t?void 0:t.length)>0?((0,o.wg)(),(0,o.j4)(p,{key:1},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(c.cardList,((t,e)=>((0,o.wg)(),(0,o.j4)(h,{key:t.order_id,button:"","detail-icon":"",onClick:a=>0!=e&&u.itemMainSet(t.card_id)},{default:(0,o.w5)((()=>[t.card_type?((0,o.wg)(),(0,o.j4)(g,{key:0,class:"card_type",src:`/img/icons/card-${t.card_type}.svg`,slot:"start"},null,8,["src"])):((0,o.wg)(),(0,o.j4)(d,{key:1,src:r.cardOutline,slot:"start",color:"primary"},null,8,["src"])),0==e?((0,o.wg)(),(0,o.iD)("div",l,[(0,o._)("h6",s,(0,n.zw)(t.label),1),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Основной способ")])),_:1})])):((0,o.wg)(),(0,o.j4)(f,{key:3,color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(t.label),1)])),_:2},1024)),(0,o.Wm)(d,{icon:r.trashOutline,slot:"end",onClick:(0,i.iM)((e=>u.itemDelete(t.card_id)),["stop"])},null,8,["icon","onClick"])])),_:2},1032,["onClick"])))),128))])),_:1})):((0,o.wg)(),(0,o.j4)(p,{key:2},{default:(0,o.w5)((()=>[(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{color:"medium"},{default:(0,o.w5)((()=>[(0,o.Uk)("Сохраненных карт нет")])),_:1})])),_:1})])),_:1})),(0,o.Wm)(h,{lines:"none",onClick:e[2]||(e[2]=t=>u.cardRegistrationOpen()),button:"","detail-icon":""},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{icon:r.addOutline,slot:"start"},null,8,["icon"]),(0,o.Uk)(" Добавить карту ")])),_:1}),(0,o.Wm)(k,{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{color:"light",onClick:e[3]||(e[3]=t=>u.cardRegistrationCheck())},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{icon:r.refreshOutline,slot:"start"},null,8,["icon"]),(0,o.Uk)(" обновить ")])),_:1})])),_:1})]})),_:1})}var c=a(4929),u=a(8903),d=a(9914),m=a(9042),h=a(9755),p=a.n(h),_={components:{IonList:c.q_,IonItem:c.Ie,IonSkeletonText:c.CK,IonLabel:c.Q$,IonIcon:c.gu,IonImg:c.Xz,IonFab:c.IJ,IonButton:c.YG,IonToggle:c.ho},setup(){return{cardOutline:u.pvm,addOutline:u.s6O,trashOutline:u.gtu,refreshOutline:u.D3P,saveOutline:u.Z8j}},data(){return{cardList:null,isOpen:!1,enable_auto_cof:1==localStorage.disable_auto_cof?0:1}},methods:{async listGet(){try{let t=await p().post(this.$heap.state.hostname+"UserCards/listGet");if(t&&t.length>0)for(let e in t)t[e].label=`${t[e].card_type.toUpperCase()} - ${t[e].card_mask.split("*").pop()}`;this.cardList=t}catch{}},async itemMainSet(t){const e={card_id:t};try{await p().post(`${this.$heap.state.hostname}UserCards/itemMainSet`,e),this.$topic.publish("userMainPaymentMethodSet"),this.listGet()}catch{}},async itemDelete(t){if(!confirm("Вы уверенны?"))return;const e={card_id:t};try{await p().post(`${this.$heap.state.hostname}UserCards/itemDelete`,e),this.listGet()}catch{this.$flash("Не удалось открепить карту")}},saveAutoCof(){localStorage.disable_auto_cof=this.enable_auto_cof?0:1},async cardRegistrationOpen(){const t=document.querySelector("ion-router-outlet"),e="card_registering",a=this,o=await c.Fy.create({component:d.Z,componentProps:{order_data:e},presentingElement:t}),n=function(){o.dismiss()};return m.Z.on("dismissModal",n),o.onDidDismiss().then((()=>{a.cardRegistrationCheck()})),o.present()},async cardRegistrationCheck(){try{const t=await p().post(this.$heap.state.hostname+"CardAcquirer/cardRegisteredSync");"ok"==t&&(this.listGet(),this.$topic.publish("userMainPaymentMethodSet"))}catch(t){}}},mounted(){this.listGet()}},g=a(3744);const f=(0,g.Z)(_,[["render",r],["__scopeId","data-v-642e1692"]]);var w=f}}]);
//# sourceMappingURL=6445.fc0ab14b.js.map