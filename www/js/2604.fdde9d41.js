"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2604],{2604:function(e,t,i){i.r(t),i.d(t,{default:function(){return k}});i(8111),i(2489);var a=i(641),s=i(33);const l=["href"],o=["href"];function d(e,t,i,d,n,r){const u=(0,a.g2)("ion-segment-button"),_=(0,a.g2)("ion-segment"),m=(0,a.g2)("ion-card-content"),p=(0,a.g2)("ion-card"),c=(0,a.g2)("ion-searchbar"),h=(0,a.g2)("ion-icon"),k=(0,a.g2)("ion-text"),b=(0,a.g2)("ion-item"),g=(0,a.g2)("ion-label"),f=(0,a.g2)("ion-chip"),y=(0,a.g2)("ion-list"),v=(0,a.g2)("ion-img"),F=(0,a.g2)("ion-avatar"),C=(0,a.g2)("ion-thumbnail"),W=(0,a.g2)("ion-skeleton-text"),I=(0,a.g2)("ion-infinite-scroll-content"),$=(0,a.g2)("ion-infinite-scroll"),T=(0,a.g2)("base-layout");return(0,a.uX)(),(0,a.Wv)(T,{pageDefaultBackLink:"/user","page-title":"Элементы"},{default:(0,a.k6)(()=>[(0,a.bF)(_,{scrollable:!0,modelValue:n.moderationType,"onUpdate:modelValue":t[6]||(t[6]=e=>n.moderationType=e),onIonChange:t[7]||(t[7]=e=>r.listTypeChanged(e)),disabled:n.is_loading},{default:(0,a.k6)(()=>[(0,a.bF)(u,{value:"images",onClick:t[0]||(t[0]=e=>n.item_type="disabled")},{default:(0,a.k6)(()=>t[17]||(t[17]=[(0,a.eW)(" Картинки ")])),_:1,__:[17]}),(0,a.bF)(u,{value:"posts",onClick:t[1]||(t[1]=e=>n.item_type="disabled")},{default:(0,a.k6)(()=>t[18]||(t[18]=[(0,a.eW)(" Посты ")])),_:1,__:[18]}),(0,a.bF)(u,{value:"products",onClick:t[2]||(t[2]=e=>n.item_type="disabled")},{default:(0,a.k6)(()=>t[19]||(t[19]=[(0,a.eW)(" Товары ")])),_:1,__:[19]}),(0,a.bF)(u,{value:"stores",onClick:t[3]||(t[3]=e=>n.item_type="disabled")},{default:(0,a.k6)(()=>t[20]||(t[20]=[(0,a.eW)(" Магазины ")])),_:1,__:[20]}),(0,a.bF)(u,{value:"users",onClick:t[4]||(t[4]=e=>n.item_type="active")},{default:(0,a.k6)(()=>t[21]||(t[21]=[(0,a.eW)(" Пользователи ")])),_:1,__:[21]}),(0,a.bF)(u,{value:"couriers",onClick:t[5]||(t[5]=e=>n.item_type="disabled")},{default:(0,a.k6)(()=>t[22]||(t[22]=[(0,a.eW)(" Курьеры ")])),_:1,__:[22]})]),_:1},8,["modelValue","disabled"]),(0,a.Lk)("div",null,[(0,a.bF)(p,null,{default:(0,a.k6)(()=>[(0,a.bF)(m,null,{default:(0,a.k6)(()=>[(0,a.bF)(_,{mode:"ios",scrollable:!0,modelValue:n.item_type,"onUpdate:modelValue":t[8]||(t[8]=e=>n.item_type=e),value:"disabled",label:"Тип элементов","label-placement":"stacked",onIonChange:t[9]||(t[9]=e=>r.listReload()),color:"primary"},{default:(0,a.k6)(()=>[(0,a.bF)(u,{value:"active"},{default:(0,a.k6)(()=>t[23]||(t[23]=[(0,a.eW)(" активные ")])),_:1,__:[23]}),(0,a.bF)(u,{value:"disabled"},{default:(0,a.k6)(()=>t[24]||(t[24]=[(0,a.eW)(" выключенные ")])),_:1,__:[24]}),(0,a.bF)(u,{value:"deleted"},{default:(0,a.k6)(()=>t[25]||(t[25]=[(0,a.eW)(" удаленные ")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),["posts","stores","products","couriers","users","pcodes"].includes(n.moderationType)?((0,a.uX)(),(0,a.Wv)(c,{key:0,placeholder:"Фильтр",modelValue:n.filter,"onUpdate:modelValue":t[10]||(t[10]=e=>n.filter=e)},null,8,["modelValue"])):(0,a.Q3)("",!0),"pcodes"==n.moderationType?((0,a.uX)(),(0,a.Wv)(y,{key:1},{default:(0,a.k6)(()=>[(0,a.bF)(b,{button:"",detail:"",onClick:t[11]||(t[11]=e=>r.itemEdit({promo_code_id:0}))},{default:(0,a.k6)(()=>[(0,a.bF)(h,{src:d.addOutline,slot:"start"},null,8,["src"]),(0,a.bF)(k,null,{default:(0,a.k6)(()=>t[26]||(t[26]=[(0,a.eW)("Добавить промокод")])),_:1,__:[26]})]),_:1}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.listComputed,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.item_id},[(0,a.bF)(b,{button:"",detail:"",onClick:t=>r.itemEdit(e),lines:"none"},{default:(0,a.k6)(()=>[(0,a.bF)(k,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(e.item_name),1)]),_:2},1024),(0,a.bF)(g,{slot:"end"},{default:(0,a.k6)(()=>[(0,a.eW)("до "+(0,s.v_)(e.date_dmy),1)]),_:2},1024)]),_:2},1032,["onClick"]),(0,a.bF)(b,null,{default:(0,a.k6)(()=>[(0,a.bF)(f,{color:"primary"},{default:(0,a.k6)(()=>[(0,a.bF)(h,{src:d.callOutline},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)(()=>[(0,a.Lk)("a",{href:`tel:${e.user_phone}`},(0,s.v_)(e.user_phone),9,l)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):(0,a.Q3)("",!0),"users"==n.moderationType?((0,a.uX)(),(0,a.Wv)(y,{key:2},{default:(0,a.k6)(()=>[(0,a.bF)(b,{button:"",detail:"",onClick:t[12]||(t[12]=e=>r.itemEdit({user_id:0}))},{default:(0,a.k6)(()=>[(0,a.bF)(h,{src:d.addOutline,slot:"start"},null,8,["src"]),(0,a.bF)(k,null,{default:(0,a.k6)(()=>t[27]||(t[27]=[(0,a.eW)("Добавить нового пользователя")])),_:1,__:[27]})]),_:1}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.listComputed,t=>((0,a.uX)(),(0,a.CE)("div",{key:t.item_id},[(0,a.bF)(b,{button:"",detail:"",onClick:e=>r.itemEdit(t),lines:"none"},{default:(0,a.k6)(()=>[(0,a.bF)(F,{slot:"start"},{default:(0,a.k6)(()=>[t.user_avatar_name?((0,a.uX)(),(0,a.Wv)(v,{key:0,src:`${e.$heap.state.settings.app.backendUrl}img/avatar/${t.user_avatar_name}.png`},null,8,["src"])):(0,a.Q3)("",!0)]),_:2},1024),(0,a.bF)(k,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(t.item_name),1)]),_:2},1024),(0,a.bF)(g,{slot:"end"},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(t.date_dmy),1)]),_:2},1024)]),_:2},1032,["onClick"]),(0,a.bF)(b,null,{default:(0,a.k6)(()=>[(0,a.bF)(f,{color:"primary"},{default:(0,a.k6)(()=>[(0,a.bF)(h,{src:d.callOutline},null,8,["src"]),(0,a.bF)(g,null,{default:(0,a.k6)(()=>[(0,a.Lk)("a",{href:`tel:${t.user_phone}`},(0,s.v_)(t.user_phone),9,o)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):"posts"==n.moderationType?((0,a.uX)(),(0,a.Wv)(y,{key:3},{default:(0,a.k6)(()=>[(0,a.bF)(b,{button:"",detail:"",onClick:t[13]||(t[13]=e=>r.itemEdit({post_id:0}))},{default:(0,a.k6)(()=>[(0,a.bF)(h,{src:d.addOutline,slot:"start"},null,8,["src"]),(0,a.bF)(k,null,{default:(0,a.k6)(()=>t[28]||(t[28]=[(0,a.eW)("Добавить новый пост")])),_:1,__:[28]})]),_:1}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.listComputed,t=>((0,a.uX)(),(0,a.CE)("div",{key:t.item_id},[(0,a.bF)(b,{button:"",detail:"",onClick:e=>r.itemEdit(t),lines:"none"},{default:(0,a.k6)(()=>[t.image_hash?((0,a.uX)(),(0,a.Wv)(v,{key:0,slot:"start",class:(0,s.C4)(t.class),src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.50.50.webp`},null,8,["class","src"])):(0,a.Q3)("",!0),(0,a.bF)(k,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(t.item_name),1)]),_:2},1024),(0,a.bF)(g,{slot:"end"},{default:(0,a.k6)(()=>[(0,a.eW)("до "+(0,s.v_)(t.date_dmy),1)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),_:1})):"products"==n.moderationType?((0,a.uX)(),(0,a.Wv)(y,{key:4},{default:(0,a.k6)(()=>[(0,a.bF)(b,null,{default:(0,a.k6)(()=>[(0,a.bF)(_,{scrollable:!0,modelValue:n.productType,"onUpdate:modelValue":t[14]||(t[14]=e=>n.productType=e),mode:"ios",onIonChange:t[15]||(t[15]=e=>r.listReload())},{default:(0,a.k6)(()=>[(0,a.bF)(u,{value:"all"},{default:(0,a.k6)(()=>t[29]||(t[29]=[(0,a.eW)(" все ")])),_:1,__:[29]}),(0,a.bF)(u,{value:"promo"},{default:(0,a.k6)(()=>t[30]||(t[30]=[(0,a.eW)(" акция ")])),_:1,__:[30]})]),_:1},8,["modelValue"])]),_:1}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.listComputed,i=>((0,a.uX)(),(0,a.CE)("div",{key:i.item_id},[(0,a.bF)(b,{button:"",onClick:e=>r.itemEdit(i),lines:"none"},{default:(0,a.k6)(()=>[i.image_hash?((0,a.uX)(),(0,a.Wv)(C,{key:0,slot:"start",class:(0,s.C4)(i.class)},{default:(0,a.k6)(()=>[(0,a.bF)(v,{src:`${e.$heap.state.hostname}image/get.php/${i.image_hash}.150.150.webp`},null,8,["src"])]),_:2},1032,["class"])):(0,a.Q3)("",!0),(0,a.bF)(k,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(i.item_name)+" ",1),i.product_price!=i.product_final_price?((0,a.uX)(),(0,a.Wv)(f,{key:0,color:"success"},{default:(0,a.k6)(()=>t[31]||(t[31]=[(0,a.eW)("%")])),_:1,__:[31]})):(0,a.Q3)("",!0)]),_:2},1024),(0,a.bF)(f,{slot:"end",color:"light"},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(i.validity)+"%",1)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),_:1})):((0,a.uX)(),(0,a.Wv)(y,{key:5},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.listComputed,t=>((0,a.uX)(),(0,a.Wv)(b,{key:t.item_id,button:"",detail:"",onClick:e=>r.itemEdit(t)},{default:(0,a.k6)(()=>[t.image_hash?((0,a.uX)(),(0,a.Wv)(C,{key:0,slot:"start",class:(0,s.C4)(t.class)},{default:(0,a.k6)(()=>[(0,a.bF)(v,{src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])]),_:2},1032,["class"])):(0,a.Q3)("",!0),(0,a.bF)(k,null,{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(t.item_name),1)]),_:2},1024),(0,a.bF)(g,{slot:"end"},{default:(0,a.k6)(()=>[(0,a.eW)((0,s.v_)(t.date_time),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),1==n.is_loading?((0,a.uX)(),(0,a.Wv)(y,{key:6},{default:(0,a.k6)(()=>[((0,a.uX)(),(0,a.CE)(a.FK,null,(0,a.pI)([1,2,3],e=>(0,a.bF)(b,{key:e,button:"",detail:""},{default:(0,a.k6)(()=>[(0,a.bF)(C,{slot:"start",style:{"background-color":"lightgray"}}),(0,a.bF)(W,{animated:""})]),_:2},1024)),64))]),_:1})):0==r.listComputed.length?((0,a.uX)(),(0,a.Wv)(p,{key:7,color:"light"},{default:(0,a.k6)(()=>[(0,a.bF)(m,null,{default:(0,a.k6)(()=>t[32]||(t[32]=[(0,a.eW)(" Ничего не найдено ")])),_:1,__:[32]})]),_:1})):(0,a.Q3)("",!0),(0,a.bF)($,{onIonInfinite:t[16]||(t[16]=e=>r.listLoadMore(e)),id:"moderation-infinite-scroll"},{default:(0,a.k6)(()=>[(0,a.bF)(I,{"loading-spinner":"bubbles","loading-text":"Загрузка"})]),_:1})])]),_:1})}var n=i(5634),r=i(2311),u=i.n(r),_=i(9119),m=i(5480),p={components:{IonInfiniteScroll:n.Ax,IonInfiniteScrollContent:n.Hp,IonItem:n.uz,IonLabel:n.he,IonList:n.nf,IonSegmentButton:n.eP,IonSegment:n.Gp,IonImg:n.KW,IonThumbnail:n.Zx,IonText:n.IO,IonSkeletonText:n.ds,IonCard:n.b_,IonCardContent:n.I9,IonSearchbar:n.S1,IonChip:n.ZB,IonAvatar:n.mC,IonIcon:n.iq},setup(){return{addOutline:m.EKF,callOutline:m.bNN}},data(){return{items:[],item_type:"disabled",filter:"",is_loading:0,is_items_left:1,moderationType:localStorage.listModerationLastType||"images",productType:"all",holders:{store:"Поставщик",courier:"Курьер",product:"Товар",order:"Заказ",product_group_list:"Категория товара",location_group_list:"Категория местоп.",store_group_list:"Категория поставщ.",user_group_list:"Категория пользователя"}}},computed:{listComputed(){for(let e of this.items)e.image_hash=e.image_hash||e.courier_photo_image_hash,e.item_id=e.image_id||e.store_id||e.courier_id||e.product_id||e.post_id,e.item_name=this.holders[e.image_holder]||(e.store_name??e.store_name_new)||e.user_name||e.product_name||e.post_title+("story"==e.post_type?" (История)":"slide"==e.post_type?"  (Слайд)":""),e.date_time=this.toLocDateTime(e.updated_at),e.date_dmy=this.toDmy(e.finished_at||e.updated_at),e.class=e.deleted_at?"deleted":"";return this.items}},methods:{async listLoadMore(e){this.is_items_left&&await this.listLoad(),e.target.complete()},async listReload(){this.is_items_left=1,this.items=[],await this.listLoad()},async listLoad(){if(1==this.is_loading)return;this.is_loading=1;let e={is_disabled:"disabled"==this.item_type?1:0,is_active:"active"==this.item_type?1:0,is_deleted:"deleted"==this.item_type?1:0,name_query:this.filter,offset:this.items.length,limit:15};try{let t;if("images"==this.moderationType)e.order="updated_at",t=await u().post(`${this.$heap.state.hostname}Image/listGet`,e);else if("posts"==this.moderationType){e.name_query_fields="post_title,post_content",e.order="updated_at";const i=await u().post(`${this.$heap.state.hostname}Post/listGet`,e);t=i.post_list}else if("products"==this.moderationType){e.name_query_fields="product_name,product_description,product_barcode,product_code",e.reverse="validity",e.is_hidden=0,"promo"==this.productType&&(e.is_promo=1);const i=await u().post(`${this.$heap.state.hostname}Product/listGet`,e);t=i.product_list}else"stores"==this.moderationType?(e.name_query_fields="store_name,store_description",e.reverse="validity",t=await u().post(`${this.$heap.state.hostname}Store/listGet`,e)):"couriers"==this.moderationType?(e.name_query_fields="courier_vehicle,user_phone,user_name",e.order="courier_list.updated_at",t=await u().post(`${this.$heap.state.hostname}Courier/listGet`,e)):"users"==this.moderationType&&(e.name_query_fields="user_phone,user_name",e.order="signed_in_at",t=await u().post(`${this.$heap.state.hostname}User/listGet`,e));this.is_loading=0,this.items=this.items.concat(t),t.length<e.limit&&(this.is_items_left=0)}catch(t){}},listTypeChanged(e){localStorage.listModerationLastType=e.target.value,this.items=[],this.is_items_left=1,this.listLoad()},listFilter(){clearTimeout(this.clock),this.clock=setTimeout(()=>{this.listReload()},300)},toLocDate(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric"};return t.toLocaleDateString(void 0,i)},toLocDateTime(e){const t=new Date(Date.parse(e)),i={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return t.toLocaleDateString(void 0,i)},toDmy(e){try{return e.split(" ")[0].split("-").reverse().join(".")}catch{return""}},itemEdit(e){"images"==this.moderationType&&this.imageEdit(e),"posts"==this.moderationType&&this.$go("/wall/post-user-edit-"+e.post_id),"products"==this.moderationType&&this.$go("/catalog/product-edit-"+e.product_id),"stores"==this.moderationType&&this.$go("/catalog/store-edit-"+e.store_id),"couriers"==this.moderationType&&this.$go("/user/courier-dashboard?courier_id="+e.courier_id),"users"==this.moderationType&&this.$go("/user/user-management?user_id="+e.user_id)},async imageEdit(e){const t={delete:["Удалить","danger"],postpone:["Потом","primary"],enable:["Ок","success"]},i=await n.OZ.create({component:_.A,componentProps:{image_hash:e.image_hash,actions:t},initialBreakpoint:.75,breakpoints:[.75,1]});this.$topic.on("dismissModal",()=>{i.dismiss()}),i.present();const a=await i.onDidDismiss();"delete"==a.role&&await this.imageDelete(e),"enable"==a.role&&await this.imageEnable(e),"postpone"==a.role&&await this.imagePostpone(e),await this.listReload()},async imageEnable(e){await u().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0})},async imagePostpone(e){await u().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:0}),await u().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:e.image_id,is_disabled:1})},async imageDelete(e){await u().post(`${this.$heap.state.hostname}Image/itemDelete`,{image_id:e.image_id})}},mounted(){this.moderationType,this.listLoad()},watch:{filter:function(){this.listFilter()}},ionViewDidEnter(){this.listReload()}},c=i(6262);const h=(0,c.A)(p,[["render",d],["__scopeId","data-v-25306d51"]]);var k=h}}]);
//# sourceMappingURL=2604.fdde9d41.js.map