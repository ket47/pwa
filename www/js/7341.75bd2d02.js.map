{"version":3,"file":"js/7341.75bd2d02.js","mappings":"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","sources":["webpack://tezkel/./src/views/ShipmentDraftView.vue","webpack://tezkel/./src/views/ShipmentDraftView.vue?ac34"],"sourcesContent":["<template>\r\n    <base-layout page-title=\"Вызов курьера\">\r\n        <shipment-draft-comp :orderData=\"order\" @stageCreate=\"onStageCreate\" @orderUpdate=\"itemUpdate\" @locationUpdate=\"locationUpdate\"/>\r\n    </base-layout>\r\n</template>\r\n<script>\r\n\r\nimport jQuery           from \"jquery\";\r\nimport ShipmentDraftComp          from '@/components/ShipmentDraftComp.vue';\r\n\r\nexport default {\r\n    components:{\r\n        ShipmentDraftComp,\r\n    },\r\n    data(){\r\n        return{\r\n            order:null,\r\n            errorCode:null\r\n        }\r\n    },\r\n    methods:{\r\n        async itemCreate(){\r\n            const date=new Date()\r\n            const draft={\r\n                order_store_id:null,\r\n                order_id:0,\r\n                entries:[],\r\n                created_at:date.toISOString().replace(/[T]/g,' ').replace(/.\\d\\d\\dZ/,''),\r\n                stage_next:{\r\n                    \"customer_confirmed\": [\"Перейти к оформлению\"],\r\n                    \"customer_deleted\": [\"Удалить\",\"danger\",\"clear\"],\r\n                },\r\n                stage_current:'customer_cart',\r\n                user_role:'customer',\r\n            }\r\n            this.itemSave(draft)\r\n        },\r\n        async itemLoad(){\r\n            try{\r\n                const storedOrder=JSON.parse(localStorage.shipmentDraft)\r\n                if( storedOrder && this.$heap.getters.userIsLogged ){\r\n                    storedOrder.deliveryCalculation=await this.itemTotalEstimate(storedOrder.order_start_location_id,storedOrder.order_finish_location_id)\r\n                    this.order=storedOrder\r\n                    return\r\n                }\r\n            }catch{/** */}\r\n            this.itemCreate()\r\n        },\r\n        itemSave( order ){\r\n            this.order=order\r\n            localStorage.shipmentDraft=JSON.stringify(Object.assign({},order,{order_id:0}))\r\n        },\r\n        async itemUpdate( orderUpdate ){\r\n            console.log(orderUpdate.mode,orderUpdate.order_start_location_id,orderUpdate.order_finish_location_id)\r\n            if( orderUpdate.mode=='refreshTotalEstimates' ){\r\n                orderUpdate.deliveryCalculation=await this.itemTotalEstimate( orderUpdate.order_start_location_id, orderUpdate.order_finish_location_id )\r\n            }\r\n            this.itemSave(Object.assign({},this.order,orderUpdate))\r\n        },\r\n        async locationUpdate(locationUpdate){\r\n            try{\r\n                await jQuery.post(`${this.$heap.state.hostname}Location/itemUpdate`,JSON.stringify(locationUpdate))\r\n                this.$flash(\"сохранено\")\r\n            }catch{/** */}\r\n        },\r\n        async itemTotalEstimate(start_location_id,finish_location_id){\r\n            if(!start_location_id || !finish_location_id){\r\n                return\r\n            }\r\n            const request={\r\n                start_location_id,finish_location_id\r\n            }\r\n            try{\r\n                return await jQuery.post(`${this.$heap.state.hostname}Shipment/itemDeliverySumEstimate`,request)\r\n            } catch(err){/** */}\r\n        },\r\n        async onStageCreate(order_id, order_stage_code){\r\n            if(order_stage_code=='customer_purged' || order_stage_code=='customer_deleted' ){\r\n                localStorage.removeItem('shipmentDraft');\r\n                this.$router.replace(`/order/order-list`)\r\n                try{\r\n                    const request={\r\n                        order_id:this.order.order_id,\r\n                        new_stage:order_stage_code\r\n                    }\r\n                    await jQuery.post(`${this.$heap.state.hostname}Shipment/itemStageCreate`,request);\r\n                }catch{/** */}\r\n                return\r\n            }\r\n            if(order_stage_code=='customer_action_confirm'){\r\n                order_stage_code='customer_confirmed'\r\n            }\r\n            try{\r\n                const request={\r\n                    is_shopping:0,\r\n                    order_id:this.order.order_id??null,\r\n                    order_description:this.order.order_description,\r\n                    order_start_location_id:this.order.order_start_location_id,\r\n                    order_finish_location_id:this.order.order_finish_location_id,\r\n                    order_sum_delivery:this.order.deliveryCalculation.sum\r\n                }\r\n                const order_id = await jQuery.post(`${this.$heap.state.hostname}Shipment/itemSync`,JSON.stringify(request))\r\n                if( order_id>0 ){\r\n                    this.$router.push(`/modal/shipment-checkout-${order_id}`)\r\n                }\r\n            } catch(err){\r\n                const exception_code=err?.responseJSON?.messages?.error;\r\n                if(!exception_code){\r\n                    return false;\r\n                }\r\n                switch(exception_code){\r\n                    case 'address_not_set':\r\n                        this.$flash(\"Необходимо добавить адрес доставки\")\r\n                        this.$topic.publish('dismissModal')\r\n                        this.$go('/modal/user-addresses')\r\n                        this.$heap.state.next_route='/order/order-'+order_id;\r\n                        break;\r\n                }\r\n                return false\r\n            }\r\n        },\r\n    },\r\n    mounted(){\r\n        this.itemLoad()\r\n    }\r\n}\r\n</script>","import { render } from \"./ShipmentDraftView.vue?vue&type=template&id=7763e6d6\"\nimport script from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\nexport * from \"./ShipmentDraftView.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createBlock","_component_base_layout","_createVNode","_component_shipment_draft_comp","orderData","$data","order","onStageCreate","$options","onOrderUpdate","itemUpdate","onLocationUpdate","locationUpdate","components","ShipmentDraftComp","data","errorCode","methods","itemCreate","date","Date","draft","order_store_id","order_id","entries","created_at","toISOString","replace","stage_next","stage_current","user_role","this","itemSave","itemLoad","storedOrder","JSON","parse","localStorage","shipmentDraft","$heap","getters","userIsLogged","deliveryCalculation","itemTotalEstimate","order_start_location_id","order_finish_location_id","stringify","Object","assign","orderUpdate","console","log","mode","jQuery","state","hostname","$flash","start_location_id","finish_location_id","request","err","order_stage_code","is_shopping","order_description","order_sum_delivery","sum","$router","push","_err$responseJSON","_err$responseJSON$mes","exception_code","responseJSON","messages","error","$topic","publish","$go","next_route","removeItem","new_stage","mounted","__exports__","render"],"sourceRoot":""}