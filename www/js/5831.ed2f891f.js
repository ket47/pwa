"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[5831],{5831:function(e,s,l){l.r(s),l.d(s,{default:function(){return m}});var a=l(641);const t=["src"],n=["src"],o=(0,a.Lk)("div",null,[(0,a.Lk)("p",null,"Ваши персональные данные будут безвозвратно удалены."),(0,a.Lk)("p",null,"Повторная регистрация по этому номеру телефона будет невозможна!")],-1);function i(e,s,l,i,u,r){const d=(0,a.g2)("ion-thumbnail"),p=(0,a.g2)("ion-radio"),h=(0,a.g2)("ion-item"),_=(0,a.g2)("ion-radio-group"),f=(0,a.g2)("ion-label"),c=(0,a.g2)("ion-item-divider"),m=(0,a.g2)("ion-input"),b=(0,a.g2)("ion-button"),k=(0,a.g2)("ion-list"),g=(0,a.g2)("ion-icon"),F=(0,a.g2)("ion-col"),v=(0,a.g2)("ion-row"),w=(0,a.g2)("ion-title"),V=(0,a.g2)("ion-toolbar"),$=(0,a.g2)("ion-header"),y=(0,a.g2)("ion-content"),I=(0,a.g2)("ion-modal"),O=(0,a.g2)("base-layout");return(0,a.uX)(),(0,a.Wv)(O,{"page-title":"Мой профиль"},{default:(0,a.k6)((()=>[(0,a.bF)(k,null,{default:(0,a.k6)((()=>[(0,a.bF)(_,{modelValue:u.fields.user_avatar_name,"onUpdate:modelValue":s[2]||(s[2]=e=>u.fields.user_avatar_name=e)},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(d,{slot:"start"},{default:(0,a.k6)((()=>[(0,a.Lk)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,t)])),_:1}),(0,a.bF)(p,{value:"man",onIonFocus:s[0]||(s[0]=e=>r.save("user_avatar_name",e.target.value))},{default:(0,a.k6)((()=>[(0,a.eW)("аватар 1")])),_:1})])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(d,{slot:"start"},{default:(0,a.k6)((()=>[(0,a.Lk)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,n)])),_:1}),(0,a.bF)(p,{value:"woman",onIonFocus:s[1]||(s[1]=e=>r.save("user_avatar_name",e.target.value))},{default:(0,a.k6)((()=>[(0,a.eW)("аватар 2")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.eW)("Данные пользователя")])),_:1})])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_name,"onUpdate:modelValue":s[3]||(s[3]=e=>u.fields.user_name=e),name:"user_name",type:"text",onChange:s[4]||(s[4]=e=>r.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",label:"Ваш псевдоним","label-placement":"stacked",required:""},null,8,["modelValue"])])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_surname,"onUpdate:modelValue":s[5]||(s[5]=e=>u.fields.user_surname=e),placeholder:"Фамилия (не обязательно)",label:"Фамилия (не обязательно)","label-placement":"stacked",name:"user_surname",type:"text",onChange:s[6]||(s[6]=e=>r.save("user_surname",e.target.value))},null,8,["modelValue"])])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{readonly:"",modelValue:u.fields.user_phone,"onUpdate:modelValue":s[7]||(s[7]=e=>u.fields.user_phone=e),label:"Телефон","label-placement":"stacked"},null,8,["modelValue"]),!u.fields.user_phone||u.fields.user_phone_verified&&"0"!==u.fields.user_phone_verified?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(b,{key:0,slot:"end",onClick:r.phoneVerify,expand:"block"},{default:(0,a.k6)((()=>[(0,a.eW)("Подтвердить")])),_:1},8,["onClick"])),u.fields.user_phone&&u.fields.user_phone_verified&&"0"!==u.fields.user_phone_verified?((0,a.uX)(),(0,a.Wv)(b,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,a.k6)((()=>[(0,a.eW)("Подтверждено")])),_:1})):(0,a.Q3)("",!0)])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_email,"onUpdate:modelValue":s[8]||(s[8]=e=>u.fields.user_email=e),name:"user_email",type:"email",onChange:s[9]||(s[9]=e=>r.save("user_email",e.target.value)),placeholder:"Электронная почта",label:"Электронная почта","label-placement":"stacked"},null,8,["modelValue"])])),_:1})])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.eW)("Пароль пользователя")])),_:1})])),_:1}),(0,a.bF)(v,{"responsive-sm":""},{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{onClick:s[10]||(s[10]=e=>r.passwordReset()),expand:"block"},{default:(0,a.k6)((()=>[(0,a.bF)(g,{icon:i.keyOutline,slot:"start"},null,8,["icon"]),(0,a.eW)("Сбросить")])),_:1})])),_:1}),(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{onClick:s[11]||(s[11]=e=>u.passwordPromptShow=!0),expand:"block"},{default:(0,a.k6)((()=>[(0,a.bF)(g,{icon:i.keyOutline,slot:"start"},null,8,["icon"]),(0,a.eW)("Изменить")])),_:1})])),_:1})])),_:1}),(0,a.bF)(c,null,{default:(0,a.k6)((()=>[(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.eW)("Удаление учетной записи")])),_:1})])),_:1}),(0,a.bF)(v,{"responsive-sm":""},{default:(0,a.k6)((()=>[(0,a.bF)(F,null,{default:(0,a.k6)((()=>[(0,a.bF)(b,{onClick:s[12]||(s[12]=e=>u.deletePromptShow=!0),expand:"block",fill:"outline",color:"danger"},{default:(0,a.k6)((()=>[(0,a.bF)(g,{icon:i.trashOutline,slot:"start"},null,8,["icon"]),(0,a.eW)("Удалить аккаунт")])),_:1})])),_:1}),(0,a.bF)(F)])),_:1}),(0,a.bF)(I,{isOpen:u.passwordPromptShow,"initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,a.k6)((()=>[(0,a.bF)($,null,{default:(0,a.k6)((()=>[(0,a.bF)(V,null,{default:(0,a.k6)((()=>[(0,a.bF)(w,null,{default:(0,a.k6)((()=>[(0,a.eW)("Новый пароль")])),_:1}),(0,a.bF)(g,{icon:i.closeOutline,onClick:s[13]||(s[13]=e=>u.passwordPromptShow=!1),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.bF)(y,{class:"ion-padding"},{default:(0,a.k6)((()=>[(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_pass_current,"onUpdate:modelValue":s[14]||(s[14]=e=>u.fields.user_pass_current=e),type:"password",placeholder:"пароль",label:"Действующий пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_pass,"onUpdate:modelValue":s[15]||(s[15]=e=>u.fields.user_pass=e),type:"text",placeholder:"пароль",label:"Новый пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_pass_confirm,"onUpdate:modelValue":s[16]||(s[16]=e=>u.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)",label:"Новый пароль (повтор)","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.bF)(b,{onClick:s[17]||(s[17]=e=>r.passwordSave()),expand:"block"},{default:(0,a.k6)((()=>[(0,a.eW)("Изменить")])),_:1})])),_:1})])),_:1},8,["isOpen"]),(0,a.bF)(I,{isOpen:u.deletePromptShow,"initial-breakpoint":.4,breakpoints:[0,.4,.8]},{default:(0,a.k6)((()=>[(0,a.bF)($,null,{default:(0,a.k6)((()=>[(0,a.bF)(V,{color:"danger"},{default:(0,a.k6)((()=>[(0,a.bF)(w,null,{default:(0,a.k6)((()=>[(0,a.eW)("Удаление учетной записи")])),_:1}),(0,a.bF)(g,{icon:i.closeOutline,onClick:s[18]||(s[18]=e=>u.deletePromptShow=!1),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,a.bF)(y,{class:"ion-padding"},{default:(0,a.k6)((()=>[(0,a.bF)(h,{lines:"none",style:{"margin-bottom":"15px"}},{default:(0,a.k6)((()=>[o])),_:1}),(0,a.bF)(h,null,{default:(0,a.k6)((()=>[(0,a.bF)(m,{modelValue:u.fields.user_pass_current,"onUpdate:modelValue":s[19]||(s[19]=e=>u.fields.user_pass_current=e),type:"password",placeholder:"пароль",label:"Действующий пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,a.bF)(b,{onClick:s[20]||(s[20]=e=>r.deleteAccount()),expand:"block",color:"danger"},{default:(0,a.k6)((()=>[(0,a.eW)("Удалить аккаунт")])),_:1})])),_:1})])),_:1},8,["isOpen"])])),_:1})}l(3110);var u=l(972),r=l(5480),d=l(2311),p=l.n(d),h=l(8701),_={components:{IonList:u.nf,IonItem:u.uz,IonLabel:u.he,IonThumbnail:u.Zx,IonRadio:u.KO,IonRadioGroup:u.f0,IonInput:u.$w,IonCol:u.hU,IonRow:u.ln,IonItemDivider:u.Dg,IonButton:u.Jm,IonModal:u.Sb,IonHeader:u.eU,IonTitle:u.BC,IonContent:u.W9,IonIcon:u.iq,IonToolbar:u.ai},setup(){return{closeOutline:r.xfX,keyOutline:r.uNo,trashOutline:r.P1A}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1,deletePromptShow:!1}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{async save(e,s){if("user_phone"==e){if(!this.isPhoneValid)return!1;s=s.replace(/\D/g,"")}var l={};l.user_id=this.$heap.state.user.user_id,l[e]=s,await this.itemUpdate(l),this.fields[e]=s},async itemUpdate(e){try{return await p().post(`${this.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e)),!0}catch(s){let e="unknown";try{const l=Object.keys(JSON.parse(s.responseJSON.messages.error))[0],a=Object.values(JSON.parse(s.responseJSON.messages.error))[0];e=l+"_"+a}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break}return!1}},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{p().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$go({name:"UserVerifyPhone",params:{phone:e}})}catch{}},async passwordSave(){if(this.fields.user_pass!=this.fields.user_pass_confirm)return void this.$flash("Пароль и подтверждение не совпадают");if(!this.fields.user_pass_current||!this.fields.user_pass||!this.fields.user_pass_confirm)return void this.$flash("Все поля обязательны для заполнения");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass,user_pass_current:this.fields.user_pass_current},s=await this.itemUpdate(e);s&&(this.passwordPromptShow=!1,this.$flash("Пароль изменен"))},async passwordReset(){if(!confirm("Выслать новый пароль на телефон и электронную почту?"))return;const e={user_phone:this.fields.user_phone,user_email:this.fields.user_email,user_name:this.fields.user_name};try{await p().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch{}},async deleteAccount(){try{if(!this.fields.user_pass_current)return void this.$flash("Действующий пароль обязателен");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass_current};await p().post(`${this.$heap.state.hostname}User/itemDelete`,e),this.deletePromptShow=!1,await h.A.signOut(),await this.$go("/user")}catch{this.$flash("Не удалось удалить аккаунт. Проверьте пароль")}},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let s="",l=0;for(let a in this.config.phoneMask){if(!this.fields.user_phone[l])break;let e=this.config.phoneMask[a];"0"==e?(s+=this.fields.user_phone[l],l++):s+=e}return this.fields.user_phone=s,this.fields.user_phone}},created(){const e=this;this.$topic.on("userGet",(s=>{e.fields=s}))}},f=l(6262);const c=(0,f.A)(_,[["render",i]]);var m=c}}]);
//# sourceMappingURL=5831.ed2f891f.js.map