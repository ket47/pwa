"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[2107],{2107:function(e,t,n){n.r(t),n.d(t,{default:function(){return f}});var o=n(641),i=n(33);const s={novalidate:""};function a(e,t,n,a,r,l){const u=(0,o.g2)("ion-card-title"),c=(0,o.g2)("ion-card-header"),d=(0,o.g2)("ion-card-content"),h=(0,o.g2)("ion-card"),p=(0,o.g2)("ion-input"),f=(0,o.g2)("ion-item"),_=(0,o.g2)("ion-list"),m=(0,o.g2)("ion-button"),k=(0,o.g2)("ion-col"),b=(0,o.g2)("ion-row"),g=(0,o.g2)("base-layout");return(0,o.uX)(),(0,o.Wv)(g,{"page-title":"Подтверждение телефона",pageDefaultBackLink:"/user"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{color:"light"},{default:(0,o.k6)(()=>[(0,o.bF)(c,null,{default:(0,o.k6)(()=>[(0,o.bF)(u,{color:"primary"},{default:(0,o.k6)(()=>t[3]||(t[3]=[(0,o.eW)(" Подтверждение номера телефона ")])),_:1,__:[3]})]),_:1}),(0,o.bF)(d,null,{default:(0,o.k6)(()=>[(0,o.Lk)("p",null,[t[4]||(t[4]=(0,o.eW)("Мы выслали вам смс с кодом подтверждения на номер ")),(0,o.Lk)("b",null,(0,i.v_)(r.user_phone),1),t[5]||(t[5]=(0,o.eW)(". Введите 4 цифры из смс ниже"))]),t[6]||(t[6]=(0,o.Lk)("hr",null,null,-1)),t[7]||(t[7]=(0,o.Lk)("p",null,"Поступление СМС на ваш телефон может занять до 2 минут.",-1))]),_:1,__:[6,7]})]),_:1}),(0,o.Lk)("form",s,[(0,o.bF)(_,null,{default:(0,o.k6)(()=>[(0,o.bF)(f,null,{default:(0,o.k6)(()=>[(0,o.bF)(p,{modelValue:r.verification_code,"onUpdate:modelValue":t[0]||(t[0]=e=>r.verification_code=e),type:"numeric",inputmode:"numeric",maxlength:"4",pattern:"\\d{4}",placeholder:"- - - -",enterkeyhint:"go",required:"",autocomplete:"one-time-code",label:"Код подтверждения из смс","label-placement":"stacked"},null,8,["modelValue"])]),_:1})]),_:1}),(0,o.bF)(b,{"responsive-sm":""},{default:(0,o.k6)(()=>[(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(m,{onClick:t[1]||(t[1]=e=>l.onSubmit()),expand:"block"},{default:(0,o.k6)(()=>t[8]||(t[8]=[(0,o.eW)("Подтвердить")])),_:1,__:[8]})]),_:1})]),_:1}),(0,o.bF)(b,{"responsive-sm":""},{default:(0,o.k6)(()=>[(0,o.bF)(k,null,{default:(0,o.k6)(()=>[(0,o.bF)(m,{onClick:t[2]||(t[2]=e=>{r.is_sent=!1,l.smsSend()}),expand:"block",color:"light",disabled:r.timeToResend>0},{default:(0,o.k6)(()=>[(0,o.eW)("Послать снова "+(0,i.v_)(l.timeLeft),1)]),_:1},8,["disabled"])]),_:1})]),_:1})])]),_:1})}var r=n(5634),l=n(2311),u=n.n(l),c=n(8701),d={name:"UserVerifyPhone",components:{IonCol:r.hU,IonInput:r.$w,IonRow:r.ln,IonButton:r.Jm,IonCard:r.b_,IonCardHeader:r.ME,IonCardTitle:r.tN,IonCardContent:r.I9,IonItem:r.uz,IonList:r.nf},data(){return{verification_code:null,user_phone:this.$heap.state.user.tmp_userphone||this.$route.params.user_phone||this.$route.query.user_phone||"",is_sent:!1,timeToResend:120}},async created(){if(this.smsSend(),navigator.credentials)try{const e=await navigator.credentials.get({otp:{transport:["sms"]}});this.verification_code=e.code}catch(e){console.log(e)}},ionViewDidEnter(){this.smsSend()},computed:{timeLeft(){const e=Math.floor(this.timeToResend/60),t=this.timeToResend-60*e;return`${e}:${t}`}},methods:{clockStart(){this.timeToResend<=0||(this.timeToResend--,setTimeout(()=>this.clockStart(),1e3))},async smsSend(){if(this.is_sent)return;if(!this.user_phone)return void this.$router.replace("/user");let e={user_phone:this.user_phone};try{this.is_sent=!0,await u().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,e),this.timeToResend=120,this.clockStart()}catch{}},async onSubmit(){if(this.verification_code&&4==String(this.verification_code).length)try{await u().post(`${this.$heap.state.hostname}/User/phoneVerificationCheck`,{user_phone:this.user_phone,verification_code:this.verification_code}),this.$flash("Номер телефона верифицирован"),this.$router.replace("/user"),await c.A.autoSignIn(),this.$go("/catalog")}catch(e){const t=e.responseJSON.messages.error;switch(t){case"verification_not_found":this.$flash("Код верификации устарел"),this.$router.replace("/modal/user-authorize");break}this.$flash("Не удалось верифицировать телефон")}}},watch:{verification_code:function(e,t){this.onSubmit()}}},h=n(6262);const p=(0,h.A)(d,[["render",a]]);var f=p}}]);
//# sourceMappingURL=2107.95fdf260.js.map