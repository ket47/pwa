"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[309],{7537:function(e,t,o){o.d(t,{Z:function(){return p}});var r=o(6252),i=o(3577);const s=["src"];function l(e,t,o,l,u,n){const a=(0,r.up)("swiper-slide"),d=(0,r.up)("swiper");return(0,r.wg)(),(0,r.j4)(d,{modules:l.modules,autoplay:{delay:3e3,disableOnInteraction:!1},loop:!0,effect:"fade"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(o.imageList,(t=>((0,r.wg)(),(0,r.j4)(a,{key:t.image_hash},{default:(0,r.w5)((()=>[(0,r._)("div",{class:"crop-to-fit",style:(0,i.j5)(`height: ${o.imgHeight||300}px;`)},[(0,r._)("img",{style:(0,i.j5)(`min-height: ${o.imgHeight||300}px;`),src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.${4*o.imgHeight||1200}.${o.imgHeight||300}.webp`},null,12,s)],4)])),_:2},1024)))),128))])),_:1},8,["modules"])}var u=o(702),n=o(3181),a={components:{Swiper:n.t,SwiperSlide:n.o},props:["imageList","imgHeight"],setup(){return{modules:[u.pt,u.xW]}}},d=o(3744);const c=(0,d.Z)(a,[["render",l],["__scopeId","data-v-f830f732"]]);var p=c},2309:function(e,t,o){o.r(t),o.d(t,{default:function(){return oe}});var r=o(6252),i=o(3577),s=o(9963);const l=e=>((0,r.dD)("data-v-30108d52"),e=e(),(0,r.Cn)(),e),u={style:{"background-color":"var(--ion-background-shade)"}},n={class:"store-info"},a=(0,r.Uk)("Добавить товар"),d=l((()=>(0,r._)("div",{style:{"border-bottom":"1px solid var(--ion-color-primary-tint)"}},null,-1))),c={style:{display:"grid","grid-template-columns":"30px 1fr",gap:"5px"}},p={style:{"grid-row":"1 / 2","align-items":"flex-start"}},g={style:{"grid-column":"2 / span 3",display:"flex","align-items":"center"}},m=(0,r.Uk)(" Доставит "),_={style:{color:"var(--ion-color-primary)"}},h={style:{display:"flex","justify-content":"space-between"}},f={key:0,style:{"text-align":"left"}},w={key:1,style:{"text-align":"right"}},y={key:0,class:"group-fixed-block hidden-block"};function v(e,t,o,l,v,k){const I=(0,r.up)("image-slider"),b=(0,r.up)("ion-text"),S=(0,r.up)("ion-col"),G=(0,r.up)("ion-icon"),x=(0,r.up)("router-link"),C=(0,r.up)("ion-row"),P=(0,r.up)("ion-button"),W=(0,r.up)("ion-note"),$=(0,r.up)("ion-grid"),q=(0,r.up)("ion-label"),z=(0,r.up)("ion-segment-button"),T=(0,r.up)("ion-segment"),j=(0,r.up)("ion-chip"),L=(0,r.up)("ion-searchbar"),D=(0,r.up)("group-list"),Z=(0,r.up)("product-list"),H=(0,r.up)("swiper-slide"),O=(0,r.up)("swiper"),A=(0,r.up)("base-layout");return(0,r.wg)(),(0,r.j4)(A,{"page-default-back-link":"/home","page-class":"store-page",contentOnScroll:e.onScroll,"page-title":e.pageTitle},{default:(0,r.w5)((()=>[(0,r._)("div",u,[(0,r._)("div",n,[(0,r.Wm)(I,{imageList:e.storeItem.images,imgHeight:200},null,8,["imageList"]),(0,r.Wm)($,{style:{margin:"15px 5px 5px 5px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(C,null,{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Wm)(b,{color:"primary",style:{"font-size":"20px"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(e.storeItem.store_name),1)])),_:1})])),_:1}),(0,r.Wm)(S,{style:{"text-align":"right"}},{default:(0,r.w5)((()=>[1==e.storeItem.is_writable?((0,r.wg)(),(0,r.j4)(x,{key:0,to:"/store-edit-"+e.storeItem.store_id},{default:(0,r.w5)((()=>[(0,r.Wm)(G,{icon:e.settingsOutline,style:{"font-size":"24px"}},null,8,["icon"])])),_:1},8,["to"])):(0,r.kq)("",!0)])),_:1})])),_:1}),1==e.storeItem.is_writable?((0,r.wg)(),(0,r.j4)(C,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Wm)(P,{onClick:t[0]||(t[0]=t=>e.productItemCreate()),color:"light"},{default:(0,r.w5)((()=>[a])),_:1})])),_:1})])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(C,{style:{"font-size":"12px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(e.storeItem.store_group_names),1)])),_:1}),(0,r.wy)((0,r.Wm)(S,{style:{"text-align":"right"}},{default:(0,r.w5)((()=>[(0,r.Uk)(" закроется в "+(0,i.zw)(e.storeItem.willBeClosedAt)+":00 ",1)])),_:1},512),[[s.F8,e.storeItem.willBeClosedAt]])])),_:1}),(0,r.Wm)(C,null,{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[(0,r.Wm)(W,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(e.storeItem.store_description),1)])),_:1})])),_:1})])),_:1}),(0,r.Wm)(C,null,{default:(0,r.w5)((()=>[(0,r.Wm)(S,null,{default:(0,r.w5)((()=>[d])),_:1})])),_:1}),(0,r.Wm)(C,null,{default:(0,r.w5)((()=>[(0,r.Wm)(S,{style:{"font-size":"12px"}},{default:(0,r.w5)((()=>[(0,r._)("div",c,[(0,r._)("div",p,[(0,r.Wm)(G,{src:"./assets/icon/box-delivery.svg",style:{"font-size":"26px",color:"var(--ion-color-primary)"}})]),(0,r._)("div",g,[(0,r._)("span",null,[m,(0,r._)("b",_,(0,i.zw)(e.$heap.state.app_title),1)])])]),(0,r._)("div",h,[e.storeItem.delivery?((0,r.wg)(),(0,r.iD)("div",f,(0,i.zw)(e.storeItem.delivery.timeMin)+"-"+(0,i.zw)(e.storeItem.delivery.timeMax)+" мин ",1)):(0,r.kq)("",!0),(0,r._)("div",null,"доставка "+(0,i.zw)(e.$heap.state.deliverySettings.fee)+"₽",1),e.storeItem.store_minimal_order?((0,r.wg)(),(0,r.iD)("div",w," заказ от "+(0,i.zw)(e.storeItem.store_minimal_order)+"₽ ",1)):(0,r.kq)("",!0)])])),_:1})])),_:1})])),_:1})]),e.storeGroups?((0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(T,{modelValue:e.activeParentGroupId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.activeParentGroupId=t),scrollable:""},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.storeGroups,(t=>((0,r.wg)(),(0,r.j4)(z,{key:t.group_id,value:t.group_id,onClick:o=>e.setActiveParentGroup(t.group_id),ref_for:!0,ref:"group-tab-"+t.group_id},{default:(0,r.w5)((()=>[(0,r.Wm)(q,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(t.group_name),1)])),_:2},1024)])),_:2},1032,["value","onClick"])))),128))])),_:1},8,["modelValue"]),e.storeGroups[e.activeParentGroupId]?((0,r.wg)(),(0,r.j4)(C,{key:0,class:"groups-container"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.storeGroups[e.activeParentGroupId].children,(t=>(0,r.wy)(((0,r.wg)(),(0,r.j4)(j,{color:"primary",key:t.group_id,ref_for:!0,ref:"group-chip-"+t.group_id,onClick:o=>e.scrollTo(t.group_id)},{default:(0,r.w5)((()=>[(0,r.Wm)(q,{color:"primary"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(t.group_name),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[s.F8,e.storeProducts[t.group_id]]]))),128))])),_:1})):(0,r.kq)("",!0)])):(0,r.kq)("",!0),(0,r.Wm)(L,{class:"search-container",value:e.searchRequest,placeholder:"Поиск в этом предприятии",onInput:t[2]||(t[2]=t=>{e.getStoreProducts({name_query:t.target.value,name_query_fields:"product_name,product_code"}),e.searchRequest=t.target.value})},null,8,["value"]),e.storeGroups?((0,r.wg)(),(0,r.j4)(D,{key:1,groupList:e.storeGroups,onClick:t=>{e.setActiveParentGroup(t)}},null,8,["groupList","onClick"])):(0,r.kq)("",!0),e.storeGroups?((0,r.wg)(),(0,r.j4)(O,{key:2,pager:"true",options:e.slideOpts,class:"product-list-slider",onSlideChange:t[3]||(t[3]=t=>e.slideChanged(t))},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.storeGroups,(t=>((0,r.wg)(),(0,r.j4)(H,{key:t.group_id},{default:(0,r.w5)((()=>[(0,r.Wm)($,{class:"product-list"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(t.children,(t=>((0,r.wg)(),(0,r.j4)(C,{key:t.group_id,ref_for:!0,ref:"group-"+t.group_id,"data-group_id":t.group_id},{default:(0,r.w5)((()=>[(0,r.Wm)(S,{class:"group-title",size:"12"},{default:(0,r.w5)((()=>[(0,r._)("label",null,[(0,r._)("b",null,(0,i.zw)(t.group_name),1)])])),_:2},1024),(0,r.Wm)(S,{size:"12"},{default:(0,r.w5)((()=>[(0,r.Wm)(Z,{productList:e.storeProducts[t.group_id]},null,8,["productList"])])),_:2},1024)])),_:2},1032,["data-group_id"])))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["options"])):(0,r.kq)("",!0)])])),_:1},8,["contentOnScroll","page-title"])}var k=o(8973),I=o(702),b=o(3181),S=o(8903),G=o(7537);const x={id:"hcat_widget_grid"},C=["onClick"];function P(e,t,o,s,l,u){const n=(0,r.up)("ion-img"),a=(0,r.up)("ion-thumbnail"),d=(0,r.up)("ion-label");return(0,r.wg)(),(0,r.iD)("div",x,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.groupList,(t=>((0,r.wg)(),(0,r.iD)("div",{key:t.group_id,onClick:()=>e.onClick(t.group_id)},[(0,r.Wm)(a,{style:{width:"70px",height:"70px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{style:{"border-radius":"10px",border:"1px solid #ddd"},src:`${e.$heap.state.hostname}image/get.php/${t.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1024),(0,r.Wm)(d,{style:{height:"2em","text-align":"center"}},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(t.group_name),1)])),_:2},1024)],8,C)))),128))])}var W=(0,r.aZ)({components:{IonImg:k.Xz,IonThumbnail:k.Bs,IonLabel:k.Q$},props:["groupList","onClick"]}),$=o(3744);const q=(0,$.Z)(W,[["render",P],["__scopeId","data-v-6c59c918"]]);var z=q;const T={class:"product_list_widget_grid"},j=["id"],L={class:"product_list_item_img"},D={style:{position:"relative",top:"-50%"}},Z={style:{height:"50px",overflow:"hidden"}},H={key:0,style:{color:"var(--ion-color-danger)"}},O=(0,r.Uk)("   "),A={style:{color:"var(--ion-color-primary)"}},M=(0,r.Uk)(" / "),U={style:{color:"var(--ion-color-medium)"}},B={style:{color:"black"}};function R(e,t,o,s,l,u){const n=(0,r.up)("cart-add-buttons"),a=(0,r.up)("ion-img"),d=(0,r.up)("router-link");return(0,r.wg)(),(0,r.iD)("div",T,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(o.productList,(t=>((0,r.wg)(),(0,r.iD)("div",{key:t.product_id,class:(0,i.C_)(t.product_quantity>0?"":"absent"),id:`product_list_item${t.product_id}`},[(0,r._)("div",L,[(0,r._)("div",D,[(0,r.Wm)(n,{buttonLayout:"vertical",productItem:t},null,8,["productItem"])]),(0,r.Wm)(d,{class:"link",to:"product-"+t.product_id},{default:(0,r.w5)((()=>[t.image_hash?((0,r.wg)(),(0,r.j4)(a,{key:0,src:e.$heap.state.hostname+"/image/get.php/"+t.image_hash+".150.150.webp"},null,8,["src"])):(0,r.kq)("",!0)])),_:2},1032,["to"])]),(0,r._)("div",Z,[(0,r.Wm)(d,{class:"link",to:"product-"+t.product_id},{default:(0,r.w5)((()=>[t.product_price!=t.product_final_price?((0,r.wg)(),(0,r.iD)("span",H,[(0,r._)("s",null,(0,i.zw)(t.product_price)+(0,i.zw)(e.$heap.state.currencySign),1),O])):(0,r.kq)("",!0),(0,r._)("span",A,(0,i.zw)(t.product_final_price)+(0,i.zw)(e.$heap.state.currencySign),1),M,(0,r._)("span",U,(0,i.zw)(t.product_unit),1),(0,r._)("div",B,(0,i.zw)(t.product_name),1)])),_:2},1032,["to"])])],10,j)))),128))])}var Y=o(9149),K={props:["productList","onClick"],components:{IonImg:k.Xz,CartAddButtons:Y.Z}};const N=(0,$.Z)(K,[["render",R],["__scopeId","data-v-02de60a6"]]);var V=N,F=o(9755),J=o.n(F),Q=o(2008),X=o(4405);const E={slidesPerView:1,pagination:!1,centeredSlides:!1,initialSlide:0,speed:400,watchSlidesProgress:!1,grabCursor:!0,touchStartForcePreventDefault:!0};var ee=(0,r.aZ)({components:{IonText:k.yW,IonCol:k.wI,IonIcon:k.gu,IonRow:k.Nd,IonNote:k.uN,IonGrid:k.jY,IonLabel:k.Q$,IonSegmentButton:k.GO,IonSegment:k.cJ,IonChip:k.hM,IonSearchbar:k.VI,IonPage:k._i,IonButton:k.YG,ImageSlider:G.Z,Swiper:b.t,SwiperSlide:b.o,GroupList:z,ProductList:V},setup(){return{search:S.yC4,settingsOutline:S.C$N,slideOpts:E,slideModules:[I.pt]}},data(){return{storeId:this.$route.params.id,searchRequest:"",pageTitle:"Магазин",error:"",storeItem:[],storeProducts:{},storeGroups:null,activeGroup:{children:[]},activeParentGroupId:0,offsetModificator:150}},computed:{isSignedIn(){return Q.Z.state.user.user_id&&Q.Z.state.user.user_id>-1}},methods:{setActiveParentGroup(e){this.activeParentGroupId=e;const t=Object.keys(this.storeGroups[this.activeParentGroupId].children)[0],o=this;setTimeout((function(){o.scrollTo(t),o.setSubgroupActive(t)}),200);const r=document.querySelector(".product-list-slider").swiper,i=Object.keys(this.storeGroups).indexOf(this.activeParentGroupId);r.slideTo(i,100,!1)},slideChanged(e){const t=e.activeIndex,o=Object.keys(this.storeGroups)[t],r=Object.keys(this.storeGroups[o].children)[0],i=this;this.setActiveParentGroup(o),setTimeout((function(){i.scrollTo(r),i.setSubgroupActive(r)}),200)},async getStore(){try{const e=await J().post(`${Q.Z.state.hostname}Store/itemGet`,{store_id:this.storeId,distance_include:1});this.storeItem=this.prepareStore(e),this.storeId=e.store_id,this.pageTitle=e.store_name,this.getStoreGroupTree({store_id:this.storeId}),Q.Z.commit("setCurrentStore",this.storeItem)}catch(e){}},prepareStore(e){e.member_of_groups.group_names&&(e.store_group_names=e.member_of_groups.group_names);var t=new Date;return e.willBeClosedAt=e["store_time_closes_"+t.getDay()],e.delivery=X.Z.deliveryCalculate(e),e},async getStoreGroupTree(e){try{this.storeGroups=await J().get(`${Q.Z.state.hostname}Product/groupTreeGet`,{store_id:e.store_id});const t=Object.keys(this.storeGroups)[0];this.activeParentGroupId=t,this.getStoreProducts()}catch(t){}},getStoreProducts(e={}){if(e.store_id=this.storeId,e.is_active=1,1==this.storeItem.is_writable&&(e.is_disabled=1,e.is_deleted=1),e.name_query&&""==e.name_query)this.getStoreGroupTree({store_id:t.storeId});else{var t=this;J().post(Q.Z.state.hostname+"Product/listGet",e).done((function(e){t.prepareProductList(e.product_list);var o=Object.keys(t.storeGroups[t.activeParentGroupId].children)[0];t.setSubgroupActive(o)})).fail((function(e){t.error=e.responseJSON.messages.error}))}},async productItemCreate(){try{const e={store_id:this.storeId,product_name:"Новый товар",product_price:1e3,product_promo_price:1e3},t=await J().post(`${Q.Z.state.hostname}Product/itemCreate`,e);this.$router.push(`product-edit-${t}`)}catch{this.$flash("Не удалось создать товар")}},prepareProductList(e){for(var t of(this.storeProducts={},e))this.storeGroups&&(this.storeProducts[t.group_id]||(this.storeProducts[t.group_id]=[])),this.storeProducts[t.group_id].push(t)},setSubgroupActive(e){var t=document.querySelectorAll(".groups-container ion-chip");for(var o of t)o.classList.remove("active-chip");this.$refs["group-chip-"+e]&&this.$refs["group-chip-"+e][0]&&this.$refs["group-chip-"+e][0].classList&&this.$refs["group-chip-"+e][0].classList.add("active-chip")},scrollTo(e){if(!this.$refs["group-"+e][0])return;const t=document.querySelector("ion-content").shadowRoot.querySelector("main").scrollTop,o=this.$refs["group-"+e][0].$el.getBoundingClientRect().top;var r=t+o-this.offsetModificator-window.innerHeight/4,i=Object.keys(this.storeGroups[this.activeParentGroupId].children)[0];i==e&&(r=t+o-this.offsetModificator),document.querySelector("ion-content").shadowRoot.querySelector("main").scrollTo({top:r,behavior:"smooth"});var s=this;setTimeout((function(){s.setSubgroupActive(e)}),500)},onScroll(e){const t=document.querySelector(".product-list-slider")?.offsetTop,o=document.querySelector(".group-fixed-block")?.offsetHeight;t-o-100<e.detail.scrollTop?document.querySelector(".group-fixed-block")&&(document.querySelector(".group-fixed-block").className="group-fixed-block"):document.querySelector(".group-fixed-block")&&(document.querySelector(".group-fixed-block").className="group-fixed-block hidden-block");var r=document.querySelectorAll(".swiper-slide-active .product-list ion-row");for(var i of r)if(i.getBoundingClientRect().top-this.offsetModificator<=window.innerHeight-window.innerHeight/4&&i.getBoundingClientRect().bottom+this.offsetModificator>=window.innerHeight-window.innerHeight/4&&i.dataset.group_id){this.setSubgroupActive(i.dataset.group_id);break}}},ionViewDidEnter(){this.getStore()},watch:{$route(e){this.storeId=e.params.id}}});const te=(0,$.Z)(ee,[["render",v],["__scopeId","data-v-30108d52"]]);var oe=te},4405:function(e,t,o){var r=o(2008);const i={deliveryCalculate(e){if(!e.locations||!e.locations[0]||!e.locations[0].distance)return null;const t=e.locations[0].distance,o=e.store_time_preparation||0;return i.deliveryTimeCalculate(t,o)},deliveryTimeCalculate(e,t){t=t??r.Z.state.deliverySettings.defaultPreparationTime;const o=r.Z.state.deliverySettings.deliveryTimeDelta,i=5*Math.round(e/r.Z.state.deliverySettings.courierVelocity*60/5)+parseInt(t),s=i>o?i-o:i,l=s+o;return{time:i,timeMin:s,timeMax:l}}};t["Z"]=i}}]);
//# sourceMappingURL=309.c7fef05e.js.map