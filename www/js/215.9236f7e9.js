"use strict";(self["webpackChunktezkel_delivery"]=self["webpackChunktezkel_delivery"]||[]).push([[215],{4215:function(e,s,o){o.r(s),o.d(s,{default:function(){return Z}});var t=o(6252),n=o(3577),a=o(9963);const l=(0,t.Uk)(" Вы уже вошли в систему с номером телефона "),u={novalidate:""},r=(0,t.Uk)("Код"),i=(0,t.Uk)("+7 "),p=(0,t.Uk)("Мобильный телефон*"),d={"padding-left":""},h=(0,t.Uk)("Пароль (Минимум 4 символа)*"),_={"padding-left":""},c=(0,t.Uk)("Войти"),m=(0,t.Uk)("Зарегистрироваться"),f=(0,t.Uk)("Забыли пароль?");function w(e,s,o,w,k,W){const I=(0,t.up)("ion-card-title"),g=(0,t.up)("ion-card-header"),b=(0,t.up)("ion-card-content"),y=(0,t.up)("ion-card"),x=(0,t.up)("ion-label"),$=(0,t.up)("ion-select-option"),V=(0,t.up)("ion-select"),v=(0,t.up)("ion-col"),C=(0,t.up)("ion-input"),U=(0,t.up)("ion-row"),S=(0,t.up)("ion-grid"),z=(0,t.up)("ion-text"),F=(0,t.up)("ion-item"),q=(0,t.up)("ion-list"),D=(0,t.up)("ion-button"),O=(0,t.up)("base-layout");return(0,t.wg)(),(0,t.j4)(O,{"page-title":"Вход в систему","page-default-back-link":"/home"},{default:(0,t.w5)((()=>[e.$heap.state.user.user_id>0?((0,t.wg)(),(0,t.j4)(y,{key:0,style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Wm)(I,{color:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(e.$heap.state.user.user_name)+" "+(0,n.zw)(e.$heap.state.user.user_surname)+" "+(0,n.zw)(e.$heap.state.user.user_middlename),1)])),_:1})])),_:1}),(0,t.Wm)(b,null,{default:(0,t.w5)((()=>[l,(0,t._)("b",null,(0,n.zw)(e.$heap.state.user.user_phone),1)])),_:1})])),_:1})):(0,t.kq)("",!0),(0,t._)("form",u,[(0,t.Wm)(q,null,{default:(0,t.w5)((()=>[(0,t.Wm)(F,null,{default:(0,t.w5)((()=>[(0,t.Wm)(S,{style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(U,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v,{size:"5"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[r])),_:1}),(0,t.Wm)(V,{value:k.user_phone_prefix},{default:(0,t.w5)((()=>[(0,t.Wm)($,{value:"7",selected:""},{default:(0,t.w5)((()=>[i])),_:1})])),_:1},8,["value"])])),_:1}),(0,t.Wm)(v,{size:"7"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[p])),_:1}),(0,t.Wm)(C,{modelValue:k.user_phone,"onUpdate:modelValue":s[0]||(s[0]=e=>k.user_phone=e),onIonChange:s[1]||(s[1]=e=>W.phoneFormat()),name:"phone",type:"tel",inputmode:"tel",placeholder:"(xxx)xxxxxxxxx",required:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(z,{color:"danger",slot:"helper"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("p",d,"Неверный номер телефона",512),[[a.F8,!W.phoneValid&&1==k.submitted]])])),_:1})])),_:1}),(0,t.Wm)(F,null,{default:(0,t.w5)((()=>[(0,t.Wm)(x,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[h])),_:1}),(0,t.Wm)(C,{modelValue:k.user_pass,"onUpdate:modelValue":s[2]||(s[2]=e=>k.user_pass=e),name:"password",type:"password",autocorrect:"off",placeholder:"Пароль (Минимум 4 символа)",required:""},null,8,["modelValue"]),(0,t.Wm)(z,{color:"danger",slot:"helper"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("p",_,"Пароль должен содержать не менее 4 символов.",512),[[a.F8,!W.passwordValid&&1==k.submitted]])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(S,null,{default:(0,t.w5)((()=>[(0,t.Wm)(U,{"responsive-sm":""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(D,{onClick:W.onSubmit,expand:"block"},{default:(0,t.w5)((()=>[c])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,t.Wm)(U,{"responsive-sm":""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(D,{color:"light",expand:"block",onClick:s[3]||(s[3]=s=>e.$router.push({path:"/sign-up"}))},{default:(0,t.w5)((()=>[m])),_:1})])),_:1})])),_:1}),(0,t.Wm)(U,{"responsive-sm":""},{default:(0,t.w5)((()=>[(0,t.Wm)(v,null,{default:(0,t.w5)((()=>[(0,t.Wm)(D,{onClick:W.openModal,color:"light",expand:"block"},{default:(0,t.w5)((()=>[f])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1})}var k=o(853);const W=(0,t.Uk)("Напоминание пароля"),I={novalidate:""},g=(0,t.Uk)("Номер телефона"),b=(0,t.Uk)("Имя пользователя"),y=(0,t.Uk)("Выслать пароль");function x(e,s,o,n,a,l){const u=(0,t.up)("ion-title"),r=(0,t.up)("ion-icon"),i=(0,t.up)("ion-toolbar"),p=(0,t.up)("ion-header"),d=(0,t.up)("ion-label"),h=(0,t.up)("ion-input"),_=(0,t.up)("ion-item"),c=(0,t.up)("ion-list"),m=(0,t.up)("ion-button"),f=(0,t.up)("ion-content");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[W])),_:1}),(0,t.Wm)(r,{icon:n.closeCircle,onClick:s[0]||(s[0]=e=>{l.closeModal()}),slot:"end",size:"large",color:"medium"},null,8,["icon"])])),_:1})])),_:1}),(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[(0,t._)("form",I,[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[g])),_:1}),(0,t.Wm)(h,{modelValue:a.userphone,"onUpdate:modelValue":s[1]||(s[1]=e=>a.userphone=e),placeholder:"Ваш телефон"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{position:"stacked",color:"primary"},{default:(0,t.w5)((()=>[b])),_:1}),(0,t.Wm)(h,{modelValue:a.username,"onUpdate:modelValue":s[2]||(s[2]=e=>a.username=e),placeholder:"Введите имя пользователя..."},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(m,{onClick:s[3]||(s[3]=e=>l.passwordReset()),expand:"full"},{default:(0,t.w5)((()=>[y])),_:1})])])),_:1})],64)}var $=o(8903),V=o(9755),v=o.n(V),C={components:{IonContent:k.W2,IonHeader:k.Gu,IonTitle:k.wd,IonToolbar:k.sr,IonList:k.q_,IonItem:k.Ie,IonInput:k.pK,IonButton:k.YG,IonIcon:k.gu,IonLabel:k.Q$},props:["phone"],setup(){return{closeCircle:$.XZx}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return k.Fy.dismiss()},async passwordReset(){let e={user_phone:"+"+this.phone.replace(/\D/g,""),user_name:this.username};try{await v().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$flash(`Ваш новый пароль выслан на номер '${this.userphone}'`)}catch(s){const e=s.responseJSON.messages.error;"user_not_found"==e?this.$flash(`Пользователь с телефоном '${this.userphone}' и именем '${this.username}' ненайден`):this.$flash("Не удалось восстановить пароль")}this.closeModal()}}},U=o(3744);const S=(0,U.Z)(C,[["render",x]]);var z=S,F=o(351),q=o(1805),D={components:{IonLabel:k.Q$,IonSelectOption:k.n0,IonSelect:k.t9,IonCol:k.wI,IonInput:k.pK,IonRow:k.Nd,IonText:k.yW,IonButton:k.YG,IonGrid:k.jY,IonCard:k.PM,IonCardHeader:k.Zi,IonCardTitle:k.Dq,IonCardContent:k.FN,IonList:k.q_,IonItem:k.Ie},data(){return{submitted:!1,user_pass:null,user_phone:null,user_phone_prefix:"7",modalOpen:!1}},computed:{phoneValid(){return 10==this.user_phone?.replace(/\D/g,"").length},passwordValid(){return this.user_pass?.length>=4}},created(){const e=JSON.parse(localStorage.signInData??"{}");e&&e.user_phone&&(this.user_phone=e.user_phone,this.phoneFormat()),e&&e.user_pass&&(this.user_pass=e.user_pass)},methods:{async onSubmit(){if(this.submitted=!0,!this.phoneValid||!this.passwordValid)return!1;let e={user_phone:this.user_phone_prefix+this.user_phone,user_pass:this.user_pass,user_pass_confirm:this.user_pass};try{await F.Z.signIn(e),await F.Z.get(),q.Z.go(-1)}catch(s){const e=s.responseJSON,o=e.messages.error;switch(o){case"user_not_found":this.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":this.$flash("Неверный пароль");break;case"user_is_disabled":this.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":this.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":this.$flash("Номер телефона не подтвержден"),localStorage.signInData=JSON.stringify({user_phone:this.user_phone_prefix+this.user_phone,user_pass:this.user_pass}),this.phoneVerify();break;default:this.$flash("Не удалось войти в систему")}}},phoneFormat(){this.user_phone||(this.user_phone="");try{let e=this.user_phone.replace(/\D/g,"");e.length>10&&(e=e.substring(e.length-10)),this.user_phone=e}catch{}},async openModal(){this.modalOpen=!0;var e=this;const s=await k.Fy.create({component:z,componentProps:{phone:e.user_phone},initialBreakpoint:.3,breakpoints:[.3,.6]});return s.present()},phoneVerify(){let e={user_phone:this.user_phone_prefix+this.user_phone};try{this.$router.push({name:"UserVerifyPhone",query:e})}catch{this.$flash("Не удалось выслать смс с подтверждением")}}}};const O=(0,U.Z)(D,[["render",w],["__scopeId","data-v-4e1710b8"]]);var Z=O}}]);
//# sourceMappingURL=215.9236f7e9.js.map