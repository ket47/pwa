"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[8763],{8763:function(t,a,e){e.r(a),e.d(a,{default:function(){return N}});var s=e(641);const i={class:"horizontalScroller"},n={id:"analysisPage"},l={class:"print-nonbreakable"},o={class:"horizontalScroller"},r={class:"grid"},d={class:"row"},c={class:"col"},u={class:"col"},p={class:"print-nonbreakable"},h={class:"horizontalScroller"},k={class:"grid"},v={class:"row"},b={class:"col"},g={class:"col"},m={class:"print-nonbreakable"},L={class:"horizontalScroller"},y={class:"grid"},f={class:"row"},_={class:"col"},C={class:"print-nonbreakable"};function w(t,a,e,w,x,R){const D=(0,s.g2)("ion-icon"),E=(0,s.g2)("ion-label"),P=(0,s.g2)("ion-chip"),S=(0,s.g2)("statistics-stacked-bar-timeline"),X=(0,s.g2)("statistics-radial-pie"),z=(0,s.g2)("statistics-rating-list"),F=(0,s.g2)("base-layout");return(0,s.uX)(),(0,s.Wv)(F,{pageTitle:"Общая статистика",pageDefaultBackLink:"/user"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",i,[(0,s.bF)(P,{onClick:a[0]||(a[0]=t=>R.reportPrint()),color:"medium"},{default:(0,s.k6)(()=>[(0,s.bF)(D,{src:w.printOutline},null,8,["src"]),(0,s.bF)(E,null,{default:(0,s.k6)(()=>a[1]||(a[1]=[(0,s.eW)("Напечатать")])),_:1,__:[1]})]),_:1})]),(0,s.Lk)("div",n,[(0,s.Lk)("div",l,[a[2]||(a[2]=(0,s.Lk)("div",{class:"ion-padding-horizontal"},[(0,s.Lk)("h5",null,"Статистика действий по заказам"),(0,s.Lk)("p",null,"За последние 7 дней")],-1)),(0,s.bF)(S,{label:"Воронка заказов",data:x.dataset,dates:x.totalDates},null,8,["data","dates"])]),(0,s.Lk)("div",o,[(0,s.Lk)("div",r,[(0,s.Lk)("div",d,[(0,s.Lk)("div",c,[x.datasetPie.pay?((0,s.uX)(),(0,s.Wv)(X,{key:0,label:"Успешные оплаты",data:x.datasetPie.pay},null,8,["data"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",u,[x.datasetPie.completed?((0,s.uX)(),(0,s.Wv)(X,{key:0,label:"Отказы продавцов",data:x.datasetPie.completed},null,8,["data"])):(0,s.Q3)("",!0)])])])]),(0,s.Lk)("div",p,[a[3]||(a[3]=(0,s.Lk)("div",{class:"ion-padding-horizontal"},[(0,s.Lk)("h5",null,"Рейтинг продавцов"),(0,s.Lk)("p",null,"За последние 7 дней")],-1)),(0,s.Lk)("div",h,[(0,s.Lk)("div",k,[(0,s.Lk)("div",v,[(0,s.Lk)("div",b,[x.datasetRatingLists.top_stores?((0,s.uX)(),(0,s.Wv)(z,{key:0,label:"Лучшие продавцы",data:x.datasetRatingLists.top_stores},null,8,["data"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",g,[x.datasetRatingLists.antitop_stores?((0,s.uX)(),(0,s.Wv)(z,{key:0,label:"Худшие продавцы",data:x.datasetRatingLists.antitop_stores},null,8,["data"])):(0,s.Q3)("",!0)])])])])]),(0,s.Lk)("div",m,[a[4]||(a[4]=(0,s.Lk)("div",{class:"ion-padding-horizontal"},[(0,s.Lk)("h5",null,"Рейтинг товаров"),(0,s.Lk)("p",null,"За последние 7 дней")],-1)),(0,s.Lk)("div",L,[(0,s.Lk)("div",y,[(0,s.Lk)("div",f,[(0,s.Lk)("div",_,[x.datasetRatingLists.top_products?((0,s.uX)(),(0,s.Wv)(z,{key:0,label:"Лучшие товары",data:x.datasetRatingLists.top_products},null,8,["data"])):(0,s.Q3)("",!0)])])])])]),(0,s.Lk)("div",C,[a[5]||(a[5]=(0,s.Lk)("div",{class:"ion-padding-horizontal"},[(0,s.Lk)("h5",null,"Статистика отказов"),(0,s.Lk)("p",null,"За последние 7 дней")],-1)),(0,s.bF)(S,{label:"Отказы",data:x.datasetRejections,dates:x.rejectionDates,showTotal:!0,showDynamics:!0},null,8,["data","dates"])])])]),_:1})}e(4114);var x=e(5634),R=e(5480),D=e(33);const E={class:"ion-padding-horizontal"},P={key:1,class:"ion-padding ion-text-center"};function S(t,a,e,i,n,l){const o=(0,s.g2)("apexchart");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",E,(0,D.v_)(e.label),1),e.data.series.length>0?((0,s.uX)(),(0,s.Wv)(o,{key:0,type:"pie",width:"380",options:n.chartOptions,series:n.series,ref:"apexChartElement"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",P,a[0]||(a[0]=[(0,s.Lk)("h2",null,"Недостаточно данных",-1),(0,s.Lk)("p",null,"для показа статистики",-1)])))],64)}var X=e(5564),z={components:{apexchart:X.A},props:["label","data","format","color","dates"],setup(){return{}},data(){var t;return{series:null===(t=this.data)||void 0===t?void 0:t.series,chartOptions:{chart:{width:380,type:"pie"},colors:["#00e396","#ff4560"],labels:this.data.labels,legend:{position:"bottom"}}}},methods:{initChart(){this.$refs.apexChartElement&&(this.$refs.apexChartElement.updateSeries(this.data.series),this.$refs.apexChartElement.updateOptions({labels:this.data.labels}))}},mounted(){setTimeout(()=>{this.initChart()},100)},updated(){setTimeout(()=>{this.initChart()},1)}},F=e(6262);const A=(0,F.A)(z,[["render",S]]);var W=A;const $={class:"ion-padding-horizontal"},j={key:1,class:"ion-padding ion-text-center"};function I(t,a,e,i,n,l){const o=(0,s.g2)("ion-icon"),r=(0,s.g2)("ion-label"),d=(0,s.g2)("ion-chip"),c=(0,s.g2)("apexchart");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",$,[(0,s.eW)((0,D.v_)(e.label)+" ",1),e.showDynamics&&e.data.length>0?((0,s.uX)(),(0,s.Wv)(d,{key:0,outline:!0,color:l.dynamicsData.color,class:"ion-no-margin",style:{"font-size":"12px",border:"none"}},{default:(0,s.k6)(()=>[(0,s.bF)(o,{icon:l.dynamicsData.icon},null,8,["icon"]),(0,s.bF)(r,null,{default:(0,s.k6)(()=>[(0,s.eW)((0,D.v_)(l.dynamicsData.value)+"%",1)]),_:1})]),_:1},8,["color"])):(0,s.Q3)("",!0)]),e.data.length>0?((0,s.uX)(),(0,s.Wv)(c,{key:0,type:"bar",height:"370",options:n.chartOptions,series:n.series,ref:"apexChartElement"},null,8,["options","series"])):((0,s.uX)(),(0,s.CE)("div",j,a[0]||(a[0]=[(0,s.Lk)("h2",null,"Недостаточно данных",-1),(0,s.Lk)("p",null,"для показа статистики",-1)])))],64)}var O={components:{IonChip:x.ZB,IonLabel:x.he,IonIcon:x.iq,apexchart:X.A},props:["label","data","format","color","dates","showTotal","showDynamics"],setup(){return{caretUpOutline:R.rHB,caretDownOutline:R.mF9,caretForwardOutline:R.d2Q}},data(){return{value:0,series:this.data,chartOptions:{chart:{type:"bar",height:350,stacked:!0,zoom:{enabled:!1},toolbar:{show:!1}},dataLabels:{enabled:!1},plotOptions:{bar:{horizontal:!1,columnWidth:"35%",dataLabels:{total:{enabled:this.showTotal,formatter:function(t,a){return"Всего: \n"+t},style:{fontSize:"13px"}}}}},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},fill:{opacity:1}}}},computed:{datesParsed(){return this.getDates(this.dates)},dynamicsData(){var t=0,a=0;for(var e in this.data){if(this.data[e].data.lenght<2)break;t+=this.data[e].data[this.data.length-1],a+=this.data[e].data[this.data.length-2]}const s=((t-a)/((t+a)/2)*100||0).toFixed(2);var i="medium",n=R.d2Q;return s>0&&(i="danger",n=R.rHB),s<0&&(i="success",n=R.mF9),{value:s,color:i,icon:n}}},methods:{initChart(){this.$refs.apexChartElement&&(this.$refs.apexChartElement.updateSeries(this.data),this.$refs.apexChartElement.updateOptions({xaxis:{categories:this.datesParsed}}))},getDates(t){let a=[];for(let e=0;e<t.length;e++)a.unshift(new Date(t[e]).toLocaleString("ru",{day:"numeric",month:"long"}));return a}},mounted(){setTimeout(()=>{this.initChart()},100)},updated(){setTimeout(()=>{this.initChart()},1)}};const T=(0,F.A)(O,[["render",I]]);var G=T;const B={class:"ion-padding-horizontal"},Q={key:0,class:"table",style:{"overflow-x":"auto"}},H={key:1,class:"ion-padding ion-text-center"};function K(t,a,e,i,n,l){const o=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("h6",B,(0,D.v_)(e.label),1),n.list.length>0?((0,s.uX)(),(0,s.CE)("div",Q,[a[0]||(a[0]=(0,s.Lk)("div",{class:"table_h"},[(0,s.Lk)("div",null,"#"),(0,s.Lk)("div",null,"Продавец"),(0,s.Lk)("div",null,"Показы")],-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.list,(t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"table_r"},[(0,s.Lk)("div",null,(0,D.v_)(a+1),1),(0,s.Lk)("div",null,[(0,s.bF)(o,{to:`/catalog/${t.act_group}-${t.act_target_id}`},{default:(0,s.k6)(()=>[(0,s.eW)((0,D.v_)(t.act_description),1)]),_:2},1032,["to"])]),(0,s.Lk)("div",null,(0,D.v_)(t.total),1)]))),128))])):((0,s.uX)(),(0,s.CE)("div",H,a[1]||(a[1]=[(0,s.Lk)("h2",null,"Недостаточно данных",-1),(0,s.Lk)("p",null,"для показа статистики",-1)])))],64)}var q={components:{},props:["label","data","format","color","dates"],setup(){return{}},data(){return{value:0,list:this.data}},methods:{}};const M=(0,F.A)(q,[["render",K],["__scopeId","data-v-2996913c"]]);var Z=M,U=e(2311),V=e.n(U),Y={components:{IonChip:x.ZB,IonLabel:x.he,IonIcon:x.iq,StatisticsStackedBarTimeline:G,StatisticsRadialPie:W,StatisticsRatingList:Z},setup(){return{printOutline:R.SfY}},data(){return{dataset:[],totalDates:[],datasetPie:{},datasetRatingLists:{},datasetRejections:[],rejectionDates:[]}},async mounted(){await this.analysisGet(),await this.topRatingGet(),this.rejectionAnalysisGet()},methods:{async analysisGet(){const t=await V().post(`${this.$heap.state.hostname}Statistics/totalOrderAnalysisGet`,{point_span:7,point_num:10});t.body.reverse(),this.parseAnalysisResponse(t.body),this.parsePieStatisticResponse(t.body),this.totalDates=this.parseDates(t.body)},async topRatingGet(){const t=await V().post(`${this.$heap.state.hostname}Statistics/ratingAnalysisGet`,{point_span:7,point_num:10});this.datasetRatingLists=t.body},async rejectionAnalysisGet(){const t=await V().post(`${this.$heap.state.hostname}Statistics/rejectionAnalysisGet`,{point_span:7,point_num:10});t.body.reverse(),this.parseRejectionResponse(t.body),this.rejectionDates=this.parseDates(t.body)},parseAnalysisResponse(t){const a={create:"Начало оформления",start:"Оформление",finish:"Завершение"},e={success:"Успех",failure:"Ошибка"};for(var s in a)for(var i in e){let l={name:a[s]+" ("+e[i]+")",group:s,data:[]};for(var n in t)l.data.push(1*t[n][s+"_"+i]);this.dataset.push(l)}},parsePieStatisticResponse(t){const a={pay:"Оплаты"},e={success:"Успех",failure:"Ошибка"},s=t[t.length-1];for(var i in a)for(var n in this.datasetPie[i]={labels:[],series:[]},e)s[i+"_"+n]&&(this.datasetPie[i].series.push(1*s[i+"_"+n]),this.datasetPie[i].labels.push(e[n]));this.datasetPie.completed={series:[1*s.finish_success-1*s.reject_success,1*s.reject_success],labels:["Исполнен","Отказ"]}},parseRejectionResponse(t){const a={home:"Главная",store:"Продавец",product:"Товар",location:"Локация",auth:"Вход"};for(var e in a){let i={name:a[e],data:[]};for(var s in t)i.data.push(1*t[s][e]);this.datasetRejections.push(i)}},parseDates(t){let a=[];for(var e in t)a.unshift(t[e].point_finish);return a},reportPrint(){var t;null===(t=document.getElementById("printPage"))||void 0===t||t.remove(),document.body.setAttribute("class","print");let a=document.getElementById("analysisPage"),e=document.createElement("DIV");e.setAttribute("id","printPage"),e.innerHTML=a.innerHTML,document.body.appendChild(e),setTimeout(window.print(),500)}}};const J=(0,F.A)(Y,[["render",w]]);var N=J}}]);
//# sourceMappingURL=8763.78794ff7.js.map