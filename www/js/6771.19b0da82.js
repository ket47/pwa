"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[6771],{6771:function(t,e,i){i.r(e),i.d(e,{default:function(){return g}});var o=i(641),a=i(33);const s={key:0},n={key:1};function l(t,e,i,l,d,r){const c=(0,o.g2)("ion-searchbar"),u=(0,o.g2)("ion-input"),p=(0,o.g2)("ion-button"),m=(0,o.g2)("ion-item"),_=(0,o.g2)("ion-content"),h=(0,o.g2)("ion-popover"),g=(0,o.g2)("ion-img"),b=(0,o.g2)("ion-thumbnail"),f=(0,o.g2)("ion-text"),k=(0,o.g2)("ion-icon"),y=(0,o.g2)("ion-chip"),v=(0,o.g2)("ion-label"),I=(0,o.g2)("ion-list"),C=(0,o.g2)("ion-skeleton-text"),F=(0,o.g2)("ion-card-content"),$=(0,o.g2)("ion-card"),w=(0,o.g2)("ion-infinite-scroll-content"),D=(0,o.g2)("ion-infinite-scroll"),W=(0,o.g2)("base-layout");return(0,o.uX)(),(0,o.Wv)(W,{pageDefaultBackLink:`/catalog/store-edit-${d.storeId}`,"page-title":"Управление товарами"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",null,[(0,o.bF)(c,{placeholder:"Фильтр",modelValue:d.filter,"onUpdate:modelValue":e[0]||(e[0]=t=>d.filter=t)},null,8,["modelValue"]),(0,o.bF)(h,{"is-open":d.editor_opened,onDidDismiss:e[2]||(e[2]=t=>d.editor_opened=0)},{default:(0,o.k6)((()=>[(0,o.bF)(_,{style:{}},{default:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>[(0,o.bF)(u,{placeholder:d.editor_placeholder,modelValue:d.editor_value,"onUpdate:modelValue":e[1]||(e[1]=t=>d.editor_value=t),style:{"--border-width":"1px","--border-radius":"10px"}},null,8,["placeholder","modelValue"]),(0,o.bF)(p,{slot:"end"},{default:(0,o.k6)((()=>[(0,o.eW)("OK")])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open"]),r.listComputed.length>0?((0,o.uX)(),(0,o.Wv)(I,{key:0},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.listComputed,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.item_id},[(0,o.bF)(m,{lines:"none",onClick:t=>r.itemEdit(e),button:"",detail:""},{default:(0,o.k6)((()=>[(0,o.bF)(b,{slot:"start",class:(0,a.C4)(e.class),style:{"border-radius":"10px"}},{default:(0,o.k6)((()=>[(0,o.bF)(g,{src:`${t.$heap.state.hostname}image/get.php/${e.image_hash}.150.150.webp`},null,8,["src"])])),_:2},1032,["class"]),(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.item_name)+" ",1),1==e.is_counted&&1*e.product_quantity==0?((0,o.uX)(),(0,o.CE)("span",s," (нет в наличии)")):(0,o.Q3)("",!0),1==e.is_hidden?((0,o.uX)(),(0,o.CE)("span",n," (скрыт)")):(0,o.Q3)("",!0)])),_:2},1024)])),_:2},1032,["onClick"]),(0,o.bF)(m,{lines:"full"},{default:(0,o.k6)((()=>[1==e.is_hidden?((0,o.uX)(),(0,o.Wv)(y,{key:0,onClick:t=>r.itemUpdate(e.product_id,"is_hidden",0),color:"warning"},{default:(0,o.k6)((()=>[(0,o.bF)(k,{src:l.eyeOffOutline},null,8,["src"]),(0,o.eW)("   ")])),_:2},1032,["onClick"])):((0,o.uX)(),(0,o.Wv)(y,{key:1,onClick:t=>r.itemUpdate(e.product_id,"is_hidden",1),color:"medium"},{default:(0,o.k6)((()=>[(0,o.bF)(k,{src:l.eyeOffOutline},null,8,["src"]),(0,o.eW)("   ")])),_:2},1032,["onClick"])),1==e.is_counted?((0,o.uX)(),(0,o.Wv)(y,{key:2,color:e.product_quantity>0?"success":"danger",onClick:t=>r.itemPrompt(e,"product_quantity","введите остаток")},{default:(0,o.k6)((()=>[(0,o.bF)(k,{src:l.calculatorOutline},null,8,["src"]),(0,o.bF)(v,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.product_quantity||0)+(0,a.v_)(e.product_unit),1)])),_:2},1024)])),_:2},1032,["color","onClick"])):((0,o.uX)(),(0,o.Wv)(y,{key:3,onClick:t=>r.itemUpdate(e.product_id,"is_counted",1),color:"medium"},{default:(0,o.k6)((()=>[(0,o.bF)(k,{src:l.calculatorOutline},null,8,["src"]),(0,o.bF)(k,{src:l.infiniteOutline},null,8,["src"]),(0,o.eW)("   ")])),_:2},1032,["onClick"])),(0,o.bF)(y,{color:"primary",onClick:t=>r.itemPrompt(e,"product_price","введите цену")},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(e.product_price)+(0,a.v_)(t.$heap.state.currencySign),1)])),_:2},1032,["onClick"])])),_:2},1024)])))),128))])),_:1})):1==d.is_loading?((0,o.uX)(),(0,o.Wv)(I,{key:1},{default:(0,o.k6)((()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)([1,2,3],(t=>(0,o.bF)(m,{key:t,button:"",detail:""},{default:(0,o.k6)((()=>[(0,o.bF)(b,{slot:"start",style:{"background-color":"lightgray"}}),(0,o.bF)(C,{animated:""})])),_:2},1024))),64))])),_:1})):((0,o.uX)(),(0,o.Wv)($,{key:2,color:"light"},{default:(0,o.k6)((()=>[(0,o.bF)(F,null,{default:(0,o.k6)((()=>[(0,o.eW)(" Ничего не найдено ")])),_:1})])),_:1})),(0,o.bF)(D,{onIonInfinite:e[3]||(e[3]=t=>r.listLoadMore(t)),id:"moderation-infinite-scroll"},{default:(0,o.k6)((()=>[(0,o.bF)(w,{"loading-spinner":"bubbles","loading-text":"Loading more data..."})])),_:1})])])),_:1},8,["pageDefaultBackLink"])}i(4114);var d=i(5654),r=i(2311),c=i.n(r),u=i(9119),p=i(5480),m={components:{IonInfiniteScroll:d.Ax,IonInfiniteScrollContent:d.Hp,IonItem:d.uz,IonList:d.nf,IonImg:d.KW,IonThumbnail:d.Zx,IonText:d.IO,IonSkeletonText:d.ds,IonCard:d.b_,IonCardContent:d.I9,IonSearchbar:d.S1,IonChip:d.ZB,IonIcon:d.iq,IonPopover:d.CF,IonContent:d.W9,IonInput:d.$w,IonButton:d.Jm},setup(){return{infiniteOutline:p.p4N,calculatorOutline:p.N0h,eyeOffOutline:p.f_X}},data(){return{storeId:this.$route.params.id,items:[],item_type:"active",filter:"",is_loading:0,moderationType:"products",holders:{store:"Поставщик",courier:"Курьер",product:"Товар",order:"Заказ",product_group_list:"Категория товара",location_group_list:"Категория местоп.",store_group_list:"Категория поставщ.",user_group_list:"Категория пользователя"},editor_opened:0,editor_value:null,editor_placeholder:""}},computed:{listComputed(){let t=[];for(let e of this.items){let i=Object.assign({},e);i.item_id=i.product_id,i.item_name=i.product_name,i.date_time=this.toLocDateTime(i.updated_at),i.class="",i.class+=i.deleted_at?"deleted ":"",i.class+=1==i.is_disabled?"disabled ":"",i.class+=1==i.is_hidden?"hidden ":"",i.class+=1==i.is_counted&&0==i.product_quantity?"absent ":"",t.push(i)}return t}},methods:{async listLoadMore(t){await this.listLoad(),t.target.complete()},async listReload(){this.items=[],this.listLoad()},async listLoad(){let t={is_disabled:"disabled"==this.item_type?1:0,is_active:"active"==this.item_type?1:0,is_deleted:"deleted"==this.item_type?1:0,name_query:this.filter,offset:this.items.length,limit:15};try{let e;if(this.is_loading=1,"products"==this.moderationType){t.name_query_fields="product_name",t.reverse="updated_at",t.store_id=this.storeId;const i=await c().post(`${this.$heap.state.hostname}Product/listGet`,t);e=i.product_list}this.is_loading=0,this.items=this.items.concat(e)}catch(e){}},listTypeChanged(t){t.target.value;this.items=[],this.listLoad()},listFilter(){clearTimeout(this.clock),this.clock=setTimeout((()=>{this.listReload()}),300)},toLocDate(t){const e=new Date(Date.parse(t)),i={month:"short",day:"numeric"};return e.toLocaleDateString(void 0,i)},toLocDateTime(t){const e=new Date(Date.parse(t)),i={month:"short",day:"numeric",hour:"numeric",minute:"numeric"};return e.toLocaleDateString(void 0,i)},async itemPrompt(t,e,i){const o=t[e],a={header:i,buttons:[{text:"Ок",role:"confirm"},{text:"Отмена",role:"cancel"}],inputs:[{type:"input",name:"comment",placeholder:i,value:o}]};"product_quantity"==e&&a.buttons.push({text:"Бесконечное кол-во",role:"notcount"});const s=await d.TN.create(a);await s.present();const{data:n,role:l}=await s.onDidDismiss();"cancel"!=l&&("notcount"!=l?this.itemUpdate(t.product_id,e,n.values.comment):this.itemUpdate(t.product_id,"is_counted",0))},async itemUpdate(t,e,i){try{const o={product_id:t,[e]:i};await c().post(`${this.$heap.state.hostname}Product/itemUpdate`,JSON.stringify(o)),this.itemAlter(t,e,i),this.$flash("💾 Сохранено")}catch(s){var o,a;const t=null===s||void 0===s||null===(o=s.responseJSON)||void 0===o||null===(a=o.messages)||void 0===a?void 0:a.error;if("idle"==t)return;this.$flash("Не сохранено")}},itemAlter(t,e,i){for(let o in this.items)this.items[o].product_id==t&&(this.items[o][e]=i)},itemEdit(t){"images"==this.moderationType&&this.imageEdit(t),"products"==this.moderationType&&this.$go("/catalog/product-edit-"+t.product_id),"stores"==this.moderationType&&this.$go("/catalog/store-edit-"+t.store_id),"couriers"==this.moderationType&&this.$go("/user/courier-dashboard?courier_id="+t.courier_id)},async imageEdit(t){const e={delete:["Удалить","danger"],postpone:["Потом","primary"],enable:["Ок","success"]},i=await d.OZ.create({component:u.A,componentProps:{image_hash:t.image_hash,actions:e},initialBreakpoint:.75,breakpoints:[.75,1]});this.$topic.on("dismissModal",(()=>{i.dismiss()})),i.present();const o=await i.onDidDismiss();"delete"==o.role&&await this.imageDelete(t),"enable"==o.role&&await this.imageEnable(t),"postpone"==o.role&&await this.imagePostpone(t),this.listReload()},async imageEnable(t){await c().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:t.image_id,is_disabled:0})},async imagePostpone(t){await c().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:t.image_id,is_disabled:0}),await c().post(`${this.$heap.state.hostname}Image/itemDisable`,{image_id:t.image_id,is_disabled:1})},async imageDelete(t){await c().post(`${this.$heap.state.hostname}Image/itemDelete`,{image_id:t.image_id})}},mounted(){this.listLoad()},watch:{filter:function(){this.listFilter()}}},_=i(6262);const h=(0,_.A)(m,[["render",l],["__scopeId","data-v-34b325b8"]]);var g=h}}]);
//# sourceMappingURL=6771.19b0da82.js.map