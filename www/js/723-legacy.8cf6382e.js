"use strict";(self["webpackChunktezkel"]=self["webpackChunktezkel"]||[]).push([[723],{723:function(e,n,o){o.r(n),o.d(n,{default:function(){return U}});var l=o(6252),s=o(3577),t=o(9963);const a={novalidate:""},u={style:{display:"grid","grid-template-columns":"100px auto",width:"100%"}},r={"padding-left":""},p={"padding-left":""},i={"padding-left":""};function d(e,n,o,d,h,_){const c=(0,l.up)("ion-card-title"),m=(0,l.up)("ion-card-header"),f=(0,l.up)("ion-card-content"),w=(0,l.up)("ion-card"),k=(0,l.up)("ion-label"),g=(0,l.up)("ion-input"),v=(0,l.up)("ion-text"),W=(0,l.up)("ion-item"),I=(0,l.up)("ion-list"),b=(0,l.up)("ion-button"),y=(0,l.up)("ion-col"),x=(0,l.up)("ion-row"),$=(0,l.up)("ion-grid"),V=(0,l.up)("base-layout");return(0,l.wg)(),(0,l.j4)(V,{"page-title":"Вход в систему",pageDefaultBackLink:"/user"},{default:(0,l.w5)((()=>[e.$heap.state.user.user_id>0?((0,l.wg)(),(0,l.j4)(w,{key:0,style:{"background-color":"var(--ion-color-success-tint)"}},{default:(0,l.w5)((()=>[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(e.$heap.state.user.user_name)+" "+(0,s.zw)(e.$heap.state.user.user_surname)+" "+(0,s.zw)(e.$heap.state.user.user_middlename),1)])),_:1})])),_:1}),(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Uk)(" Вы уже вошли в систему с номером телефона "),(0,l._)("b",null,(0,s.zw)(e.$heap.state.user.user_phone),1)])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l._)("form",a,[(0,l.Wm)(I,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{lines:"full"},{default:(0,l.w5)((()=>[(0,l._)("div",u,[(0,l._)("div",null,[(0,l.Wm)(k,{position:"stacked"},{default:(0,l.w5)((()=>[(0,l.Uk)("Код")])),_:1}),(0,l.Wm)(g,{readonly:""},{default:(0,l.w5)((()=>[(0,l.Uk)("+7")])),_:1})]),(0,l._)("div",null,[(0,l.Wm)(k,{position:"stacked"},{default:(0,l.w5)((()=>[(0,l.Uk)("Мобильный телефон*")])),_:1}),(0,l.Wm)(g,{modelValue:h.user_phone,"onUpdate:modelValue":n[0]||(n[0]=e=>h.user_phone=e),onIonChange:n[1]||(n[1]=e=>_.phoneFormat()),name:"phone",type:"tel",inputmode:"tel",placeholder:"(xxx)xxxxxxxxx",required:""},null,8,["modelValue"]),(0,l.Wm)(v,{color:"danger",slot:"helper"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("p",r,"Неверный номер телефона",512),[[t.F8,!_.phoneValid&&1==h.submitted]])])),_:1})])]),(0,l.Wm)(v,{color:"danger",slot:"helper"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("p",p,"Неверный номер телефона",512),[[t.F8,!_.phoneValid&&1==h.submitted]])])),_:1})])),_:1}),(0,l.Wm)(W,{lines:"full"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{position:"stacked"},{default:(0,l.w5)((()=>[(0,l.Uk)("Пароль (Минимум 4 символа)*")])),_:1}),(0,l.Wm)(g,{modelValue:h.user_pass,"onUpdate:modelValue":n[2]||(n[2]=e=>h.user_pass=e),name:"password",type:"password",autocorrect:"off",placeholder:"Пароль (Минимум 4 символа)",required:""},null,8,["modelValue"]),(0,l.Wm)(v,{color:"danger",slot:"helper"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("p",i,"Пароль должен содержать не менее 4 символов.",512),[[t.F8,!_.passwordValid&&1==h.submitted]])])),_:1})])),_:1})])),_:1}),(0,l.Wm)($,null,{default:(0,l.w5)((()=>[(0,l.Wm)(x,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,{onClick:_.onSubmit,expand:"block"},{default:(0,l.w5)((()=>[(0,l.Uk)("Войти")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,l.Wm)(x,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,{color:"light",expand:"block",onClick:n[3]||(n[3]=n=>e.$router.push({path:"/user/sign-up"}))},{default:(0,l.w5)((()=>[(0,l.Uk)("Зарегистрироваться")])),_:1})])),_:1})])),_:1}),(0,l.Wm)(x,{"responsive-sm":""},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(b,{onClick:_.openModal,color:"light",expand:"block"},{default:(0,l.w5)((()=>[(0,l.Uk)("Забыли пароль?")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])])),_:1})}var h=o(8534),_=(o(4916),o(5306),o(8862),o(1632));const c={novalidate:""},m=(0,l._)("div",{style:{padding:"15px","font-size":"0.8em",color:"#999"}}," Рекомендуем сначала проверить СМС сообщение с паролем, которое было выслано вам при регистрации в сервисе. ",-1),f=(0,l._)("a",{href:"#"},"службу поддержки",-1);function w(e,n,o,s,t,a){const u=(0,l.up)("ion-title"),r=(0,l.up)("ion-icon"),p=(0,l.up)("ion-toolbar"),i=(0,l.up)("ion-header"),d=(0,l.up)("ion-input"),h=(0,l.up)("ion-item"),_=(0,l.up)("ion-list"),w=(0,l.up)("ion-button"),k=(0,l.up)("ion-content");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(i,null,{default:(0,l.w5)((()=>[(0,l.Wm)(p,null,{default:(0,l.w5)((()=>[(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Uk)("Восстановление пароля")])),_:1}),(0,l.Wm)(r,{slot:"end",onClick:n[0]||(n[0]=e=>{a.closeModal()}),icon:s.closeOutline,size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[(0,l._)("form",c,[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"Ваш номер телефона","label-placement":"stacked",modelValue:t.userphone,"onUpdate:modelValue":n[1]||(n[1]=e=>t.userphone=e),placeholder:"Ваш телефон"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(d,{label:"Ваш ник","label-placement":"stacked",modelValue:t.username,"onUpdate:modelValue":n[2]||(n[2]=e=>t.username=e),placeholder:"Имя, указанное вами при регистрации"},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(w,{onClick:n[3]||(n[3]=e=>a.passwordReset()),expand:"full"},{default:(0,l.w5)((()=>[(0,l.Uk)("Создать новый пароль")])),_:1})]),m,(0,l._)("div",{style:{padding:"15px","font-size":"0.8em"},onClick:n[4]||(n[4]=n=>e.$router.push("page/contacts"))},[(0,l.Uk)(" Если у вас возникли сложности с восстановлением пароля, обращайтесь в "),f])])),_:1})],64)}var k=o(8903),g=o(9755),v=o.n(g),W={components:{IonContent:_.W2,IonHeader:_.Gu,IonTitle:_.wd,IonToolbar:_.sr,IonList:_.q_,IonItem:_.Ie,IonInput:_.pK,IonButton:_.YG,IonIcon:_.gu,IonLabel:_.Q$},props:["phone"],setup(){return{closeOutline:k.fID}},data(){return{username:"",userphone:this.phone}},methods:{closeModal(){return _.Fy.dismiss()},passwordReset(){var e=this;return(0,h.Z)((function*(){let n={user_phone:"+"+e.userphone.replace(/\D/g,""),user_name:e.username};try{yield v().post(`${e.$heap.state.hostname}User/passwordReset`,n),e.$flash(`Ваш новый пароль выслан на номер '${e.userphone}'`)}catch(s){var o,l;const n=null===s||void 0===s||null===(o=s.responseJSON)||void 0===o||null===(l=o.messages)||void 0===l?void 0:l.error;"user_notfound"==n?e.$flash(`Пользователь с телефоном '${e.userphone}' и именем '${e.username}' не найден`):e.$flash("Не удалось восстановить пароль")}e.closeModal()}))()}}},I=o(3744);const b=(0,I.Z)(W,[["render",w]]);var y=b,x=o(351),$=o(8709),V={components:{IonLabel:_.Q$,IonCol:_.wI,IonInput:_.pK,IonRow:_.Nd,IonText:_.yW,IonButton:_.YG,IonGrid:_.jY,IonCard:_.PM,IonCardHeader:_.Zi,IonCardTitle:_.Dq,IonCardContent:_.FN,IonList:_.q_,IonItem:_.Ie},data(){return{submitted:!1,user_pass:null,user_phone:null,user_phone_prefix:"7",modalOpen:!1}},computed:{phoneValid(){var e;return 10==(null===(e=this.user_phone)||void 0===e?void 0:e.replace(/\D/g,"").length)},passwordValid(){var e;return(null===(e=this.user_pass)||void 0===e?void 0:e.length)>=4}},created(){var e;const n=JSON.parse(null!==(e=localStorage.signInData)&&void 0!==e?e:"{}");n&&n.user_phone&&(this.user_phone=n.user_phone,this.phoneFormat()),n&&n.user_pass&&(this.user_pass=n.user_pass)},methods:{onSubmit(){var e=this;return(0,h.Z)((function*(){if(e.submitted=!0,!e.phoneValid||!e.passwordValid)return!1;let n={user_phone:e.user_phone_prefix+e.user_phone,user_pass:e.user_pass,user_pass_confirm:e.user_pass};try{yield x.Z.signIn(n),yield x.Z.get(),$.Z.go(-1)}catch(o){const n=o.responseJSON,l=n.messages.error;switch(l){case"user_not_found":e.$flash("Пользователь не найден. Пройдите регистрацию.");break;case"user_pass_wrong":e.$flash("Неверный пароль");break;case"user_is_disabled":e.$flash("Пользователь отключен. Обратитесь к администратору");break;case"user_is_deleted":e.$flash("Пользователь удален. Обратитесь к администратору");break;case"user_phone_unverified":e.$flash("Номер телефона не подтвержден"),localStorage.signInData=JSON.stringify({user_phone:e.user_phone_prefix+e.user_phone,user_pass:e.user_pass}),e.phoneVerify();break;default:e.$flash("Не удалось войти в систему")}}}))()},phoneFormat(){this.user_phone||(this.user_phone="");try{let e=this.user_phone.replace(/\D/g,"");e.length>10&&(e=e.substring(e.length-10)),this.user_phone=e}catch(e){}},openModal(){var e=this;return(0,h.Z)((function*(){var n,o;e.modalOpen=!0;const l=null!==(n=null!==(o=e.user_phone_prefix)&&void 0!==o?o:""+e.user_phone)&&void 0!==n?n:"",s=yield _.Fy.create({component:y,componentProps:{phone:l},initialBreakpoint:.5,breakpoints:[.5,.75]});return s.present()}))()},phoneVerify(){try{this.$heap.state.user.tmp_userphone=this.user_phone_prefix+this.user_phone,this.$go("/user/verify-phone")}catch(e){this.$flash("Не удалось выслать смс с подтверждением")}}}};const C=(0,I.Z)(V,[["render",d],["__scopeId","data-v-98d2caa8"]]);var U=C}}]);
//# sourceMappingURL=723-legacy.8cf6382e.js.map