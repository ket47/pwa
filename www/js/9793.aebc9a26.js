"use strict";(self["webpackChunkTezkel"]=self["webpackChunkTezkel"]||[]).push([[9793],{9793:function(e,l,s){s.r(l),s.d(l,{default:function(){return b}});var t=s(641);const a=["src"],n=["src"],i=(0,t.Lk)("div",null,[(0,t.Lk)("p",null,"Ваши персональные данные будут безвозвратно удалены."),(0,t.Lk)("p",null," Повторная регистрация по этому номеру телефона будет невозможна! ")],-1);function o(e,l,s,o,r,u){const d=(0,t.g2)("ion-icon"),h=(0,t.g2)("ion-input"),p=(0,t.g2)("ion-item"),_=(0,t.g2)("ion-button"),c=(0,t.g2)("ion-label"),f=(0,t.g2)("ion-list-header"),b=(0,t.g2)("ion-avatar"),m=(0,t.g2)("ion-segment-button"),k=(0,t.g2)("ion-segment"),g=(0,t.g2)("ion-list"),F=(0,t.g2)("ion-item-divider"),v=(0,t.g2)("ion-col"),y=(0,t.g2)("ion-row"),w=(0,t.g2)("ion-title"),$=(0,t.g2)("ion-toolbar"),V=(0,t.g2)("ion-header"),O=(0,t.g2)("ion-content"),I=(0,t.g2)("ion-modal"),S=(0,t.g2)("base-layout");return(0,t.uX)(),(0,t.Wv)(S,{"page-title":"Мой профиль"},{default:(0,t.k6)((()=>[(0,t.bF)(g,null,{default:(0,t.k6)((()=>[(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.personOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(h,{modelValue:r.fields.user_name,"onUpdate:modelValue":l[0]||(l[0]=e=>r.fields.user_name=e),name:"user_name",type:"text",onChange:l[1]||(l[1]=e=>u.save("user_name",e.target.value)),placeholder:"как к вам обращаться?",label:"Ваш псевдоним","label-placement":"stacked",required:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.giftOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(h,{modelValue:r.fields.user_birthday,"onUpdate:modelValue":l[2]||(l[2]=e=>r.fields.user_birthday=e),placeholder:"День рождения",label:"День рождения","label-placement":"stacked",name:"user_birthday",type:"date",onChange:l[3]||(l[3]=e=>u.save("user_birthday",e.target.value)),readonly:r.birthday_is_set},null,8,["modelValue","readonly"])])),_:1}),(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.callOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(h,{readonly:"",modelValue:r.fields.user_phone,"onUpdate:modelValue":l[4]||(l[4]=e=>r.fields.user_phone=e),label:"Телефон","label-placement":"stacked"},null,8,["modelValue"]),!r.fields.user_phone||r.fields.user_phone_verified&&"0"!==r.fields.user_phone_verified?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(_,{key:0,slot:"end",onClick:u.phoneVerify,expand:"block"},{default:(0,t.k6)((()=>[(0,t.eW)("Подтвердить")])),_:1},8,["onClick"])),r.fields.user_phone&&r.fields.user_phone_verified&&"0"!==r.fields.user_phone_verified?((0,t.uX)(),(0,t.Wv)(_,{key:1,slot:"end",expand:"block",disabled:"true"},{default:(0,t.k6)((()=>[(0,t.eW)("Подтверждено")])),_:1})):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.atOutline,slot:"start"},null,8,["icon"]),(0,t.bF)(h,{modelValue:r.fields.user_email,"onUpdate:modelValue":l[5]||(l[5]=e=>r.fields.user_email=e),name:"user_email",type:"email",onChange:l[6]||(l[6]=e=>u.save("user_email",e.target.value)),placeholder:"Электронная почта",label:"Электронная почта","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,t.bF)(f,null,{default:(0,t.k6)((()=>[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.eW)("Аватар")])),_:1})])),_:1}),(0,t.bF)(p,{lines:"none"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{mode:"ios",modelValue:r.fields.user_avatar_name,"onUpdate:modelValue":l[7]||(l[7]=e=>r.fields.user_avatar_name=e),onIonChange:l[8]||(l[8]=e=>u.save("user_avatar_name",e.target.value))},{default:(0,t.k6)((()=>[(0,t.bF)(m,{value:"man"},{default:(0,t.k6)((()=>[(0,t.bF)(b,null,{default:(0,t.k6)((()=>[(0,t.Lk)("img",{src:e.$heap.state.hostname+"img/avatar/man.png"},null,8,a)])),_:1})])),_:1}),(0,t.bF)(m,{value:"woman"},{default:(0,t.k6)((()=>[(0,t.bF)(b,null,{default:(0,t.k6)((()=>[(0,t.Lk)("img",{src:e.$heap.state.hostname+"img/avatar/woman.png"},null,8,n)])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,t.bF)(F,null,{default:(0,t.k6)((()=>[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.eW)("Пароль")])),_:1})])),_:1}),(0,t.bF)(y,{"responsive-sm":""},{default:(0,t.k6)((()=>[(0,t.bF)(v,null,{default:(0,t.k6)((()=>[(0,t.bF)(_,{onClick:l[9]||(l[9]=e=>u.passwordReset()),expand:"block",color:"medium",fill:"outline"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,t.eW)("Сбросить")])),_:1})])),_:1}),(0,t.bF)(v,null,{default:(0,t.k6)((()=>[(0,t.bF)(_,{onClick:l[10]||(l[10]=e=>r.passwordPromptShow=!0),expand:"block",color:"medium",fill:"outline"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.keyOutline,slot:"start"},null,8,["icon"]),(0,t.eW)("Изменить ")])),_:1})])),_:1})])),_:1}),(0,t.bF)(F,null,{default:(0,t.k6)((()=>[(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.eW)("Удаление профиля")])),_:1})])),_:1}),(0,t.bF)(y,{"responsive-sm":""},{default:(0,t.k6)((()=>[(0,t.bF)(v,null,{default:(0,t.k6)((()=>[(0,t.bF)(_,{onClick:l[11]||(l[11]=e=>r.deletePromptShow=!0),expand:"block",fill:"outline",color:"danger"},{default:(0,t.k6)((()=>[(0,t.bF)(d,{icon:o.trashOutline,slot:"start"},null,8,["icon"]),(0,t.eW)(" Удалить профиль ")])),_:1})])),_:1}),(0,t.bF)(v)])),_:1}),(0,t.bF)(I,{isOpen:r.passwordPromptShow,"initial-breakpoint":.8,breakpoints:[0,.4,.8]},{default:(0,t.k6)((()=>[(0,t.bF)(V,null,{default:(0,t.k6)((()=>[(0,t.bF)($,null,{default:(0,t.k6)((()=>[(0,t.bF)(w,null,{default:(0,t.k6)((()=>[(0,t.eW)("Новый пароль")])),_:1}),(0,t.bF)(d,{icon:o.closeOutline,onClick:l[12]||(l[12]=e=>r.passwordPromptShow=!1),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,t.bF)(O,{class:"ion-padding"},{default:(0,t.k6)((()=>[(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:r.fields.user_pass_current,"onUpdate:modelValue":l[13]||(l[13]=e=>r.fields.user_pass_current=e),type:"password",placeholder:"нет пароля",label:"Действующий пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:r.fields.user_pass,"onUpdate:modelValue":l[14]||(l[14]=e=>r.fields.user_pass=e),type:"text",placeholder:"пароль",label:"Новый пароль","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,t.bF)(p,null,{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:r.fields.user_pass_confirm,"onUpdate:modelValue":l[15]||(l[15]=e=>r.fields.user_pass_confirm=e),type:"text",placeholder:"пароль (повтор)",label:"Новый пароль (повтор)","label-placement":"stacked"},null,8,["modelValue"])])),_:1}),(0,t.bF)(_,{onClick:l[16]||(l[16]=e=>u.passwordSave()),expand:"block"},{default:(0,t.k6)((()=>[(0,t.eW)("Изменить")])),_:1})])),_:1})])),_:1},8,["isOpen"]),(0,t.bF)(I,{isOpen:r.deletePromptShow,"initial-breakpoint":.8,breakpoints:[0,.4,.8]},{default:(0,t.k6)((()=>[(0,t.bF)(V,null,{default:(0,t.k6)((()=>[(0,t.bF)($,{color:"danger"},{default:(0,t.k6)((()=>[(0,t.bF)(w,null,{default:(0,t.k6)((()=>[(0,t.eW)("Удаление учетной записи")])),_:1}),(0,t.bF)(d,{icon:o.closeOutline,onClick:l[17]||(l[17]=e=>r.deletePromptShow=!1),slot:"end",size:"large"},null,8,["icon"])])),_:1})])),_:1}),(0,t.bF)(O,{class:"ion-padding"},{default:(0,t.k6)((()=>[(0,t.bF)(p,{lines:"none",style:{"margin-bottom":"15px"}},{default:(0,t.k6)((()=>[i])),_:1}),(0,t.bF)(_,{onClick:l[18]||(l[18]=e=>u.deleteAccount()),expand:"block",color:"danger"},{default:(0,t.k6)((()=>[(0,t.eW)("Удалить аккаунт")])),_:1}),(0,t.bF)(_,{onClick:l[19]||(l[19]=e=>r.deletePromptShow=!1),expand:"block",color:"light"},{default:(0,t.k6)((()=>[(0,t.eW)("Закрыть")])),_:1})])),_:1})])),_:1},8,["isOpen"])])),_:1})}var r=s(5654),u=s(5480),d=s(2311),h=s.n(d),p=s(8701),_={components:{IonList:r.nf,IonItem:r.uz,IonLabel:r.he,IonInput:r.$w,IonCol:r.hU,IonRow:r.ln,IonItemDivider:r.Dg,IonButton:r.Jm,IonModal:r.Sb,IonHeader:r.eU,IonTitle:r.BC,IonContent:r.W9,IonIcon:r.iq,IonToolbar:r.ai,IonSegment:r.Gp,IonSegmentButton:r.eP,IonAvatar:r.mC,IonListHeader:r.AF},setup(){return{closeOutline:u.xfX,keyOutline:u.uNo,trashOutline:u.P1A,callOutline:u.bNN,personOutline:u.wAZ,atOutline:u.WFd,giftOutline:u.Lsq}},data(){return{config:{phoneMask:"+0(000)-000-00-00"},fields:this.$heap.state.user,passwordPromptShow:!1,deletePromptShow:!1,birthday_is_set:0}},computed:{isPhoneValid(){return 11==this.fields.user_phone.replace(/\D/g,"").length}},methods:{async save(e,l){if("user_phone"==e){if(!this.isPhoneValid)return!1;l=l.replace(/\D/g,"")}var s={};s.user_id=this.$heap.state.user.user_id,s[e]=l,await this.itemUpdate(s),this.fields[e]=l},async itemUpdate(e){try{const l=await h().post(`${this.$heap.state.hostname}User/itemUpdate`,JSON.stringify(e));if("ok"==l)return this.$flash("Сохранено"),!0}catch(l){let e="unknown";try{const s=Object.keys(JSON.parse(l.responseJSON.messages.error))[0],t=Object.values(JSON.parse(l.responseJSON.messages.error))[0];e=s+"_"+t}catch{}switch(e){case"user_phone_notunique":this.$flash("Пользователь с таким телефоном уже зарегистрирован");break;case"user_phone_required":case"user_phone_invalid":case"user_phone_short":this.$flash("Проверьте номер телефона");break;case"user_name_required":case"user_name_short":this.$flash("Проверьте ваш псевдоним");break;case"user_email_invalid":this.$flash("Проверьте ваш е-маил");break;case"user_email_notunique":this.$flash("Такой е-маил уже используется");break;case"user_pass_short":this.$flash("Пароль слишком короткий");break;case"user_pass_wrong":this.$flash("Действующий пароль не верный");break;case"user_pass_notmatches":this.$flash("Пароль не совпадает с подтверждением");break}return!1}p.A.get()},phoneVerify(){const e=this.fields.user_phone.replace(/\D/g,"");try{h().post(`${this.$heap.state.hostname}User/phoneVerificationSend`,{user_phone:e}),this.$go({name:"UserVerifyPhone",params:{phone:e}})}catch{}},async passwordSave(){if(this.fields.user_pass!=this.fields.user_pass_confirm)return void this.$flash("Пароль и подтверждение не совпадают");if(!this.fields.user_pass)return void this.$flash("Пароль не заполнен");const e={user_id:this.$heap.state.user.user_id,user_pass:this.fields.user_pass,user_pass_current:this.fields.user_pass_current},l=await this.itemUpdate(e);l&&(this.passwordPromptShow=!1,this.$flash("Пароль изменен"))},async passwordReset(){if(!confirm("Выслать новый пароль на телефон и электронную почту?"))return;const e={user_phone:this.fields.user_phone,user_email:this.fields.user_email,user_name:this.fields.user_name};try{await h().post(`${this.$heap.state.hostname}User/passwordReset`,e),this.$alert("Вам был выслан новый пароль","Пароль сброшен")}catch{}},async deleteAccount(){try{const e={user_id:this.$heap.state.user.user_id};await h().post(`${this.$heap.state.hostname}User/itemDelete`,e),this.deletePromptShow=!1,await p.A.signOut(),await this.$go("/user")}catch{this.$flash("Не удалось удалить аккаунт. Проверьте пароль")}},isPhoneValidate(e){this.fields.user_phone=e.target.value,this.fields.user_phone=this.fields.user_phone.replace(/\D/g,""),this.fields.user_phone.length>11&&(this.fields.user_phone=this.fields.user_phone.substring(0,11));let l="",s=0;for(let t in this.config.phoneMask){if(!this.fields.user_phone[s])break;let e=this.config.phoneMask[t];"0"==e?(l+=this.fields.user_phone[s],s++):l+=e}return this.fields.user_phone=l,this.fields.user_phone}},created(){this.$topic.on("userGet",(e=>{this.fields=e,this.fields["user_birthday"]&&(this.fields["user_birthday"]=this.fields["user_birthday"].split(" ")[0]),this.birthday_is_set=!!e.user_birthday}))}},c=s(6262);const f=(0,c.A)(_,[["render",o]]);var b=f}}]);
//# sourceMappingURL=9793.aebc9a26.js.map